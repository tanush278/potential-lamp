<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Planner Pro - Advanced Edition</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js" defer></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet">
    <style>
        :root {
            --primary-black: #000000;
            --secondary-black: #0a0a0a;
            --card-black: #111111;
            --border-gray: #333333;
            --text-white: #ffffff;
            --text-gray: #aaaaaa;
            --accent-white: #ffffff;
            --success-green: #00ff88;
            --warning-orange: #ff9f43;
            --error-red: #ff6b6b;
            --info-blue: #00d4ff;
            --gradient-primary: linear-gradient(135deg, #000000 0%, #1a1a1a 50%, #000000 100%);
            --gradient-card: linear-gradient(145deg, #111111 0%, #1a1a1a 100%);
            --gradient-accent: linear-gradient(90deg, #ffffff 0%, #e0e0e0 100%);
            --shadow-light: 0 4px 20px rgba(255, 255, 255, 0.1);
            --shadow-heavy: 0 20px 60px rgba(0, 0, 0, 0.8);
            --border-radius-sm: 8px;
            --border-radius-md: 15px;
            --border-radius-lg: 25px;
            --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-bounce: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--primary-black);
            color: var(--text-white);
            line-height: 1.6;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        /* Enhanced Container System */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        .container-fluid {
            width: 100%;
            padding: 0 1rem;
        }

        /* Stunning Profile Management Screen */
        .profile-management {
            min-height: 100vh;
            background: var(--primary-black);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .profile-management::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(255, 255, 255, 0.03) 0%, transparent 50%);
            animation: backgroundPulse 8s ease-in-out infinite;
        }

        @keyframes backgroundPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .profile-card {
            background: var(--gradient-card);
            border: 2px solid var(--border-gray);
            border-radius: var(--border-radius-lg);
            padding: 3rem;
            max-width: 900px;
            width: 95%;
            position: relative;
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow-heavy);
            z-index: 2;
            animation: slideInUp 1s ease-out;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .profile-header {
            text-align: center;
            margin-bottom: 3rem;
            position: relative;
        }

        .profile-header::after {
            content: '';
            position: absolute;
            bottom: -1rem;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 3px;
            background: var(--gradient-accent);
            border-radius: 2px;
        }

        .profile-header h1 {
            font-family: 'Poppins', sans-serif;
            font-size: clamp(2.5rem, 5vw, 4rem);
            font-weight: 800;
            margin-bottom: 1rem;
            background: var(--gradient-accent);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.02em;
            line-height: 1.1;
        }

        .profile-header .subtitle {
            font-size: 1.25rem;
            color: var(--text-gray);
            font-weight: 400;
            margin-bottom: 0.5rem;
        }

        .profile-header .tagline {
            font-size: 1rem;
            color: var(--text-gray);
            font-style: italic;
            opacity: 0.8;
        }

        /* Enhanced Welcome Section */
        .welcome-section {
            text-align: center;
            margin: 2rem 0 3rem;
            padding: 2rem;
            background: var(--gradient-card);
            border-radius: var(--border-radius-md);
            border: 1px solid var(--border-gray);
            position: relative;
            overflow: hidden;
        }

        .welcome-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .welcome-section h3 {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--text-white);
        }

        .welcome-section p {
            font-size: 1.1rem;
            color: var(--text-gray);
            line-height: 1.7;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Profile List Enhancement */
        .profile-list {
            margin: 2rem 0;
        }

        .profile-list h3 {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--text-white);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .profiles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .profile-item {
            background: var(--gradient-card);
            border: 2px solid var(--border-gray);
            border-radius: var(--border-radius-md);
            padding: 1.5rem;
            position: relative;
            transition: var(--transition-smooth);
            overflow: hidden;
        }

        .profile-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-accent);
            transform: scaleX(0);
            transition: var(--transition-smooth);
        }

        .profile-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-light);
            border-color: var(--accent-white);
        }

        .profile-item:hover::before {
            transform: scaleX(1);
        }

        .profile-item-info h4 {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-white);
            margin-bottom: 0.5rem;
        }

        .profile-item-info p {
            color: var(--text-gray);
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }

        .profile-item-actions {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        /* Enhanced Action Buttons */
        .action-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 2rem;
        }

        /* Stunning Cover Page */
        .cover-page {
            min-height: 100vh;
            background: var(--primary-black);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .cover-page::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 30% 70%, rgba(255, 255, 255, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 70% 30%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                linear-gradient(135deg, transparent 0%, rgba(255, 255, 255, 0.03) 50%, transparent 100%);
            animation: coverAnimation 12s ease-in-out infinite;
        }

        @keyframes coverAnimation {
            0%, 100% { transform: rotate(0deg) scale(1); }
            33% { transform: rotate(1deg) scale(1.02); }
            66% { transform: rotate(-1deg) scale(0.98); }
        }

        .cover-content {
            max-width: 800px;
            text-align: center;
            padding: 2rem;
            position: relative;
            z-index: 2;
        }

        .app-title {
            font-family: 'Poppins', sans-serif;
            font-size: clamp(3rem, 8vw, 6rem);
            font-weight: 900;
            margin-bottom: 1.5rem;
            background: var(--gradient-accent);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.03em;
            line-height: 1;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.2); }
        }

        .app-subtitle {
            font-size: clamp(1.2rem, 3vw, 2rem);
            color: var(--text-gray);
            margin-bottom: 2rem;
            font-weight: 400;
            line-height: 1.4;
        }

        .features-highlight {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 2rem 0 3rem;
        }

        .feature-item {
            background: var(--gradient-card);
            border: 1px solid var(--border-gray);
            border-radius: var(--border-radius-md);
            padding: 1.5rem;
            text-align: center;
            transition: var(--transition-bounce);
        }

        .feature-item:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: var(--shadow-light);
        }

        .feature-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--accent-white);
        }

        .feature-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .feature-desc {
            font-size: 0.9rem;
            color: var(--text-gray);
        }

        /* Revolutionary Button Design */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            padding: 1rem 2rem;
            border: none;
            border-radius: var(--border-radius-lg);
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition-bounce);
            text-decoration: none;
            position: relative;
            overflow: hidden;
            min-width: 180px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: var(--transition-smooth);
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: var(--gradient-accent);
            color: var(--primary-black);
            box-shadow: 0 8px 25px rgba(255, 255, 255, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 15px 35px rgba(255, 255, 255, 0.4);
        }

        .btn-secondary {
            background: var(--gradient-card);
            color: var(--text-white);
            border: 2px solid var(--border-gray);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .btn-secondary:hover {
            transform: translateY(-3px) scale(1.05);
            border-color: var(--accent-white);
            box-shadow: 0 15px 35px rgba(255, 255, 255, 0.1);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--error-red), #ff5252);
            color: var(--text-white);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
        }

        .btn-danger:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 15px 35px rgba(255, 107, 107, 0.4);
        }

        .btn-small {
            padding: 0.6rem 1.2rem;
            font-size: 0.9rem;
            min-width: 120px;
        }

        .btn-large {
            padding: 1.25rem 2.5rem;
            font-size: 1.1rem;
            min-width: 220px;
        }

        /* Enhanced Main App Layout with Sidebar */
        .main-app {
            display: none;
            min-height: 100vh;
            background: var(--primary-black);
        }

        .app-layout {
            display: flex;
            min-height: 100vh;
        }

        /* Modern Sidebar Navigation */
        .sidebar {
            width: 280px;
            background: var(--gradient-card);
            border-right: 2px solid var(--border-gray);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            transition: var(--transition-smooth);
        }

        .sidebar.collapsed {
            width: 70px;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-gray);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .sidebar.collapsed .sidebar-header {
            padding: 1.5rem 1rem;
            justify-content: center;
        }

        .sidebar-logo {
            font-family: 'Poppins', sans-serif;
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-white);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sidebar.collapsed .sidebar-text {
            display: none;
        }

        .sidebar-toggle {
            background: none;
            border: none;
            color: var(--text-gray);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: var(--border-radius-sm);
            transition: var(--transition-smooth);
        }

        .sidebar-toggle:hover {
            background: var(--secondary-black);
            color: var(--text-white);
        }

        .sidebar-nav {
            padding: 1rem 0;
        }

        .nav-section {
            margin-bottom: 2rem;
        }

        .nav-section-title {
            padding: 0 1.5rem 0.5rem;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-gray);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .sidebar.collapsed .nav-section-title {
            display: none;
        }

        .nav-item {
            position: relative;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 1rem 1.5rem;
            color: var(--text-gray);
            text-decoration: none;
            transition: var(--transition-smooth);
            border-left: 3px solid transparent;
            cursor: pointer;
        }

        .nav-link:hover {
            background: var(--secondary-black);
            color: var(--text-white);
            border-left-color: var(--accent-white);
        }

        .nav-link.active {
            background: var(--secondary-black);
            color: var(--text-white);
            border-left-color: var(--accent-white);
            position: relative;
        }

        .nav-link.active::after {
            content: '';
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--accent-white);
        }

        .nav-icon {
            font-size: 1.2rem;
            margin-right: 1rem;
            width: 20px;
            text-align: center;
        }

        .sidebar.collapsed .nav-text {
            display: none;
        }

        .nav-arrow {
            margin-left: auto;
            font-size: 0.8rem;
            transition: var(--transition-smooth);
        }

        .nav-item.expanded .nav-arrow {
            transform: rotate(90deg);
        }

        .nav-submenu {
            display: none;
            background: var(--primary-black);
            border-top: 1px solid var(--border-gray);
        }

        .nav-item.expanded .nav-submenu {
            display: block;
        }

        .nav-sublink {
            display: flex;
            align-items: center;
            padding: 0.8rem 1.5rem 0.8rem 3rem;
            color: var(--text-gray);
            text-decoration: none;
            transition: var(--transition-smooth);
            font-size: 0.9rem;
        }

        .nav-sublink:hover {
            background: var(--secondary-black);
            color: var(--text-white);
        }

        .nav-sublink.active {
            background: var(--secondary-black);
            color: var(--text-white);
            position: relative;
        }

        .nav-sublink.active::before {
            content: '';
            position: absolute;
            left: 2.5rem;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--accent-white);
        }

        /* Main Content Area */
        .main-content {
            margin-left: 280px;
            flex: 1;
            transition: var(--transition-smooth);
            min-height: 100vh;
        }

        .sidebar.collapsed + .main-content {
            margin-left: 70px;
        }

        /* Premium Header */
        .app-header {
            background: var(--gradient-card);
            border-bottom: 2px solid var(--border-gray);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(20px);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .breadcrumb {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-white);
        }

        .app-logo {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-white);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .app-logo i {
            font-size: 1.8rem;
            background: var(--gradient-accent);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .profile-info-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .current-profile {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--secondary-black);
            border-radius: var(--border-radius-md);
            border: 1px solid var(--border-gray);
        }

        /* Advanced Navigation */
        .main-nav, .sub-nav {
            background: var(--secondary-black);
            border-bottom: 1px solid var(--border-gray);
            padding: 1rem 0;
            position: sticky;
            top: 70px;
            z-index: 99;
            backdrop-filter: blur(10px);
        }

        .nav-buttons, .sub-nav-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-btn, .sub-nav-btn {
            background: var(--card-black);
            color: var(--text-white);
            border: 2px solid var(--border-gray);
            padding: 0.8rem 1.5rem;
            border-radius: var(--border-radius-lg);
            cursor: pointer;
            font-weight: 500;
            font-size: 0.95rem;
            transition: var(--transition-smooth);
            position: relative;
            overflow: hidden;
        }

        .nav-btn::before, .sub-nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: var(--transition-smooth);
        }

        .nav-btn:hover, .sub-nav-btn:hover {
            transform: translateY(-2px);
            border-color: var(--accent-white);
            box-shadow: var(--shadow-light);
        }

        .nav-btn:hover::before, .sub-nav-btn:hover::before {
            left: 100%;
        }

        .nav-btn.active, .sub-nav-btn.active {
            background: var(--gradient-accent);
            color: var(--primary-black);
            border-color: var(--accent-white);
            box-shadow: 0 5px 20px rgba(255, 255, 255, 0.3);
        }

        /* Dashboard Layout */
        .dashboard {
            padding: 2rem;
        }

        .dashboard-header {
            margin-bottom: 2rem;
        }

        .dashboard-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: var(--gradient-accent);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .dashboard-subtitle {
            color: var(--text-gray);
            font-size: 1.1rem;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .dashboard-card {
            background: var(--gradient-card);
            border: 2px solid var(--border-gray);
            border-radius: var(--border-radius-md);
            padding: 2rem;
            position: relative;
            overflow: hidden;
            transition: var(--transition-bounce);
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-light);
            border-color: var(--accent-white);
        }

        .dashboard-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-accent);
            transform: scaleX(0);
            transition: var(--transition-smooth);
        }

        .dashboard-card:hover::before {
            transform: scaleX(1);
        }

        .card-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--accent-white);
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .card-description {
            color: var(--text-gray);
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }

        .card-action {
            margin-top: auto;
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .stat-card {
            background: var(--gradient-card);
            border: 1px solid var(--border-gray);
            border-radius: var(--border-radius-md);
            padding: 1.5rem;
            text-align: center;
            transition: var(--transition-smooth);
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-light);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-white);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-gray);
            font-size: 0.9rem;
        }

        /* Premium Section Layout */
        .section {
            display: none;
            padding: 2rem;
            min-height: calc(100vh - 100px);
        }

        .section.active {
            display: block;
            animation: sectionFadeIn 0.5s ease-out;
        }

        @keyframes sectionFadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-header {
            text-align: center;
            margin-bottom: 3rem;
            position: relative;
        }

        .section-header::after {
            content: '';
            position: absolute;
            bottom: -1rem;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background: var(--gradient-accent);
            border-radius: 2px;
        }

        .section-title {
            font-family: 'Poppins', sans-serif;
            font-size: clamp(2rem, 4vw, 3rem);
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--text-white);
            letter-spacing: -0.01em;
        }

        .section-subtitle {
            font-size: 1.2rem;
            color: var(--text-gray);
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.6;
        }

        /* Revolutionary Card Design */
        .card {
            background: var(--gradient-card);
            border: 2px solid var(--border-gray);
            border-radius: var(--border-radius-md);
            padding: 2rem;
            margin: 1.5rem 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            position: relative;
            overflow: hidden;
            transition: var(--transition-smooth);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--gradient-accent);
            transform: scaleX(0);
            transition: var(--transition-smooth);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.7);
            border-color: var(--accent-white);
        }

        .card:hover::before {
            transform: scaleX(1);
        }

        .card-header {
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-gray);
            position: relative;
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-white);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .card-subtitle {
            color: var(--text-gray);
            font-size: 0.95rem;
            line-height: 1.5;
        }

        /* Advanced Form System */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-white);
            font-size: 0.95rem;
        }

        .required {
            color: var(--error-red);
            margin-left: 0.25rem;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 1rem 1.25rem;
            background: var(--secondary-black);
            border: 2px solid var(--border-gray);
            border-radius: var(--border-radius-md);
            color: var(--text-white);
            font-size: 1rem;
            transition: var(--transition-smooth);
            font-family: inherit;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--accent-white);
            background: var(--card-black);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1);
        }

        .form-input::placeholder {
            color: var(--text-gray);
        }

        /* Enhanced Assessment Design */
        .assessment-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--secondary-black);
            border-radius: 4px;
            margin-bottom: 2rem;
            overflow: hidden;
            border: 1px solid var(--border-gray);
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-accent);
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 4px;
        }

        .question-card {
            background: var(--gradient-card);
            border: 2px solid var(--border-gray);
            border-radius: var(--border-radius-md);
            padding: 3rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .question-number {
            color: var(--text-gray);
            font-size: 1rem;
            margin-bottom: 1.5rem;
            font-weight: 500;
        }

        .question-text {
            font-size: 1.6rem;
            font-weight: 600;
            margin-bottom: 2rem;
            color: var(--text-white);
            line-height: 1.4;
        }

        .options-grid {
            display: grid;
            gap: 1rem;
            margin: 2rem 0;
        }

        .option-btn {
            background: var(--secondary-black);
            color: var(--text-white);
            border: 2px solid var(--border-gray);
            padding: 1.25rem 1.5rem;
            border-radius: var(--border-radius-md);
            cursor: pointer;
            font-size: 1rem;
            transition: var(--transition-bounce);
            text-align: left;
            position: relative;
            overflow: hidden;
        }

        .option-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: var(--transition-smooth);
        }

        .option-btn:hover {
            transform: translateY(-2px) scale(1.02);
            border-color: var(--accent-white);
            box-shadow: var(--shadow-light);
        }

        .option-btn:hover::before {
            left: 100%;
        }

        .option-btn.selected {
            background: var(--gradient-accent);
            color: var(--primary-black);
            border-color: var(--accent-white);
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 10px 30px rgba(255, 255, 255, 0.3);
        }

        .results-container {
            text-align: center;
            padding: 3rem;
            background: var(--gradient-card);
            border-radius: var(--border-radius-md);
            border: 2px solid var(--border-gray);
        }

        .personality-type {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text-white);
            margin: 1.5rem 0;
            background: var(--gradient-accent);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .personality-description {
            font-size: 1.2rem;
            color: var(--text-gray);
            margin-bottom: 2rem;
            line-height: 1.7;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Premium Data Display */
        .data-display {
            background: var(--secondary-black);
            border: 1px solid var(--border-gray);
            border-radius: var(--border-radius-md);
            padding: 1.5rem;
            margin: 1rem 0;
        }

        .data-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-gray);
        }

        .data-row:last-child {
            border-bottom: none;
        }

        .data-label {
            font-weight: 500;
            color: var(--text-gray);
            flex: 1;
        }

        .data-value {
            font-weight: 600;
            color: var(--text-white);
            text-align: right;
            flex: 1;
        }

        /* Enhanced List Items */
        .items-list {
            margin: 1.5rem 0;
        }

        .list-item {
            background: var(--gradient-card);
            border: 2px solid var(--border-gray);
            border-radius: var(--border-radius-md);
            padding: 1.5rem;
            margin: 1rem 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition-smooth);
            position: relative;
            overflow: hidden;
        }

        .list-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--gradient-accent);
            transform: scaleY(0);
            transition: var(--transition-smooth);
        }

        .list-item:hover {
            transform: translateX(5px);
            border-color: var(--accent-white);
            box-shadow: var(--shadow-light);
        }

        .list-item:hover::before {
            transform: scaleY(1);
        }

        .item-info {
            flex: 1;
        }

        .item-title {
            font-weight: 600;
            color: var(--text-white);
            margin-bottom: 0.5rem;
            font-size: 1.1rem;
        }

        .item-details {
            color: var(--text-gray);
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .item-actions {
            display: flex;
            gap: 0.75rem;
            flex-shrink: 0;
        }

        /* Revolutionary Charts */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .chart-container {
            background: var(--gradient-card);
            border: 2px solid var(--border-gray);
            border-radius: var(--border-radius-md);
            padding: 2rem;
            position: relative;
            overflow: hidden;
        }

        .chart-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-accent);
            transform: scaleX(0);
            transition: var(--transition-smooth);
        }

        .chart-container:hover::before {
            transform: scaleX(1);
        }

        .chart-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            text-align: center;
            color: var(--text-white);
        }

        /* Advanced Widgets */
        .widgets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 2rem 0;
        }

        .widget {
            background: var(--gradient-card);
            border: 2px solid var(--border-gray);
            border-radius: var(--border-radius-md);
            padding: 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: var(--transition-bounce);
        }

        .widget::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-accent);
            transform: scaleX(0);
            transition: var(--transition-smooth);
        }

        .widget:hover {
            transform: translateY(-8px) scale(1.03);
            box-shadow: var(--shadow-light);
        }

        .widget:hover::before {
            transform: scaleX(1);
        }

        .widget-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--accent-white);
        }

        .widget-value {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--text-white);
            font-family: 'Poppins', sans-serif;
        }

        .widget-label {
            color: var(--text-gray);
            font-size: 0.95rem;
            font-weight: 500;
        }

        /* Premium Chatbot */
        .chatbot-container {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 1000;
        }

        .chatbot-toggle {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: var(--gradient-accent);
            color: var(--primary-black);
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(255, 255, 255, 0.3);
            transition: var(--transition-bounce);
            position: relative;
            overflow: hidden;
        }

        .chatbot-toggle::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transform: translateX(-100%);
            transition: var(--transition-smooth);
        }

        .chatbot-toggle:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 15px 40px rgba(255, 255, 255, 0.4);
        }

        .chatbot-toggle:hover::before {
            transform: translateX(100%);
        }

        .chatbot-window {
            display: none;
            position: absolute;
            bottom: 90px;
            right: 0;
            width: 400px;
            height: 600px;
            background: var(--gradient-card);
            border: 2px solid var(--border-gray);
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-heavy);
            overflow: hidden;
        }

        .chatbot-header {
            background: var(--secondary-black);
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chatbot-header h4 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
        }

        .chatbot-messages {
            height: 450px;
            overflow-y: auto;
            padding: 1rem;
            scroll-behavior: smooth;
        }

        .chat-message {
            margin: 1rem 0;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            animation: messageSlideIn 0.3s ease-out;
        }

        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chat-message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gradient-accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            color: var(--primary-black);
            flex-shrink: 0;
        }

        .chat-message.user .message-avatar {
            background: var(--secondary-black);
            color: var(--text-white);
            border: 2px solid var(--border-gray);
        }

        .message-content {
            background: var(--secondary-black);
            color: var(--text-white);
            padding: 1rem 1.25rem;
            border-radius: var(--border-radius-md);
            max-width: 80%;
            word-wrap: break-word;
            line-height: 1.5;
            border: 1px solid var(--border-gray);
        }

        .chat-message.user .message-content {
            background: var(--gradient-accent);
            color: var(--primary-black);
            border-color: var(--accent-white);
        }

        .chatbot-input {
            display: flex;
            padding: 1rem;
            border-top: 1px solid var(--border-gray);
            gap: 0.75rem;
            background: var(--secondary-black);
        }

        .chatbot-input input {
            flex: 1;
            padding: 0.75rem 1rem;
            background: var(--card-black);
            border: 1px solid var(--border-gray);
            border-radius: var(--border-radius-md);
            color: var(--text-white);
            font-size: 0.95rem;
        }

        .chatbot-input input:focus {
            outline: none;
            border-color: var(--accent-white);
        }

        /* Enhanced Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }

        .modal-content {
            background: var(--gradient-card);
            border: 2px solid var(--border-gray);
            border-radius: var(--border-radius-md);
            padding: 2.5rem;
            max-width: 600px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-gray);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-white);
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-gray);
            font-size: 1.5rem;
            cursor: pointer;
            transition: var(--transition-smooth);
            padding: 0.5rem;
            border-radius: 50%;
        }

        .close-btn:hover {
            color: var(--text-white);
            background: var(--secondary-black);
        }

        /* Premium Alerts */
        .alert {
            padding: 1.25rem 1.5rem;
            border-radius: var(--border-radius-md);
            margin: 1rem 0;
            font-weight: 500;
            border: 2px solid;
            position: relative;
            overflow: hidden;
        }

        .alert::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: currentColor;
        }

        .alert-success {
            background: rgba(0, 255, 136, 0.1);
            border-color: var(--success-green);
            color: var(--success-green);
        }

        .alert-danger {
            background: rgba(255, 107, 107, 0.1);
            border-color: var(--error-red);
            color: var(--error-red);
        }

        .alert-info {
            background: rgba(0, 212, 255, 0.1);
            border-color: var(--info-blue);
            color: var(--info-blue);
        }

        .alert-warning {
            background: rgba(255, 159, 67, 0.1);
            border-color: var(--warning-orange);
            color: var(--warning-orange);
        }

        /* File Upload Enhancement */
        .file-upload {
            border: 3px dashed var(--border-gray);
            border-radius: var(--border-radius-md);
            padding: 3rem 2rem;
            text-align: center;
            background: var(--secondary-black);
            transition: var(--transition-smooth);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .file-upload::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.05), transparent);
            transition: var(--transition-smooth);
        }

        .file-upload:hover {
            border-color: var(--accent-white);
            background: var(--card-black);
            transform: scale(1.02);
        }

        .file-upload:hover::before {
            left: 100%;
        }

        .file-upload.dragover {
            border-color: var(--success-green);
            background: rgba(0, 255, 136, 0.05);
            transform: scale(1.05);
        }

        .upload-icon {
            font-size: 4rem;
            color: var(--text-gray);
            margin-bottom: 1.5rem;
            transition: var(--transition-smooth);
        }

        .file-upload:hover .upload-icon {
            color: var(--accent-white);
            transform: scale(1.1);
        }

        .upload-text {
            color: var(--text-gray);
            margin-bottom: 1rem;
            font-size: 1.1rem;
            font-weight: 500;
        }

        .upload-formats {
            color: var(--text-gray);
            font-size: 0.9rem;
            opacity: 0.7;
        }

        /* Export Options Enhancement */
        .export-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        .export-option {
            background: var(--gradient-card);
            border: 2px solid var(--border-gray);
            border-radius: var(--border-radius-md);
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition-bounce);
            position: relative;
            overflow: hidden;
        }

        .export-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-accent);
            transform: scaleX(0);
            transition: var(--transition-smooth);
        }

        .export-option:hover {
            transform: translateY(-5px) scale(1.03);
            border-color: var(--accent-white);
            box-shadow: var(--shadow-light);
        }

        .export-option:hover::before {
            transform: scaleX(1);
        }

        .export-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--accent-white);
            transition: var(--transition-smooth);
        }

        .export-option:hover .export-icon {
            transform: scale(1.1) rotate(5deg);
        }

        .export-title {
            font-weight: 600;
            margin-bottom: 0.75rem;
            font-size: 1.1rem;
        }

        .export-description {
            color: var(--text-gray);
            font-size: 0.9rem;
            line-height: 1.4;
        }

        /* Advanced Responsive Design */
        @media (max-width: 1200px) {
            .container {
                max-width: 1140px;
                padding: 0 1.5rem;
            }
        }

        @media (max-width: 992px) {
            .container {
                max-width: 960px;
                padding: 0 1rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .widgets-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.collapsed {
                width: 100%;
                transform: translateX(-100%);
            }

                                .sidebar.mobile-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .sidebar.collapsed + .main-content {
                margin-left: 0;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .quick-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .profile-card {
                padding: 2rem;
            }
            
            .cover-content {
                padding: 1rem;
            }
            
            .features-highlight {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 300px;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 0.5rem;
            }
            
            .profile-info-header {
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .widgets-grid {
                grid-template-columns: 1fr;
            }
            
            .chatbot-window {
                width: 350px;
                height: 500px;
            }
            
            .chatbot-messages {
                height: 350px;
            }
            
            .modal-content {
                padding: 1.5rem;
                margin: 1rem;
            }

            .app-header {
                padding: 1rem;
            }

            .breadcrumb {
                font-size: 1.1rem;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 0 0.75rem;
            }
            
            .profile-card {
                padding: 1.5rem;
            }
            
            .card {
                padding: 1.5rem;
            }
            
            .section {
                padding: 2rem 0;
            }
            
            .question-card {
                padding: 2rem;
            }
            
            .chatbot-container {
                bottom: 1rem;
                right: 1rem;
            }
            
            .chatbot-window {
                width: 320px;
                height: 450px;
            }
            
            .chatbot-messages {
                height: 300px;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid var(--border-gray);
            border-radius: 50%;
            border-top-color: var(--accent-white);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--secondary-black);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-gray);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-gray);
        }

        /* Selection Styling */
        ::selection {
            background: rgba(255, 255, 255, 0.2);
            color: var(--text-white);
        }

        /* Focus Styling */
        *:focus {
            outline: 2px solid rgba(255, 255, 255, 0.3);
            outline-offset: 2px;
        }

        /* Mobile Overlay */
        .mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
        }

        /* Print Styles */
        @media print {
            .chatbot-container,
            .app-header,
            .main-nav,
            .sub-nav {
                display: none !important;
            }
            
            .card {
                break-inside: avoid;
            }
        }
    </style>
</head>
<body>
    <!-- Enhanced Profile Management Screen -->
    <div id="profile-management" class="profile-management">
        <div class="profile-card" data-aos="fade-up" data-aos-duration="1000">
            <div class="profile-header">
                <h1><i class="fas fa-chart-line"></i> Financial Planner Pro</h1>
                <p class="subtitle">Advanced Financial Planning Platform</p>
                <p class="tagline">Your Gateway to Financial Freedom</p>
            </div>

            <!-- Enhanced Welcome Section -->
            <div id="welcome-message" class="welcome-section" data-aos="fade-up" data-aos-delay="200">
                <h3><i class="fas fa-rocket"></i> Welcome to Your Financial Journey!</h3>
                <p>Experience the most advanced financial planning platform designed to transform your financial future. Create your personalized profile and unlock powerful insights, comprehensive analytics, and professional-grade reporting tools.</p>
            </div>

            <!-- Enhanced Saved Profiles List -->
            <div id="saved-profiles" class="profile-list" style="display: none;" data-aos="fade-up" data-aos-delay="300">
                <h3><i class="fas fa-folder-open"></i> Your Saved Profiles</h3>
                <div id="profiles-container" class="profiles-grid"></div>
            </div>

            <!-- Enhanced Action Buttons -->
            <div class="action-buttons" data-aos="fade-up" data-aos-delay="400">
                <button class="btn btn-primary btn-large" onclick="createNewProfile()">
                    <i class="fas fa-plus-circle"></i> Create New Profile
                </button>
                <button class="btn btn-secondary btn-large" onclick="showImportModal()">
                    <i class="fas fa-cloud-upload-alt"></i> Import Data
                </button>
            </div>
        </div>
    </div>

    <!-- Revolutionary Cover Page -->
    <div id="cover-page" class="cover-page" style="display: none;">
        <div class="cover-content" data-aos="zoom-in" data-aos-duration="1200">
            <h1 class="app-title">Financial Planner Pro</h1>
            <p class="app-subtitle">Your Complete Financial Planning & Wealth Management Solution</p>
            
            <!-- Features Highlight -->
            <div class="features-highlight" data-aos="fade-up" data-aos-delay="300">
                <div class="feature-item" data-aos="flip-left" data-aos-delay="400">
                    <div class="feature-icon"><i class="fas fa-brain"></i></div>
                    <div class="feature-title">Smart Assessment</div>
                    <div class="feature-desc">AI-powered personality analysis</div>
                </div>
                <div class="feature-item" data-aos="flip-left" data-aos-delay="500">
                    <div class="feature-icon"><i class="fas fa-chart-bar"></i></div>
                    <div class="feature-title">Advanced Analytics</div>
                    <div class="feature-desc">Real-time financial insights</div>
                </div>
                <div class="feature-item" data-aos="flip-left" data-aos-delay="600">
                    <div class="feature-icon"><i class="fas fa-file-pdf"></i></div>
                    <div class="feature-title">Professional Reports</div>
                    <div class="feature-desc">Export-ready PDF reports</div>
                </div>
                <div class="feature-item" data-aos="flip-left" data-aos-delay="700">
                    <div class="feature-icon"><i class="fas fa-shield-alt"></i></div>
                    <div class="feature-title">Secure Storage</div>
                    <div class="feature-desc">Bank-grade data protection</div>
                </div>
            </div>
            
            <div class="action-buttons" data-aos="fade-up" data-aos-delay="800">
                <button class="btn btn-primary btn-large" onclick="startPersonalityAssessment()">
                    <i class="fas fa-play-circle"></i> Start Assessment
                </button>
                <button class="btn btn-secondary" onclick="startClientProfiling()">
                    <i class="fas fa-user-cog"></i> Skip to Profiling
                </button>
                <button class="btn btn-secondary" onclick="goBackToProfiles()">
                    <i class="fas fa-arrow-left"></i> Back to Profiles
                </button>
            </div>
        </div>
    </div>

    <!-- Advanced Main Application -->
    <div id="main-app" class="main-app">
        <div class="app-layout">
            <!-- Modern Sidebar Navigation -->
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <div class="sidebar-logo">
                        <i class="fas fa-chart-line"></i>
                        <span class="sidebar-text">FinPro</span>
                    </div>
                    <button class="sidebar-toggle" onclick="toggleSidebar()">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>

                <nav class="sidebar-nav">
                    <!-- Dashboard Section -->
                    <div class="nav-section">
                        <div class="nav-section-title">Overview</div>
                        <div class="nav-item">
                            <a class="nav-link active" onclick="showSection('dashboard')">
                                <i class="nav-icon fas fa-home"></i>
                                <span class="nav-text">Dashboard</span>
                            </a>
                        </div>
                    </div>

                    <!-- Client Data Section -->
                    <div class="nav-section">
                        <div class="nav-section-title">Client Data</div>
                        <div class="nav-item">
                            <a class="nav-link" onclick="toggleNavItem(this)">
                                <i class="nav-icon fas fa-user-edit"></i>
                                <span class="nav-text">Client Profile</span>
                                <i class="nav-arrow fas fa-chevron-right"></i>
                            </a>
                            <div class="nav-submenu">
                                <a class="nav-sublink" onclick="showSection('personality')">
                                    <i class="fas fa-brain"></i> Assessment
                                </a>
                                <a class="nav-sublink" onclick="showSection('profile')">
                                    <i class="fas fa-id-card"></i> Basic Info
                                </a>
                                <a class="nav-sublink" onclick="showSection('financial')">
                                    <i class="fas fa-wallet"></i> Financial Status
                                </a>
                                <a class="nav-sublink" onclick="showSection('networth')">
                                    <i class="fas fa-calculator"></i> Net Worth
                                </a>
                                <a class="nav-sublink" onclick="showSection('goals')">
                                    <i class="fas fa-bullseye"></i> Goals & Insurance
                                </a>
                                <a class="nav-sublink" onclick="showSection('risk')">
                                    <i class="fas fa-chart-area"></i> Risk Profile
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Investment Advisory Section -->
                    <div class="nav-section">
                        <div class="nav-section-title">Advisory</div>
                        <div class="nav-item">
                            <a class="nav-link" onclick="toggleNavItem(this)">
                                <i class="nav-icon fas fa-chart-line"></i>
                                <span class="nav-text">Investment Advisory</span>
                                <i class="nav-arrow fas fa-chevron-right"></i>
                            </a>
                            <div class="nav-submenu">
                                <a class="nav-sublink" onclick="showSection('recommendations')">
                                    <i class="fas fa-lightbulb"></i> Investment Plan
                                </a>
                                <a class="nav-sublink" onclick="showSection('portfolio')">
                                    <i class="fas fa-pie-chart"></i> Portfolio Analysis
                                </a>
                                <a class="nav-sublink" onclick="showSection('sip')">
                                    <i class="fas fa-calendar-check"></i> SIP Calculator
                                </a>
                                <a class="nav-sublink" onclick="showSection('tax')">
                                    <i class="fas fa-receipt"></i> Tax Planning
                                </a>
                                <a class="nav-sublink" onclick="showSection('retirement')">
                                    <i class="fas fa-umbrella"></i> Retirement
                                </a>
                                <a class="nav-sublink" onclick="showSection('comparison')">
                                    <i class="fas fa-balance-scale"></i> Product Compare
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Analytics & Reports Section -->
                    <div class="nav-section">
                        <div class="nav-section-title">Reports</div>
                        <div class="nav-item">
                            <a class="nav-link" onclick="toggleNavItem(this)">
                                <i class="nav-icon fas fa-chart-bar"></i>
                                <span class="nav-text">Analytics & Reports</span>
                                <i class="nav-arrow fas fa-chevron-right"></i>
                            </a>
                            <div class="nav-submenu">
                                <a class="nav-sublink" onclick="showSection('analytics')">
                                    <i class="fas fa-chart-bar"></i> Analytics
                                </a>
                                <a class="nav-sublink" onclick="showSection('reports')">
                                    <i class="fas fa-file-alt"></i> Reports
                                </a>
                                <a class="nav-sublink" onclick="showSection('summary')">
                                    <i class="fas fa-clipboard-list"></i> Executive Summary
                                </a>
                                <a class="nav-sublink" onclick="showSection('alerts')">
                                    <i class="fas fa-bell"></i> Smart Alerts
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Financial Tools Section -->
                    <div class="nav-section">
                        <div class="nav-section-title">Tools</div>
                        <div class="nav-item">
                            <a class="nav-link" onclick="toggleNavItem(this)">
                                <i class="nav-icon fas fa-tools"></i>
                                <span class="nav-text">Financial Tools</span>
                                <i class="nav-arrow fas fa-chevron-right"></i>
                            </a>
                            <div class="nav-submenu">
                                <a class="nav-sublink" onclick="showSection('loan-calculator')">
                                    <i class="fas fa-home"></i> Loan Calculator
                                </a>
                                <a class="nav-sublink" onclick="showSection('budget-planner')">
                                    <i class="fas fa-chart-pie"></i> Budget Planner
                                </a>
                                <a class="nav-sublink" onclick="showSection('investment-tracker')">
                                    <i class="fas fa-trending-up"></i> Investment Tracker
                                </a>
                                <a class="nav-sublink" onclick="showSection('financial-calendar')">
                                    <i class="fas fa-calendar-alt"></i> Financial Calendar
                                </a>
                            </div>
                        </div>
                    </div>
                </nav>
            </aside>

            <!-- Main Content Area -->
            <main class="main-content">
                <!-- Premium Header -->
                <header class="app-header">
                    <div class="header-content">
                        <div class="breadcrumb">
                            <span id="current-section-title">Dashboard</span>
                        </div>
                        <div class="profile-info-header">
                            <div class="current-profile">
                                <i class="fas fa-user-circle"></i>
                                <span id="current-profile-name">Profile Name</span>
                                <span id="current-profile-status" class="profile-status"></span>
                            </div>
                            <button class="btn btn-small btn-primary" onclick="saveCurrentProfile()">
                                <i class="fas fa-save"></i> Save
                            </button>
                            <button class="btn btn-small btn-secondary" onclick="showExportModal()">
                                <i class="fas fa-download"></i> Export
                            </button>
                            <button class="btn btn-small btn-secondary" onclick="showSettingsModal()">
                                <i class="fas fa-cog"></i> Settings
                            </button>
                            <button class="btn btn-small btn-secondary" onclick="goBackToProfiles()">
                                <i class="fas fa-home"></i> Home
                            </button>
                        </div>
                    </div>
                </header>

                <!-- Dashboard Section -->
                <section id="dashboard" class="section active">
                    <div class="dashboard">
                        <div class="dashboard-header" data-aos="fade-down">
                            <h1 class="dashboard-title">Financial Dashboard</h1>
                            <p class="dashboard-subtitle">Your comprehensive financial overview and quick access to all planning tools</p>
                        </div>

                        <!-- Quick Stats -->
                        <div class="quick-stats" data-aos="fade-up" data-aos-delay="200">
                            <div class="stat-card">
                                <div class="stat-value" id="dashboard-net-worth">0</div>
                                <div class="stat-label">Net Worth</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="dashboard-monthly-savings">0</div>
                                <div class="stat-label">Monthly Savings</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="dashboard-investment-value">0</div>
                                <div class="stat-label">Investments</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="dashboard-financial-score">0%</div>
                                <div class="stat-label">Financial Health</div>
                            </div>
                        </div>

                        <!-- Main Dashboard Cards -->
                        <div class="dashboard-grid" data-aos="fade-up" data-aos-delay="300">
                            <div class="dashboard-card">
                                <div class="card-icon"><i class="fas fa-brain"></i></div>
                                <h3 class="card-title">Financial Assessment</h3>
                                <p class="card-description">Discover your investment personality and risk profile through our comprehensive behavioral finance assessment.</p>
                                <div class="card-action">
                                    <button class="btn btn-primary" onclick="showSection('personality')">
                                        <i class="fas fa-play"></i> Start Assessment
                                    </button>
                                </div>
                            </div>

                            <div class="dashboard-card">
                                <div class="card-icon"><i class="fas fa-user-edit"></i></div>
                                <h3 class="card-title">Client Profile</h3>
                                <p class="card-description">Build your comprehensive financial profile with personal information and financial status.</p>
                                <div class="card-action">
                                    <button class="btn btn-primary" onclick="showSection('profile')">
                                        <i class="fas fa-edit"></i> Update Profile
                                    </button>
                                </div>
                            </div>

                            <div class="dashboard-card">
                                <div class="card-icon"><i class="fas fa-lightbulb"></i></div>
                                <h3 class="card-title">Investment Recommendations</h3>
                                <p class="card-description">Get personalized investment strategies powered by advanced algorithms and market analysis.</p>
                                <div class="card-action">
                                    <button class="btn btn-primary" onclick="showSection('recommendations')">
                                        <i class="fas fa-magic"></i> Get Recommendations
                                    </button>
                                </div>
                            </div>

                            <div class="dashboard-card">
                                <div class="card-icon"><i class="fas fa-chart-bar"></i></div>
                                <h3 class="card-title">Portfolio Analytics</h3>
                                <p class="card-description">Advanced analytics and performance tracking for your investment portfolio.</p>
                                <div class="card-action">
                                    <button class="btn btn-primary" onclick="showSection('analytics')">
                                        <i class="fas fa-chart-line"></i> View Analytics
                                    </button>
                                </div>
                            </div>

                            <div class="dashboard-card">
                                <div class="card-icon"><i class="fas fa-file-alt"></i></div>
                                <h3 class="card-title">Professional Reports</h3>
                                <p class="card-description">Generate comprehensive financial reports with professional insights and recommendations.</p>
                                <div class="card-action">
                                    <button class="btn btn-primary" onclick="showSection('reports')">
                                        <i class="fas fa-download"></i> Generate Reports
                                    </button>
                                </div>
                            </div>

                            <div class="dashboard-card">
                                <div class="card-icon"><i class="fas fa-tools"></i></div>
                                <h3 class="card-title">Financial Tools</h3>
                                <p class="card-description">Access powerful calculators and planning tools for loans, SIPs, retirement, and more.</p>
                                <div class="card-action">
                                    <button class="btn btn-primary" onclick="showSection('loan-calculator')">
                                        <i class="fas fa-calculator"></i> Use Tools
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Sections Container -->
            <!-- Enhanced Personality Assessment Section -->
            <section id="personality" class="section">
                <div class="section-header" data-aos="fade-down">
                    <h2 class="section-title">
                        <i class="fas fa-brain"></i>
                        Advanced Financial Personality Assessment
                    </h2>
                    <p class="section-subtitle">
                        Discover your unique financial DNA through our scientifically-designed assessment that analyzes your investment behavior, risk tolerance, and wealth-building preferences.
                    </p>
                </div>

                <div class="assessment-container" data-aos="fade-up" data-aos-delay="200">
                    <!-- Progress Indicator -->
                    <div class="progress-bar">
                        <div class="progress-fill" id="assessment-progress" style="width: 0%"></div>
                    </div>

                    <!-- Assessment Questions -->
                    <div id="assessment-questions">
                        <div class="question-card">
                            <div class="question-number" id="question-number">Question 1 of 10</div>
                            <div class="question-text" id="question-text">Loading question...</div>
                            <div class="options-grid" id="question-options">
                                <!-- Options will be loaded here -->
                            </div>
                        </div>

                        <div style="text-align: center; margin-top: 2rem;">
                            <button class="btn btn-secondary" id="prev-btn" onclick="previousQuestion()" style="display: none;">
                                <i class="fas fa-arrow-left"></i> Previous
                            </button>
                            <button class="btn btn-primary" id="next-btn" onclick="nextQuestion()" style="display: none;">
                                Next <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Assessment Results -->
                    <div id="assessment-results" style="display: none;" data-aos="zoom-in">
                        <div class="results-container">
                            <div style="text-align: center; margin-bottom: 2rem;">
                                <i class="fas fa-trophy" style="font-size: 3rem; color: var(--warning-orange); margin-bottom: 1rem;"></i>
                                <h3>Your Financial Personality Revealed</h3>
                            </div>
                            <div class="personality-type" id="personality-type"></div>
                            <div class="personality-description" id="personality-description"></div>
                            
                            <!-- Personality Insights -->
                            <div id="personality-insights" class="card" style="margin-top: 2rem;">
                                <div class="card-header">
                                    <h4 class="card-title"><i class="fas fa-lightbulb"></i> Personalized Insights</h4>
                                </div>
                                <div id="insights-content"></div>
                            </div>
                            
                            <div style="text-align: center; margin-top: 2rem;">
                                <button class="btn btn-primary btn-large" onclick="proceedToClientProfiling()">
                                    Continue to Profile Setup <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Enhanced Basic Client Information -->
            <section id="profile" class="section">
                <div class="section-header" data-aos="fade-down">
                    <h2 class="section-title">
                        <i class="fas fa-user-edit"></i>
                        Comprehensive Client Profile
                    </h2>
                    <p class="section-subtitle">
                        Build your detailed financial profile with our advanced data collection system that ensures personalized recommendations and accurate planning.
                    </p>
                </div>

                <div class="card" data-aos="fade-up" data-aos-delay="200">
                    <form id="basic-info-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Full Name <span class="required">*</span></label>
                                <input type="text" id="client-name" class="form-input" placeholder="Enter your full name" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Age <span class="required">*</span></label>
                                <input type="number" id="client-age" class="form-input" min="18" max="100" placeholder="Enter your age" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Occupation <span class="required">*</span></label>
                                <input type="text" id="client-occupation" class="form-input" placeholder="Enter your occupation" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Marital Status <span class="required">*</span></label>
                                <select id="marital-status" class="form-select" required>
                                    <option value="">Select Status</option>
                                    <option value="single">Single</option>
                                    <option value="married">Married</option>
                                    <option value="divorced">Divorced</option>
                                    <option value="widowed">Widowed</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Number of Dependents <span class="required">*</span></label>
                                <input type="number" id="dependents" class="form-input" min="0" placeholder="Enter number of dependents" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">City <span class="required">*</span></label>
                                <input type="text" id="client-city" class="form-input" placeholder="Enter your city" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Annual Income Range</label>
                                <select id="income-range" class="form-select">
                                    <option value="">Select Range</option>
                                    <option value="below-3">Below 3 Lakhs</option>
                                    <option value="3-5">3-5 Lakhs</option>
                                    <option value="5-10">5-10 Lakhs</option>
                                    <option value="10-25">10-25 Lakhs</option>
                                    <option value="25-50">25-50 Lakhs</option>
                                    <option value="above-50">Above 50 Lakhs</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Education Level</label>
                                <select id="education-level" class="form-select">
                                    <option value="">Select Education</option>
                                    <option value="high-school">High School</option>
                                    <option value="bachelor">Bachelor's Degree</option>
                                    <option value="master">Master's Degree</option>
                                    <option value="doctorate">Doctorate</option>
                                    <option value="professional">Professional Certification</option>
                                </select>
                            </div>
                        </div>
                        <div style="text-align: center; margin-top: 2rem;">
                            <button type="submit" class="btn btn-primary btn-large">
                                <i class="fas fa-save"></i> Save Profile Information
                            </button>
                        </div>
                    </form>

                    <div id="saved-basic-info" style="display: none;" data-aos="fade-in">
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle"></i> Profile information saved successfully!
                        </div>
                        <div id="basic-info-display"></div>
                        <div style="text-align: center; margin-top: 1.5rem;">
                            <button class="btn btn-secondary" onclick="editBasicInfo()">
                                <i class="fas fa-edit"></i> Modify Information
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Enhanced Financial Status -->
            <section id="financial" class="section">
                <div class="section-header" data-aos="fade-down">
                    <h2 class="section-title">
                        <i class="fas fa-chart-line"></i>
                        Advanced Financial Status Analysis
                    </h2>
                    <p class="section-subtitle">
                        Provide comprehensive details about your current financial situation for accurate planning and personalized recommendations.
                    </p>
                </div>

                <div class="card" data-aos="fade-up" data-aos-delay="200">
                    <form id="financial-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Monthly Income () <span class="required">*</span></label>
                                <input type="number" id="monthly-income" class="form-input" min="0" placeholder="Enter monthly income" required>
                                <small style="color: var(--text-gray); margin-top: 0.5rem; display: block;">Include salary, business income, rental income, etc.</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Monthly Expenses () <span class="required">*</span></label>
                                <input type="number" id="monthly-expenses" class="form-input" min="0" placeholder="Enter monthly expenses" required>
                                <small style="color: var(--text-gray); margin-top: 0.5rem; display: block;">Include all recurring expenses</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Current Savings () <span class="required">*</span></label>
                                <input type="number" id="current-savings" class="form-input" min="0" placeholder="Enter current savings" required>
                                <small style="color: var(--text-gray); margin-top: 0.5rem; display: block;">Total liquid savings available</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Annual Income () <span class="required">*</span></label>
                                <input type="number" id="annual-income" class="form-input" min="0" placeholder="Enter annual income" required>
                                <small style="color: var(--text-gray); margin-top: 0.5rem; display: block;">Gross annual income before taxes</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Emergency Fund Target (Months)</label>
                                <input type="number" id="emergency-target" class="form-input" min="3" max="12" value="6" placeholder="6">
                                <small style="color: var(--text-gray); margin-top: 0.5rem; display: block;">Recommended: 6-12 months of expenses</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Current Debt ()</label>
                                <input type="number" id="current-debt" class="form-input" min="0" placeholder="Enter total debt">
                                <small style="color: var(--text-gray); margin-top: 0.5rem; display: block;">Total outstanding debt amount</small>
                            </div>
                        </div>
                        <div style="text-align: center; margin-top: 2rem;">
                            <button type="submit" class="btn btn-primary btn-large">
                                <i class="fas fa-chart-bar"></i> Analyze Financial Status
                            </button>
                        </div>
                    </form>

                    <div id="saved-financial-info" style="display: none;" data-aos="fade-in">
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle"></i> Financial status analyzed successfully!
                        </div>
                        <div id="financial-info-display"></div>
                        <div id="financial-insights" class="card" style="margin-top: 1.5rem;">
                            <div class="card-header">
                                <h4 class="card-title"><i class="fas fa-lightbulb"></i> Financial Health Insights</h4>
                            </div>
                            <div id="financial-insights-content"></div>
                        </div>
                        <div style="text-align: center; margin-top: 1.5rem;">
                            <button class="btn btn-secondary" onclick="editFinancialInfo()">
                                <i class="fas fa-edit"></i> Modify Financial Status
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Revolutionary Net Worth Calculator -->
            <section id="networth" class="section">
                <div class="section-header" data-aos="fade-down">
                    <h2 class="section-title">
                        <i class="fas fa-calculator"></i>
                        Advanced Net Worth Calculator
                    </h2>
                    <p class="section-subtitle">
                        Build a comprehensive picture of your financial position with our advanced asset and liability tracking system featuring real-time calculations and visual analytics.
                    </p>
                </div>

                <div class="form-grid">
                    <!-- Enhanced Assets Section -->
                    <div class="card" data-aos="fade-right" data-aos-delay="200">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-plus-circle"></i>
                                Asset Portfolio
                            </h3>
                            <p class="card-subtitle">Add and manage your assets with detailed categorization</p>
                        </div>
                        
                        <form id="asset-form">
                            <div class="form-group">
                                <label class="form-label">Asset Category <span class="required">*</span></label>
                                <select id="asset-type" class="form-select" required>
                                    <option value="">Select Asset Category</option>
                                    <option value="cash"> Cash & Bank Deposits</option>
                                    <option value="stocks"> Stocks & Mutual Funds</option>
                                    <option value="property"> Real Estate</option>
                                    <option value="gold"> Gold & Precious Metals</option>
                                    <option value="crypto"> Cryptocurrency</option>
                                    <option value="business"> Business Assets</option>
                                    <option value="other"> Other Assets</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Asset Description <span class="required">*</span></label>
                                <input type="text" id="asset-name" class="form-input" placeholder="e.g., HDFC Equity Fund, Apartment in Mumbai" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Current Value () <span class="required">*</span></label>
                                <input type="number" id="asset-value" class="form-input" min="0" placeholder="Enter current market value" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Purchase Date</label>
                                <input type="date" id="asset-date" class="form-input">
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Add Asset
                            </button>
                        </form>

                        <div id="assets-list" class="items-list">
                            <!-- Assets will be displayed here -->
                        </div>
                    </div>

                    <!-- Enhanced Liabilities Section -->
                    <div class="card" data-aos="fade-left" data-aos-delay="300">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-minus-circle"></i>
                                Liability Management
                            </h3>
                            <p class="card-subtitle">Track and analyze your debts and liabilities</p>
                        </div>
                        
                        <form id="loan-form">
                            <div class="form-group">
                                <label class="form-label">Loan Type <span class="required">*</span></label>
                                <select id="loan-type" class="form-select" required>
                                    <option value="">Select Loan Type</option>
                                    <option value="home"> Home Loan</option>
                                    <option value="car"> Car Loan</option>
                                    <option value="personal"> Personal Loan</option>
                                    <option value="education"> Education Loan</option>
                                    <option value="credit"> Credit Card Debt</option>
                                    <option value="business"> Business Loan</option>
                                    <option value="other"> Other Loans</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Outstanding Amount () <span class="required">*</span></label>
                                <input type="number" id="loan-amount" class="form-input" min="0" placeholder="Enter outstanding amount" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Interest Rate (%) <span class="required">*</span></label>
                                <input type="number" id="loan-rate" class="form-input" min="0" max="50" step="0.1" placeholder="Enter interest rate" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Remaining Tenure (Years) <span class="required">*</span></label>
                                <input type="number" id="loan-tenure" class="form-input" min="0" max="50" placeholder="Enter remaining years" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Monthly EMI ()</label>
                                <input type="number" id="loan-emi" class="form-input" min="0" placeholder="Enter monthly EMI">
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Add Liability
                            </button>
                        </form>

                        <div id="loans-list" class="items-list">
                            <!-- Loans will be displayed here -->
                        </div>
                    </div>
                </div>

                <!-- Enhanced Net Worth Summary -->
                <div class="card" data-aos="fade-up" data-aos-delay="400">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-chart-pie"></i>
                            Comprehensive Net Worth Analysis
                        </h3>
                        <p class="card-subtitle">Real-time calculation with detailed breakdown and insights</p>
                    </div>
                    
                    <div class="form-grid">
                        <div id="networth-summary">
                            <div class="data-display">
                                <div class="data-row">
                                    <span class="data-label"> Total Assets:</span>
                                    <span class="data-value" id="total-assets">0</span>
                                </div>
                                <div class="data-row">
                                    <span class="data-label"> Total Liabilities:</span>
                                    <span class="data-value" id="total-liabilities">0</span>
                                </div>
                                <div class="data-row" style="border-top: 2px solid var(--accent-white); font-weight: bold; font-size: 1.3rem; padding-top: 1rem;">
                                    <span class="data-label"> Net Worth:</span>
                                    <span class="data-value" id="net-worth">0</span>
                                </div>
                                <div class="data-row">
                                    <span class="data-label"> Asset-to-Liability Ratio:</span>
                                    <span class="data-value" id="asset-liability-ratio">0:1</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="charts-grid">
                            <div class="chart-container">
                                <h5 class="chart-title">Asset Distribution</h5>
                                <canvas id="asset-chart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div id="networth-insights" class="card" style="margin-top: 1.5rem;">
                        <div class="card-header">
                            <h4 class="card-title"><i class="fas fa-lightbulb"></i> Net Worth Insights</h4>
                        </div>
                        <div id="networth-insights-content"></div>
                    </div>
                </div>
            </section>

            <!-- Revolutionary Goals and Insurance Planning -->
            <section id="goals" class="section">
                <div class="section-header" data-aos="fade-down">
                    <h2 class="section-title">
                        <i class="fas fa-bullseye"></i>
                        Smart Goals & Insurance Planning
                    </h2>
                    <p class="section-subtitle">
                        Set intelligent financial goals with inflation adjustment and comprehensive insurance planning with automated calculations for optimal coverage.
                    </p>
                </div>

                <div class="form-grid">
                    <!-- Advanced Financial Goals -->
                    <div class="card" data-aos="fade-right" data-aos-delay="200">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-target"></i>
                                Intelligent Goal Setting
                            </h3>
                            <p class="card-subtitle">AI-powered goal planning with inflation adjustment and smart recommendations</p>
                        </div>
                        
                        <form id="goal-form">
                            <div class="form-group">
                                <label class="form-label">Goal Name <span class="required">*</span></label>
                                <input type="text" id="goal-name" class="form-input" placeholder="e.g., Dream Home, Child's Education, World Tour" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Goal Category</label>
                                <select id="goal-category" class="form-select">
                                    <option value="lifestyle"> Lifestyle</option>
                                    <option value="education"> Education</option>
                                    <option value="property"> Property</option>
                                    <option value="business"> Business</option>
                                    <option value="retirement"> Retirement</option>
                                    <option value="emergency"> Emergency</option>
                                    <option value="other"> Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Target Amount ( in today's terms) <span class="required">*</span></label>
                                <input type="number" id="goal-amount" class="form-input" min="0" placeholder="Enter amount in current value" required>
                                <small style="color: var(--text-gray); margin-top: 0.5rem; display: block;">Enter the amount in today's purchasing power</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Time Frame (Years) <span class="required">*</span></label>
                                <input type="number" id="goal-timeframe" class="form-input" min="1" max="50" placeholder="Years to achieve goal" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Expected Inflation Rate (%)</label>
                                <input type="number" id="goal-inflation" class="form-input" value="6" min="0" max="20" step="0.1">
                                <small style="color: var(--text-gray); margin-top: 0.5rem; display: block;">Default: 6% per annum (adjustable)</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Priority Level <span class="required">*</span></label>
                                <select id="goal-priority" class="form-select" required>
                                    <option value="">Select Priority</option>
                                    <option value="critical"> Critical</option>
                                    <option value="high"> High</option>
                                    <option value="medium"> Medium</option>
                                    <option value="low"> Low</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Current Progress ()</label>
                                <input type="number" id="goal-progress-amount" class="form-input" min="0" placeholder="Amount already saved">
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Add Smart Goal
                            </button>
                        </form>

                        <div id="goals-list" class="items-list">
                            <!-- Goals will be displayed here -->
                        </div>
                    </div>

                    <!-- Advanced Insurance Planning -->
                    <div class="card" data-aos="fade-left" data-aos-delay="300">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-shield-alt"></i>
                                Comprehensive Insurance Analysis
                            </h3>
                            <p class="card-subtitle">Advanced insurance needs calculation with personalized recommendations</p>
                        </div>
                        
                        <form id="insurance-form">
                            <div class="form-group">
                                <label class="form-label">Current Life Insurance Coverage ()</label>
                                <input type="number" id="current-life-insurance" class="form-input" min="0" placeholder="Enter current coverage">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Current Health Insurance Coverage ()</label>
                                <input type="number" id="current-health-insurance" class="form-input" min="0" placeholder="Enter current coverage">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Outstanding Loans ()</label>
                                <input type="number" id="outstanding-loans" class="form-input" min="0" placeholder="Total outstanding debt">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Family Annual Expenses () <span class="required">*</span></label>
                                <input type="number" id="family-expenses" class="form-input" min="0" placeholder="Annual family expenses" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Income Replacement Period (Years)</label>
                                <input type="number" id="income-years" class="form-input" value="15" min="1" max="50" placeholder="Years of income replacement">
                                <small style="color: var(--text-gray); margin-top: 0.5rem; display: block;">Recommended: 10-20 years</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Number of Dependents</label>
                                <input type="number" id="insurance-dependents" class="form-input" min="0" placeholder="Number of dependents">
                            </div>
                            
                            <div style="text-align: center; margin: 1.5rem 0;">
                                <button type="button" class="btn btn-secondary" onclick="calculateAdvancedInsurance()">
                                    <i class="fas fa-calculator"></i> Calculate Insurance Needs
                                </button>
                            </div>
                            
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Save Insurance Profile
                            </button>
                        </form>

                        <div id="insurance-results" style="display: none;">
                            <!-- Insurance calculation results -->
                        </div>

                        <div id="saved-insurance-info" style="display: none;" data-aos="fade-in">
                            <div class="alert alert-success">
                                <i class="fas fa-check-circle"></i> Insurance profile saved successfully!
                            </div>
                            <div id="insurance-info-display"></div>
                            <div style="text-align: center; margin-top: 1.5rem;">
                                <button class="btn btn-secondary" onclick="editInsuranceInfo()">
                                    <i class="fas fa-edit"></i> Modify Insurance Profile
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Enhanced Risk Profile Assessment -->
            <section id="risk" class="section">
                <div class="section-header" data-aos="fade-down">
                    <h2 class="section-title">
                        <i class="fas fa-chart-area"></i>
                        Advanced Risk Profile Analysis
                    </h2>
                    <p class="section-subtitle">
                        Comprehensive risk assessment using behavioral finance principles to determine your optimal investment strategy and risk tolerance levels.
                    </p>
                </div>

                <div class="card" data-aos="fade-up" data-aos-delay="200">
                    <form id="risk-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Investment Experience <span class="required">*</span></label>
                                <select id="investment-experience" class="form-select" required>
                                    <option value="">Select Experience Level</option>
                                    <option value="beginner"> Beginner (0-2 years)</option>
                                    <option value="intermediate"> Intermediate (3-7 years)</option>
                                    <option value="experienced"> Experienced (8-15 years)</option>
                                    <option value="expert"> Expert (15+ years)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Risk Tolerance <span class="required">*</span></label>
                                <select id="risk-tolerance" class="form-select" required>
                                    <option value="">Select Risk Level</option>
                                    <option value="very-conservative"> Very Conservative - Capital preservation</option>
                                    <option value="conservative"> Conservative - Stable returns</option>
                                    <option value="moderate"><i class="fas fa-balance-scale"></i> Moderate - Balanced approach</option>
                                    <option value="aggressive"> Aggressive - Growth focused</option>
                                    <option value="very-aggressive"> Very Aggressive - Maximum returns</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Investment Horizon <span class="required">*</span></label>
                                <select id="investment-horizon" class="form-select" required>
                                    <option value="">Select Time Horizon</option>
                                    <option value="short"> Short Term (1-3 years)</option>
                                    <option value="medium"> Medium Term (3-7 years)</option>
                                    <option value="long"> Long Term (7-15 years)</option>
                                    <option value="very-long"> Very Long Term (15+ years)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Monthly Investment Capacity () <span class="required">*</span></label>
                                <input type="number" id="monthly-investment" class="form-input" min="0" placeholder="Amount you can invest monthly" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Investment Knowledge Areas</label>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 0.5rem; margin-top: 0.5rem;">
                                    <label style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-gray);">
                                        <input type="checkbox" id="knowledge-stocks" value="stocks">
                                         Stocks & Equity
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-gray);">
                                        <input type="checkbox" id="knowledge-bonds" value="bonds">
                                         Bonds & Fixed Income
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-gray);">
                                        <input type="checkbox" id="knowledge-mutual-funds" value="mutual-funds">
                                         Mutual Funds
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-gray);">
                                        <input type="checkbox" id="knowledge-real-estate" value="real-estate">
                                         Real Estate
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-gray);">
                                        <input type="checkbox" id="knowledge-crypto" value="crypto">
                                         Cryptocurrency
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 0.5rem; color: var(--text-gray);">
                                        <input type="checkbox" id="knowledge-commodities" value="commodities">
                                         Commodities
                                    </label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Preferred Investment Style</label>
                                <select id="investment-style" class="form-select">
                                    <option value="">Select Style</option>
                                    <option value="passive"> Passive - Set and forget</option>
                                    <option value="active"> Active - Regular monitoring</option>
                                    <option value="mix"> Mixed - Combination approach</option>
                                </select>
                            </div>
                        </div>
                        <div style="text-align: center; margin-top: 2rem;">
                            <button type="submit" class="btn btn-primary btn-large">
                                <i class="fas fa-chart-area"></i> Analyze Risk Profile
                            </button>
                        </div>
                    </form>

                    <div id="saved-risk-info" style="display: none;" data-aos="fade-in">
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle"></i> Risk profile analyzed successfully!
                        </div>
                        <div id="risk-info-display"></div>
                        <div id="risk-recommendations" class="card" style="margin-top: 1.5rem;">
                            <div class="card-header">
                                <h4 class="card-title"><i class="fas fa-lightbulb"></i> Personalized Risk Insights</h4>
                            </div>
                            <div id="risk-recommendations-content"></div>
                        </div>
                        <div style="text-align: center; margin-top: 1.5rem;">
                            <button class="btn btn-secondary" onclick="editRiskInfo()">
                                <i class="fas fa-edit"></i> Modify Risk Profile
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Revolutionary Investment Recommendations -->
            <section id="recommendations" class="section">
                <div class="section-header" data-aos="fade-down">
                    <h2 class="section-title">
                        <i class="fas fa-lightbulb"></i>
                        Personalized Investment Recommendations
                    </h2>
                    <p class="section-subtitle">
                        Get personalized investment strategies powered by advanced algorithms that analyze your complete financial profile, goals, and market conditions.
                    </p>
                </div>

                <div class="card" data-aos="fade-up" data-aos-delay="200">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <button class="btn btn-primary btn-large" onclick="generateAdvancedInvestmentPlan()">
                            <i class="fas fa-magic"></i> Generate Smart Investment Plan
                        </button>
                        <button class="btn btn-secondary" onclick="generateQuickRecommendations()">
                            <i class="fas fa-bolt"></i> Quick Recommendations
                        </button>
                    </div>
                    
                    <div id="investment-plan-results">
                        <!-- Investment plan will be displayed here -->
                    </div>
                </div>
            </section>

            <!-- Advanced Portfolio Analysis -->
            <section id="portfolio" class="section">
                <div class="section-header" data-aos="fade-down">
                    <h2 class="section-title">
                        <i class="fas fa-pie-chart"></i>
                        Advanced Portfolio Analysis
                    </h2>
                    <p class="section-subtitle">
                        Comprehensive portfolio analysis with risk metrics, performance tracking, and intelligent rebalancing recommendations.
                    </p>
                </div>

                <div class="card" data-aos="fade-up" data-aos-delay="200">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <button class="btn btn-primary" onclick="analyzeAdvancedPortfolio()">
                            <i class="fas fa-search-plus"></i> Deep Portfolio Analysis
                        </button>
                        <button class="btn btn-secondary" onclick="generateRebalancingPlan()">
                            <i class="fas fa-balance-scale"></i> Smart Rebalancing
                        </button>
                        <button class="btn btn-secondary" onclick="performRiskAnalysis()">
                            <i class="fas fa-exclamation-triangle"></i> Risk Analysis
                        </button>
                    </div>
                    
                    <div id="portfolio-analysis-results">
                        <!-- Portfolio analysis will be displayed here -->
                    </div>
                </div>
            </section>

            <!-- Enhanced SIP Calculator -->
            <section id="sip" class="section">
                <div class="section-header" data-aos="fade-down">
                    <h2 class="section-title">
                        <i class="fas fa-calendar-check"></i>
                        Advanced SIP Calculator
                    </h2>
                    <p class="section-subtitle">
                        Sophisticated SIP planning with inflation adjustment, step-up calculations, and goal-based recommendations.
                    </p>
                </div>

                <div class="card" data-aos="fade-up" data-aos-delay="200">
                    <form id="sip-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Monthly SIP Amount () <span class="required">*</span></label>
                                <input type="number" id="sip-amount" class="form-input" min="500" placeholder="Minimum 500" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Expected Annual Return (%) <span class="required">*</span></label>
                                <input type="number" id="sip-return" class="form-input" value="12" min="1" max="30" step="0.1" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Investment Period (Years) <span class="required">*</span></label>
                                <input type="number" id="sip-period" class="form-input" min="1" max="50" placeholder="Investment duration" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Expected Inflation Rate (%)</label>
                                <input type="number" id="sip-inflation" class="form-input" value="6" min="0" max="20" step="0.1">
                                <small style="color: var(--text-gray); margin-top: 0.5rem; display: block;">For real returns calculation</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Annual Step-up (%)</label>
                                <input type="number" id="sip-stepup" class="form-input" value="10" min="0" max="50" step="0.1">
                                <small style="color: var(--text-gray); margin-top: 0.5rem; display: block;">Yearly increase in SIP amount</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Tax Rate (%)</label>
                                <input type="number" id="sip-tax" class="form-input" value="10" min="0" max="50" step="0.1">
                                <small style="color: var(--text-gray); margin-top: 0.5rem; display: block;">Expected tax on returns</small>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin: 2rem 0;">
                            <button type="submit" class="btn btn-primary btn-large">
                                <i class="fas fa-calculator"></i> Calculate Advanced SIP Returns
                            </button>
                        </div>
                    </form>

                    <div id="sip-results" style="display: none;"ed"> Mixed - Balanced approach</option>
                                </select>
                            </div>
                        </div>
                        <div style="text-align: center; margin-top: 2rem;">
                            <button type="submit" class="btn btn-primary btn-large">
                                <i class="fas fa-chart-area"></i> Analyze Risk Profile
                            </button>
                        </div>
                    </form>

                    <div id="saved-risk-info" style="display: none;" data-aos="fade-in">
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle"></i> Risk profile analyzed successfully!
                        </div>
                        <div id="risk-info-display"></div>
                        <div id="risk-recommendations" class="card" style="margin-top: 1.5rem;">
                            <div class="card-header">
                                <h4 class="card-title"><i class="fas fa-lightbulb"></i> Personalized Risk Insights</h4>
                            </div>
                            <div id="risk-recommendations-content"></div>
                        </div>
                        <div style="text-align: center; margin-top: 1.5rem;">
                            <button class="btn btn-secondary" onclick="editRiskInfo()">
                                <i class="fas fa-edit"></i> Modify Risk Profile
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Revolutionary Investment Recommendations -->
            <section id="recommendations" class="section">
                <div class="section-header" data-aos="fade-down">
                    <h2 class="section-title">
                        <i class="fas fa-lightbulb"></i>
                        AI-Powered Investment Recommendations
                    </h2>
                    <p class="section-subtitle">
                        Get personalized investment strategies powered by advanced algorithms that analyze your complete financial profile, goals, and market conditions.
                    </p>
                </div>

                <div class="card" data-aos="fade-up" data-aos-delay="200">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <button class="btn btn-primary btn-large" onclick="generateAdvancedInvestmentPlan()">
                            <i class="fas fa-magic"></i> Generate Smart Investment Plan
                        </button>
                        <button class="btn btn-secondary" onclick="generateQuickRecommendations()">
                            <i class="fas fa-bolt"></i> Quick Recommendations
                        </button>
                    </div>
                    
                    <div id="investment-plan-results">
                        <!-- Investment plan will be displayed here -->
                    </div>
                </div>
            </section>

            <!-- Advanced Portfolio Analysis -->
            <section id="portfolio" class="section">
                <div class="section-header" data-aos="fade-down">
                    <h2 class="section-title">
                        <i class="fas fa-pie-chart"></i>
                        Advanced Portfolio Analysis
                    </h2>
                    <p class="section-subtitle">
                        Comprehensive portfolio analysis with risk metrics, performance tracking, and intelligent rebalancing recommendations.
                    </p>
                </div>

                <div class="card" data-aos="fade-up" data-aos-delay="200">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <button class="btn btn-primary" onclick="analyzeAdvancedPortfolio()">
                            <i class="fas fa-search-plus"></i> Deep Portfolio Analysis
                        </button>
                        <button class="btn btn-secondary" onclick="generateRebalancingPlan()">
                            <i class="fas fa-balance-scale"></i> Smart Rebalancing
                        </button>
                        <button class="btn btn-secondary" onclick="performRiskAnalysis()">
                            <i class="fas fa-exclamation-triangle"></i> Risk Analysis
                        </button>
                    </div>
                    
                    <div id="portfolio-analysis-results">
                        <!-- Portfolio analysis will be displayed here -->
                    </div>
                </div>
            </section>

            <!-- Enhanced SIP Calculator -->
            <section id="sip" class="section">
                <div class="section-header" data-aos="fade-down">
                    <h2 class="section-title">
                        <i class="fas fa-calendar-check"></i>
                        Advanced SIP Calculator
                    </h2>
                    <p class="section-subtitle">
                        Sophisticated SIP planning with inflation adjustment, step-up calculations, and goal-based recommendations.
                    </p>
                </div>

                <div class="card" data-aos="fade-up" data-aos-delay="200">
                    <form id="sip-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Monthly SIP Amount () <span class="required">*</span></label>
                                <input type="number" id="sip-amount" class="form-input" min="500" placeholder="Minimum 500" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Expected Annual Return (%) <span class="required">*</span></label>
                                <input type="number" id="sip-return" class="form-input" value="12" min="1" max="30" step="0.1" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Investment Period (Years) <span class="required">*</span></label>
                                <input type="number" id="sip-period" class="form-input" min="1" max="50" placeholder="Investment duration" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Expected Inflation Rate (%)</label>
                                <input type="number" id="sip-inflation" class="form-input" value="6" min="0" max="20" step="0.1">
                                <small style="color: var(--text-gray); margin-top: 0.5rem; display: block;">For real returns calculation</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Annual Step-up (%)</label>
                                <input type="number" id="sip-stepup" class="form-input" value="10" min="0" max="50" step="0.1">
                                <small style="color: var(--text-gray); margin-top: 0.5rem; display: block;">Yearly increase in SIP amount</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Tax Rate (%)</label>
                                <input type="number" id="sip-tax" class="form-input" value="10" min="0" max="50" step="0.1">
                                <small style="color: var(--text-gray); margin-top: 0.5rem; display: block;">Expected tax on returns</small>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin: 2rem 0;">
                            <button type="submit" class="btn btn-primary btn-large">
                                <i class="fas fa-calculator"></i> Calculate Advanced SIP Returns
                            </button>
                        </div>
                    </form>

                    <div id="sip-results" style="display: none;">
                        <!-- SIP calculation results will be displayed here -->
                    </div>
                </div>
            </section>

            <!-- Advanced Tax Planning -->
            <section id="tax" class="section">
                <div class="section-header" data-aos="fade-down">
                    <h2 class="section-title">
                        <i class="fas fa-receipt"></i>
                        Comprehensive Tax Planning
                    </h2>
                    <p class="section-subtitle">
                        Advanced tax optimization strategies with detailed analysis of both old and new tax regimes, including smart investment recommendations.
                    </p>
                </div>

                <div class="card" data-aos="fade-up" data-aos-delay="200">
                    <form id="tax-planning-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Annual Gross Income () <span class="required">*</span></label>
                                <input type="number" id="taxable-income" class="form-input" min="0" placeholder="Enter gross annual income" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Preferred Tax Regime <span class="required">*</span></label>
                                <select id="tax-regime" class="form-select" required>
                                    <option value="">Select Tax Regime</option>
                                    <option value="old"><i class="fas fa-university"></i> Old Tax Regime (with deductions)</option>
                                    <option value="new"><i class="fas fa-star"></i> New Tax Regime (lower rates)</option>
                                    <option value="compare"><i class="fas fa-balance-scale"></i> Compare Both Regimes</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Current 80C Investments ()</label>
                                <input type="number" id="current-80c" class="form-input" min="0" max="150000" placeholder="Current 80C investments">
                                <small style="color: var(--text-gray); margin-top: 0.5rem; display: block;">Maximum limit: 1.5 lakhs</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Health Insurance Premium ()</label>
                                <input type="number" id="health-premium" class="form-input" min="0" placeholder="Health insurance premium">
                                <small style="color: var(--text-gray); margin-top: 0.5rem; display: block;">For 80D deduction</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Home Loan Interest ()</label>
                                <input type="number" id="home-loan-interest" class="form-input" min="0" placeholder="Annual home loan interest">
                                <small style="color: var(--text-gray); margin-top: 0.5rem; display: block;">For 24(b) deduction</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">HRA Received ()</label>
                                <input type="number" id="hra-received" class="form-input" min="0" placeholder="Annual HRA received">
                                <small style="color: var(--text-gray); margin-top: 0.5rem; display: block;">House Rent Allowance</small>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin: 2rem 0;">
                            <button type="submit" class="btn btn-primary btn-large">
                                <i class="fas fa-calculator"></i> Generate Advanced Tax Plan
                            </button>
                        </div>
                    </form>

                    <div id="tax-plan-results" style="display: none;">
                        <!-- Tax planning results will be displayed here -->
                    </div>
                </div>
            </section>

            <!-- Advanced Retirement Planning -->
            <section id="retirement" class="section">
                <div class="section-header" data-aos="fade-down">
                    <h2 class="section-title">
                        <i class="fas fa-umbrella"></i>
                        Comprehensive Retirement Planning
                    </h2>
                    <p class="section-subtitle">
                        Advanced retirement planning with inflation modeling, lifestyle adjustments, healthcare considerations, and multiple scenario analysis.
                    </p>
                </div>

                <div class="card" data-aos="fade-up" data-aos-delay="200">
                    <form id="retirement-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Current Age <span class="required">*</span></label>
                                <input type="number" id="current-age" class="form-input" min="18" max="65" placeholder="Your current age" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Planned Retirement Age <span class="required">*</span></label>
                                <input type="number" id="retirement-age" class="form-input" min="50" max="75" placeholder="When you plan to retire" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Current Monthly Expenses () <span class="required">*</span></label>
                                <input type="number" id="current-monthly-expenses" class="form-input" min="0" placeholder="Current monthly expenses" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Expected Inflation Rate (%)</label>
                                <input type="number" id="retirement-inflation" class="form-input" value="6" min="0" max="15" step="0.1">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Life Expectancy <span class="required">*</span></label>
                                <input type="number" id="life-expectancy" class="form-input" value="85" min="65" max="100" placeholder="Expected life expectancy" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Expected Return on Investments (%)</label>
                                <input type="number" id="retirement-return" class="form-input" value="10" min="5" max="20" step="0.1">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Post-Retirement Expense Ratio (%)</label>
                                <input type="number" id="expense-ratio" class="form-input" value="80" min="50" max="120" step="5">
                                <small style="color: var(--text-gray); margin-top: 0.5rem; display: block;">% of current expenses needed in retirement</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Healthcare Inflation (%)</label>
                                <input type="number" id="healthcare-inflation" class="form-input" value="8" min="0" max="20" step="0.1">
                                <small style="color: var(--text-gray); margin-top: 0.5rem; display: block;">Healthcare costs typically rise faster</small>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin: 2rem 0;">
                            <button type="submit" class="btn btn-primary btn-large">
                                <i class="fas fa-calculator"></i> Calculate Retirement Needs
                            </button>
                        </div>
                    </form>

                    <div id="retirement-results" style="display: none;">
                        <!-- Retirement planning results will be displayed here -->
                    </div>
                </div>
            </section>

            <!-- Smart Product Comparison -->
            <section id="comparison" class="section">
                <div class="section-header" data-aos="fade-down">
                    <h2 class="section-title">
                        <i class="fas fa-balance-scale"></i>
                        AI-Powered Product Comparison
                    </h2>
                    <p class="section-subtitle">
                        Intelligent product comparison engine that analyzes thousands of financial products to find the perfect match for your profile and goals.
                    </p>
                </div>

                <div class="card" data-aos="fade-up" data-aos-delay="200">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <button class="btn btn-primary btn-large" onclick="generateSmartComparison()">
                            <i class="fas fa-magic"></i> Generate Smart Recommendations
                        </button>
                        <button class="btn btn-secondary" onclick="compareSpecificProducts()">
                            <i class="fas fa-search"></i> Compare Specific Products
                        </button>
                    </div>
                    
                    <div id="product-comparison-results">
                        <!-- Product comparison will be displayed here -->
                    </div>
                </div>
            </section>

            <!-- Revolutionary Analytics Dashboard -->
            <section id="analytics" class="section">
                <div class="section-header" data-aos="fade-down">
                    <h2 class="section-title">
                        <i class="fas fa-chart-bar"></i>
                        Advanced Financial Analytics
                    </h2>
                    <p class="section-subtitle">
                        Comprehensive financial analytics with real-time insights, predictive modeling, and interactive visualizations powered by advanced algorithms.
                    </p>
                </div>

                <!-- Enhanced Financial Health Widgets -->
                <div class="widgets-grid" data-aos="fade-up" data-aos-delay="200">
                    <div class="widget">
                        <div class="widget-icon"><i class="fas fa-heartbeat"></i></div>
                        <div class="widget-value" id="financial-score">0</div>
                        <div class="widget-label">Financial Health Score</div>
                    </div>
                    <div class="widget">
                        <div class="widget-icon"><i class="fas fa-wallet"></i></div>
                        <div class="widget-value" id="net-worth-widget">0</div>
                        <div class="widget-label">Net Worth</div>
                    </div>
                    <div class="widget">
                        <div class="widget-icon"><i class="fas fa-piggy-bank"></i></div>
                        <div class="widget-value" id="savings-rate">0%</div>
                        <div class="widget-label">Savings Rate</div>
                    </div>
                    <div class="widget">
                        <div class="widget-icon"><i class="fas fa-shield"></i></div>
                        <div class="widget-value" id="emergency-fund-months">0</div>
                        <div class="widget-label">Emergency Fund (Months)</div>
                    </div>
                    <div class="widget">
                        <div class="widget-icon"><i class="fas fa-chart-line"></i></div>
                        <div class="widget-value" id="investment-growth">0%</div>
                        <div class="widget-label">Investment Growth</div>
                    </div>
                    <div class="widget">
                        <div class="widget-icon"><i class="fas fa-target"></i></div>
                        <div class="widget-value" id="goal-progress">0%</div>
                        <div class="widget-label">Goals Progress</div>
                    </div>
                </div>

                <!-- Advanced Charts Grid -->
                <div class="charts-grid" data-aos="fade-up" data-aos-delay="300">
                    <div class="chart-container">
                        <h5 class="chart-title">Asset Allocation Analysis</h5>
                        <canvas id="analytics-asset-chart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h5 class="chart-title">Income vs Expenses Trend</h5>
                        <canvas id="income-expense-chart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h5 class="chart-title">Goal Achievement Progress</h5>
                        <canvas id="goal-progress-chart"></canvas>
                    </div>
                    <div class="chart-container">
                        <h5 class="chart-title">Net Worth Projection</h5>
                        <canvas id="networth-projection-chart"></canvas>
                    </div>
                </div>

                <div style="text-align: center; margin: 2rem 0;" data-aos="fade-up" data-aos-delay="400">
                    <button class="btn btn-primary" onclick="updateAllCharts()">
                        <i class="fas fa-sync-alt"></i> Refresh Analytics
                    </button>
                    <button class="btn btn-secondary" onclick="exportAnalytics()">
                        <i class="fas fa-download"></i> Export Analytics
                    </button>
                </div>
            </section>

            <!-- Professional Reports Section -->
            <section id="reports" class="section">
                <div class="section-header" data-aos="fade-down">
                    <h2 class="section-title">
                        <i class="fas fa-file-alt"></i>
                        Professional Report Generation
                    </h2>
                    <p class="section-subtitle">
                        Generate comprehensive, professional-grade financial reports with advanced analytics, insights, and recommendations in multiple formats.
                    </p>
                </div>

                <div class="form-grid" data-aos="fade-up" data-aos-delay="200">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-chart-bar"></i>
                                Comprehensive Financial Report
                            </h3>
                            <p class="card-subtitle">Complete analysis of your financial position with detailed insights and recommendations</p>
                        </div>
                        <div style="text-align: center;">
                            <button class="btn btn-primary" onclick="generateDetailedReport()">
                                <i class="fas fa-eye"></i> Preview Report
                            </button>
                            <button class="btn btn-secondary" onclick="downloadDetailedReport()">
                                <i class="fas fa-download"></i> Download PDF
                            </button>
                            <button class="btn btn-secondary" onclick="scheduleReport('detailed')">
                                <i class="fas fa-calendar"></i> Schedule Report
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-lightbulb"></i>
                                Investment Strategy Report
                            </h3>
                            <p class="card-subtitle">Personalized investment recommendations with risk analysis and portfolio optimization</p>
                        </div>
                        <div style="text-align: center;">
                            <button class="btn btn-primary" onclick="generateInvestmentReport()">
                                <i class="fas fa-eye"></i> Preview Report
                            </button>
                            <button class="btn btn-secondary" onclick="downloadInvestmentReport()">
                                <i class="fas fa-download"></i> Download PDF
                            </button>
                            <button class="btn btn-secondary" onclick="scheduleReport('investment')">
                                <i class="fas fa-calendar"></i> Schedule Report
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-tasks"></i>
                                Action Plan Report
                            </h3>
                            <p class="card-subtitle">Step-by-step financial action items with timelines and priority levels</p>
                        </div>
                        <div style="text-align: center;">
                            <button class="btn btn-primary" onclick="generateActionPlan()">
                                <i class="fas fa-eye"></i> Preview Report
                            </button>
                            <button class="btn btn-secondary" onclick="downloadActionPlan()">
                                <i class="fas fa-download"></i> Download PDF
                            </button>
                            <button class="btn btn-secondary" onclick="scheduleReport('action')">
                                <i class="fas fa-calendar"></i> Schedule Report
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-shield-alt"></i>
                                Risk Assessment Report
                            </h3>
                            <p class="card-subtitle">Comprehensive risk analysis with mitigation strategies and insurance recommendations</p>
                        </div>
                        <div style="text-align: center;">
                            <button class="btn btn-primary" onclick="generateRiskReport()">
                                <i class="fas fa-eye"></i> Preview Report
                            </button>
                            <button class="btn btn-secondary" onclick="downloadRiskReport()">
                                <i class="fas fa-download"></i> Download PDF
                            </button>
                            <button class="btn btn-secondary" onclick="scheduleReport('risk')">
                                <i class="fas fa-calendar"></i> Schedule Report
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Report Preview Area -->
                <div id="report-preview" style="display: none;" data-aos="fade-in">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-eye"></i>
                                Report Preview
                            </h3>
                            <div style="float: right;">
                                <button class="btn btn-small btn-secondary" onclick="closeReportPreview()">
                                    <i class="fas fa-times"></i> Close
                                </button>
                            </div>
                        </div>
                        <div id="report-content">
                            <!-- Report content will be displayed here -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Executive Summary & Alerts -->
            <section id="summary" class="section">
                <div class="section-header" data-aos="fade-down">
                    <h2 class="section-title">
                        <i class="fas fa-clipboard-list"></i>
                        Executive Summary & Intelligence
                    </h2>
                    <p class="section-subtitle">
                        AI-powered executive summary with key insights, actionable alerts, and strategic recommendations for optimal financial decisions.
                    </p>
                </div>

                <div class="card" data-aos="fade-up" data-aos-delay="200">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <button class="btn btn-primary btn-large" onclick="generateExecutiveSummary()">
                            <i class="fas fa-magic"></i> Generate AI Summary
                        </button>
                        <button class="btn btn-secondary" onclick="generateQuickInsights()">
                            <i class="fas fa-bolt"></i> Quick Insights
                        </button>
                    </div>
                    
                    <div id="executive-summary-content">
                        <!-- Executive summary will be displayed here -->
                    </div>
                </div>
            </section>

            <!-- Smart Alerts Section -->
            <section id="alerts" class="section">
                <div class="section-header" data-aos="fade-down">
                    <h2 class="section-title">
                        <i class="fas fa-bell"></i>
                        Smart Financial Alerts
                    </h2>
                    <p class="section-subtitle">
                        Intelligent alert system that monitors your financial health and provides timely notifications for important financial decisions.
                    </p>
                </div>

                <div class="card" data-aos="fade-up" data-aos-delay="200">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-exclamation-triangle"></i>
                            Active Financial Alerts
                        </h3>
                    </div>
                    <div id="financial-alerts">
                        <!-- Alerts will be displayed here -->
                    </div>
                    
                    <div style="text-align: center; margin-top: 2rem;">
                        <button class="btn btn-primary" onclick="refreshAlerts()">
                            <i class="fas fa-sync-alt"></i> Refresh Alerts
                        </button>
                        <button class="btn btn-secondary" onclick="configureAlerts()">
                            <i class="fas fa-cog"></i> Configure Alerts
                        </button>
                    </div>
                </div>
            </section>

            <!-- Advanced Tools Section -->
            <!-- Loan Calculator -->
            <section id="loan-calculator" class="section">
                <div class="section-header" data-aos="fade-down">
                    <h2 class="section-title">
                        <i class="fas fa-home"></i>
                        Advanced Loan Calculator
                    </h2>
                    <p class="section-subtitle">
                        Comprehensive loan analysis with EMI calculations, amortization schedules, and prepayment strategies.
                    </p>
                </div>

                <div class="card" data-aos="fade-up" data-aos-delay="200">
                    <form id="loan-calculator-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Loan Amount () <span class="required">*</span></label>
                                <input type="number" id="loan-principal" class="form-input" min="0" placeholder="Enter loan amount" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Interest Rate (% per annum) <span class="required">*</span></label>
                                <input type="number" id="loan-interest-rate" class="form-input" min="0" max="50" step="0.1" placeholder="Enter interest rate" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Loan Tenure (Years) <span class="required">*</span></label>
                                <input type="number" id="loan-tenure-years" class="form-input" min="1" max="50" placeholder="Enter tenure in years" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Loan Type</label>
                                <select id="loan-calc-type" class="form-select">
                                    <option value="reducing">Reducing Balance (Standard)</option>
                                    <option value="flat">Flat Rate</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Prepayment Amount ()</label>
                                <input type="number" id="prepayment-amount" class="form-input" min="0" placeholder="Optional prepayment">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Prepayment After (Years)</label>
                                <input type="number" id="prepayment-after" class="form-input" min="1" placeholder="Years after which prepayment">
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin: 2rem 0;">
                            <button type="submit" class="btn btn-primary btn-large">
                                <i class="fas fa-calculator"></i> Calculate Loan Details
                            </button>
                        </div>
                    </form>

                    <div id="loan-calculator-results" style="display: none;">
                        <!-- Loan calculator results will be displayed here -->
                    </div>
                </div>
            </section>

            <!-- Budget Planner -->
            <section id="budget-planner" class="section">
                <div class="section-header" data-aos="fade-down">
                    <h2 class="section-title">
                        <i class="fas fa-chart-pie"></i>
                        Smart Budget Planner
                    </h2>
                    <p class="section-subtitle">
                        Intelligent budget planning with expense categorization, spending analysis, and optimization recommendations.
                    </p>
                </div>

                <div class="card" data-aos="fade-up" data-aos-delay="200">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-plus"></i>
                            Budget Categories
                        </h3>
                    </div>
                    
                    <form id="budget-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Category</label>
                                <select id="budget-category" class="form-select">
                                    <option value="housing"> Housing</option>
                                    <option value="food"> Food & Dining</option>
                                    <option value="transportation"> Transportation</option>
                                    <option value="utilities"> Utilities</option>
                                    <option value="healthcare"> Healthcare</option>
                                    <option value="entertainment"> Entertainment</option>
                                    <option value="shopping"> Shopping</option>
                                    <option value="education"> Education</option>
                                    <option value="savings"> Savings</option>
                                    <option value="other"> Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Budgeted Amount ()</label>
                                <input type="number" id="budget-amount" class="form-input" min="0" placeholder="Enter budget amount">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Actual Spent ()</label>
                                <input type="number" id="actual-spent" class="form-input" min="0" placeholder="Enter actual spending">
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin: 1.5rem 0;">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Add Budget Item
                            </button>
                        </div>
                    </form>

                    <div id="budget-list" class="items-list">
                        <!-- Budget items will be displayed here -->
                    </div>

                    <div id="budget-analysis" style="display: none;">
                        <!-- Budget analysis will be displayed here -->
                    </div>
                </div>
            </section>

            <!-- Investment Tracker -->
            <section id="investment-tracker" class="section">
                <div class="section-header" data-aos="fade-down">
                    <h2 class="section-title">
                        <i class="fas fa-trending-up"></i>
                        Investment Performance Tracker
                    </h2>
                    <p class="section-subtitle">
                        Track and analyze your investment performance with real-time data, benchmarking, and portfolio optimization insights.
                    </p>
                </div>

                <div class="card" data-aos="fade-up" data-aos-delay="200">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-plus"></i>
                            Add Investment
                        </h3>
                    </div>
                    
                    <form id="investment-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Investment Name</label>
                                <input type="text" id="investment-name" class="form-input" placeholder="e.g., HDFC Top 100 Fund">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Investment Type</label>
                                <select id="investment-type" class="form-select">
                                    <option value="mutual-fund"> Mutual Fund</option>
                                    <option value="stock"> Stock</option>
                                    <option value="bond"> Bond</option>
                                    <option value="etf"> ETF</option>
                                    <option value="fd"><i class="fas fa-university"></i> Fixed Deposit</option>
                                    <option value="ppf"> PPF</option>
                                    <option value="other"> Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Investment Amount ()</label>
                                <input type="number" id="investment-amount" class="form-input" min="0" placeholder="Enter investment amount">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Current Value ()</label>
                                <input type="number" id="current-value" class="form-input" min="0" placeholder="Enter current value">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Purchase Date</label>
                                <input type="date" id="purchase-date" class="form-input">
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin: 1.5rem 0;">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Add Investment
                            </button>
                        </div>
                    </form>

                    <div id="investment-list" class="items-list">
                        <!-- Investment items will be displayed here -->
                    </div>

                    <div id="investment-performance" style="display: none;">
                        <!-- Investment performance analysis will be displayed here -->
                    </div>
                </div>
            </section>

            <!-- Financial Calendar -->
            <section id="financial-calendar" class="section">
                <div class="section-header" data-aos="fade-down">
                    <h2 class="section-title">
                        <i class="fas fa-calendar-alt"></i>
                        Smart Financial Calendar
                    </h2>
                    <p class="section-subtitle">
                        Never miss important financial deadlines with our intelligent calendar that tracks tax dates, investment reviews, and financial milestones.
                    </p>
                </div>

                <div class="card" data-aos="fade-up" data-aos-delay="200">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-calendar-plus"></i>
                            Financial Events & Reminders
                        </h3>
                    </div>
                    
                    <div id="financial-calendar-content">
                        <!-- Calendar content will be displayed here -->
                    </div>
                    
                    <div style="text-align: center; margin: 2rem 0;">
                        <button class="btn btn-primary" onclick="loadFinancialCalendar()">
                            <i class="fas fa-calendar"></i> Load Calendar
                        </button>
                        <button class="btn btn-secondary" onclick="addFinancialEvent()">
                            <i class="fas fa-plus"></i> Add Event
                        </button>
                    </div>
                </div>
            </section>
            </main>
        </div>
    </div>

    <!-- Mobile Overlay -->
    <div class="mobile-overlay" id="mobile-overlay" onclick="closeMobileSidebar()"></div>

    <!-- Premium Chatbot -->
    <div class="chatbot-container">
        <button class="chatbot-toggle" onclick="toggleChatbot()">
            <i class="fas fa-robot"></i>
        </button>
        <div class="chatbot-window" id="chatbot-window">
                            <div class="chatbot-header">
                    <h4><i class="fas fa-robot"></i> Financial Assistant</h4>
                    <button class="close-btn" onclick="toggleChatbot()"></button>
                </div>
            <div class="chatbot-messages" id="chat-messages">
                <!-- Messages will be added here -->
            </div>
            <div class="chatbot-input">
                <input type="text" id="chat-input" placeholder="Ask me anything about finance..." onkeypress="handleChatKeyPress(event)">
                <button class="btn btn-primary btn-small" onclick="sendMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Enhanced Modals -->
    <!-- Save Profile Modal -->
    <div id="save-profile-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-save"></i> Save Profile</h3>
                <button class="close-btn" onclick="hideProfileModal()">&times;</button>
            </div>
            <form id="save-profile-form">
                <div class="form-group">
                    <label class="form-label">Profile Name <span class="required">*</span></label>
                    <input type="text" id="profile-name-input" class="form-input" placeholder="Enter a memorable name for this profile" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea id="profile-description" class="form-input" rows="3" placeholder="Optional description or notes"></textarea>
                </div>
                <div style="text-align: center; margin-top: 1.5rem;">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save Profile
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="hideProfileModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="export-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-download"></i> Export Your Data</h3>
                <button class="close-btn" onclick="hideExportModal()">&times;</button>
            </div>
            <div class="export-options">
                <div class="export-option" onclick="exportCurrentData('json')">
                    <div class="export-icon"><i class="fas fa-file-code"></i></div>
                    <div class="export-title">JSON Data File</div>
                    <div class="export-description">Complete backup for import and data portability</div>
                </div>
                <div class="export-option" onclick="exportCurrentData('pdf')">
                    <div class="export-icon"><i class="fas fa-file-pdf"></i></div>
                    <div class="export-title">PDF Summary</div>
                    <div class="export-description">Professional report format for sharing</div>
                </div>
                <div class="export-option" onclick="exportCurrentData('excel')">
                    <div class="export-icon"><i class="fas fa-file-excel"></i></div>
                    <div class="export-title">Excel Spreadsheet</div>
                    <div class="export-description">Structured data for analysis</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div id="import-data-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-upload"></i> Import Your Data</h3>
                <button class="close-btn" onclick="hideImportModal()">&times;</button>
            </div>
            <div class="file-upload" onclick="document.getElementById('import-file-input').click()">
                <div class="upload-icon"><i class="fas fa-cloud-upload-alt"></i></div>
                <div class="upload-text">Click to select or drag & drop your file here</div>
                <div class="upload-formats">Supported formats: JSON, CSV, Excel</div>
                <input type="file" id="import-file-input" accept=".json,.csv,.xlsx" style="display: none;" onchange="handleFileUpload(event)">
            </div>
            <div style="text-align: center; margin-top: 1.5rem;">
                <button class="btn btn-primary" onclick="importFromFile()">
                    <i class="fas fa-upload"></i> Import Data
                </button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-cog"></i> Application Settings</h3>
                <button class="close-btn" onclick="hideSettingsModal()">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">Currency</label>
                <select id="currency-setting" class="form-select">
                    <option value="INR"> Indian Rupee (INR)</option>
                    <option value="USD">$ US Dollar (USD)</option>
                    <option value="EUR"> Euro (EUR)</option>
                    <option value="GBP"> British Pound (GBP)</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Default Inflation Rate (%)</label>
                <input type="number" id="default-inflation" class="form-input" value="6" min="0" max="20" step="0.1">
            </div>
            <div class="form-group">
                <label class="form-label">Auto-save Interval</label>
                <select id="autosave-interval" class="form-select">
                    <option value="30">Every 30 seconds</option>
                    <option value="60">Every minute</option>
                    <option value="300">Every 5 minutes</option>
                    <option value="0">Disabled</option>
                </select>
            </div>
            <div style="text-align: center; margin-top: 1.5rem;">
                <button class="btn btn-primary" onclick="saveSettings()">
                    <i class="fas fa-save"></i> Save Settings
                </button>
                <button class="btn btn-secondary" onclick="hideSettingsModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; align-items: center; justify-content: center;">
        <div style="text-align: center; color: white;">
            <div class="loading" style="margin-bottom: 1rem;"></div>
            <div>Processing your request...</div>
        </div>
    </div>

    <!-- AOS Animation Library -->
    <script>
        // Initialize AOS (Animate On Scroll)
        document.addEventListener('DOMContentLoaded', function() {
            AOS.init({
                duration: 800,
                easing: 'ease-in-out',
                once: true,
                offset: 100
            });
        });
    </script>

    <script>
        // Enhanced Global Variables
        let currentProfileId = null;
        let clientData = {
            profileInfo: {},
            basicInfo: {},
            financialStatus: {},
            assets: [],
            loans: [],
            goals: [],
            insuranceProfile: {},
            riskProfile: {},
            assessmentResults: {},
            budgetItems: [],
            investments: [],
            settings: {
                currency: 'INR',
                defaultInflation: 6,
                autoSaveInterval: 60
            }
        };

        // Enhanced Assessment Questions (10 questions for more accuracy)
        let assessmentQuestions = [
            {
                question: "How do you react when your investments lose 20% of their value in a market downturn?",
                options: [
                    { text: "I panic and sell everything immediately to prevent further losses", score: 1 },
                    { text: "I feel very uncomfortable but hold on, hoping for recovery", score: 2 },
                    { text: "I stay calm and continue with my original investment plan", score: 3 },
                    { text: "I see it as an opportunity and invest more money", score: 4 },
                    { text: "I'm completely comfortable and might even increase my risk exposure", score: 5 }
                ]
            },
            {
                question: "What's your primary investment objective?",
                options: [
                    { text: "Preserve my capital at all costs, even if returns are minimal", score: 1 },
                    { text: "Generate steady income with minimal risk to principal", score: 2 },
                    { text: "Achieve moderate growth while maintaining some stability", score: 3 },
                    { text: "Maximize long-term wealth creation with higher risk tolerance", score: 4 },
                    { text: "Pursue maximum returns regardless of volatility or risk", score: 5 }
                ]
            },
            {
                question: "How much of your investment portfolio would you be comfortable putting in high-risk, high-reward investments?",
                options: [
                    { text: "0% - I prefer guaranteed returns only", score: 1 },
                    { text: "10-20% - Just a small portion for potential upside", score: 2 },
                    { text: "30-50% - A balanced approach with moderate risk", score: 3 },
                    { text: "60-80% - Majority in growth investments", score: 4 },
                    { text: "90-100% - Almost everything in high-growth opportunities", score: 5 }
                ]
            },
            {
                question: "What percentage of your monthly income can you comfortably invest without affecting your lifestyle?",
                options: [
                    { text: "Less than 5% - I have very tight finances", score: 1 },
                    { text: "5-10% - I can invest a small amount regularly", score: 2 },
                    { text: "10-20% - I have decent savings capacity", score: 3 },
                    { text: "20-30% - I have good surplus for investments", score: 4 },
                    { text: "More than 30% - I have substantial excess funds", score: 5 }
                ]
            },
            {
                question: "How important is it for you to access your invested money quickly if needed?",
                options: [
                    { text: "Extremely important - I need immediate access anytime", score: 1 },
                    { text: "Very important - I might need access within a few months", score: 2 },
                    { text: "Somewhat important - I can wait 1-2 years if needed", score: 3 },
                    { text: "Not very important - I can wait 3-5 years", score: 4 },
                    { text: "Not important at all - I can lock money for 10+ years", score: 5 }
                ]
            },
            {
                question: "How would you describe your investment knowledge and experience?",
                options: [
                    { text: "Complete beginner - I know very little about investing", score: 1 },
                    { text: "Basic knowledge - I understand simple investment concepts", score: 2 },
                    { text: "Moderate knowledge - I've made some investments before", score: 3 },
                    { text: "Good knowledge - I actively manage my investments", score: 4 },
                    { text: "Expert level - I have extensive investment experience", score: 5 }
                ]
            },
            {
                question: "If you had 1 lakh to invest today, what would you do?",
                options: [
                    { text: "Put it all in a fixed deposit or savings account", score: 1 },
                    { text: "Invest mostly in bonds and a little in mutual funds", score: 2 },
                    { text: "Split equally between debt and equity mutual funds", score: 3 },
                    { text: "Invest mostly in equity funds with some debt allocation", score: 4 },
                    { text: "Put it all in high-growth stocks or aggressive funds", score: 5 }
                ]
            },
            {
                question: "How do you feel about the possibility of losing money in the short term for potentially higher long-term gains?",
                options: [
                    { text: "Completely unacceptable - I cannot afford any losses", score: 1 },
                    { text: "Very uncomfortable - I prefer predictable returns", score: 2 },
                    { text: "Somewhat acceptable - if the potential gains justify it", score: 3 },
                    { text: "Quite comfortable - long-term growth is my priority", score: 4 },
                    { text: "Perfectly fine - I understand volatility is part of growth", score: 5 }
                ]
            },
            {
                question: "What's your typical reaction to financial news about market crashes or economic uncertainty?",
                options: [
                    { text: "I get very anxious and want to move everything to safe investments", score: 1 },
                    { text: "I worry but try to stick to my original plan", score: 2 },
                    { text: "I pay attention but don't make hasty decisions", score: 3 },
                    { text: "I see it as temporary and focus on long-term trends", score: 4 },
                    { text: "I view it as a buying opportunity and consider investing more", score: 5 }
                ]
            },
            {
                question: "How do you prefer to make investment decisions?",
                options: [
                    { text: "I want guaranteed returns and complete safety", score: 1 },
                    { text: "I prefer professional advice and conservative strategies", score: 2 },
                    { text: "I like balanced approaches with professional guidance", score: 3 },
                    { text: "I enjoy researching and making informed decisions myself", score: 4 },
                    { text: "I'm comfortable with complex strategies and high-risk investments", score: 5 }
                ]
            }
        ];

        let currentQuestion = 0;
        let selectedAnswers = [];
        let charts = {};
        let isChatbotOpen = false;
        let autoSaveInterval = null;

        // Enhanced Application Initialization
        document.addEventListener('DOMContentLoaded', function() {
            loadProfiles();
            initializeEventListeners();
            loadSettings();
            startAutoSave();
            loadAssessmentQuestion();
            
            // Initialize sidebar collapse state based on screen size
            const sidebar = document.getElementById('sidebar');
            if (window.innerWidth <= 768) {
                sidebar.classList.remove('mobile-open');
            }
            
            // Initialize dashboard as the default active section
            updateDashboardStats();
            
            // Initialize tooltips and animations
            setTimeout(() => {
                AOS.refresh();
            }, 100);
        });

        // Handle window resize for responsive sidebar
        window.addEventListener('resize', function() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobile-overlay');
            if (window.innerWidth > 768) {
                sidebar.classList.remove('mobile-open');
                overlay.style.display = 'none';
            }
        });

        // Enhanced Event Listeners
        function initializeEventListeners() {
            // Form event listeners
            document.getElementById('basic-info-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveBasicInfo();
            });
            
            document.getElementById('financial-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveFinancialStatus();
            });
            
            document.getElementById('asset-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addAsset();
            });
            
            document.getElementById('loan-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addLoan();
            });
            
            document.getElementById('goal-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addGoal();
            });
            
            document.getElementById('insurance-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveInsuranceProfile();
            });
            
            document.getElementById('risk-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveRiskProfile();
            });
            
            document.getElementById('sip-form').addEventListener('submit', function(e) {
                e.preventDefault();
                calculateAdvancedSIPReturns();
            });
            
            document.getElementById('tax-planning-form').addEventListener('submit', function(e) {
                e.preventDefault();
                generateAdvancedTaxPlan();
            });
            
            document.getElementById('retirement-form').addEventListener('submit', function(e) {
                e.preventDefault();
                calculateAdvancedRetirement();
            });
            
            document.getElementById('save-profile-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveCurrentProfile();
            });
            
            document.getElementById('loan-calculator-form').addEventListener('submit', function(e) {
                e.preventDefault();
                calculateLoanDetails();
            });
            
            document.getElementById('budget-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addBudgetItem();
            });
            
            document.getElementById('investment-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addInvestment();
            });
        }

        // Enhanced Profile Management
        function loadProfiles() {
            const profiles = JSON.parse(localStorage.getItem('financialPlannerProfiles') || '{}');
            const profilesContainer = document.getElementById('profiles-container');
            const welcomeMessage = document.getElementById('welcome-message');
            const savedProfiles = document.getElementById('saved-profiles');

            if (Object.keys(profiles).length === 0) {
                welcomeMessage.style.display = 'block';
                savedProfiles.style.display = 'none';
            } else {
                welcomeMessage.style.display = 'none';
                savedProfiles.style.display = 'block';
                
                profilesContainer.innerHTML = '';
                
                Object.entries(profiles).forEach(([id, profile]) => {
                    const profileCard = document.createElement('div');
                    profileCard.className = 'profile-item';
                    profileCard.setAttribute('data-aos', 'fade-up');
                    profileCard.innerHTML = `
                        <div class="profile-item-info">
                            <h4>${profile.profileInfo.name || 'Unnamed Profile'}</h4>
                            <p><i class="fas fa-calendar"></i> Created: ${new Date(profile.profileInfo.createdDate).toLocaleDateString()}</p>
                            <p><i class="fas fa-clock"></i> Last Modified: ${new Date(profile.profileInfo.lastModified).toLocaleDateString()}</p>
                            <p><i class="fas fa-info-circle"></i> ${profile.profileInfo.description || 'No description'}</p>
                        </div>
                        <div class="profile-item-actions">
                            <button class="btn btn-primary btn-small" onclick="loadProfile('${id}')">
                                <i class="fas fa-folder-open"></i> Open
                            </button>
                            <button class="btn btn-danger btn-small" onclick="deleteProfile('${id}')">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    `;
                    profilesContainer.appendChild(profileCard);
                });
                
                // Refresh AOS animations
                AOS.refresh();
            }
        }

        function createNewProfile() {
            currentProfileId = null;
            clientData = {
                profileInfo: {},
                basicInfo: {},
                financialStatus: {},
                assets: [],
                loans: [],
                goals: [],
                insuranceProfile: {},
                riskProfile: {},
                assessmentResults: {},
                budgetItems: [],
                investments: [],
                settings: {
                    currency: 'INR',
                    defaultInflation: 6,
                    autoSaveInterval: 60
                }
            };
            
            document.getElementById('profile-management').style.display = 'none';
            document.getElementById('cover-page').style.display = 'flex';
        }

        function loadProfile(profileId) {
            const profiles = JSON.parse(localStorage.getItem('financialPlannerProfiles') || '{}');
            const profile = profiles[profileId];
            
            if (profile) {
                currentProfileId = profileId;
                clientData = { ...clientData, ...profile };
                
                document.getElementById('profile-management').style.display = 'none';
                document.getElementById('main-app').style.display = 'block';
                
                loadClientData();
                updateHeaderProfileInfo();
                showAlert(`Profile "${profile.profileInfo.name}" loaded successfully!`, 'success');
            }
        }

        function deleteProfile(profileId) {
            if (confirm('Are you sure you want to delete this profile? This action cannot be undone.')) {
                const profiles = JSON.parse(localStorage.getItem('financialPlannerProfiles') || '{}');
                delete profiles[profileId];
                localStorage.setItem('financialPlannerProfiles', JSON.stringify(profiles));
                loadProfiles();
                showAlert('Profile deleted successfully!', 'success');
            }
        }

        function goBackToProfiles() {
            document.getElementById('profile-management').style.display = 'flex';
            document.getElementById('cover-page').style.display = 'none';
            document.getElementById('main-app').style.display = 'none';
            loadProfiles();
        }

        // Enhanced Navigation Functions
        function startPersonalityAssessment() {
            document.getElementById('cover-page').style.display = 'none';
            document.getElementById('main-app').style.display = 'block';
            showSection('personality');
            loadAssessmentQuestion();
        }

        function startClientProfiling() {
            document.getElementById('cover-page').style.display = 'none';
            document.getElementById('main-app').style.display = 'block';
            showSection('profile');
        }

        // New Sidebar Navigation Functions
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobile-overlay');
            const isMobile = window.innerWidth <= 768;
            
            if (isMobile) {
                const isOpen = sidebar.classList.toggle('mobile-open');
                overlay.style.display = isOpen ? 'block' : 'none';
            } else {
                sidebar.classList.toggle('collapsed');
            }
        }

        function closeMobileSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobile-overlay');
            sidebar.classList.remove('mobile-open');
            overlay.style.display = 'none';
        }

        function toggleNavItem(element) {
            const navItem = element.parentElement;
            const isExpanded = navItem.classList.contains('expanded');
            
            // Close all other nav items
            document.querySelectorAll('.nav-item.expanded').forEach(item => {
                if (item !== navItem) {
                    item.classList.remove('expanded');
                }
            });
            
            // Toggle current nav item
            navItem.classList.toggle('expanded', !isExpanded);
        }

        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
            
            // Show selected section
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
            }

            // Update navigation active states
            document.querySelectorAll('.nav-link, .nav-sublink').forEach(link => {
                link.classList.remove('active');
            });

            // Find and activate the corresponding nav link
            const navLink = document.querySelector(`[onclick="showSection('${sectionId}')"]`);
            if (navLink) {
                navLink.classList.add('active');
                
                // If it's a sublink, also expand the parent
                if (navLink.classList.contains('nav-sublink')) {
                    const parentNavItem = navLink.closest('.nav-item');
                    if (parentNavItem) {
                        parentNavItem.classList.add('expanded');
                        const parentLink = parentNavItem.querySelector('.nav-link');
                        if (parentLink) {
                            parentLink.classList.add('active');
                        }
                    }
                }
            }

            // Update breadcrumb
            updateBreadcrumb(sectionId);

            // Auto-save when switching sections
            if (currentProfileId) {
                autoSave();
            }
            
            // Update dashboard stats when switching to dashboard
            if (sectionId === 'dashboard') {
                updateDashboardStats();
            }

            // Close mobile sidebar when switching sections
            if (window.innerWidth <= 768) {
                closeMobileSidebar();
            }
            
            // Refresh AOS animations for the new section
            setTimeout(() => {
                AOS.refresh();
            }, 100);
        }

        function updateBreadcrumb(sectionId) {
            const breadcrumbTitle = document.getElementById('current-section-title');
            const sectionTitles = {
                'dashboard': 'Dashboard',
                'personality': 'Financial Assessment',
                'profile': 'Basic Information',
                'financial': 'Financial Status',
                'networth': 'Net Worth Calculator',
                'goals': 'Goals & Insurance',
                'risk': 'Risk Profile',
                'recommendations': 'Investment Recommendations',
                'portfolio': 'Portfolio Analysis',
                'sip': 'SIP Calculator',
                'tax': 'Tax Planning',
                'retirement': 'Retirement Planning',
                'comparison': 'Product Comparison',
                'analytics': 'Analytics Dashboard',
                'reports': 'Professional Reports',
                'summary': 'Executive Summary',
                'alerts': 'Smart Alerts',
                'loan-calculator': 'Loan Calculator',
                'budget-planner': 'Budget Planner',
                'investment-tracker': 'Investment Tracker',
                'financial-calendar': 'Financial Calendar'
            };
            
            if (breadcrumbTitle && sectionTitles[sectionId]) {
                breadcrumbTitle.textContent = sectionTitles[sectionId];
            }
        }

        function updateDashboardStats() {
            // Update dashboard statistics with current data
            const netWorthElement = document.getElementById('dashboard-net-worth');
            const monthlySavingsElement = document.getElementById('dashboard-monthly-savings');
            const investmentValueElement = document.getElementById('dashboard-investment-value');
            const financialScoreElement = document.getElementById('dashboard-financial-score');

            if (clientData.financialStatus) {
                const netWorth = (clientData.financialStatus.currentSavings || 0) - (clientData.financialStatus.currentDebt || 0);
                const monthlySavings = clientData.financialStatus.monthlySavings || 0;
                const savingsRate = clientData.financialStatus.savingsRate || 0;

                if (netWorthElement) netWorthElement.textContent = `${formatCurrency(netWorth)}`;
                if (monthlySavingsElement) monthlySavingsElement.textContent = `${formatCurrency(monthlySavings)}`;
                if (financialScoreElement) financialScoreElement.textContent = `${Math.round(savingsRate)}%`;
            }

            // Calculate total investment value from assets
            let totalInvestments = 0;
            if (clientData.assets) {
                totalInvestments = clientData.assets.reduce((sum, asset) => {
                    if (asset.type === 'stocks' || asset.type === 'crypto' || asset.type === 'business') {
                        return sum + (asset.value || 0);
                    }
                    return sum;
                }, 0);
            }

            if (investmentValueElement) {
                investmentValueElement.textContent = `${formatCurrency(totalInvestments)}`;
            }
        }

        // Enhanced Auto-save System
        function startAutoSave() {
            const interval = clientData.settings?.autoSaveInterval || 60;
            if (interval > 0) {
                autoSaveInterval = setInterval(() => {
                    if (currentProfileId) {
                        autoSave();
                    }
                }, interval * 1000);
            }
        }

        function autoSave() {
            if (!currentProfileId) return;
            
            clientData.profileInfo.lastModified = new Date().toISOString();
            const profiles = JSON.parse(localStorage.getItem('financialPlannerProfiles') || '{}');
            profiles[currentProfileId] = clientData;
            localStorage.setItem('financialPlannerProfiles', JSON.stringify(profiles));
            
            // Update profile status indicator
            const statusIndicator = document.getElementById('current-profile-status');
            if (statusIndicator) {
                statusIndicator.style.color = '#00ff88';
                setTimeout(() => {
                    statusIndicator.style.color = '#aaaaaa';
                }, 1000);
            }
        }

        // Enhanced Assessment Functions
        function loadAssessmentQuestion() {
            if (currentQuestion >= assessmentQuestions.length) {
                completeAssessment();
                return;
            }

            const question = assessmentQuestions[currentQuestion];
            document.getElementById('question-number').textContent = `Question ${currentQuestion + 1} of ${assessmentQuestions.length}`;
            document.getElementById('question-text').textContent = question.question;

            const optionsContainer = document.getElementById('question-options');
            optionsContainer.innerHTML = '';

            question.options.forEach((option, index) => {
                const optionBtn = document.createElement('button');
                optionBtn.className = 'option-btn';
                optionBtn.textContent = option.text;
                optionBtn.onclick = () => selectOption(index);
                optionBtn.setAttribute('data-aos', 'fade-up');
                optionBtn.setAttribute('data-aos-delay', (index * 100).toString());
                optionsContainer.appendChild(optionBtn);
            });

            // Update progress bar
            const progress = ((currentQuestion) / assessmentQuestions.length) * 100;
            document.getElementById('assessment-progress').style.width = progress + '%';

            // Show/hide navigation buttons
            document.getElementById('prev-btn').style.display = currentQuestion > 0 ? 'inline-flex' : 'none';
            document.getElementById('next-btn').style.display = 'none';
            
            // Refresh AOS animations
            AOS.refresh();
        }

        function selectOption(optionIndex) {
            // Remove previous selection
            document.querySelectorAll('.option-btn').forEach(btn => btn.classList.remove('selected'));
            
            // Add selection to clicked option
            event.target.classList.add('selected');
            
            // Store answer
            selectedAnswers[currentQuestion] = {
                questionIndex: currentQuestion,
                optionIndex: optionIndex,
                score: assessmentQuestions[currentQuestion].options[optionIndex].score
            };

            // Show next button
            document.getElementById('next-btn').style.display = 'inline-flex';
        }

        function nextQuestion() {
            if (selectedAnswers[currentQuestion]) {
                currentQuestion++;
                loadAssessmentQuestion();
            }
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                loadAssessmentQuestion();
                
                // Restore previous selection
                if (selectedAnswers[currentQuestion]) {
                    const optionBtns = document.querySelectorAll('.option-btn');
                    optionBtns[selectedAnswers[currentQuestion].optionIndex].classList.add('selected');
                    document.getElementById('next-btn').style.display = 'inline-flex';
                }
            }
        }

        function completeAssessment() {
            // Calculate total score
            const totalScore = selectedAnswers.reduce((sum, answer) => sum + answer.score, 0);
            const averageScore = totalScore / assessmentQuestions.length;

            let personalityType, description, insights;

            if (averageScore <= 1.5) {
                personalityType = "Ultra Conservative Investor";
                description = "You prioritize capital preservation above all else. Your investment strategy should focus on guaranteed returns through fixed deposits, government bonds, and conservative debt funds.";
                insights = [
                    " Focus on capital protection strategies",
                    " Consider government securities and high-grade bonds",
                    " Build a substantial emergency fund",
                    " Start with small equity exposure (5-10%) to build confidence"
                ];
            } else if (averageScore <= 2.5) {
                personalityType = "Conservative Investor";
                description = "You prefer stability and steady returns. A balanced approach with emphasis on debt instruments and gradual equity exposure suits your profile.";
                insights = [
                    " Maintain 70% debt, 30% equity allocation",
                    " Focus on large-cap mutual funds for equity exposure",
                    " Consider hybrid funds for balanced growth",
                    " Regular portfolio reviews to build confidence"
                ];
            } else if (averageScore <= 3.5) {
                personalityType = "Moderate Investor";
                description = "You seek balanced growth with moderate risk. A diversified portfolio with equal emphasis on growth and stability aligns with your investment philosophy.";
                insights = [
                    " Balanced 50-60% equity, 40-50% debt allocation",
                    " Include international diversification",
                    " Mix of large-cap and mid-cap funds",
                    " Perfect for long-term SIP strategies"
                ];
            } else if (averageScore <= 4.5) {
                personalityType = "Growth Investor";
                description = "You're comfortable with higher risk for better returns. Equity-focused investments with some debt allocation for stability suits your profile.";
                insights = [
                    " Aggressive 70-80% equity allocation",
                    " Include mid-cap and small-cap exposure",
                    " Consider ELSS funds for tax benefits",
                    " Regular rebalancing for optimal returns"
                ];
            } else {
                personalityType = "Aggressive Investor";
                description = "You're willing to take high risks for maximum returns. Focus on high-growth equity investments, emerging markets, and alternative investments.";
                insights = [
                    " Maximum equity exposure (80-90%)",
                    " Include international and emerging market funds",
                    " Consider alternative investments",
                    " High-risk, high-reward strategies"
                ];
            }

            // Store results
            clientData.assessmentResults = {
                personalityType: personalityType,
                description: description,
                score: averageScore,
                insights: insights,
                completedDate: new Date().toISOString()
            };

            // Display results
            document.getElementById('assessment-questions').style.display = 'none';
            document.getElementById('assessment-results').style.display = 'block';
            document.getElementById('personality-type').textContent = personalityType;
            document.getElementById('personality-description').textContent = description;
            
            // Display insights
            const insightsContent = document.getElementById('insights-content');
            insightsContent.innerHTML = `
                <ul style="list-style: none; padding: 0; margin: 1rem 0;">
                    ${insights.map(insight => `<li style="padding: 0.5rem 0; border-bottom: 1px solid var(--border-gray);">${insight}</li>`).join('')}
                </ul>
            `;

            // Update progress bar to 100%
            document.getElementById('assessment-progress').style.width = '100%';
            
            // Auto-save results
            if (currentProfileId) {
                autoSave();
            }
        }

        function proceedToClientProfiling() {
            showSection('profile');
        }

        // Enhanced Basic Info Functions
        function saveBasicInfo() {
            clientData.basicInfo = {
                name: document.getElementById('client-name').value,
                age: parseInt(document.getElementById('client-age').value),
                occupation: document.getElementById('client-occupation').value,
                maritalStatus: document.getElementById('marital-status').value,
                dependents: parseInt(document.getElementById('dependents').value),
                city: document.getElementById('client-city').value,
                incomeRange: document.getElementById('income-range').value,
                educationLevel: document.getElementById('education-level').value,
                lastUpdated: new Date().toISOString()
            };

            displayBasicInfo();
            autoSave();
            showAlert('Profile information saved successfully!', 'success');
        }

        function displayBasicInfo() {
            const info = clientData.basicInfo;
            document.getElementById('basic-info-form').style.display = 'none';
            document.getElementById('saved-basic-info').style.display = 'block';
            
            document.getElementById('basic-info-display').innerHTML = `
                <div class="data-display">
                    <div class="data-row">
                        <span class="data-label"> Name:</span>
                        <span class="data-value">${info.name}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label"> Age:</span>
                        <span class="data-value">${info.age} years</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label"> Occupation:</span>
                        <span class="data-value">${info.occupation}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label"> Marital Status:</span>
                        <span class="data-value">${info.maritalStatus}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label"> Dependents:</span>
                        <span class="data-value">${info.dependents}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label"> City:</span>
                        <span class="data-value">${info.city}</span>
                    </div>
                    ${info.incomeRange ? `
                    <div class="data-row">
                        <span class="data-label"> Income Range:</span>
                        <span class="data-value">${info.incomeRange}</span>
                    </div>
                    ` : ''}
                    ${info.educationLevel ? `
                    <div class="data-row">
                        <span class="data-label"> Education:</span>
                        <span class="data-value">${info.educationLevel}</span>
                    </div>
                    ` : ''}
                </div>
            `;
        }

        function editBasicInfo() {
            document.getElementById('basic-info-form').style.display = 'block';
            document.getElementById('saved-basic-info').style.display = 'none';
        }

        // Enhanced Financial Status Functions
        function saveFinancialStatus() {
            const monthlyIncome = parseFloat(document.getElementById('monthly-income').value);
            const monthlyExpenses = parseFloat(document.getElementById('monthly-expenses').value);
            const currentSavings = parseFloat(document.getElementById('current-savings').value);
            const annualIncome = parseFloat(document.getElementById('annual-income').value);
            const emergencyTarget = parseInt(document.getElementById('emergency-target').value) || 6;
            const currentDebt = parseFloat(document.getElementById('current-debt').value) || 0;

            clientData.financialStatus = {
                monthlyIncome,
                monthlyExpenses,
                currentSavings,
                annualIncome,
                emergencyTarget,
                currentDebt,
                monthlySavings: monthlyIncome - monthlyExpenses,
                savingsRate: monthlyIncome > 0 ? ((monthlyIncome - monthlyExpenses) / monthlyIncome * 100) : 0,
                emergencyFundNeeded: monthlyExpenses * emergencyTarget,
                debtToIncomeRatio: annualIncome > 0 ? (currentDebt / annualIncome * 100) : 0,
                lastUpdated: new Date().toISOString()
            };

            displayFinancialInfo();
            generateFinancialInsights();
            autoSave();
            showAlert('Financial status analyzed successfully!', 'success');
        }

        function displayFinancialInfo() {
            const info = clientData.financialStatus;
            document.getElementById('financial-form').style.display = 'none';
            document.getElementById('saved-financial-info').style.display = 'block';
            
            document.getElementById('financial-info-display').innerHTML = `
                <div class="data-display">
                    <div class="data-row">
                        <span class="data-label"> Monthly Income:</span>
                        <span class="data-value">${formatCurrency(info.monthlyIncome)}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label"> Monthly Expenses:</span>
                        <span class="data-value">${formatCurrency(info.monthlyExpenses)}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label"> Monthly Savings:</span>
                        <span class="data-value">${formatCurrency(info.monthlySavings)}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label"> Savings Rate:</span>
                        <span class="data-value">${info.savingsRate.toFixed(1)}%</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label"> Current Savings:</span>
                        <span class="data-value">${formatCurrency(info.currentSavings)}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label"> Annual Income:</span>
                        <span class="data-value">${formatCurrency(info.annualIncome)}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label"> Emergency Fund Needed:</span>
                        <span class="data-value">${formatCurrency(info.emergencyFundNeeded)}</span>
                    </div>
                    ${info.currentDebt > 0 ? `
                    <div class="data-row">
                        <span class="data-label"> Debt-to-Income Ratio:</span>
                        <span class="data-value">${info.debtToIncomeRatio.toFixed(1)}%</span>
                    </div>
                    ` : ''}
                </div>
            `;
        }

        function generateFinancialInsights() {
            const info = clientData.financialStatus;
            const insights = [];
            
            if (info.savingsRate < 10) {
                insights.push(" Your savings rate is below 10%. Consider reducing expenses or increasing income.");
            } else if (info.savingsRate >= 20) {
                insights.push(" Excellent savings rate! You're on track for strong financial growth.");
            }
            
            if (info.currentSavings < info.emergencyFundNeeded) {
                const shortfall = info.emergencyFundNeeded - info.currentSavings;
                insights.push(` Emergency fund shortfall: ${formatCurrency(shortfall)}. Build this as priority.`);
            }
            
            if (info.debtToIncomeRatio > 40) {
                insights.push(" High debt-to-income ratio. Focus on debt reduction strategies.");
            }
            
            if (info.monthlySavings > 0) {
                const monthsToEmergencyFund = Math.ceil((info.emergencyFundNeeded - info.currentSavings) / info.monthlySavings);
                if (monthsToEmergencyFund > 0) {
                    insights.push(` At current savings rate, you can build emergency fund in ${monthsToEmergencyFund} months.`);
                }
            }
            
            document.getElementById('financial-insights-content').innerHTML = `
                <ul style="list-style: none; padding: 0; margin: 1rem 0;">
                    ${insights.map(insight => `<li style="padding: 0.75rem 0; border-bottom: 1px solid var(--border-gray);">${insight}</li>`).join('')}
                </ul>
            `;
        }

        function editFinancialInfo() {
            document.getElementById('financial-form').style.display = 'block';
            document.getElementById('saved-financial-info').style.display = 'none';
        }

        // Utility Functions
        function formatCurrency(amount) {
            if (amount >= 10000000) {
                return (amount / 10000000).toFixed(2) + ' Cr';
            } else if (amount >= 100000) {
                return (amount / 100000).toFixed(2) + ' L';
            } else if (amount >= 1000) {
                return (amount / 1000).toFixed(0) + 'K';
            }
            return Math.round(amount).toLocaleString('en-IN');
        }

        function showAlert(message, type = 'success') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.style.cssText = `
                position: fixed;
                top: 2rem;
                right: 2rem;
                z-index: 10000;
                min-width: 350px;
                max-width: 500px;
                animation: slideIn 0.3s ease-out;
            `;
            alertDiv.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'danger' ? 'exclamation-triangle' : 'info-circle'}"></i>
                ${message}
                <button onclick="this.parentElement.remove()" style="float: right; background: none; border: none; color: inherit; font-size: 1.2em; cursor: pointer; padding: 0.25rem;">&times;</button>
            `;
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                if (alertDiv.parentElement) {
                    alertDiv.style.animation = 'slideOut 0.3s ease-in';
                    setTimeout(() => alertDiv.remove(), 300);
                }
            }, 5000);
        }

        // Enhanced Chatbot Functions
        function toggleChatbot() {
            const chatbotWindow = document.getElementById('chatbot-window');
            isChatbotOpen = !isChatbotOpen;
            chatbotWindow.style.display = isChatbotOpen ? 'block' : 'none';
            
            if (isChatbotOpen && document.getElementById('chat-messages').children.length === 0) {
                addMessageToChat('bot', 'Hello! I\'m your Financial Assistant. I can help you with investment strategies, financial planning, tax optimization, and answer any questions about your financial journey. What would you like to know?');
            }
        }

        function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (message === '') return;

            // Add user message to chat
            addMessageToChat('user', message);
            
            // Clear input
            input.value = '';

            // Show typing indicator
            showTypingIndicator();

            // Simulate bot response with delay
            setTimeout(() => {
                hideTypingIndicator();
                const response = generateAdvancedBotResponse(message);
                addMessageToChat('bot', response);
            }, 1500);
        }

        function addMessageToChat(sender, message) {
            const chatMessages = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}`;
            
            if (sender === 'bot') {
                messageDiv.innerHTML = `
                    <div class="message-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content">${message}</div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="message-content">${message}</div>
                    <div class="message-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                `;
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTypingIndicator() {
            const chatMessages = document.getElementById('chat-messages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'chat-message bot typing-indicator';
            typingDiv.id = 'typing-indicator';
            typingDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="message-content">
                    <div class="typing-dots">
                        <span></span><span></span><span></span>
                    </div>
                </div>
            `;
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        function generateAdvancedBotResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            // Analyze user's financial data for personalized responses
            const hasFinancialData = clientData.financialStatus && clientData.financialStatus.monthlyIncome;
            const hasAssessment = clientData.assessmentResults && clientData.assessmentResults.personalityType;
            
            if (lowerMessage.includes('sip') || lowerMessage.includes('systematic investment')) {
                const monthlyCapacity = hasFinancialData ? clientData.financialStatus.monthlySavings : 10000;
                return `SIP is an excellent wealth-building strategy! ${hasFinancialData ? `Based on your monthly savings of ${formatCurrency(monthlyCapacity)}, you could start with a SIP of ${formatCurrency(monthlyCapacity * 0.7)} across diversified funds.` : 'I recommend starting with at least 5,000 monthly.'} ${hasAssessment ? `Given your ${clientData.assessmentResults.personalityType} profile, I can suggest specific fund categories that match your risk tolerance.` : 'Complete the assessment for personalized fund recommendations!'} Would you like me to calculate potential returns for different SIP amounts?`;
            }
            
            if (lowerMessage.includes('retirement') || lowerMessage.includes('retire')) {
                const age = hasFinancialData && clientData.basicInfo.age ? clientData.basicInfo.age : 30;
                const yearsToRetirement = 60 - age;
                return `Retirement planning is crucial for financial freedom! ${age ? `At ${age} years, you have approximately ${yearsToRetirement} years until retirement.` : ''} ${hasFinancialData ? `With your current monthly expenses of ${formatCurrency(clientData.financialStatus.monthlyExpenses)}, you'd need approximately ${formatCurrency(clientData.financialStatus.monthlyExpenses * 12 * 25)} as a retirement corpus (25x annual expenses rule).` : 'The general rule is to accumulate 25-30 times your annual expenses.'} Start early to leverage the power of compounding! Would you like me to create a detailed retirement plan?`;
            }
            
            if (lowerMessage.includes('tax') || lowerMessage.includes('80c') || lowerMessage.includes('saving tax')) {
                return `Smart tax planning can save you significant money! Under Section 80C, you can save up to 46,800 annually by investing 1.5 lakhs. Best options include ELSS mutual funds (equity returns + tax benefits), PPF (15-year lock-in), and EPF contributions. ${hasFinancialData && clientData.financialStatus.annualIncome ? `Based on your income level, you could be in the ${clientData.financialStatus.annualIncome > 1000000 ? '30%' : clientData.financialStatus.annualIncome > 500000 ? '20%' : '5%'} tax bracket.` : ''} Section 80D offers additional savings for health insurance premiums. Would you like a detailed tax optimization strategy?`;
            }
            
            if (lowerMessage.includes('emergency') || lowerMessage.includes('fund')) {
                const emergencyNeeded = hasFinancialData ? clientData.financialStatus.emergencyFundNeeded : 300000;
                const currentSavings = hasFinancialData ? clientData.financialStatus.currentSavings : 0;
                return `An emergency fund is your financial safety net! ${hasFinancialData ? `You need ${formatCurrency(emergencyNeeded)} (${clientData.financialStatus.emergencyTarget} months of expenses). You currently have ${formatCurrency(currentSavings)}, so you need ${formatCurrency(Math.max(0, emergencyNeeded - currentSavings))} more.` : 'Aim for 6-12 months of expenses in easily accessible accounts.'} Keep this in liquid funds, savings accounts, or short-term FDs. Build this before investing in market-linked products. Need help creating an emergency fund strategy?`;
            }
            
            if (lowerMessage.includes('insurance') || lowerMessage.includes('life insurance') || lowerMessage.includes('health insurance')) {
                const annualIncome = hasFinancialData ? clientData.financialStatus.annualIncome : 600000;
                return `Insurance is crucial for financial protection! Life insurance should be 10-15 times your annual income. ${hasFinancialData ? `For your income of ${formatCurrency(annualIncome)}, consider ${formatCurrency(annualIncome * 12)} life coverage.` : 'For most people, 50-75 lakhs is a good starting point.'} Health insurance should be minimum 5 lakhs per family member, preferably 10+ lakhs in metro cities. Term insurance is cost-effective for life cover. ${hasFinancialData && clientData.basicInfo.dependents ? `With ${clientData.basicInfo.dependents} dependents, adequate coverage is even more critical.` : ''} Want help calculating your exact insurance needs?`;
            }
            
            if (lowerMessage.includes('goal') || lowerMessage.includes('planning') || lowerMessage.includes('financial plan')) {
                const goalsCount = clientData.goals ? clientData.goals.length : 0;
                return `Goal-based financial planning is the foundation of wealth creation! ${goalsCount > 0 ? `I see you have ${goalsCount} goals defined. Each goal needs a specific investment strategy based on time horizon and risk tolerance.` : 'Start by defining SMART financial goals - Specific, Measurable, Achievable, Relevant, Time-bound.'} ${hasAssessment ? `Your ${clientData.assessmentResults.personalityType} profile suggests specific strategies for each goal type.` : ''} Short-term goals (1-3 years) need debt instruments, medium-term (3-7 years) need balanced funds, and long-term (7+ years) can handle more equity exposure. Ready to create a comprehensive financial plan?`;
            }
            
            if (lowerMessage.includes('risk') || lowerMessage.includes('volatile') || lowerMessage.includes('loss')) {
                const riskProfile = hasAssessment ? clientData.assessmentResults.personalityType : 'Moderate Investor';
                return `Understanding risk is key to successful investing! ${hasAssessment ? `As a ${riskProfile}, your risk tolerance is well-defined. This means you should allocate ${riskProfile.includes('Conservative') ? '20-40%' : riskProfile.includes('Aggressive') ? '70-90%' : '50-70%'} to equity investments.` : 'Complete the risk assessment to get personalized recommendations!'} Remember: Higher risk = Higher potential returns, but also higher volatility. Diversification across asset classes, time horizons, and geographies reduces overall portfolio risk. The key is matching your investments to your risk capacity and tolerance. Want specific risk management strategies?`;
            }
            
            if (lowerMessage.includes('debt') || lowerMessage.includes('loan') || lowerMessage.includes('emi')) {
                const debtRatio = hasFinancialData ? clientData.financialStatus.debtToIncomeRatio : 0;
                return `Smart debt management is crucial for financial health! ${hasFinancialData && debtRatio > 0 ? `Your debt-to-income ratio is ${debtRatio.toFixed(1)}%. ${debtRatio > 40 ? 'This is high - focus on debt reduction as priority.' : 'This is manageable, but still optimize it.'}` : ''} Priority order: 1) Pay off high-interest debt (credit cards, personal loans) first, 2) Consider prepayment for home loans if rate > 8%, 3) Maintain good EMI-to-income ratio (<40%). For home loans, every 1 lakh prepayment can save 2-3 lakhs in interest over the loan tenure. Need a debt optimization strategy?`;
            }
            
            if (lowerMessage.includes('mutual fund') || lowerMessage.includes('mf') || lowerMessage.includes('fund')) {
                const riskProfile = hasAssessment ? clientData.assessmentResults.personalityType : null;
                return `Mutual funds are excellent for diversified investing! ${riskProfile ? `For ${riskProfile}s, I recommend: ${riskProfile.includes('Conservative') ? 'Large-cap funds, hybrid funds, and debt funds' : riskProfile.includes('Aggressive') ? 'Mid-cap, small-cap, and international funds' : 'Balanced mix of large-cap, mid-cap, and debt funds'}.` : ''} Key factors: 1) Expense ratio (<1% for equity, <0.5% for debt), 2) Consistent performance over 3-5 years, 3) Fund manager track record, 4) AUM size (500Cr - 20,000Cr ideal). Always invest through SIP for rupee cost averaging. Want specific fund recommendations based on your profile?`;
            }
            
            if (lowerMessage.includes('stock') || lowerMessage.includes('equity') || lowerMessage.includes('share')) {
                return `Direct equity investing requires knowledge and time! Start with mutual funds if you're new to markets. For direct stocks: 1) Invest only surplus money, 2) Research company fundamentals, 3) Diversify across sectors, 4) Have 3-5 year minimum horizon, 5) Never invest based on tips. Blue-chip stocks are safer but offer moderate returns. Mid and small-cap stocks are riskier but offer higher growth potential. ${hasAssessment && clientData.assessmentResults.personalityType.includes('Conservative') ? 'Given your conservative nature, stick to large-cap stocks or equity mutual funds.' : ''} Want to learn fundamental analysis basics?`;
            }
            
            if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('hey')) {
                const name = hasFinancialData && clientData.basicInfo.name ? clientData.basicInfo.name : 'there';
                return `Hello ${name}!  I'm your AI Financial Assistant, here to help you make informed financial decisions. ${hasAssessment ? `I see you're a ${clientData.assessmentResults.personalityType} - great choice completing the assessment!` : ''} ${hasFinancialData ? `I have access to your financial profile and can provide personalized advice.` : 'Complete your financial profile for personalized recommendations.'} I can help with investment strategies, retirement planning, tax optimization, insurance planning, and answer any financial questions. What would you like to explore today?`;
            }
            
            if (lowerMessage.includes('help') || lowerMessage.includes('what can you do')) {
                return `I'm here to be your comprehensive financial guide!  Here's how I can help:\n\n **Investment Advice**: SIP strategies, mutual funds, stocks, asset allocation\n **Financial Planning**: Goal-based planning, retirement strategies\n **Tax Optimization**: 80C, 80D, tax-saving investments\n **Insurance Planning**: Life & health insurance calculations\n **Portfolio Analysis**: Risk assessment, rebalancing strategies\n **Banking**: Emergency funds, loan optimization\n **Financial Education**: Concepts, strategies, market insights\n\nJust ask me anything about your financial journey - I'll provide personalized advice based on your profile!`;
            }
            
            // Default personalized response
            const personalizedGreeting = hasFinancialData && clientData.basicInfo.name ? `Hi ${clientData.basicInfo.name}! ` : 'Hello! ';
            return `${personalizedGreeting}That's a great question about financial planning! ${hasAssessment ? `Based on your ${clientData.assessmentResults.personalityType} profile, ` : ''}I'd recommend focusing on building a diversified portfolio aligned with your risk tolerance and financial goals. ${hasFinancialData ? `With your current financial situation, we can create a customized strategy for wealth building.` : 'Complete your financial profile for personalized recommendations.'} Feel free to ask about specific areas like SIP planning, tax saving, retirement planning, insurance, or any other financial topics. I'm here to help you make informed decisions! `;
        }

        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // Settings Functions
        function showSettingsModal() {
            document.getElementById('settings-modal').style.display = 'flex';
            loadCurrentSettings();
        }

        function hideSettingsModal() {
            document.getElementById('settings-modal').style.display = 'none';
        }

        function loadCurrentSettings() {
            document.getElementById('currency-setting').value = clientData.settings?.currency || 'INR';
            document.getElementById('default-inflation').value = clientData.settings?.defaultInflation || 6;
            document.getElementById('autosave-interval').value = clientData.settings?.autoSaveInterval || 60;
        }

        function saveSettings() {
            clientData.settings = {
                currency: document.getElementById('currency-setting').value,
                defaultInflation: parseFloat(document.getElementById('default-inflation').value),
                autoSaveInterval: parseInt(document.getElementById('autosave-interval').value)
            };
            
            // Restart auto-save with new interval
            if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
            }
            startAutoSave();
            
            autoSave();
            hideSettingsModal();
            showAlert('Settings saved successfully!', 'success');
        }

        function loadSettings() {
            const savedSettings = localStorage.getItem('financialPlannerSettings');
            if (savedSettings) {
                clientData.settings = { ...clientData.settings, ...JSON.parse(savedSettings) };
            }
        }

        // Modal Functions
        function showProfileModal() {
            document.getElementById('save-profile-modal').style.display = 'flex';
            document.getElementById('profile-name-input').focus();
        }

        function hideProfileModal() {
            document.getElementById('save-profile-modal').style.display = 'none';
            document.getElementById('profile-name-input').value = '';
            document.getElementById('profile-description').value = '';
        }

        function showExportModal() {
            document.getElementById('export-modal').style.display = 'flex';
        }

        function hideExportModal() {
            document.getElementById('export-modal').style.display = 'none';
        }

        function showImportModal() {
            document.getElementById('import-data-modal').style.display = 'flex';
        }

        function hideImportModal() {
            document.getElementById('import-data-modal').style.display = 'none';
        }

        function saveCurrentProfile() {
            if (currentProfileId) {
                autoSave();
                showAlert('Profile updated successfully!', 'success');
            } else {
                showProfileModal();
            }
        }

        // Enhanced Profile Save Function
        function saveProfile() {
            const profileName = document.getElementById('profile-name-input').value.trim();
            const profileDescription = document.getElementById('profile-description').value.trim();
            
            if (!profileName) {
                showAlert('Please enter a profile name', 'danger');
                return;
            }

            const profileId = Date.now().toString();
            const profiles = JSON.parse(localStorage.getItem('financialPlannerProfiles') || '{}');
            
            clientData.profileInfo = {
                name: profileName,
                description: profileDescription,
                createdDate: new Date().toISOString(),
                lastModified: new Date().toISOString()
            };

            profiles[profileId] = clientData;
            localStorage.setItem('financialPlannerProfiles', JSON.stringify(profiles));
            
            currentProfileId = profileId;
            hideProfileModal();
            showAlert(`Profile "${profileName}" saved successfully!`, 'success');
            updateHeaderProfileInfo();
        }

        // Event listener for profile form
        document.getElementById('save-profile-form').addEventListener('submit', function(e) {
            e.preventDefault();
            saveProfile();
        });

        function updateHeaderProfileInfo() {
            const profileInfo = clientData.profileInfo;
            const nameElement = document.getElementById('current-profile-name');
            
            if (profileInfo && profileInfo.name) {
                nameElement.textContent = profileInfo.name;
            } else {
                nameElement.textContent = 'Unsaved Profile';
            }
        }

        // Export Functions
        function exportCurrentData(format) {
            const dataToExport = {
                ...clientData,
                exportDate: new Date().toISOString(),
                version: '2.0',
                appName: 'Financial Planner Pro Advanced'
            };
            
            if (format === 'json') {
                const dataStr = JSON.stringify(dataToExport, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `financial_data_${clientData.profileInfo.name || 'profile'}_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                showAlert('Data exported successfully as JSON!', 'success');
            } else if (format === 'pdf') {
                generatePDFExport();
            } else if (format === 'excel') {
                generateExcelExport();
            }
            
            hideExportModal();
        }

        function generatePDFExport() {
            showAlert('PDF export feature coming soon! This will generate a comprehensive financial report.', 'info');
        }

        function generateExcelExport() {
            showAlert('Excel export feature coming soon! This will create a structured spreadsheet with all your data.', 'info');
        }

        // Import Functions
        function importFromFile() {
            const fileInput = document.getElementById('import-file-input');
            const file = fileInput.files[0];
            
            if (!file) {
                showAlert('Please select a file to import', 'danger');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (importedData.basicInfo || importedData.financialStatus || importedData.assets) {
                        // Merge imported data with current structure
                        clientData = { ...clientData, ...importedData };
                        
                        // Generate new profile ID
                        currentProfileId = Date.now().toString();
                        clientData.profileInfo.lastModified = new Date().toISOString();
                        
                        // Save imported profile
                        const profiles = JSON.parse(localStorage.getItem('financialPlannerProfiles') || '{}');
                        profiles[currentProfileId] = clientData;
                        localStorage.setItem('financialPlannerProfiles', JSON.stringify(profiles));
                        
                        hideImportModal();
                        showAlert('Data imported successfully! Profile has been created.', 'success');
                        loadClientData();
                        updateHeaderProfileInfo();
                    } else {
                        showAlert('Invalid file format. Please upload a valid Financial Planner Pro export file.', 'danger');
                    }
                } catch (error) {
                    showAlert('Error reading file. Please check if it\'s a valid JSON file.', 'danger');
                }
            };
            
            reader.readAsText(file);
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                // Visual feedback for file selection
                const uploadArea = document.querySelector('.file-upload');
                uploadArea.style.borderColor = '#00ff88';
                uploadArea.querySelector('.upload-text').textContent = `Selected: ${file.name}`;
                
                setTimeout(() => {
                    uploadArea.style.borderColor = '';
                    uploadArea.querySelector('.upload-text').textContent = 'Click to select or drag & drop your file here';
                }, 2000);
            }
        }

        function loadClientData() {
            // Load basic info
            if (clientData.basicInfo && clientData.basicInfo.name) {
                document.getElementById('client-name').value = clientData.basicInfo.name;
                document.getElementById('client-age').value = clientData.basicInfo.age;
                document.getElementById('client-occupation').value = clientData.basicInfo.occupation;
                document.getElementById('marital-status').value = clientData.basicInfo.maritalStatus;
                document.getElementById('dependents').value = clientData.basicInfo.dependents;
                document.getElementById('client-city').value = clientData.basicInfo.city;
                if (clientData.basicInfo.incomeRange) document.getElementById('income-range').value = clientData.basicInfo.incomeRange;
                if (clientData.basicInfo.educationLevel) document.getElementById('education-level').value = clientData.basicInfo.educationLevel;
                displayBasicInfo();
            }

            // Load financial status
            if (clientData.financialStatus && clientData.financialStatus.monthlyIncome) {
                document.getElementById('monthly-income').value = clientData.financialStatus.monthlyIncome;
                document.getElementById('monthly-expenses').value = clientData.financialStatus.monthlyExpenses;
                document.getElementById('current-savings').value = clientData.financialStatus.currentSavings;
                document.getElementById('annual-income').value = clientData.financialStatus.annualIncome;
                if (clientData.financialStatus.emergencyTarget) document.getElementById('emergency-target').value = clientData.financialStatus.emergencyTarget;
                if (clientData.financialStatus.currentDebt) document.getElementById('current-debt').value = clientData.financialStatus.currentDebt;
                displayFinancialInfo();
                generateFinancialInsights();
            }

            // Load risk profile
            if (clientData.riskProfile && clientData.riskProfile.experience) {
                document.getElementById('investment-experience').value = clientData.riskProfile.experience;
                document.getElementById('risk-tolerance').value = clientData.riskProfile.tolerance;
                document.getElementById('investment-horizon').value = clientData.riskProfile.horizon;
                document.getElementById('monthly-investment').value = clientData.riskProfile.monthlyInvestment;
                displayRiskInfo();
            }

            // Load insurance profile
            if (clientData.insuranceProfile && Object.keys(clientData.insuranceProfile).length > 0) {
                if (clientData.insuranceProfile.currentLifeInsurance) document.getElementById('current-life-insurance').value = clientData.insuranceProfile.currentLifeInsurance;
                if (clientData.insuranceProfile.currentHealthInsurance) document.getElementById('current-health-insurance').value = clientData.insuranceProfile.currentHealthInsurance;
                if (clientData.insuranceProfile.outstandingLoans) document.getElementById('outstanding-loans').value = clientData.insuranceProfile.outstandingLoans;
                if (clientData.insuranceProfile.familyExpenses) document.getElementById('family-expenses').value = clientData.insuranceProfile.familyExpenses;
                if (clientData.insuranceProfile.incomeYears) document.getElementById('income-years').value = clientData.insuranceProfile.incomeYears;
                displayInsuranceInfo();
            }

            // Update lists and calculations
            updateAssetsList();
            updateLoansList();
            updateGoalsList();
            updateNetWorth();
            updateHeaderProfileInfo();
            updateDashboardStats();
            
            // Refresh charts if they exist
            setTimeout(() => {
                updateAllCharts();
            }, 500);
        }

        // Enhanced Asset Management
        function addAsset() {
            const assetType = document.getElementById('asset-type').value;
            const assetName = document.getElementById('asset-name').value;
            const assetValue = parseFloat(document.getElementById('asset-value').value);
            const assetDate = document.getElementById('asset-date').value;

            if (!assetType || !assetName || !assetValue) {
                showAlert('Please fill in all required fields', 'danger');
                return;
            }

            const asset = {
                id: Date.now(),
                type: assetType,
                name: assetName,
                value: assetValue,
                date: assetDate,
                createdAt: new Date().toISOString()
            };

            if (!clientData.assets) {
                clientData.assets = [];
            }

            clientData.assets.push(asset);
            updateAssetsList();
            updateNetWorth();
            autoSave();

            // Clear form
            document.getElementById('asset-form').reset();
            showAlert('Asset added successfully!', 'success');
        }

        function updateAssetsList() {
            const assetsContainer = document.getElementById('assets-list');
            if (!assetsContainer || !clientData.assets) return;

            assetsContainer.innerHTML = '';

            clientData.assets.forEach(asset => {
                const assetItem = document.createElement('div');
                assetItem.className = 'list-item';
                assetItem.innerHTML = `
                    <div class="item-info">
                        <div class="item-title">${getAssetIcon(asset.type)} ${asset.name}</div>
                        <div class="item-details">
                            Value: ${formatCurrency(asset.value)} | 
                            ${asset.date ? `Added: ${new Date(asset.date).toLocaleDateString()}` : 'Date not specified'}
                        </div>
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-small btn-secondary" onclick="editAsset(${asset.id})">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn btn-small btn-danger" onclick="deleteAsset(${asset.id})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
                assetsContainer.appendChild(assetItem);
            });
        }

        function getAssetIcon(type) {
            const icons = {
                'cash': '',
                'stocks': '',
                'property': '',
                'gold': '',
                'crypto': '',
                'business': '',
                'other': ''
            };
            return icons[type] || '';
        }

        function editAsset(assetId) {
            const asset = clientData.assets.find(a => a.id === assetId);
            if (!asset) return;

            document.getElementById('asset-type').value = asset.type;
            document.getElementById('asset-name').value = asset.name;
            document.getElementById('asset-value').value = asset.value;
            document.getElementById('asset-date').value = asset.date;

            // Remove the asset so it can be re-added with updated values
            deleteAsset(assetId);
        }

        function deleteAsset(assetId) {
            if (confirm('Are you sure you want to delete this asset?')) {
                clientData.assets = clientData.assets.filter(a => a.id !== assetId);
                updateAssetsList();
                updateNetWorth();
                autoSave();
                showAlert('Asset deleted successfully!', 'success');
            }
        }

        // Enhanced Loan Management
        function addLoan() {
            const loanType = document.getElementById('loan-type').value;
            const loanAmount = parseFloat(document.getElementById('loan-amount').value);
            const loanRate = parseFloat(document.getElementById('loan-rate').value);
            const loanTenure = parseFloat(document.getElementById('loan-tenure').value);
            const loanEmi = parseFloat(document.getElementById('loan-emi').value) || 0;

            if (!loanType || !loanAmount || !loanRate || !loanTenure) {
                showAlert('Please fill in all required fields', 'danger');
                return;
            }

            // Calculate EMI if not provided
            const monthlyRate = loanRate / 12 / 100;
            const totalMonths = loanTenure * 12;
            const calculatedEmi = loanEmi || (loanAmount * monthlyRate * Math.pow(1 + monthlyRate, totalMonths)) / (Math.pow(1 + monthlyRate, totalMonths) - 1);

            const loan = {
                id: Date.now(),
                type: loanType,
                amount: loanAmount,
                rate: loanRate,
                tenure: loanTenure,
                emi: calculatedEmi,
                createdAt: new Date().toISOString()
            };

            if (!clientData.loans) {
                clientData.loans = [];
            }

            clientData.loans.push(loan);
            updateLoansList();
            updateNetWorth();
            autoSave();

            // Clear form
            document.getElementById('loan-form').reset();
            showAlert('Loan added successfully!', 'success');
        }

        function updateLoansList() {
            const loansContainer = document.getElementById('loans-list');
            if (!loansContainer || !clientData.loans) return;

            loansContainer.innerHTML = '';

            clientData.loans.forEach(loan => {
                const loanItem = document.createElement('div');
                loanItem.className = 'list-item';
                loanItem.innerHTML = `
                    <div class="item-info">
                        <div class="item-title">${getLoanIcon(loan.type)} ${loan.type.charAt(0).toUpperCase() + loan.type.slice(1)} Loan</div>
                        <div class="item-details">
                            Amount: ${formatCurrency(loan.amount)} | 
                            Rate: ${loan.rate}% | 
                            EMI: ${formatCurrency(loan.emi)} | 
                            Tenure: ${loan.tenure} years
                        </div>
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-small btn-secondary" onclick="editLoan(${loan.id})">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn btn-small btn-danger" onclick="deleteLoan(${loan.id})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
                loansContainer.appendChild(loanItem);
            });
        }

        function getLoanIcon(type) {
            const icons = {
                'home': '',
                'car': '',
                'personal': '',
                'education': '',
                'credit': '',
                'business': '',
                'other': ''
            };
            return icons[type] || '';
        }

        function editLoan(loanId) {
            const loan = clientData.loans.find(l => l.id === loanId);
            if (!loan) return;

            document.getElementById('loan-type').value = loan.type;
            document.getElementById('loan-amount').value = loan.amount;
            document.getElementById('loan-rate').value = loan.rate;
            document.getElementById('loan-tenure').value = loan.tenure;
            document.getElementById('loan-emi').value = loan.emi;

            // Remove the loan so it can be re-added with updated values
            deleteLoan(loanId);
        }

        function deleteLoan(loanId) {
            if (confirm('Are you sure you want to delete this loan?')) {
                clientData.loans = clientData.loans.filter(l => l.id !== loanId);
                updateLoansList();
                updateNetWorth();
                autoSave();
                showAlert('Loan deleted successfully!', 'success');
            }
        }

        function updateNetWorth() {
            const totalAssets = clientData.assets ? clientData.assets.reduce((sum, asset) => sum + asset.value, 0) : 0;
            const totalLiabilities = clientData.loans ? clientData.loans.reduce((sum, loan) => sum + loan.amount, 0) : 0;
            const netWorth = totalAssets - totalLiabilities;

            // Update display elements
            const totalAssetsElement = document.getElementById('total-assets');
            const totalLiabilitiesElement = document.getElementById('total-liabilities');
            const netWorthElement = document.getElementById('net-worth');
            const ratioElement = document.getElementById('asset-liability-ratio');

            if (totalAssetsElement) totalAssetsElement.textContent = `${formatCurrency(totalAssets)}`;
            if (totalLiabilitiesElement) totalLiabilitiesElement.textContent = `${formatCurrency(totalLiabilities)}`;
            if (netWorthElement) {
                netWorthElement.textContent = `${formatCurrency(netWorth)}`;
                netWorthElement.style.color = netWorth >= 0 ? '#00ff88' : '#ff6b6b';
            }
            if (ratioElement) {
                const ratio = totalLiabilities > 0 ? (totalAssets / totalLiabilities).toFixed(2) : totalAssets > 0 ? '' : '0';
                ratioElement.textContent = `${ratio}:1`;
            }

            // Update net worth insights
            generateNetWorthInsights(totalAssets, totalLiabilities, netWorth);

            // Update asset chart
            updateAssetChart();
        }

        function generateNetWorthInsights(totalAssets, totalLiabilities, netWorth) {
            const insights = [];
            
            if (netWorth > 0) {
                insights.push(" Positive net worth! You're building wealth effectively.");
            } else if (netWorth < 0) {
                insights.push(" Negative net worth. Focus on debt reduction and asset building.");
            }
            
            if (totalLiabilities > 0) {
                const debtToAssetRatio = (totalLiabilities / totalAssets) * 100;
                if (debtToAssetRatio > 50) {
                    insights.push(" High debt-to-asset ratio. Consider debt consolidation or reduction strategies.");
                } else if (debtToAssetRatio < 30) {
                    insights.push(" Good debt-to-asset ratio. Your borrowing is well-managed.");
                }
            }
            
            if (totalAssets > 1000000) {
                insights.push(" Great job building substantial assets! Consider diversification strategies.");
            } else if (totalAssets < 100000) {
                insights.push(" Focus on building your asset base through systematic investments.");
            }

            const insightsElement = document.getElementById('networth-insights-content');
            if (insightsElement) {
                insightsElement.innerHTML = `
                    <ul style="list-style: none; padding: 0; margin: 1rem 0;">
                        ${insights.map(insight => `<li style="padding: 0.75rem 0; border-bottom: 1px solid var(--border-gray);">${insight}</li>`).join('')}
                    </ul>
                `;
            }
        }

        function updateAssetChart() {
            const ctx = document.getElementById('asset-chart');
            if (!ctx || !clientData.assets || clientData.assets.length === 0) return;

            // Group assets by type
            const assetsByType = {};
            clientData.assets.forEach(asset => {
                if (!assetsByType[asset.type]) {
                    assetsByType[asset.type] = 0;
                }
                assetsByType[asset.type] += asset.value;
            });

            const labels = Object.keys(assetsByType).map(type => {
                const typeNames = {
                    'cash': 'Cash & Deposits',
                    'stocks': 'Stocks & MFs',
                    'property': 'Real Estate',
                    'gold': 'Gold & Metals',
                    'crypto': 'Cryptocurrency',
                    'business': 'Business Assets',
                    'other': 'Other Assets'
                };
                return typeNames[type] || type;
            });

            const data = Object.values(assetsByType);
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f39c12', '#9b59b6', '#2ecc71', '#95a5a6'];

            // Destroy existing chart if it exists
            if (charts.assetChart) {
                charts.assetChart.destroy();
            }

            charts.assetChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors.slice(0, labels.length),
                        borderWidth: 2,
                        borderColor: '#111111'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#ffffff',
                                padding: 20
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.parsed;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `${context.label}: ${formatCurrency(value)} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Enhanced Goals Management
        function addGoal() {
            const goalName = document.getElementById('goal-name').value;
            const goalCategory = document.getElementById('goal-category').value;
            const goalAmount = parseFloat(document.getElementById('goal-amount').value);
            const goalTimeframe = parseInt(document.getElementById('goal-timeframe').value);
            const goalInflation = parseFloat(document.getElementById('goal-inflation').value) || 6;
            const goalPriority = document.getElementById('goal-priority').value;
            const goalProgress = parseFloat(document.getElementById('goal-progress-amount').value) || 0;

            if (!goalName || !goalAmount || !goalTimeframe || !goalPriority) {
                showAlert('Please fill in all required fields', 'danger');
                return;
            }

            // Calculate inflation-adjusted amount
            const inflationAdjustedAmount = goalAmount * Math.pow(1 + goalInflation/100, goalTimeframe);
            const monthlyRequired = (inflationAdjustedAmount - goalProgress) / (goalTimeframe * 12);

            const goal = {
                id: Date.now(),
                name: goalName,
                category: goalCategory,
                currentAmount: goalAmount,
                inflationAdjustedAmount: inflationAdjustedAmount,
                timeframe: goalTimeframe,
                inflation: goalInflation,
                priority: goalPriority,
                progress: goalProgress,
                monthlyRequired: monthlyRequired,
                createdAt: new Date().toISOString()
            };

            if (!clientData.goals) {
                clientData.goals = [];
            }

            clientData.goals.push(goal);
            updateGoalsList();
            autoSave();

            // Clear form
            document.getElementById('goal-form').reset();
            showAlert('Goal added successfully!', 'success');
        }

        function updateGoalsList() {
            const goalsContainer = document.getElementById('goals-list');
            if (!goalsContainer || !clientData.goals) return;

            goalsContainer.innerHTML = '';

            clientData.goals.forEach(goal => {
                const progressPercentage = (goal.progress / goal.inflationAdjustedAmount * 100).toFixed(1);
                const goalItem = document.createElement('div');
                goalItem.className = 'list-item';
                goalItem.innerHTML = `
                    <div class="item-info">
                        <div class="item-title">${getGoalIcon(goal.category)} ${goal.name}</div>
                        <div class="item-details">
                            Target: ${formatCurrency(goal.inflationAdjustedAmount)} | 
                            Timeline: ${goal.timeframe} years | 
                            Priority: ${goal.priority.toUpperCase()} | 
                            Progress: ${progressPercentage}%
                            <br>
                            Monthly Required: ${formatCurrency(goal.monthlyRequired)}
                        </div>
                        <div style="margin-top: 0.5rem;">
                            <div style="background: var(--secondary-black); height: 6px; border-radius: 3px; overflow: hidden;">
                                <div style="width: ${Math.min(progressPercentage, 100)}%; height: 100%; background: ${getPriorityColor(goal.priority)}; transition: width 0.3s ease;"></div>
                            </div>
                        </div>
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-small btn-secondary" onclick="editGoal(${goal.id})">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn btn-small btn-danger" onclick="deleteGoal(${goal.id})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                `;
                goalsContainer.appendChild(goalItem);
            });
        }

        function getGoalIcon(category) {
            const icons = {
                'lifestyle': '',
                'education': '',
                'property': '',
                'business': '',
                'retirement': '',
                'emergency': '',
                'other': ''
            };
            return icons[category] || '';
        }

        function getPriorityColor(priority) {
            const colors = {
                'critical': '#ff6b6b',
                'high': '#ff9f43',
                'medium': '#f39c12',
                'low': '#00ff88'
            };
            return colors[priority] || '#95a5a6';
        }

        function editGoal(goalId) {
            const goal = clientData.goals.find(g => g.id === goalId);
            if (!goal) return;

            document.getElementById('goal-name').value = goal.name;
            document.getElementById('goal-category').value = goal.category;
            document.getElementById('goal-amount').value = goal.currentAmount;
            document.getElementById('goal-timeframe').value = goal.timeframe;
            document.getElementById('goal-inflation').value = goal.inflation;
            document.getElementById('goal-priority').value = goal.priority;
            document.getElementById('goal-progress-amount').value = goal.progress;

            // Remove the goal so it can be re-added with updated values
            deleteGoal(goalId);
        }

        function deleteGoal(goalId) {
            if (confirm('Are you sure you want to delete this goal?')) {
                clientData.goals = clientData.goals.filter(g => g.id !== goalId);
                updateGoalsList();
                autoSave();
                showAlert('Goal deleted successfully!', 'success');
            }
        }

        // Enhanced Insurance Management
        function calculateAdvancedInsurance() {
            const familyExpenses = parseFloat(document.getElementById('family-expenses').value);
            const incomeYears = parseInt(document.getElementById('income-years').value) || 15;
            const outstandingLoans = parseFloat(document.getElementById('outstanding-loans').value) || 0;
            const dependents = parseInt(document.getElementById('insurance-dependents').value) || 0;

            if (!familyExpenses) {
                showAlert('Please enter family annual expenses', 'danger');
                return;
            }

            // Calculate life insurance need
            const incomeReplacement = familyExpenses * incomeYears;
            const emergencyFund = familyExpenses * 1; // 1 year emergency
            const educationCost = dependents * 1500000; // 15L per child for education
            const totalLifeInsurance = incomeReplacement + emergencyFund + educationCost + outstandingLoans;

            // Calculate health insurance need
            const baseHealthInsurance = 500000; // 5L base
            const enhancedHealthInsurance = 1000000; // 10L recommended
            const familyHealthInsurance = dependents > 2 ? enhancedHealthInsurance * 2 : enhancedHealthInsurance;

            displayInsuranceResults(totalLifeInsurance, familyHealthInsurance, {
                incomeReplacement,
                emergencyFund,
                educationCost,
                outstandingLoans,
                familyExpenses,
                incomeYears,
                dependents
            });
        }

        function displayInsuranceResults(lifeInsurance, healthInsurance, breakdown) {
            const resultsContainer = document.getElementById('insurance-results');
            resultsContainer.style.display = 'block';
            resultsContainer.innerHTML = `
                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h4 class="card-title"><i class="fas fa-shield-alt"></i> Insurance Needs Analysis</h4>
                    </div>
                    <div class="data-display">
                        <div class="data-row">
                            <span class="data-label"> Recommended Life Insurance:</span>
                            <span class="data-value">${formatCurrency(lifeInsurance)}</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label"> Recommended Health Insurance:</span>
                            <span class="data-value">${formatCurrency(healthInsurance)}</span>
                        </div>
                    </div>
                    
                    <h5 style="margin: 1.5rem 0 1rem; color: var(--text-white);">Life Insurance Breakdown:</h5>
                    <div class="data-display">
                        <div class="data-row">
                            <span class="data-label">Income Replacement (${breakdown.incomeYears} years):</span>
                            <span class="data-value">${formatCurrency(breakdown.incomeReplacement)}</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">Emergency Fund:</span>
                            <span class="data-value">${formatCurrency(breakdown.emergencyFund)}</span>
                        </div>
                        ${breakdown.dependents > 0 ? `
                        <div class="data-row">
                            <span class="data-label">Education Cost (${breakdown.dependents} dependents):</span>
                            <span class="data-value">${formatCurrency(breakdown.educationCost)}</span>
                        </div>
                        ` : ''}
                        ${breakdown.outstandingLoans > 0 ? `
                        <div class="data-row">
                            <span class="data-label">Outstanding Loans:</span>
                            <span class="data-value">${formatCurrency(breakdown.outstandingLoans)}</span>
                        </div>
                        ` : ''}
                    </div>

                    <div style="background: var(--info-blue); background: rgba(0, 212, 255, 0.1); border: 1px solid var(--info-blue); border-radius: var(--border-radius-md); padding: 1rem; margin-top: 1.5rem;">
                        <h6 style="color: var(--info-blue); margin-bottom: 0.5rem;"><i class="fas fa-lightbulb"></i> Recommendations</h6>
                        <ul style="color: var(--info-blue); margin: 0; padding-left: 1.5rem;">
                            <li>Consider term life insurance for cost-effective coverage</li>
                            <li>Health insurance should cover family including parents if dependent</li>
                            <li>Review and update coverage annually</li>
                            <li>Consider critical illness and disability coverage</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        function saveInsuranceProfile() {
            const currentLifeInsurance = parseFloat(document.getElementById('current-life-insurance').value) || 0;
            const currentHealthInsurance = parseFloat(document.getElementById('current-health-insurance').value) || 0;
            const outstandingLoans = parseFloat(document.getElementById('outstanding-loans').value) || 0;
            const familyExpenses = parseFloat(document.getElementById('family-expenses').value);
            const incomeYears = parseInt(document.getElementById('income-years').value) || 15;
            const dependents = parseInt(document.getElementById('insurance-dependents').value) || 0;

            if (!familyExpenses) {
                showAlert('Please enter family annual expenses', 'danger');
                return;
            }

            clientData.insuranceProfile = {
                currentLifeInsurance,
                currentHealthInsurance,
                outstandingLoans,
                familyExpenses,
                incomeYears,
                dependents,
                lastUpdated: new Date().toISOString()
            };

            displayInsuranceInfo();
            autoSave();
            showAlert('Insurance profile saved successfully!', 'success');
        }

        function displayInsuranceInfo() {
            const info = clientData.insuranceProfile;
            if (!info) return;

            document.getElementById('insurance-form').style.display = 'none';
            document.getElementById('saved-insurance-info').style.display = 'block';
            
            document.getElementById('insurance-info-display').innerHTML = `
                <div class="data-display">
                    <div class="data-row">
                        <span class="data-label"> Current Life Insurance:</span>
                        <span class="data-value">${formatCurrency(info.currentLifeInsurance)}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label"> Current Health Insurance:</span>
                        <span class="data-value">${formatCurrency(info.currentHealthInsurance)}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label"> Dependents:</span>
                        <span class="data-value">${info.dependents}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label"> Annual Family Expenses:</span>
                        <span class="data-value">${formatCurrency(info.familyExpenses)}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label"> Income Replacement Period:</span>
                        <span class="data-value">${info.incomeYears} years</span>
                    </div>
                </div>
            `;
        }

        function editInsuranceInfo() {
            document.getElementById('insurance-form').style.display = 'block';
            document.getElementById('saved-insurance-info').style.display = 'none';
        }

        // Enhanced Risk Profile Management
        function saveRiskProfile() {
            const experience = document.getElementById('investment-experience').value;
            const tolerance = document.getElementById('risk-tolerance').value;
            const horizon = document.getElementById('investment-horizon').value;
            const monthlyInvestment = parseFloat(document.getElementById('monthly-investment').value);
            const style = document.getElementById('investment-style').value;

            if (!experience || !tolerance || !horizon || !monthlyInvestment) {
                showAlert('Please fill in all required fields', 'danger');
                return;
            }

            // Get selected knowledge areas
            const knowledgeAreas = [];
            document.querySelectorAll('[id^="knowledge-"]:checked').forEach(checkbox => {
                knowledgeAreas.push(checkbox.value);
            });

            // Calculate risk score
            const riskScore = calculateRiskScore(experience, tolerance, horizon, knowledgeAreas);

            clientData.riskProfile = {
                experience,
                tolerance,
                horizon,
                monthlyInvestment,
                style,
                knowledgeAreas,
                riskScore,
                lastUpdated: new Date().toISOString()
            };

            displayRiskInfo();
            generateRiskRecommendations();
            autoSave();
            showAlert('Risk profile saved successfully!', 'success');
        }

        function calculateRiskScore(experience, tolerance, horizon, knowledgeAreas) {
            let score = 0;

            // Experience scoring
            const experienceScores = {
                'beginner': 1,
                'intermediate': 2,
                'experienced': 3,
                'expert': 4
            };
            score += experienceScores[experience] || 1;

            // Tolerance scoring
            const toleranceScores = {
                'very-conservative': 1,
                'conservative': 2,
                'moderate': 3,
                'aggressive': 4,
                'very-aggressive': 5
            };
            score += toleranceScores[tolerance] || 2;

            // Horizon scoring
            const horizonScores = {
                'short': 1,
                'medium': 2,
                'long': 3,
                'very-long': 4
            };
            score += horizonScores[horizon] || 2;

            // Knowledge areas bonus
            score += Math.min(knowledgeAreas.length * 0.5, 2);

            return Math.min(score, 15); // Cap at 15
        }

        function displayRiskInfo() {
            const info = clientData.riskProfile;
            if (!info) return;

            document.getElementById('risk-form').style.display = 'none';
            document.getElementById('saved-risk-info').style.display = 'block';
            
            const riskLevel = getRiskLevel(info.riskScore);
            
            document.getElementById('risk-info-display').innerHTML = `
                <div class="data-display">
                    <div class="data-row">
                        <span class="data-label"> Risk Score:</span>
                        <span class="data-value">${info.riskScore}/15 - ${riskLevel}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label"> Investment Experience:</span>
                        <span class="data-value">${info.experience.charAt(0).toUpperCase() + info.experience.slice(1)}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label"> Risk Tolerance:</span>
                        <span class="data-value">${info.tolerance.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label"> Investment Horizon:</span>
                        <span class="data-value">${info.horizon.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())} Term</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label"> Monthly Investment Capacity:</span>
                        <span class="data-value">${formatCurrency(info.monthlyInvestment)}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label"> Investment Style:</span>
                        <span class="data-value">${info.style ? info.style.charAt(0).toUpperCase() + info.style.slice(1) : 'Not specified'}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label"> Knowledge Areas:</span>
                        <span class="data-value">${info.knowledgeAreas.length > 0 ? info.knowledgeAreas.join(', ') : 'None specified'}</span>
                    </div>
                </div>
            `;
        }

        function getRiskLevel(score) {
            if (score <= 4) return 'Conservative';
            if (score <= 8) return 'Moderate';
            if (score <= 12) return 'Aggressive';
            return 'Very Aggressive';
        }

        function generateRiskRecommendations() {
            const info = clientData.riskProfile;
            if (!info) return;

            const recommendations = [];
            const riskLevel = getRiskLevel(info.riskScore);

            // Asset allocation recommendations
            if (riskLevel === 'Conservative') {
                recommendations.push(" Recommended Allocation: 20% Equity, 70% Debt, 10% Gold");
                recommendations.push(" Focus on large-cap funds and government securities");
                recommendations.push(" Suitable for short to medium-term goals");
            } else if (riskLevel === 'Moderate') {
                recommendations.push(" Recommended Allocation: 50% Equity, 40% Debt, 10% Alternative");
                recommendations.push(" Mix of large-cap and mid-cap funds");
                recommendations.push(" Perfect for medium to long-term wealth building");
            } else if (riskLevel === 'Aggressive') {
                recommendations.push(" Recommended Allocation: 70% Equity, 20% Debt, 10% Alternative");
                recommendations.push(" Include mid-cap, small-cap, and international funds");
                recommendations.push(" Ideal for long-term wealth creation");
            } else {
                recommendations.push(" Recommended Allocation: 85% Equity, 10% Alternative, 5% Debt");
                recommendations.push(" High-growth potential with mid/small-cap focus");
                recommendations.push(" Only for very long-term investors");
            }

            // Experience-based recommendations
            if (info.experience === 'beginner') {
                recommendations.push(" Start with systematic investment plans (SIPs)");
                recommendations.push(" Consider professional financial advisory");
            } else if (info.experience === 'expert') {
                recommendations.push(" Consider direct equity and alternative investments");
                recommendations.push(" Regular portfolio rebalancing recommended");
            }

            // Investment capacity recommendations
            if (info.monthlyInvestment < 5000) {
                recommendations.push(" Start small and increase gradually");
                recommendations.push(" Focus on low-cost index funds");
            } else if (info.monthlyInvestment > 25000) {
                recommendations.push(" Consider diversified multi-asset allocation");
                recommendations.push(" Include international diversification");
            }

            const recommendationsElement = document.getElementById('risk-recommendations-content');
            if (recommendationsElement) {
                recommendationsElement.innerHTML = `
                    <ul style="list-style: none; padding: 0; margin: 1rem 0;">
                        ${recommendations.map(rec => `<li style="padding: 0.75rem 0; border-bottom: 1px solid var(--border-gray);">${rec}</li>`).join('')}
                    </ul>
                `;
            }
        }

        function editRiskInfo() {
            document.getElementById('risk-form').style.display = 'block';
            document.getElementById('saved-risk-info').style.display = 'none';
        }

        // Enhanced SIP Calculator
        function calculateAdvancedSIPReturns() {
            const sipAmount = parseFloat(document.getElementById('sip-amount').value);
            const annualReturn = parseFloat(document.getElementById('sip-return').value);
            const investmentPeriod = parseInt(document.getElementById('sip-period').value);
            const inflationRate = parseFloat(document.getElementById('sip-inflation').value) || 6;
            const stepUpRate = parseFloat(document.getElementById('sip-stepup').value) || 0;
            const taxRate = parseFloat(document.getElementById('sip-tax').value) || 10;

            if (!sipAmount || !annualReturn || !investmentPeriod) {
                showAlert('Please fill in all required fields', 'danger');
                return;
            }

            const monthlyReturn = annualReturn / 12 / 100;
            const totalMonths = investmentPeriod * 12;
            let totalInvestment = 0;
            let futureValue = 0;
            let currentSipAmount = sipAmount;

            // Calculate with step-up
            for (let year = 1; year <= investmentPeriod; year++) {
                const monthsInYear = Math.min(12, totalMonths - ((year - 1) * 12));
                
                for (let month = 1; month <= monthsInYear; month++) {
                    const remainingMonths = totalMonths - ((year - 1) * 12 + month - 1);
                    const futureValueFactor = Math.pow(1 + monthlyReturn, remainingMonths);
                    futureValue += currentSipAmount * futureValueFactor;
                    totalInvestment += currentSipAmount;
                }
                
                // Step up for next year
                if (year < investmentPeriod && stepUpRate > 0) {
                    currentSipAmount = currentSipAmount * (1 + stepUpRate / 100);
                }
            }

            const totalGains = futureValue - totalInvestment;
            const taxOnGains = totalGains * (taxRate / 100);
            const postTaxValue = futureValue - taxOnGains;
            const realReturn = annualReturn - inflationRate;
            const realValue = calculateRealValue(totalInvestment, realReturn / 100, investmentPeriod);

            displaySIPResults({
                sipAmount,
                totalInvestment,
                futureValue,
                totalGains,
                taxOnGains,
                postTaxValue,
                realValue,
                annualReturn,
                realReturn,
                investmentPeriod,
                stepUpRate,
                inflationRate
            });
        }

        function calculateRealValue(investment, realReturnRate, years) {
            const monthlyRealReturn = realReturnRate / 12;
            const months = years * 12;
            return investment * ((Math.pow(1 + monthlyRealReturn, months) - 1) / monthlyRealReturn);
        }

        function displaySIPResults(results) {
            const resultsContainer = document.getElementById('sip-results');
            resultsContainer.style.display = 'block';
            
            const absoluteReturn = ((results.futureValue / results.totalInvestment - 1) * 100).toFixed(2);
            const xirr = (Math.pow(results.futureValue / results.totalInvestment, 1 / results.investmentPeriod) - 1) * 100;

            resultsContainer.innerHTML = `
                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h4 class="card-title"><i class="fas fa-calculator"></i> SIP Investment Analysis</h4>
                    </div>
                    
                    <div class="widgets-grid" style="margin: 1.5rem 0;">
                        <div class="widget">
                            <div class="widget-icon"><i class="fas fa-piggy-bank"></i></div>
                            <div class="widget-value">${formatCurrency(results.totalInvestment)}</div>
                            <div class="widget-label">Total Investment</div>
                        </div>
                        <div class="widget">
                            <div class="widget-icon"><i class="fas fa-chart-line"></i></div>
                            <div class="widget-value">${formatCurrency(results.futureValue)}</div>
                            <div class="widget-label">Future Value</div>
                        </div>
                        <div class="widget">
                            <div class="widget-icon"><i class="fas fa-trophy"></i></div>
                            <div class="widget-value">${formatCurrency(results.totalGains)}</div>
                            <div class="widget-label">Total Gains</div>
                        </div>
                        <div class="widget">
                            <div class="widget-icon"><i class="fas fa-percentage"></i></div>
                            <div class="widget-value">${absoluteReturn}%</div>
                            <div class="widget-label">Absolute Return</div>
                        </div>
                    </div>

                    <div class="data-display">
                        <div class="data-row">
                            <span class="data-label"> Monthly SIP Amount:</span>
                            <span class="data-value">${formatCurrency(results.sipAmount)}</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label"> Investment Period:</span>
                            <span class="data-value">${results.investmentPeriod} years</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label"> Expected Annual Return:</span>
                            <span class="data-value">${results.annualReturn}%</span>
                        </div>
                        ${results.stepUpRate > 0 ? `
                        <div class="data-row">
                            <span class="data-label"> Annual Step-up:</span>
                            <span class="data-value">${results.stepUpRate}%</span>
                        </div>
                        ` : ''}
                        <div class="data-row">
                            <span class="data-label"> Post-tax Value:</span>
                            <span class="data-value">${formatCurrency(results.postTaxValue)}</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label"> Real Value (Inflation Adjusted):</span>
                            <span class="data-value">${formatCurrency(results.realValue)}</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label"> XIRR (Annualized Return):</span>
                            <span class="data-value">${xirr.toFixed(2)}%</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label"> Tax on Gains:</span>
                            <span class="data-value">${formatCurrency(results.taxOnGains)}</span>
                        </div>
                    </div>

                    <div style="background: var(--success-green); background: rgba(0, 255, 136, 0.1); border: 1px solid var(--success-green); border-radius: var(--border-radius-md); padding: 1rem; margin-top: 1.5rem;">
                        <h6 style="color: var(--success-green); margin-bottom: 0.5rem;"><i class="fas fa-lightbulb"></i> Key Insights</h6>
                        <ul style="color: var(--success-green); margin: 0; padding-left: 1.5rem;">
                            <li>Your money will grow ${(results.futureValue / results.totalInvestment).toFixed(1)}x in ${results.investmentPeriod} years</li>
                            <li>Wealth creation potential: ${formatCurrency(results.totalGains)} over investment period</li>
                            <li>Real purchasing power: ${formatCurrency(results.realValue)} (today's terms)</li>
                            ${results.stepUpRate > 0 ? '<li>Step-up strategy will significantly boost your returns</li>' : '<li>Consider annual step-up to beat inflation</li>'}
                        </ul>
                    </div>
                </div>
            `;
        }

        function updateAllCharts() {
            // Update all charts when data changes
            updateAssetChart();
            updateIncomeExpenseChart();
            updateGoalProgressChart();
            updateNetworthProjectionChart();
        }

        function updateIncomeExpenseChart() {
            const ctx = document.getElementById('income-expense-chart');
            if (!ctx || !clientData.financialStatus) return;

            const monthlyIncome = clientData.financialStatus.monthlyIncome || 0;
            const monthlyExpenses = clientData.financialStatus.monthlyExpenses || 0;
            const monthlySavings = monthlyIncome - monthlyExpenses;

            // Destroy existing chart if it exists
            if (charts.incomeExpenseChart) {
                charts.incomeExpenseChart.destroy();
            }

            charts.incomeExpenseChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Monthly Income', 'Monthly Expenses', 'Monthly Savings'],
                    datasets: [{
                        data: [monthlyIncome, monthlyExpenses, monthlySavings],
                        backgroundColor: ['#4ecdc4', '#ff6b6b', '#00ff88'],
                        borderWidth: 2,
                        borderColor: '#111111'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${formatCurrency(context.parsed.y)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#ffffff',
                                callback: function(value) {
                                    return '' + formatCurrency(value);
                                }
                            },
                            grid: {
                                color: '#333333'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#ffffff'
                            },
                            grid: {
                                color: '#333333'
                            }
                        }
                    }
                }
            });
        }

        function updateGoalProgressChart() {
            const ctx = document.getElementById('goal-progress-chart');
            if (!ctx || !clientData.goals || clientData.goals.length === 0) return;

            const goals = clientData.goals.slice(0, 5); // Show top 5 goals
            const labels = goals.map(goal => goal.name);
            const progress = goals.map(goal => (goal.progress / goal.inflationAdjustedAmount * 100).toFixed(1));

            // Destroy existing chart if it exists
            if (charts.goalProgressChart) {
                charts.goalProgressChart.destroy();
            }

            charts.goalProgressChart = new Chart(ctx, {
                type: 'horizontalBar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Progress %',
                        data: progress,
                        backgroundColor: '#4ecdc4',
                        borderWidth: 2,
                        borderColor: '#111111'
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.parsed.x}% completed`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                color: '#ffffff',
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            grid: {
                                color: '#333333'
                            }
                        },
                        y: {
                            ticks: {
                                color: '#ffffff'
                            },
                            grid: {
                                color: '#333333'
                            }
                        }
                    }
                }
            });
        }

        function updateNetworthProjectionChart() {
            const ctx = document.getElementById('networth-projection-chart');
            if (!ctx || !clientData.financialStatus) return;

            const currentNetWorth = (clientData.financialStatus.currentSavings || 0) - (clientData.financialStatus.currentDebt || 0);
            const monthlySavings = clientData.financialStatus.monthlySavings || 0;
            
            // Project net worth for next 10 years
            const years = [];
            const projectedNetWorth = [];
            
            for (let i = 0; i <= 10; i++) {
                years.push(new Date().getFullYear() + i);
                const projectedValue = currentNetWorth + (monthlySavings * 12 * i * 1.08); // 8% growth assumption
                projectedNetWorth.push(projectedValue);
            }

            // Destroy existing chart if it exists
            if (charts.networthProjectionChart) {
                charts.networthProjectionChart.destroy();
            }

            charts.networthProjectionChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Projected Net Worth',
                        data: projectedNetWorth,
                        borderColor: '#00ff88',
                        backgroundColor: 'rgba(0, 255, 136, 0.1)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 3
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#ffffff'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${formatCurrency(context.parsed.y)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                color: '#ffffff',
                                callback: function(value) {
                                    return '' + formatCurrency(value);
                                }
                            },
                            grid: {
                                color: '#333333'
                            }
                        },
                        x: {
                            ticks: {
                                color: '#ffffff'
                            },
                            grid: {
                                color: '#333333'
                            }
                        }
                    }
                }
            });
        }

        // Professional Report Generation System
        function generateDetailedReport() {
            const reportContent = generateReportContent('detailed');
            showReportPreview(reportContent, 'Comprehensive Financial Report');
        }

        function generateInvestmentReport() {
            const reportContent = generateReportContent('investment');
            showReportPreview(reportContent, 'Investment Strategy Report');
        }

        function generateActionPlan() {
            const reportContent = generateReportContent('action');
            showReportPreview(reportContent, 'Financial Action Plan');
        }

        function generateRiskReport() {
            const reportContent = generateReportContent('risk');
            showReportPreview(reportContent, 'Risk Assessment Report');
        }

        function generateReportContent(type) {
            const currentDate = new Date().toLocaleDateString('en-IN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            let content = '';

            // Report Header
            content += `
                <div style="text-align: center; margin-bottom: 3rem; padding: 2rem; border-bottom: 2px solid var(--accent-white);">
                    <h1 style="font-size: 2.5rem; margin-bottom: 0.5rem; color: var(--text-white);">
                        ${getReportTitle(type)}
                    </h1>
                    <p style="font-size: 1.2rem; color: var(--text-gray); margin-bottom: 1rem;">
                        ${clientData.basicInfo?.name || 'Financial Planning Client'}
                    </p>
                    <p style="color: var(--text-gray);">Generated on ${currentDate}</p>
                </div>
            `;

            if (type === 'detailed') {
                content += generateDetailedReportContent();
            } else if (type === 'investment') {
                content += generateInvestmentReportContent();
            } else if (type === 'action') {
                content += generateActionPlanContent();
            } else if (type === 'risk') {
                content += generateRiskReportContent();
            }

            return content;
        }

        function getReportTitle(type) {
            const titles = {
                'detailed': 'Comprehensive Financial Report',
                'investment': 'Investment Strategy Report',
                'action': 'Financial Action Plan',
                'risk': 'Risk Assessment Report'
            };
            return titles[type] || 'Financial Report';
        }

        function generateDetailedReportContent() {
            let content = '';

            // Executive Summary
            content += `
                <div style="margin-bottom: 3rem;">
                    <h2 style="color: var(--text-white); border-bottom: 2px solid var(--accent-white); padding-bottom: 0.5rem;">
                         Executive Summary
                    </h2>
                    <div style="background: var(--gradient-card); padding: 2rem; border-radius: var(--border-radius-md); margin: 1rem 0;">
                        ${generateExecutiveSummaryContent()}
                    </div>
                </div>
            `;

            // Client Profile Overview
            if (clientData.basicInfo?.name) {
                content += `
                    <div style="margin-bottom: 3rem;">
                        <h2 style="color: var(--text-white); border-bottom: 2px solid var(--accent-white); padding-bottom: 0.5rem;">
                             Client Profile
                        </h2>
                        ${generateClientProfileSection()}
                    </div>
                `;
            }

            // Financial Status Analysis
            if (clientData.financialStatus) {
                content += `
                    <div style="margin-bottom: 3rem;">
                        <h2 style="color: var(--text-white); border-bottom: 2px solid var(--accent-white); padding-bottom: 0.5rem;">
                             Financial Status Analysis
                        </h2>
                        ${generateFinancialStatusSection()}
                    </div>
                `;
            }

            // Net Worth Analysis
            if (clientData.assets || clientData.loans) {
                content += `
                    <div style="margin-bottom: 3rem;">
                        <h2 style="color: var(--text-white); border-bottom: 2px solid var(--accent-white); padding-bottom: 0.5rem;">
                             Net Worth Analysis
                        </h2>
                        ${generateNetWorthSection()}
                    </div>
                `;
            }

            // Goals Analysis
            if (clientData.goals && clientData.goals.length > 0) {
                content += `
                    <div style="margin-bottom: 3rem;">
                        <h2 style="color: var(--text-white); border-bottom: 2px solid var(--accent-white); padding-bottom: 0.5rem;">
                             Goals & Targets
                        </h2>
                        ${generateGoalsSection()}
                    </div>
                `;
            }

            // Risk Profile
            if (clientData.riskProfile) {
                content += `
                    <div style="margin-bottom: 3rem;">
                        <h2 style="color: var(--text-white); border-bottom: 2px solid var(--accent-white); padding-bottom: 0.5rem;">
                             Risk Profile Analysis
                        </h2>
                        ${generateRiskProfileSection()}
                    </div>
                `;
            }

            // Recommendations
            content += `
                <div style="margin-bottom: 3rem;">
                    <h2 style="color: var(--text-white); border-bottom: 2px solid var(--accent-white); padding-bottom: 0.5rem;">
                         Strategic Recommendations
                    </h2>
                    ${generateRecommendationsSection()}
                </div>
            `;

            return content;
        }

        function generateExecutiveSummaryContent() {
            const netWorth = calculateCurrentNetWorth();
            const financialHealthScore = calculateFinancialHealthScore();
            const goalProgress = calculateOverallGoalProgress();

            return `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                    <div style="text-align: center; padding: 1rem; background: var(--secondary-black); border-radius: var(--border-radius-md);">
                        <h3 style="color: var(--success-green); font-size: 2rem; margin-bottom: 0.5rem;">${formatCurrency(netWorth)}</h3>
                        <p style="color: var(--text-gray);">Current Net Worth</p>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: var(--secondary-black); border-radius: var(--border-radius-md);">
                        <h3 style="color: var(--info-blue); font-size: 2rem; margin-bottom: 0.5rem;">${financialHealthScore}%</h3>
                        <p style="color: var(--text-gray);">Financial Health Score</p>
                    </div>
                    <div style="text-align: center; padding: 1rem; background: var(--secondary-black); border-radius: var(--border-radius-md);">
                        <h3 style="color: var(--warning-orange); font-size: 2rem; margin-bottom: 0.5rem;">${goalProgress}%</h3>
                        <p style="color: var(--text-gray);">Goals Progress</p>
                    </div>
                </div>
                <div style="color: var(--text-gray); line-height: 1.6;">
                    <p><strong>Financial Position:</strong> ${getFinancialPositionSummary(netWorth, financialHealthScore)}</p>
                    <p><strong>Key Strengths:</strong> ${getKeyStrengths()}</p>
                    <p><strong>Areas for Improvement:</strong> ${getImprovementAreas()}</p>
                    <p><strong>Next Steps:</strong> ${getNextSteps()}</p>
                </div>
            `;
        }

        function calculateCurrentNetWorth() {
            const totalAssets = clientData.assets ? clientData.assets.reduce((sum, asset) => sum + asset.value, 0) : 0;
            const totalLiabilities = clientData.loans ? clientData.loans.reduce((sum, loan) => sum + loan.amount, 0) : 0;
            return totalAssets - totalLiabilities;
        }

        function calculateFinancialHealthScore() {
            let score = 0;
            let factors = 0;

            if (clientData.financialStatus) {
                // Savings rate (40% weight)
                const savingsRate = clientData.financialStatus.savingsRate || 0;
                if (savingsRate >= 20) score += 40;
                else if (savingsRate >= 15) score += 30;
                else if (savingsRate >= 10) score += 20;
                else if (savingsRate >= 5) score += 10;
                factors++;

                // Emergency fund (30% weight)
                const emergencyFundRatio = clientData.financialStatus.currentSavings / (clientData.financialStatus.monthlyExpenses * 6);
                if (emergencyFundRatio >= 1) score += 30;
                else if (emergencyFundRatio >= 0.7) score += 20;
                else if (emergencyFundRatio >= 0.5) score += 10;
                factors++;

                // Debt ratio (30% weight)
                const debtRatio = clientData.financialStatus.debtToIncomeRatio || 0;
                if (debtRatio <= 20) score += 30;
                else if (debtRatio <= 30) score += 20;
                else if (debtRatio <= 40) score += 10;
                factors++;
            }

            return factors > 0 ? Math.round(score / factors * 100 / 100) : 0;
        }

        function calculateOverallGoalProgress() {
            if (!clientData.goals || clientData.goals.length === 0) return 0;
            
            const totalProgress = clientData.goals.reduce((sum, goal) => {
                return sum + (goal.progress / goal.inflationAdjustedAmount * 100);
            }, 0);
            
            return Math.round(totalProgress / clientData.goals.length);
        }

        function generateClientProfileSection() {
            const info = clientData.basicInfo;
            return `
                <div style="background: var(--gradient-card); padding: 2rem; border-radius: var(--border-radius-md); margin: 1rem 0;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                        <div><strong>Name:</strong> ${info.name}</div>
                        <div><strong>Age:</strong> ${info.age} years</div>
                        <div><strong>Occupation:</strong> ${info.occupation}</div>
                        <div><strong>Marital Status:</strong> ${info.maritalStatus}</div>
                        <div><strong>Dependents:</strong> ${info.dependents}</div>
                        <div><strong>City:</strong> ${info.city}</div>
                        ${info.incomeRange ? `<div><strong>Income Range:</strong> ${info.incomeRange}</div>` : ''}
                        ${info.educationLevel ? `<div><strong>Education:</strong> ${info.educationLevel}</div>` : ''}
                    </div>
                </div>
            `;
        }

        function generateFinancialStatusSection() {
            const info = clientData.financialStatus;
            return `
                <div style="background: var(--gradient-card); padding: 2rem; border-radius: var(--border-radius-md); margin: 1rem 0;">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                        <div><strong>Monthly Income:</strong> ${formatCurrency(info.monthlyIncome)}</div>
                        <div><strong>Monthly Expenses:</strong> ${formatCurrency(info.monthlyExpenses)}</div>
                        <div><strong>Monthly Savings:</strong> ${formatCurrency(info.monthlySavings)}</div>
                        <div><strong>Savings Rate:</strong> ${info.savingsRate.toFixed(1)}%</div>
                        <div><strong>Current Savings:</strong> ${formatCurrency(info.currentSavings)}</div>
                        <div><strong>Annual Income:</strong> ${formatCurrency(info.annualIncome)}</div>
                    </div>
                    <div style="background: var(--secondary-black); padding: 1.5rem; border-radius: var(--border-radius-md);">
                        <h4 style="color: var(--text-white); margin-bottom: 1rem;">Financial Health Analysis</h4>
                        ${generateFinancialHealthAnalysis(info)}
                    </div>
                </div>
            `;
        }

        function generateFinancialHealthAnalysis(info) {
            const analysis = [];
            
            if (info.savingsRate >= 20) {
                analysis.push(" Excellent savings rate - You're on track for strong financial growth");
            } else if (info.savingsRate >= 10) {
                analysis.push(" Good savings rate - Consider increasing to 20% for faster wealth building");
            } else {
                analysis.push(" Low savings rate - Focus on expense optimization and income enhancement");
            }

            const emergencyMonths = info.currentSavings / info.monthlyExpenses;
            if (emergencyMonths >= 6) {
                analysis.push(" Strong emergency fund - Well prepared for financial uncertainties");
            } else {
                analysis.push(` Emergency fund needs attention - Current coverage: ${emergencyMonths.toFixed(1)} months`);
            }

            if (info.debtToIncomeRatio && info.debtToIncomeRatio > 40) {
                analysis.push(" High debt burden - Prioritize debt reduction strategies");
            } else if (info.debtToIncomeRatio && info.debtToIncomeRatio > 20) {
                analysis.push(" Moderate debt levels - Monitor and optimize debt management");
            } else {
                analysis.push(" Healthy debt levels - Good financial discipline");
            }

            return analysis.map(item => `<p style="margin: 0.5rem 0; color: var(--text-gray);">${item}</p>`).join('');
        }

        function showReportPreview(content, title) {
            const previewContainer = document.getElementById('report-preview');
            const reportContent = document.getElementById('report-content');
            
            reportContent.innerHTML = `
                <div style="max-height: 70vh; overflow-y: auto; padding: 1rem;">
                    ${content}
                </div>
                <div style="text-align: center; margin-top: 2rem; padding-top: 1rem; border-top: 1px solid var(--border-gray);">
                    <button class="btn btn-primary" onclick="downloadPDFReport('${title}')">
                        <i class="fas fa-download"></i> Download PDF
                    </button>
                    <button class="btn btn-secondary" onclick="printReport()">
                        <i class="fas fa-print"></i> Print Report
                    </button>
                </div>
            `;
            
            previewContainer.style.display = 'block';
            previewContainer.scrollIntoView({ behavior: 'smooth' });
        }

        function closeReportPreview() {
            document.getElementById('report-preview').style.display = 'none';
        }

        function downloadPDFReport(title) {
            // Note: This is a simplified PDF generation. For production, consider using jsPDF with html2canvas
            const content = document.getElementById('report-content').innerHTML;
            
            // Create a new window for PDF generation
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${title}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; color: #333; }
                        h1, h2, h3 { color: #000; }
                        .data-display { margin: 10px 0; }
                        .data-row { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #eee; }
                    </style>
                </head>
                <body>
                    ${content.replace(/var\(--[^)]+\)/g, '#333').replace(/background: var[^;]+;/g, '')}
                </body>
                </html>
            `);
            printWindow.document.close();
            
            setTimeout(() => {
                printWindow.print();
                printWindow.close();
            }, 500);
            
            showAlert('PDF report generated successfully!', 'success');
        }

        function printReport() {
            const content = document.getElementById('report-content').innerHTML;
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Financial Report</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; color: #333; }
                        h1, h2, h3 { color: #000; }
                    </style>
                </head>
                <body>${content}</body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
            printWindow.close();
        }

        // Helper functions for report generation
        function getFinancialPositionSummary(netWorth, healthScore) {
            if (healthScore >= 80) return "Strong financial foundation with excellent wealth-building potential";
            if (healthScore >= 60) return "Good financial health with opportunities for optimization";
            if (healthScore >= 40) return "Moderate financial position requiring strategic improvements";
            return "Financial position needs significant attention and restructuring";
        }

        function getKeyStrengths() {
            const strengths = [];
            if (clientData.financialStatus?.savingsRate >= 15) strengths.push("Strong savings discipline");
            if (clientData.assessmentResults) strengths.push("Completed financial personality assessment");
            if (clientData.goals?.length > 0) strengths.push("Clear financial goals defined");
            if (clientData.riskProfile) strengths.push("Well-defined risk profile");
            return strengths.length > 0 ? strengths.join(", ") : "Engagement with financial planning process";
        }

        function getImprovementAreas() {
            const areas = [];
            if (!clientData.financialStatus || clientData.financialStatus.savingsRate < 10) areas.push("Increase savings rate");
            if (!clientData.insuranceProfile) areas.push("Complete insurance planning");
            if (!clientData.goals || clientData.goals.length === 0) areas.push("Define specific financial goals");
            if (!clientData.assets || clientData.assets.length === 0) areas.push("Begin systematic investing");
            return areas.length > 0 ? areas.join(", ") : "Continue current financial practices";
        }

        function getNextSteps() {
            const steps = [];
            if (!clientData.riskProfile) steps.push("Complete risk assessment");
            if (!clientData.goals || clientData.goals.length === 0) steps.push("Set SMART financial goals");
            if (clientData.financialStatus?.savingsRate < 15) steps.push("Optimize expense management");
            steps.push("Begin systematic investment planning");
            return steps.join(", ");
        }

        function generateExecutiveSummary() {
            const summaryContent = generateReportContent('executive');
            showReportPreview(summaryContent, 'Executive Summary');
        }

        // 1. Investment Advisory Section Functions
        function generateAdvancedInvestmentPlan() {
            if (!validateInvestmentPlanData()) {
                showAlert('Please complete your risk profile and financial status first', 'warning');
                return;
            }

            const investmentPlan = createPersonalizedInvestmentPlan();
            displayInvestmentPlan(investmentPlan);
        }

        function validateInvestmentPlanData() {
            return clientData.riskProfile && clientData.financialStatus && clientData.financialStatus.monthlyIncome;
        }

        function createPersonalizedInvestmentPlan() {
            const riskProfile = clientData.riskProfile;
            const financialStatus = clientData.financialStatus;
            const monthlyInvestment = riskProfile.monthlyInvestment || (financialStatus.monthlySavings * 0.7);
            
            // Asset allocation based on risk profile
            const allocations = getAssetAllocation(riskProfile.riskScore);
            
            // Specific fund recommendations
            const fundRecommendations = getFundRecommendations(riskProfile, allocations);
            
            // Investment timeline and targets
            const investmentTargets = calculateInvestmentTargets(monthlyInvestment, allocations);

            return {
                allocations,
                fundRecommendations,
                investmentTargets,
                monthlyInvestment,
                riskLevel: getRiskLevel(riskProfile.riskScore),
                investmentHorizon: riskProfile.horizon
            };
        }

        function getAssetAllocation(riskScore) {
            if (riskScore <= 4) {
                return { equity: 20, debt: 70, gold: 5, international: 0, alternative: 5 };
            } else if (riskScore <= 8) {
                return { equity: 50, debt: 35, gold: 5, international: 5, alternative: 5 };
            } else if (riskScore <= 12) {
                return { equity: 70, debt: 15, gold: 5, international: 7, alternative: 3 };
            } else {
                return { equity: 80, debt: 5, gold: 3, international: 10, alternative: 2 };
            }
        }

        function getFundRecommendations(riskProfile, allocations) {
            const recommendations = [];

            // Equity recommendations
            if (allocations.equity > 0) {
                if (riskProfile.experience === 'beginner') {
                    recommendations.push({
                        category: 'Large Cap Equity',
                        allocation: allocations.equity * 0.7,
                        funds: ['Axis Bluechip Fund', 'Mirae Asset Large Cap Fund', 'Canara Robeco Bluechip Equity Fund'],
                        rationale: 'Stable large companies for conservative equity exposure'
                    });
                    recommendations.push({
                        category: 'Index Fund',
                        allocation: allocations.equity * 0.3,
                        funds: ['UTI Nifty Index Fund', 'HDFC Index Fund Nifty 50', 'ICICI Prudential Nifty Index Fund'],
                        rationale: 'Low-cost broad market exposure'
                    });
                } else {
                    recommendations.push({
                        category: 'Large Cap Equity',
                        allocation: allocations.equity * 0.5,
                        funds: ['Axis Bluechip Fund', 'Mirae Asset Large Cap Fund', 'Canara Robeco Bluechip Equity Fund'],
                        rationale: 'Core equity holdings for stability'
                    });
                    recommendations.push({
                        category: 'Mid Cap Equity',
                        allocation: allocations.equity * 0.3,
                        funds: ['Axis Midcap Fund', 'HDFC Mid-Cap Opportunities Fund', 'DSP Midcap Fund'],
                        rationale: 'Higher growth potential with mid-cap exposure'
                    });
                    recommendations.push({
                        category: 'Small Cap Equity',
                        allocation: allocations.equity * 0.2,
                        funds: ['Axis Small Cap Fund', 'SBI Small Cap Fund', 'DSP Small Cap Fund'],
                        rationale: 'Maximum growth potential for long-term wealth creation'
                    });
                }
            }

            // Debt recommendations
            if (allocations.debt > 0) {
                recommendations.push({
                    category: 'Corporate Bond Fund',
                    allocation: allocations.debt * 0.6,
                    funds: ['HDFC Corporate Bond Fund', 'ICICI Prudential Corporate Bond Fund', 'Axis Corporate Debt Fund'],
                    rationale: 'Higher yields with moderate credit risk'
                });
                recommendations.push({
                    category: 'Government Securities',
                    allocation: allocations.debt * 0.4,
                    funds: ['SBI Magnum Gilt Fund', 'HDFC Gilt Fund', 'UTI Gilt Fund'],
                    rationale: 'Safe government backing with interest rate sensitivity'
                });
            }

            // Gold recommendations
            if (allocations.gold > 0) {
                recommendations.push({
                    category: 'Gold ETF',
                    allocation: allocations.gold,
                    funds: ['HDFC Gold ETF', 'ICICI Prudential Gold ETF', 'Axis Gold ETF'],
                    rationale: 'Hedge against inflation and currency devaluation'
                });
            }

            // International recommendations
            if (allocations.international > 0) {
                recommendations.push({
                    category: 'International Equity',
                    allocation: allocations.international,
                    funds: ['Motilal Oswal Nasdaq 100 ETF', 'HDFC International Fund', 'Franklin India Feeder Franklin US Opportunities Fund'],
                    rationale: 'Geographic diversification and exposure to global markets'
                });
            }

            return recommendations;
        }

        function calculateInvestmentTargets(monthlyInvestment, allocations) {
            const targets = [];
            
            Object.entries(allocations).forEach(([category, percentage]) => {
                if (percentage > 0) {
                    const monthlyAmount = (monthlyInvestment * percentage) / 100;
                    const annualAmount = monthlyAmount * 12;
                    const fiveYearValue = calculateFutureValue(monthlyAmount, getExpectedReturn(category), 5);
                    const tenYearValue = calculateFutureValue(monthlyAmount, getExpectedReturn(category), 10);
                    
                    targets.push({
                        category: category.charAt(0).toUpperCase() + category.slice(1),
                        monthlyAmount,
                        annualAmount,
                        fiveYearValue,
                        tenYearValue,
                        expectedReturn: getExpectedReturn(category)
                    });
                }
            });
            
            return targets;
        }

        function getExpectedReturn(category) {
            const returns = {
                equity: 12,
                debt: 7,
                gold: 8,
                international: 10,
                alternative: 9
            };
            return returns[category] || 8;
        }

        function calculateFutureValue(monthlyAmount, annualReturn, years) {
            const monthlyReturn = annualReturn / 12 / 100;
            const months = years * 12;
            return monthlyAmount * ((Math.pow(1 + monthlyReturn, months) - 1) / monthlyReturn);
        }

        function displayInvestmentPlan(plan) {
            const resultsContainer = document.getElementById('investment-plan-results');
            
            resultsContainer.innerHTML = `
                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h4 class="card-title"><i class="fas fa-magic"></i> Your Personalized Investment Strategy</h4>
                        <p class="card-subtitle">Based on ${plan.riskLevel} risk profile and ${plan.investmentHorizon} investment horizon</p>
                    </div>
                    
                    <!-- Asset Allocation Overview -->
                    <div style="margin: 2rem 0;">
                        <h5 style="color: var(--text-white); margin-bottom: 1rem;"> Recommended Asset Allocation</h5>
                        <div class="widgets-grid" style="grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));">
                            ${Object.entries(plan.allocations).filter(([_, value]) => value > 0).map(([asset, percentage]) => `
                                <div class="widget">
                                    <div class="widget-icon">${getAssetIcon(asset)}</div>
                                    <div class="widget-value">${percentage}%</div>
                                    <div class="widget-label">${asset.charAt(0).toUpperCase() + asset.slice(1)}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Monthly Investment Breakdown -->
                    <div style="margin: 2rem 0;">
                        <h5 style="color: var(--text-white); margin-bottom: 1rem;"> Monthly Investment Allocation (${formatCurrency(plan.monthlyInvestment)})</h5>
                        <div class="data-display">
                            ${plan.investmentTargets.map(target => `
                                <div class="data-row">
                                    <span class="data-label">${target.category}:</span>
                                    <span class="data-value">${formatCurrency(target.monthlyAmount)} (${target.expectedReturn}% expected return)</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Fund Recommendations -->
                    <div style="margin: 2rem 0;">
                        <h5 style="color: var(--text-white); margin-bottom: 1rem;"> Specific Fund Recommendations</h5>
                        ${plan.fundRecommendations.map(rec => `
                            <div style="background: var(--secondary-black); padding: 1.5rem; border-radius: var(--border-radius-md); margin: 1rem 0; border-left: 4px solid var(--accent-white);">
                                <h6 style="color: var(--text-white); margin-bottom: 0.5rem;">${rec.category} (${rec.allocation}% allocation)</h6>
                                <p style="color: var(--text-gray); margin-bottom: 1rem;">${rec.rationale}</p>
                                <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                    ${rec.funds.map(fund => `<span style="background: var(--gradient-accent); color: var(--primary-black); padding: 0.25rem 0.75rem; border-radius: 15px; font-size: 0.9rem;">${fund}</span>`).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <!-- Projected Returns -->
                    <div style="margin: 2rem 0;">
                        <h5 style="color: var(--text-white); margin-bottom: 1rem;"> Projected Investment Growth</h5>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                            <div style="background: var(--gradient-card); padding: 1.5rem; border-radius: var(--border-radius-md); text-align: center;">
                                <h3 style="color: var(--success-green); font-size: 1.8rem; margin-bottom: 0.5rem;">${formatCurrency(plan.investmentTargets.reduce((sum, target) => sum + target.fiveYearValue, 0))}</h3>
                                <p style="color: var(--text-gray);">5-Year Value</p>
                            </div>
                            <div style="background: var(--gradient-card); padding: 1.5rem; border-radius: var(--border-radius-md); text-align: center;">
                                <h3 style="color: var(--info-blue); font-size: 1.8rem; margin-bottom: 0.5rem;">${formatCurrency(plan.investmentTargets.reduce((sum, target) => sum + target.tenYearValue, 0))}</h3>
                                <p style="color: var(--text-gray);">10-Year Value</p>
                            </div>
                        </div>
                    </div>

                    <!-- Action Steps -->
                    <div style="background: var(--success-green); background: rgba(0, 255, 136, 0.1); border: 1px solid var(--success-green); border-radius: var(--border-radius-md); padding: 1.5rem; margin-top: 2rem;">
                        <h6 style="color: var(--success-green); margin-bottom: 1rem;"><i class="fas fa-tasks"></i> Next Steps</h6>
                        <ol style="color: var(--success-green); margin: 0; padding-left: 1.5rem;">
                            <li>Start with ${plan.riskLevel === 'Conservative' ? 'debt funds and large-cap equity' : 'core large-cap funds'}</li>
                            <li>Set up systematic investment plans (SIPs) for chosen funds</li>
                            <li>Review and rebalance portfolio every 6 months</li>
                            <li>Increase investment amount by 10-15% annually</li>
                        </ol>
                    </div>
                </div>
            `;
        }

        function getAssetIcon(asset) {
            const icons = {
                equity: '',
                debt: '',
                gold: '',
                international: '',
                alternative: ''
            };
            return icons[asset] || '';
        }

        function generateQuickRecommendations() {
            if (!clientData.riskProfile || !clientData.financialStatus) {
                showAlert('Please complete your risk profile and financial status first', 'warning');
                return;
            }

            const quickRecs = generateQuickInvestmentRecommendations();
            displayQuickRecommendations(quickRecs);
        }

        function generateQuickInvestmentRecommendations() {
            const riskScore = clientData.riskProfile.riskScore;
            const monthlyInvestment = clientData.riskProfile.monthlyInvestment || 5000;
            
            if (riskScore <= 4) {
                return {
                    type: 'Conservative Portfolio',
                    funds: [
                        { name: 'HDFC Corporate Bond Fund', allocation: 40, amount: monthlyInvestment * 0.4 },
                        { name: 'Axis Bluechip Fund', allocation: 30, amount: monthlyInvestment * 0.3 },
                        { name: 'HDFC Gold ETF', allocation: 20, amount: monthlyInvestment * 0.2 },
                        { name: 'UTI Nifty Index Fund', allocation: 10, amount: monthlyInvestment * 0.1 }
                    ],
                    expectedReturn: 8.5,
                    riskLevel: 'Low'
                };
            } else if (riskScore <= 8) {
                return {
                    type: 'Balanced Portfolio',
                    funds: [
                        { name: 'Axis Bluechip Fund', allocation: 30, amount: monthlyInvestment * 0.3 },
                        { name: 'HDFC Mid-Cap Opportunities Fund', allocation: 25, amount: monthlyInvestment * 0.25 },
                        { name: 'HDFC Corporate Bond Fund', allocation: 25, amount: monthlyInvestment * 0.25 },
                        { name: 'UTI Nifty Index Fund', allocation: 15, amount: monthlyInvestment * 0.15 },
                        { name: 'HDFC Gold ETF', allocation: 5, amount: monthlyInvestment * 0.05 }
                    ],
                    expectedReturn: 10.5,
                    riskLevel: 'Moderate'
                };
            } else {
                return {
                    type: 'Growth Portfolio',
                    funds: [
                        { name: 'Axis Bluechip Fund', allocation: 25, amount: monthlyInvestment * 0.25 },
                        { name: 'HDFC Mid-Cap Opportunities Fund', allocation: 25, amount: monthlyInvestment * 0.25 },
                        { name: 'Axis Small Cap Fund', allocation: 20, amount: monthlyInvestment * 0.2 },
                        { name: 'Motilal Oswal Nasdaq 100 ETF', allocation: 15, amount: monthlyInvestment * 0.15 },
                        { name: 'HDFC Corporate Bond Fund', allocation: 10, amount: monthlyInvestment * 0.1 },
                        { name: 'HDFC Gold ETF', allocation: 5, amount: monthlyInvestment * 0.05 }
                    ],
                    expectedReturn: 12.5,
                    riskLevel: 'High'
                };
            }
        }

        function displayQuickRecommendations(recs) {
            const resultsContainer = document.getElementById('investment-plan-results');
            
            resultsContainer.innerHTML = `
                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h4 class="card-title"><i class="fas fa-bolt"></i> Quick Investment Recommendations</h4>
                        <p class="card-subtitle">${recs.type} - ${recs.riskLevel} Risk | Expected Return: ${recs.expectedReturn}%</p>
                    </div>
                    
                    <div class="data-display">
                        ${recs.funds.map(fund => `
                            <div class="data-row">
                                <span class="data-label">${fund.name} (${fund.allocation}%):</span>
                                <span class="data-value">${formatCurrency(fund.amount)}/month</span>
                            </div>
                        `).join('')}
                    </div>

                    <div style="background: var(--info-blue); background: rgba(0, 212, 255, 0.1); border: 1px solid var(--info-blue); border-radius: var(--border-radius-md); padding: 1.5rem; margin-top: 2rem;">
                        <h6 style="color: var(--info-blue); margin-bottom: 1rem;"><i class="fas fa-lightbulb"></i> Quick Start Guide</h6>
                        <ul style="color: var(--info-blue); margin: 0; padding-left: 1.5rem;">
                            <li>Start with top 2-3 funds from the list above</li>
                            <li>Set up monthly SIPs for consistent investing</li>
                            <li>Review and add more funds gradually</li>
                            <li>Rebalance portfolio annually</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        // Portfolio Analysis Functions
        function analyzeAdvancedPortfolio() {
            if (!clientData.assets || clientData.assets.length === 0) {
                showAlert('Please add your assets first to analyze your portfolio', 'warning');
                return;
            }

            const portfolioAnalysis = performPortfolioAnalysis();
            displayPortfolioAnalysis(portfolioAnalysis);
        }

        function performPortfolioAnalysis() {
            const assets = clientData.assets;
            const totalValue = assets.reduce((sum, asset) => sum + asset.value, 0);
            
            // Asset allocation analysis
            const allocation = {};
            assets.forEach(asset => {
                allocation[asset.type] = (allocation[asset.type] || 0) + asset.value;
            });

            // Convert to percentages
            const allocationPercentage = {};
            Object.keys(allocation).forEach(type => {
                allocationPercentage[type] = (allocation[type] / totalValue * 100).toFixed(1);
            });

            // Risk analysis
            const riskAnalysis = calculatePortfolioRisk(allocationPercentage);
            
            // Performance projections
            const projections = calculatePortfolioProjections(allocation);
            
            // Rebalancing recommendations
            const rebalancingRecs = generateRebalancingRecommendations(allocationPercentage);

            return {
                totalValue,
                allocation: allocationPercentage,
                riskAnalysis,
                projections,
                rebalancingRecs
            };
        }

        function calculatePortfolioRisk(allocation) {
            const riskWeights = {
                cash: 0.5,
                stocks: 8.5,
                property: 3.0,
                gold: 4.0,
                crypto: 12.0,
                business: 6.0,
                other: 3.0
            };

            let portfolioRisk = 0;
            Object.entries(allocation).forEach(([type, percentage]) => {
                portfolioRisk += (percentage / 100) * (riskWeights[type] || 3.0);
            });

            let riskLevel = 'Low';
            if (portfolioRisk > 6) riskLevel = 'High';
            else if (portfolioRisk > 3) riskLevel = 'Moderate';

            return {
                score: portfolioRisk.toFixed(1),
                level: riskLevel,
                volatility: (portfolioRisk * 1.5).toFixed(1)
            };
        }

        function calculatePortfolioProjections(allocation) {
            const expectedReturns = {
                cash: 4,
                stocks: 12,
                property: 8,
                gold: 6,
                crypto: 15,
                business: 10,
                other: 7
            };

            let expectedReturn = 0;
            let totalValue = Object.values(allocation).reduce((sum, value) => sum + value, 0);

            Object.entries(allocation).forEach(([type, value]) => {
                const weight = value / totalValue;
                expectedReturn += weight * (expectedReturns[type] || 7);
            });

            const oneYear = totalValue * (1 + expectedReturn / 100);
            const threeYear = totalValue * Math.pow(1 + expectedReturn / 100, 3);
            const fiveYear = totalValue * Math.pow(1 + expectedReturn / 100, 5);

            return {
                expectedReturn: expectedReturn.toFixed(1),
                oneYear,
                threeYear,
                fiveYear
            };
        }

        function generateRebalancingRecommendations(currentAllocation) {
            const recommendations = [];
            
            // Check for over-concentration
            Object.entries(currentAllocation).forEach(([type, percentage]) => {
                if (percentage > 40 && type !== 'property') {
                    recommendations.push(` Over-concentrated in ${type} (${percentage}%) - Consider diversifying`);
                }
            });

            // Check for missing asset classes
            if (!currentAllocation.stocks || currentAllocation.stocks < 10) {
                recommendations.push(" Consider adding equity exposure for growth potential");
            }
            
            if (!currentAllocation.cash || currentAllocation.cash < 5) {
                recommendations.push(" Maintain some liquid cash for emergencies");
            }

            if (!currentAllocation.gold || currentAllocation.gold < 3) {
                recommendations.push(" Consider small gold allocation for inflation hedge");
            }

            if (recommendations.length === 0) {
                recommendations.push(" Portfolio appears well-balanced across asset classes");
            }

            return recommendations;
        }

        function displayPortfolioAnalysis(analysis) {
            const resultsContainer = document.getElementById('portfolio-analysis-results');
            
            resultsContainer.innerHTML = `
                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h4 class="card-title"><i class="fas fa-search-plus"></i> Portfolio Analysis Report</h4>
                        <p class="card-subtitle">Total Portfolio Value: ${formatCurrency(analysis.totalValue)}</p>
                    </div>
                    
                    <!-- Portfolio Overview -->
                    <div style="margin: 2rem 0;">
                        <h5 style="color: var(--text-white); margin-bottom: 1rem;"> Current Asset Allocation</h5>
                        <div class="data-display">
                            ${Object.entries(analysis.allocation).map(([type, percentage]) => `
                                <div class="data-row">
                                    <span class="data-label">${getAssetIcon(type)} ${type.charAt(0).toUpperCase() + type.slice(1)}:</span>
                                    <span class="data-value">${percentage}%</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Risk Analysis -->
                    <div style="margin: 2rem 0;">
                        <h5 style="color: var(--text-white); margin-bottom: 1rem;"> Risk Analysis</h5>
                        <div class="widgets-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                            <div class="widget">
                                <div class="widget-icon"></div>
                                <div class="widget-value">${analysis.riskAnalysis.score}</div>
                                <div class="widget-label">Risk Score</div>
                            </div>
                            <div class="widget">
                                <div class="widget-icon"></div>
                                <div class="widget-value">${analysis.riskAnalysis.level}</div>
                                <div class="widget-label">Risk Level</div>
                            </div>
                            <div class="widget">
                                <div class="widget-icon"></div>
                                <div class="widget-value">${analysis.riskAnalysis.volatility}%</div>
                                <div class="widget-label">Expected Volatility</div>
                            </div>
                        </div>
                    </div>

                    <!-- Performance Projections -->
                    <div style="margin: 2rem 0;">
                        <h5 style="color: var(--text-white); margin-bottom: 1rem;"> Performance Projections</h5>
                        <div style="background: var(--gradient-card); padding: 2rem; border-radius: var(--border-radius-md);">
                            <p style="color: var(--text-gray); margin-bottom: 1rem;">Expected Annual Return: <strong style="color: var(--success-green);">${analysis.projections.expectedReturn}%</strong></p>
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                                <div style="text-align: center;">
                                    <h6 style="color: var(--text-white); margin-bottom: 0.5rem;">1 Year</h6>
                                    <p style="color: var(--success-green); font-size: 1.2rem; font-weight: 600;">${formatCurrency(analysis.projections.oneYear)}</p>
                                </div>
                                <div style="text-align: center;">
                                    <h6 style="color: var(--text-white); margin-bottom: 0.5rem;">3 Years</h6>
                                    <p style="color: var(--success-green); font-size: 1.2rem; font-weight: 600;">${formatCurrency(analysis.projections.threeYear)}</p>
                                </div>
                                <div style="text-align: center;">
                                    <h6 style="color: var(--text-white); margin-bottom: 0.5rem;">5 Years</h6>
                                    <p style="color: var(--success-green); font-size: 1.2rem; font-weight: 600;">${formatCurrency(analysis.projections.fiveYear)}</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Rebalancing Recommendations -->
                    <div style="margin: 2rem 0;">
                        <h5 style="color: var(--text-white); margin-bottom: 1rem;"> Rebalancing Recommendations</h5>
                        <div style="background: var(--info-blue); background: rgba(0, 212, 255, 0.1); border: 1px solid var(--info-blue); border-radius: var(--border-radius-md); padding: 1.5rem;">
                            ${analysis.rebalancingRecs.map(rec => `<p style="color: var(--info-blue); margin: 0.5rem 0;">${rec}</p>`).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function generateRebalancingPlan() {
            if (!clientData.assets || clientData.assets.length === 0) {
                showAlert('Please add your assets first to generate rebalancing plan', 'warning');
                return;
            }

            const rebalancingPlan = createRebalancingPlan();
            displayRebalancingPlan(rebalancingPlan);
        }

        function createRebalancingPlan() {
            const idealAllocation = getIdealAllocation();
            const currentAllocation = getCurrentAllocation();
            const totalValue = clientData.assets.reduce((sum, asset) => sum + asset.value, 0);
            
            const rebalancingActions = [];
            
            Object.keys(idealAllocation).forEach(assetType => {
                const idealAmount = totalValue * idealAllocation[assetType] / 100;
                const currentAmount = (currentAllocation[assetType] || 0) * totalValue / 100;
                const difference = idealAmount - currentAmount;
                
                if (Math.abs(difference) > totalValue * 0.02) { // 2% threshold
                    const action = difference > 0 ? 'Buy' : 'Sell';
                    rebalancingActions.push({
                        assetType,
                        action,
                        amount: Math.abs(difference),
                        currentPercentage: currentAllocation[assetType] || 0,
                        targetPercentage: idealAllocation[assetType]
                    });
                }
            });

            return {
                idealAllocation,
                currentAllocation,
                rebalancingActions,
                totalValue
            };
        }

        function getIdealAllocation() {
            if (clientData.riskProfile) {
                return getAssetAllocation(clientData.riskProfile.riskScore);
            }
            // Default balanced allocation
            return { equity: 60, debt: 30, gold: 5, international: 5 };
        }

        function getCurrentAllocation() {
            const assets = clientData.assets;
            const totalValue = assets.reduce((sum, asset) => sum + asset.value, 0);
            const allocation = {};
            
            assets.forEach(asset => {
                const mappedType = mapAssetType(asset.type);
                allocation[mappedType] = (allocation[mappedType] || 0) + (asset.value / totalValue * 100);
            });
            
            return allocation;
        }

        function mapAssetType(type) {
            const mapping = {
                'stocks': 'equity',
                'cash': 'debt',
                'property': 'equity',
                'crypto': 'alternative',
                'business': 'equity'
            };
            return mapping[type] || 'debt';
        }

        function displayRebalancingPlan(plan) {
            const resultsContainer = document.getElementById('portfolio-analysis-results');
            
            resultsContainer.innerHTML = `
                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h4 class="card-title"><i class="fas fa-balance-scale"></i> Portfolio Rebalancing Plan</h4>
                        <p class="card-subtitle">Optimize your portfolio allocation</p>
                    </div>
                    
                    ${plan.rebalancingActions.length > 0 ? `
                        <div style="margin: 2rem 0;">
                            <h5 style="color: var(--text-white); margin-bottom: 1rem;"> Recommended Actions</h5>
                            <div class="data-display">
                                ${plan.rebalancingActions.map(action => `
                                    <div class="data-row">
                                        <span class="data-label">${action.action} ${action.assetType.charAt(0).toUpperCase() + action.assetType.slice(1)}:</span>
                                        <span class="data-value">${formatCurrency(action.amount)} (${action.currentPercentage.toFixed(1)}%  ${action.targetPercentage}%)</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : `
                        <div style="background: var(--success-green); background: rgba(0, 255, 136, 0.1); border: 1px solid var(--success-green); border-radius: var(--border-radius-md); padding: 1.5rem; margin: 2rem 0;">
                            <h6 style="color: var(--success-green); margin-bottom: 1rem;"><i class="fas fa-check-circle"></i> Portfolio is Well Balanced</h6>
                            <p style="color: var(--success-green); margin: 0;">Your current allocation is close to the recommended target. No major rebalancing needed at this time.</p>
                        </div>
                    `}

                    <div style="margin: 2rem 0;">
                        <h5 style="color: var(--text-white); margin-bottom: 1rem;"> Target vs Current Allocation</h5>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                            ${Object.entries(plan.idealAllocation).map(([type, target]) => {
                                const current = plan.currentAllocation[type] || 0;
                                return `
                                    <div style="background: var(--gradient-card); padding: 1rem; border-radius: var(--border-radius-md); text-align: center;">
                                        <h6 style="color: var(--text-white); margin-bottom: 0.5rem;">${type.charAt(0).toUpperCase() + type.slice(1)}</h6>
                                        <p style="color: var(--text-gray); font-size: 0.9rem;">Current: ${current.toFixed(1)}%</p>
                                        <p style="color: var(--success-green); font-weight: 600;">Target: ${target}%</p>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function performRiskAnalysis() {
            if (!clientData.assets || clientData.assets.length === 0) {
                showAlert('Please add your assets first to perform risk analysis', 'warning');
                return;
            }

            const riskAnalysis = calculateDetailedRiskAnalysis();
            displayRiskAnalysis(riskAnalysis);
        }

        function calculateDetailedRiskAnalysis() {
            const assets = clientData.assets;
            const totalValue = assets.reduce((sum, asset) => sum + asset.value, 0);
            
            // Calculate Value at Risk (VaR)
            const var95 = calculateVaR(assets, totalValue, 0.95);
            const var99 = calculateVaR(assets, totalValue, 0.99);
            
            // Diversification analysis
            const diversificationScore = calculateDiversificationScore(assets);
            
            // Stress test scenarios
            const stressTests = performStressTests(assets, totalValue);
            
            return {
                var95,
                var99,
                diversificationScore,
                stressTests
            };
        }

        function calculateVaR(assets, totalValue, confidence) {
            const volatilities = {
                cash: 0.02,
                stocks: 0.20,
                property: 0.15,
                gold: 0.18,
                crypto: 0.60,
                business: 0.25,
                other: 0.15
            };
            
            let portfolioVolatility = 0;
            assets.forEach(asset => {
                const weight = asset.value / totalValue;
                const vol = volatilities[asset.type] || 0.15;
                portfolioVolatility += weight * vol;
            });
            
            // Simplified VaR calculation
            const zScore = confidence === 0.95 ? 1.645 : 2.326;
            return totalValue * portfolioVolatility * zScore;
        }

        function calculateDiversificationScore(assets) {
            const assetTypes = [...new Set(assets.map(asset => asset.type))];
            const maxPossibleTypes = 7; // cash, stocks, property, gold, crypto, business, other
            
            // Base score from number of asset types
            let score = (assetTypes.length / maxPossibleTypes) * 50;
            
            // Concentration penalty
            const totalValue = assets.reduce((sum, asset) => sum + asset.value, 0);
            const concentrationPenalty = assets.reduce((penalty, asset) => {
                const weight = asset.value / totalValue;
                if (weight > 0.4) penalty += (weight - 0.4) * 100;
                return penalty;
            }, 0);
            
            score = Math.max(0, score - concentrationPenalty);
            return Math.min(100, score);
        }

        function performStressTests(assets, totalValue) {
            const scenarios = {
                'Market Crash': { stocks: -0.3, property: -0.2, crypto: -0.5, business: -0.25 },
                'Inflation Spike': { cash: -0.1, debt: -0.15, gold: 0.2, property: 0.1 },
                'Economic Recession': { stocks: -0.25, business: -0.3, property: -0.15, cash: 0.02 }
            };
            
            const results = {};
            
            Object.entries(scenarios).forEach(([scenarioName, impacts]) => {
                let newValue = 0;
                assets.forEach(asset => {
                    const impact = impacts[asset.type] || 0;
                    newValue += asset.value * (1 + impact);
                });
                
                results[scenarioName] = {
                    newValue,
                    loss: totalValue - newValue,
                    lossPercentage: ((totalValue - newValue) / totalValue * 100).toFixed(1)
                };
            });
            
            return results;
        }

        function displayRiskAnalysis(analysis) {
            const resultsContainer = document.getElementById('portfolio-analysis-results');
            
            resultsContainer.innerHTML = `
                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h4 class="card-title"><i class="fas fa-exclamation-triangle"></i> Comprehensive Risk Analysis</h4>
                        <p class="card-subtitle">Understand your portfolio's risk exposure</p>
                    </div>
                    
                    <!-- Risk Metrics -->
                    <div style="margin: 2rem 0;">
                        <h5 style="color: var(--text-white); margin-bottom: 1rem;"> Risk Metrics</h5>
                        <div class="widgets-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                            <div class="widget">
                                <div class="widget-icon"></div>
                                <div class="widget-value">${formatCurrency(analysis.var95)}</div>
                                <div class="widget-label">VaR (95% confidence)</div>
                            </div>
                            <div class="widget">
                                <div class="widget-icon"></div>
                                <div class="widget-value">${formatCurrency(analysis.var99)}</div>
                                <div class="widget-label">VaR (99% confidence)</div>
                            </div>
                            <div class="widget">
                                <div class="widget-icon"></div>
                                <div class="widget-value">${analysis.diversificationScore.toFixed(0)}/100</div>
                                <div class="widget-label">Diversification Score</div>
                            </div>
                        </div>
                    </div>

                    <!-- Stress Test Results -->
                    <div style="margin: 2rem 0;">
                        <h5 style="color: var(--text-white); margin-bottom: 1rem;"> Stress Test Scenarios</h5>
                        <div class="data-display">
                            ${Object.entries(analysis.stressTests).map(([scenario, result]) => `
                                <div class="data-row">
                                    <span class="data-label">${scenario}:</span>
                                    <span class="data-value" style="color: ${result.loss > 0 ? 'var(--error-red)' : 'var(--success-green)'};">
                                        ${result.loss > 0 ? '-' : '+'}${formatCurrency(Math.abs(result.loss))} (${result.lossPercentage}%)
                                    </span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Risk Management Recommendations -->
                    <div style="background: var(--warning-orange); background: rgba(255, 159, 67, 0.1); border: 1px solid var(--warning-orange); border-radius: var(--border-radius-md); padding: 1.5rem; margin-top: 2rem;">
                        <h6 style="color: var(--warning-orange); margin-bottom: 1rem;"><i class="fas fa-shield-alt"></i> Risk Management Recommendations</h6>
                        <ul style="color: var(--warning-orange); margin: 0; padding-left: 1.5rem;">
                            ${analysis.diversificationScore < 50 ? '<li>Improve diversification across asset classes</li>' : ''}
                            ${analysis.var95 > (clientData.assets.reduce((sum, asset) => sum + asset.value, 0) * 0.15) ? '<li>Consider reducing portfolio volatility</li>' : ''}
                            <li>Maintain emergency fund separate from investments</li>
                            <li>Review and rebalance portfolio quarterly</li>
                            <li>Consider hedging strategies for large positions</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        // 2. Retirement Planning Calculator
        function calculateAdvancedRetirement() {
            const currentAge = parseFloat(document.getElementById('current-age').value);
            const retirementAge = parseFloat(document.getElementById('retirement-age').value);
            const currentIncome = parseFloat(document.getElementById('retirement-current-income').value);
            const currentSavings = parseFloat(document.getElementById('retirement-current-savings').value);
            const monthlyContribution = parseFloat(document.getElementById('retirement-monthly-contribution').value);
            const expectedLifespan = parseFloat(document.getElementById('expected-lifespan').value);
            const inflationRate = parseFloat(document.getElementById('retirement-inflation').value) / 100;
            const expectedReturn = parseFloat(document.getElementById('retirement-return').value) / 100;
            const incomeReplacement = parseFloat(document.getElementById('income-replacement').value) / 100;

            if (!currentAge || !retirementAge || !currentIncome) {
                showAlert('Please fill in all required fields', 'warning');
                return;
            }

            const retirementPlan = calculateRetirementPlan({
                currentAge,
                retirementAge,
                currentIncome,
                currentSavings: currentSavings || 0,
                monthlyContribution: monthlyContribution || 0,
                expectedLifespan: expectedLifespan || 80,
                inflationRate,
                expectedReturn,
                incomeReplacement
            });

            displayRetirementPlan(retirementPlan);
        }

        function calculateRetirementPlan(params) {
            const yearsToRetirement = params.retirementAge - params.currentAge;
            const retirementYears = params.expectedLifespan - params.retirementAge;
            
            // Calculate future value of current savings
            const futureValueCurrentSavings = params.currentSavings * Math.pow(1 + params.expectedReturn, yearsToRetirement);
            
            // Calculate future value of monthly contributions
            const monthlyReturn = params.expectedReturn / 12;
            const months = yearsToRetirement * 12;
            const futureValueContributions = params.monthlyContribution * 
                ((Math.pow(1 + monthlyReturn, months) - 1) / monthlyReturn);
            
            // Total savings at retirement
            const totalSavingsAtRetirement = futureValueCurrentSavings + futureValueContributions;
            
            // Required income at retirement (inflation adjusted)
            const requiredAnnualIncomeAtRetirement = params.currentIncome * params.incomeReplacement * 
                Math.pow(1 + params.inflationRate, yearsToRetirement);
            
            // Required corpus using 4% withdrawal rule (adjusted for inflation)
            const requiredCorpus = requiredAnnualIncomeAtRetirement * 25;
            
            // Shortfall/surplus
            const shortfall = requiredCorpus - totalSavingsAtRetirement;
            
            // Additional monthly investment needed to bridge shortfall
            let additionalMonthlyInvestment = 0;
            if (shortfall > 0) {
                additionalMonthlyInvestment = shortfall / 
                    ((Math.pow(1 + monthlyReturn, months) - 1) / monthlyReturn);
            }

            // Monte Carlo simulation for success probability
            const successProbability = calculateRetirementSuccessProbability(
                totalSavingsAtRetirement, 
                requiredAnnualIncomeAtRetirement, 
                retirementYears,
                params.expectedReturn,
                params.inflationRate
            );

            return {
                yearsToRetirement,
                retirementYears,
                totalSavingsAtRetirement,
                requiredCorpus,
                requiredAnnualIncomeAtRetirement,
                shortfall,
                additionalMonthlyInvestment: Math.max(0, additionalMonthlyInvestment),
                successProbability,
                currentAge: params.currentAge,
                retirementAge: params.retirementAge,
                monthlyContribution: params.monthlyContribution
            };
        }

        function calculateRetirementSuccessProbability(corpus, annualIncome, years, expectedReturn, inflationRate) {
            // Simplified Monte Carlo simulation
            let successfulRuns = 0;
            const simulations = 1000;
            
            for (let i = 0; i < simulations; i++) {
                let remainingCorpus = corpus;
                let currentAnnualIncome = annualIncome;
                
                for (let year = 0; year < years; year++) {
                    // Random return variation (3% from expected)
                    const randomReturn = expectedReturn + (Math.random() - 0.5) * 0.06;
                    
                    // Withdraw required income
                    remainingCorpus -= currentAnnualIncome;
                    
                    // Apply return to remaining corpus
                    remainingCorpus *= (1 + randomReturn);
                    
                    // Adjust income for inflation
                    currentAnnualIncome *= (1 + inflationRate);
                    
                    // If corpus is depleted, this run failed
                    if (remainingCorpus <= 0) break;
                }
                
                if (remainingCorpus > 0) successfulRuns++;
            }
            
            return (successfulRuns / simulations * 100).toFixed(1);
        }

        function displayRetirementPlan(plan) {
            const resultsContainer = document.getElementById('retirement-results');
            
            resultsContainer.innerHTML = `
                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h4 class="card-title"><i class="fas fa-calendar-check"></i> Your Retirement Plan Analysis</h4>
                        <p class="card-subtitle">${plan.yearsToRetirement} years to retirement | ${plan.retirementYears} years in retirement</p>
                    </div>
                    
                    <!-- Key Metrics -->
                    <div style="margin: 2rem 0;">
                        <h5 style="color: var(--text-white); margin-bottom: 1rem;"> Key Retirement Metrics</h5>
                        <div class="widgets-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                            <div class="widget">
                                <div class="widget-icon"></div>
                                <div class="widget-value">${formatCurrency(plan.totalSavingsAtRetirement)}</div>
                                <div class="widget-label">Projected Savings</div>
                            </div>
                            <div class="widget">
                                <div class="widget-icon"></div>
                                <div class="widget-value">${formatCurrency(plan.requiredCorpus)}</div>
                                <div class="widget-label">Required Corpus</div>
                            </div>
                            <div class="widget">
                                <div class="widget-icon"></div>
                                <div class="widget-value">${plan.successProbability}%</div>
                                <div class="widget-label">Success Probability</div>
                            </div>
                        </div>
                    </div>

                    <!-- Shortfall Analysis -->
                    ${plan.shortfall > 0 ? `
                        <div style="background: var(--warning-orange); background: rgba(255, 159, 67, 0.1); border: 1px solid var(--warning-orange); border-radius: var(--border-radius-md); padding: 1.5rem; margin: 2rem 0;">
                            <h6 style="color: var(--warning-orange); margin-bottom: 1rem;"><i class="fas fa-exclamation-triangle"></i> Retirement Shortfall Detected</h6>
                            <div class="data-display" style="background: transparent;">
                                <div class="data-row" style="border: none;">
                                    <span class="data-label" style="color: var(--warning-orange);">Shortfall Amount:</span>
                                    <span class="data-value" style="color: var(--warning-orange);">${formatCurrency(plan.shortfall)}</span>
                                </div>
                                <div class="data-row" style="border: none;">
                                    <span class="data-label" style="color: var(--warning-orange);">Additional Monthly Investment Needed:</span>
                                    <span class="data-value" style="color: var(--warning-orange);">${formatCurrency(plan.additionalMonthlyInvestment)}</span>
                                </div>
                            </div>
                        </div>
                    ` : `
                        <div style="background: var(--success-green); background: rgba(0, 255, 136, 0.1); border: 1px solid var(--success-green); border-radius: var(--border-radius-md); padding: 1.5rem; margin: 2rem 0;">
                            <h6 style="color: var(--success-green); margin-bottom: 1rem;"><i class="fas fa-check-circle"></i> Retirement Goal on Track</h6>
                            <p style="color: var(--success-green); margin: 0;">Congratulations! Your current savings plan is sufficient to meet your retirement goals. Surplus: ${formatCurrency(Math.abs(plan.shortfall))}</p>
                        </div>
                    `}

                    <!-- Income Replacement Analysis -->
                    <div style="margin: 2rem 0;">
                        <h5 style="color: var(--text-white); margin-bottom: 1rem;"> Retirement Income Analysis</h5>
                        <div class="data-display">
                            <div class="data-row">
                                <span class="data-label">Required Annual Income at Retirement:</span>
                                <span class="data-value">${formatCurrency(plan.requiredAnnualIncomeAtRetirement)}</span>
                            </div>
                            <div class="data-row">
                                <span class="data-label">Monthly Income from Corpus (4% rule):</span>
                                <span class="data-value">${formatCurrency(plan.totalSavingsAtRetirement * 0.04 / 12)}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Recommendations -->
                    <div style="background: var(--info-blue); background: rgba(0, 212, 255, 0.1); border: 1px solid var(--info-blue); border-radius: var(--border-radius-md); padding: 1.5rem; margin-top: 2rem;">
                        <h6 style="color: var(--info-blue); margin-bottom: 1rem;"><i class="fas fa-lightbulb"></i> Retirement Planning Recommendations</h6>
                        <ul style="color: var(--info-blue); margin: 0; padding-left: 1.5rem;">
                            ${plan.successProbability < 70 ? '<li>Consider increasing monthly contributions to improve success probability</li>' : ''}
                            ${plan.additionalMonthlyInvestment > 0 ? `<li>Increase monthly investment by ${formatCurrency(plan.additionalMonthlyInvestment)} to bridge the shortfall</li>` : ''}
                            <li>Review and rebalance portfolio annually to maintain target allocation</li>
                            <li>Consider healthcare inflation and long-term care costs</li>
                            <li>Explore tax-efficient retirement accounts like EPF, PPF, and NPS</li>
                            ${plan.yearsToRetirement > 20 ? '<li>Focus on equity investments for better long-term growth</li>' : '<li>Gradually shift to conservative investments as retirement approaches</li>'}
                        </ul>
                    </div>
                </div>
            `;
        }

        // 3. Advanced Tax Planning Calculator
        function generateAdvancedTaxPlan() {
            const annualIncome = parseFloat(document.getElementById('tax-annual-income').value);
            const currentInvestments = parseFloat(document.getElementById('tax-current-investments').value) || 0;
            const houseLoanInterest = parseFloat(document.getElementById('house-loan-interest').value) || 0;
            const medicalInsurance = parseFloat(document.getElementById('medical-insurance').value) || 0;
            const donationsCharity = parseFloat(document.getElementById('donations-charity').value) || 0;
            const age = parseFloat(document.getElementById('taxpayer-age').value) || 30;

            if (!annualIncome) {
                showAlert('Please enter your annual income', 'warning');
                return;
            }

            const taxPlan = calculateTaxOptimization({
                annualIncome,
                currentInvestments,
                houseLoanInterest,
                medicalInsurance,
                donationsCharity,
                age
            });

            displayTaxPlan(taxPlan);
        }

        function calculateTaxOptimization(params) {
            const income = params.annualIncome;
            const isSenior = params.age >= 60;
            
            // Basic exemption limit
            const basicExemption = isSenior ? 300000 : 250000;
            
            // Calculate current tax liability
            const currentTaxableIncome = Math.max(0, income - basicExemption - params.currentInvestments - 
                params.houseLoanInterest - params.medicalInsurance - params.donationsCharity);
            const currentTax = calculateIncomeTax(currentTaxableIncome, isSenior);
            
            // Calculate optimized tax plan
            const optimizations = generateTaxOptimizations(params);
            const totalOptimizedDeductions = optimizations.reduce((sum, opt) => sum + opt.amount, 0);
            const optimizedTaxableIncome = Math.max(0, income - basicExemption - totalOptimizedDeductions);
            const optimizedTax = calculateIncomeTax(optimizedTaxableIncome, isSenior);
            
            const taxSavings = currentTax - optimizedTax;
            
            return {
                currentTaxableIncome,
                currentTax,
                optimizedTaxableIncome,
                optimizedTax,
                taxSavings,
                optimizations,
                basicExemption,
                totalOptimizedDeductions
            };
        }

        function calculateIncomeTax(taxableIncome, isSenior) {
            if (taxableIncome <= 0) return 0;
            
            let tax = 0;
            const slabs = isSenior ? 
                [[300000, 0], [500000, 0.05], [1000000, 0.20], [Infinity, 0.30]] :
                [[250000, 0], [500000, 0.05], [1000000, 0.20], [Infinity, 0.30]];
            
            let remainingIncome = taxableIncome;
            let previousSlab = 0;
            
            for (const [slabLimit, rate] of slabs) {
                const taxableInThisSlab = Math.min(remainingIncome, slabLimit - previousSlab);
                tax += taxableInThisSlab * rate;
                remainingIncome -= taxableInThisSlab;
                
                if (remainingIncome <= 0) break;
                previousSlab = slabLimit;
            }
            
            // Add cess (4%)
            tax *= 1.04;
            
            return tax;
        }

        function generateTaxOptimizations(params) {
            const optimizations = [];
            const maxDeductions = {
                '80C': 150000,
                '80D': params.age >= 60 ? 50000 : 25000,
                '80CCD1B': 50000,
                '80E': 200000,
                '80G': Math.min(params.annualIncome * 0.1, 100000),
                '24B': 200000,
                '80EEA': 150000
            };
            
            // Section 80C optimizations
            const current80C = params.currentInvestments;
            if (current80C < maxDeductions['80C']) {
                const additional80C = maxDeductions['80C'] - current80C;
                optimizations.push({
                    section: '80C',
                    description: 'ELSS Mutual Funds, PPF, EPF',
                    amount: additional80C,
                    currentAmount: current80C,
                    maxLimit: maxDeductions['80C'],
                    taxBenefit: additional80C * 0.3
                });
            }
            
            // Section 80D optimizations
            if (params.medicalInsurance < maxDeductions['80D']) {
                const additional80D = maxDeductions['80D'] - params.medicalInsurance;
                optimizations.push({
                    section: '80D',
                    description: 'Health Insurance Premium',
                    amount: additional80D,
                    currentAmount: params.medicalInsurance,
                    maxLimit: maxDeductions['80D'],
                    taxBenefit: additional80D * 0.3
                });
            }
            
            // Section 80CCD(1B) - NPS
            optimizations.push({
                section: '80CCD(1B)',
                description: 'National Pension System (NPS)',
                amount: maxDeductions['80CCD1B'],
                currentAmount: 0,
                maxLimit: maxDeductions['80CCD1B'],
                taxBenefit: maxDeductions['80CCD1B'] * 0.3
            });
            
            // Section 24(B) - Home loan interest
            if (params.houseLoanInterest < maxDeductions['24B']) {
                const additionalHomeLoan = Math.min(50000, maxDeductions['24B'] - params.houseLoanInterest);
                if (additionalHomeLoan > 0) {
                    optimizations.push({
                        section: '24(B)',
                        description: 'Home Loan Interest (Self-Occupied)',
                        amount: additionalHomeLoan,
                        currentAmount: params.houseLoanInterest,
                        maxLimit: 200000,
                        taxBenefit: additionalHomeLoan * 0.3
                    });
                }
            }
            
            // Section 80G - Donations
            if (params.donationsCharity < maxDeductions['80G']) {
                const additionalDonations = Math.min(25000, maxDeductions['80G'] - params.donationsCharity);
                optimizations.push({
                    section: '80G',
                    description: 'Donations to Charity',
                    amount: additionalDonations,
                    currentAmount: params.donationsCharity,
                    maxLimit: maxDeductions['80G'],
                    taxBenefit: additionalDonations * 0.5 // 50% deduction for most donations
                });
            }
            
            return optimizations.filter(opt => opt.amount > 0);
        }

        function displayTaxPlan(plan) {
            const resultsContainer = document.getElementById('tax-optimization-results');
            
            resultsContainer.innerHTML = `
                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h4 class="card-title"><i class="fas fa-calculator"></i> Advanced Tax Optimization Plan</h4>
                        <p class="card-subtitle">Potential Tax Savings: ${formatCurrency(plan.taxSavings)}</p>
                    </div>
                    
                    <!-- Tax Comparison -->
                    <div style="margin: 2rem 0;">
                        <h5 style="color: var(--text-white); margin-bottom: 1rem;"> Tax Liability Comparison</h5>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                            <div style="background: var(--error-red); background: rgba(255, 99, 132, 0.1); border: 1px solid var(--error-red); border-radius: var(--border-radius-md); padding: 1.5rem; text-align: center;">
                                <h6 style="color: var(--error-red); margin-bottom: 1rem;">Current Tax</h6>
                                <p style="color: var(--error-red); font-size: 1.5rem; font-weight: 600; margin: 0;">${formatCurrency(plan.currentTax)}</p>
                                <p style="color: var(--text-gray); font-size: 0.9rem;">Taxable: ${formatCurrency(plan.currentTaxableIncome)}</p>
                            </div>
                            <div style="background: var(--success-green); background: rgba(0, 255, 136, 0.1); border: 1px solid var(--success-green); border-radius: var(--border-radius-md); padding: 1.5rem; text-align: center;">
                                <h6 style="color: var(--success-green); margin-bottom: 1rem;">Optimized Tax</h6>
                                <p style="color: var(--success-green); font-size: 1.5rem; font-weight: 600; margin: 0;">${formatCurrency(plan.optimizedTax)}</p>
                                <p style="color: var(--text-gray); font-size: 0.9rem;">Taxable: ${formatCurrency(plan.optimizedTaxableIncome)}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Tax Saving Opportunities -->
                    <div style="margin: 2rem 0;">
                        <h5 style="color: var(--text-white); margin-bottom: 1rem;"> Tax Saving Opportunities</h5>
                        <div class="data-display">
                            ${plan.optimizations.map(opt => `
                                <div class="data-row">
                                    <span class="data-label">
                                        ${opt.section} - ${opt.description}:
                                        <br><small style="color: var(--text-gray);">Current: ${formatCurrency(opt.currentAmount)} | Max: ${formatCurrency(opt.maxLimit)}</small>
                                    </span>
                                    <span class="data-value">
                                        ${formatCurrency(opt.amount)}
                                        <br><small style="color: var(--success-green);">Saves: ${formatCurrency(opt.taxBenefit)}</small>
                                    </span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Investment Recommendations -->
                    <div style="background: var(--info-blue); background: rgba(0, 212, 255, 0.1); border: 1px solid var(--info-blue); border-radius: var(--border-radius-md); padding: 1.5rem; margin-top: 2rem;">
                        <h6 style="color: var(--info-blue); margin-bottom: 1rem;"><i class="fas fa-piggy-bank"></i> Recommended Tax-Saving Investments</h6>
                        <ul style="color: var(--info-blue); margin: 0; padding-left: 1.5rem;">
                            <li><strong>ELSS Mutual Funds</strong> - 3-year lock-in, potential for high returns</li>
                            <li><strong>Public Provident Fund (PPF)</strong> - 15-year lock-in, tax-free returns</li>
                            <li><strong>National Pension System (NPS)</strong> - Additional 50,000 deduction under 80CCD(1B)</li>
                            <li><strong>Health Insurance</strong> - Covers medical emergencies while saving tax</li>
                            <li><strong>Term Life Insurance</strong> - Financial protection for family</li>
                        </ul>
                    </div>

                    <!-- Action Plan -->
                    <div style="background: var(--success-green); background: rgba(0, 255, 136, 0.1); border: 1px solid var(--success-green); border-radius: var(--border-radius-md); padding: 1.5rem; margin-top: 2rem;">
                        <h6 style="color: var(--success-green); margin-bottom: 1rem;"><i class="fas fa-tasks"></i> Implementation Action Plan</h6>
                        <ol style="color: var(--success-green); margin: 0; padding-left: 1.5rem;">
                            <li>Maximize Section 80C investments (1.5 lakh limit)</li>
                            <li>Start NPS investment for additional 50,000 deduction</li>
                            <li>Ensure adequate health insurance coverage</li>
                            <li>Consider home loan for additional interest deduction</li>
                            <li>Plan charitable donations for Section 80G benefits</li>
                        </ol>
                    </div>
                </div>
            `;
        }

        // 4. Advanced Loan Calculator
        function calculateLoanDetails() {
            const loanAmount = parseFloat(document.getElementById('loan-amount').value);
            const interestRate = parseFloat(document.getElementById('loan-interest-rate').value);
            const loanTenure = parseFloat(document.getElementById('loan-tenure').value);
            const loanType = document.getElementById('loan-type').value;
            const processingFee = parseFloat(document.getElementById('processing-fee').value) || 0;

            if (!loanAmount || !interestRate || !loanTenure) {
                showAlert('Please fill in all required loan details', 'warning');
                return;
            }

            const loanDetails = calculateAdvancedLoanMetrics({
                principal: loanAmount,
                annualRate: interestRate / 100,
                tenureYears: loanTenure,
                loanType,
                processingFee
            });

            displayLoanDetails(loanDetails);
        }

        function calculateAdvancedLoanMetrics(params) {
            const { principal, annualRate, tenureYears, loanType, processingFee } = params;
            const monthlyRate = annualRate / 12;
            const totalMonths = tenureYears * 12;
            
            // Calculate EMI using standard formula
            const emi = principal * (monthlyRate * Math.pow(1 + monthlyRate, totalMonths)) / 
                        (Math.pow(1 + monthlyRate, totalMonths) - 1);
            
            // Calculate total payment and interest
            const totalPayment = emi * totalMonths;
            const totalInterest = totalPayment - principal;
            
            // Calculate effective interest rate including processing fee
            const totalCost = totalPayment + processingFee;
            const effectiveRate = ((totalCost / principal) ** (1 / tenureYears) - 1) * 100;
            
            // Generate amortization schedule
            const amortizationSchedule = generateAmortizationSchedule(principal, monthlyRate, totalMonths, emi);
            
            // Calculate prepayment scenarios
            const prepaymentAnalysis = calculatePrepaymentScenarios(principal, monthlyRate, totalMonths, emi);
            
            // Calculate loan affordability metrics
            const affordabilityMetrics = calculateAffordabilityMetrics(emi, loanType);

            return {
                emi,
                totalPayment,
                totalInterest,
                effectiveRate,
                processingFee,
                amortizationSchedule,
                prepaymentAnalysis,
                affordabilityMetrics,
                principal,
                tenureYears,
                annualRate: annualRate * 100
            };
        }

        function generateAmortizationSchedule(principal, monthlyRate, totalMonths, emi) {
            const schedule = [];
            let remainingPrincipal = principal;
            let cumulativeInterest = 0;
            let cumulativePrincipal = 0;
            
            for (let month = 1; month <= Math.min(totalMonths, 12); month++) { // Show first year only
                const interestPayment = remainingPrincipal * monthlyRate;
                const principalPayment = emi - interestPayment;
                remainingPrincipal -= principalPayment;
                cumulativeInterest += interestPayment;
                cumulativePrincipal += principalPayment;
                
                schedule.push({
                    month,
                    emi: emi,
                    principalPayment,
                    interestPayment,
                    remainingPrincipal,
                    cumulativeInterest,
                    cumulativePrincipal
                });
            }
            
            return schedule;
        }

        function calculatePrepaymentScenarios(principal, monthlyRate, totalMonths, emi) {
            const scenarios = [10000, 50000, 100000];
            const prepaymentResults = [];
            
            scenarios.forEach(prepaymentAmount => {
                if (prepaymentAmount < principal) {
                    const newPrincipal = principal - prepaymentAmount;
                    const newTotalMonths = Math.log(1 + (newPrincipal * monthlyRate) / emi) / Math.log(1 + monthlyRate);
                    const newTotalPayment = emi * newTotalMonths;
                    const savedAmount = (emi * totalMonths) - (newTotalPayment + prepaymentAmount);
                    const savedTime = totalMonths - newTotalMonths;
                    
                    prepaymentResults.push({
                        prepaymentAmount,
                        newTenureMonths: Math.ceil(newTotalMonths),
                        savedAmount,
                        savedTimeMonths: Math.floor(savedTime),
                        roi: (savedAmount / prepaymentAmount * 100).toFixed(1)
                    });
                }
            });
            
            return prepaymentResults;
        }

        function calculateAffordabilityMetrics(emi, loanType) {
            // Suggested income multiples based on loan type
            const incomeMultiples = {
                'home': 3.5,
                'car': 5,
                'personal': 6,
                'education': 4
            };
            
            const suggestedMinIncome = emi * (incomeMultiples[loanType] || 5);
            const emiToIncomeRatio = 30; // 30% max recommended
            
            return {
                suggestedMinIncome,
                maxRecommendedEmi: suggestedMinIncome * (emiToIncomeRatio / 100),
                affordabilityRating: emi <= (suggestedMinIncome * 0.3) ? 'Good' : 
                                   emi <= (suggestedMinIncome * 0.4) ? 'Moderate' : 'High Risk'
            };
        }

        function displayLoanDetails(details) {
            const resultsContainer = document.getElementById('loan-calculator-results');
            
            resultsContainer.innerHTML = `
                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h4 class="card-title"><i class="fas fa-calculator"></i> Comprehensive Loan Analysis</h4>
                        <p class="card-subtitle">Loan Amount: ${formatCurrency(details.principal)} | Tenure: ${details.tenureYears} years</p>
                    </div>
                    
                    <!-- Key Loan Metrics -->
                    <div style="margin: 2rem 0;">
                        <h5 style="color: var(--text-white); margin-bottom: 1rem;"> Key Loan Metrics</h5>
                        <div class="widgets-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                            <div class="widget">
                                <div class="widget-icon"></div>
                                <div class="widget-value">${formatCurrency(details.emi)}</div>
                                <div class="widget-label">Monthly EMI</div>
                            </div>
                            <div class="widget">
                                <div class="widget-icon"></div>
                                <div class="widget-value">${formatCurrency(details.totalInterest)}</div>
                                <div class="widget-label">Total Interest</div>
                            </div>
                            <div class="widget">
                                <div class="widget-icon"></div>
                                <div class="widget-value">${formatCurrency(details.totalPayment)}</div>
                                <div class="widget-label">Total Payment</div>
                            </div>
                            <div class="widget">
                                <div class="widget-icon"></div>
                                <div class="widget-value">${details.effectiveRate.toFixed(2)}%</div>
                                <div class="widget-label">Effective Rate</div>
                            </div>
                        </div>
                    </div>

                    <!-- Affordability Analysis -->
                    <div style="margin: 2rem 0;">
                        <h5 style="color: var(--text-white); margin-bottom: 1rem;"> Affordability Analysis</h5>
                        <div style="background: var(--gradient-card); padding: 1.5rem; border-radius: var(--border-radius-md);">
                            <div class="data-display" style="background: transparent;">
                                <div class="data-row" style="border: none;">
                                    <span class="data-label">Suggested Minimum Income:</span>
                                    <span class="data-value">${formatCurrency(details.affordabilityMetrics.suggestedMinIncome)}</span>
                                </div>
                                <div class="data-row" style="border: none;">
                                    <span class="data-label">Affordability Rating:</span>
                                    <span class="data-value" style="color: ${details.affordabilityMetrics.affordabilityRating === 'Good' ? 'var(--success-green)' : 
                                        details.affordabilityMetrics.affordabilityRating === 'Moderate' ? 'var(--warning-orange)' : 'var(--error-red)'};">
                                        ${details.affordabilityMetrics.affordabilityRating}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Prepayment Analysis -->
                    <div style="margin: 2rem 0;">
                        <h5 style="color: var(--text-white); margin-bottom: 1rem;"> Prepayment Benefits Analysis</h5>
                        <div class="data-display">
                            ${details.prepaymentAnalysis.map(scenario => `
                                <div class="data-row">
                                    <span class="data-label">
                                        Prepay ${formatCurrency(scenario.prepaymentAmount)}:
                                        <br><small style="color: var(--text-gray);">Save ${scenario.savedTimeMonths} months</small>
                                    </span>
                                    <span class="data-value">
                                        Save ${formatCurrency(scenario.savedAmount)}
                                        <br><small style="color: var(--success-green);">ROI: ${scenario.roi}%</small>
                                    </span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- First Year Amortization -->
                    <div style="margin: 2rem 0;">
                        <h5 style="color: var(--text-white); margin-bottom: 1rem;"> First Year Payment Breakdown</h5>
                        <div style="max-height: 300px; overflow-y: auto;">
                            <table style="width: 100%; border-collapse: collapse; color: var(--text-white);">
                                <thead style="background: var(--secondary-black); position: sticky; top: 0;">
                                    <tr>
                                        <th style="padding: 0.75rem; text-align: left; border-bottom: 1px solid var(--accent-white);">Month</th>
                                        <th style="padding: 0.75rem; text-align: right; border-bottom: 1px solid var(--accent-white);">Principal</th>
                                        <th style="padding: 0.75rem; text-align: right; border-bottom: 1px solid var(--accent-white);">Interest</th>
                                        <th style="padding: 0.75rem; text-align: right; border-bottom: 1px solid var(--accent-white);">Balance</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${details.amortizationSchedule.map(row => `
                                        <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                                            <td style="padding: 0.5rem;">${row.month}</td>
                                            <td style="padding: 0.5rem; text-align: right;">${formatCurrency(row.principalPayment)}</td>
                                            <td style="padding: 0.5rem; text-align: right;">${formatCurrency(row.interestPayment)}</td>
                                            <td style="padding: 0.5rem; text-align: right;">${formatCurrency(row.remainingPrincipal)}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Recommendations -->
                    <div style="background: var(--info-blue); background: rgba(0, 212, 255, 0.1); border: 1px solid var(--info-blue); border-radius: var(--border-radius-md); padding: 1.5rem; margin-top: 2rem;">
                        <h6 style="color: var(--info-blue); margin-bottom: 1rem;"><i class="fas fa-lightbulb"></i> Loan Management Tips</h6>
                        <ul style="color: var(--info-blue); margin: 0; padding-left: 1.5rem;">
                            <li>Consider prepaying to reduce total interest cost</li>
                            <li>Ensure EMI doesn't exceed 40% of monthly income</li>
                            <li>Compare rates from multiple lenders before finalizing</li>
                            <li>Factor in processing fees and other charges</li>
                            <li>Consider loan insurance for financial protection</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        // 5. Budget Planner Functions
        function addBudgetItem() {
            const category = document.getElementById('budget-category').value;
            const description = document.getElementById('budget-description').value;
            const amount = parseFloat(document.getElementById('budget-amount').value);
            const type = document.getElementById('budget-type').value;

            if (!category || !description || !amount) {
                showAlert('Please fill in all budget fields', 'warning');
                return;
            }

            if (!clientData.budget) {
                clientData.budget = { income: [], expenses: [] };
            }

            const budgetItem = {
                id: Date.now(),
                category,
                description,
                amount,
                type,
                date: new Date().toISOString().split('T')[0]
            };

            clientData.budget[type].push(budgetItem);
            saveClientData();
            
            // Clear form
            document.getElementById('budget-category').value = '';
            document.getElementById('budget-description').value = '';
            document.getElementById('budget-amount').value = '';

            displayBudgetOverview();
            showAlert('Budget item added successfully!', 'success');
        }

        function displayBudgetOverview() {
            const budgetContainer = document.getElementById('budget-overview');
            
            if (!clientData.budget || (!clientData.budget.income.length && !clientData.budget.expenses.length)) {
                budgetContainer.innerHTML = `
                    <div class="card" style="margin-top: 2rem;">
                        <div class="card-header">
                            <h4 class="card-title"><i class="fas fa-chart-pie"></i> Budget Overview</h4>
                            <p class="card-subtitle">No budget data available. Add some items to get started.</p>
                        </div>
                    </div>
                `;
                return;
            }

            const totalIncome = clientData.budget.income.reduce((sum, item) => sum + item.amount, 0);
            const totalExpenses = clientData.budget.expenses.reduce((sum, item) => sum + item.amount, 0);
            const netAmount = totalIncome - totalExpenses;
            
            // Group expenses by category
            const expensesByCategory = {};
            clientData.budget.expenses.forEach(item => {
                expensesByCategory[item.category] = (expensesByCategory[item.category] || 0) + item.amount;
            });

            // Calculate expense percentages
            const expensePercentages = {};
            Object.keys(expensesByCategory).forEach(category => {
                expensePercentages[category] = ((expensesByCategory[category] / totalExpenses) * 100).toFixed(1);
            });

            budgetContainer.innerHTML = `
                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h4 class="card-title"><i class="fas fa-chart-pie"></i> Budget Overview</h4>
                        <p class="card-subtitle">Monthly Budget Analysis</p>
                    </div>
                    
                    <!-- Budget Summary -->
                    <div style="margin: 2rem 0;">
                        <div class="widgets-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                            <div class="widget">
                                <div class="widget-icon"></div>
                                <div class="widget-value">${formatCurrency(totalIncome)}</div>
                                <div class="widget-label">Total Income</div>
                            </div>
                            <div class="widget">
                                <div class="widget-icon"></div>
                                <div class="widget-value">${formatCurrency(totalExpenses)}</div>
                                <div class="widget-label">Total Expenses</div>
                            </div>
                            <div class="widget">
                                <div class="widget-icon">${netAmount >= 0 ? '' : ''}</div>
                                <div class="widget-value" style="color: ${netAmount >= 0 ? 'var(--success-green)' : 'var(--error-red)'};">${formatCurrency(Math.abs(netAmount))}</div>
                                <div class="widget-label">${netAmount >= 0 ? 'Surplus' : 'Deficit'}</div>
                            </div>
                            <div class="widget">
                                <div class="widget-icon"></div>
                                <div class="widget-value">${totalExpenses > 0 ? ((totalExpenses / totalIncome) * 100).toFixed(1) : 0}%</div>
                                <div class="widget-label">Expense Ratio</div>
                            </div>
                        </div>
                    </div>

                    <!-- Expense Breakdown -->
                    ${Object.keys(expensesByCategory).length > 0 ? `
                        <div style="margin: 2rem 0;">
                            <h5 style="color: var(--text-white); margin-bottom: 1rem;"> Expense Breakdown by Category</h5>
                            <div class="data-display">
                                ${Object.entries(expensesByCategory).map(([category, amount]) => `
                                    <div class="data-row">
                                        <span class="data-label">${category.charAt(0).toUpperCase() + category.slice(1)}:</span>
                                        <span class="data-value">${formatCurrency(amount)} (${expensePercentages[category]}%)</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}

                    <!-- Recent Transactions -->
                    <div style="margin: 2rem 0;">
                        <h5 style="color: var(--text-white); margin-bottom: 1rem;"> Recent Transactions</h5>
                        <div style="max-height: 300px; overflow-y: auto;">
                            ${[...clientData.budget.income, ...clientData.budget.expenses]
                                .sort((a, b) => new Date(b.date) - new Date(a.date))
                                .slice(0, 10)
                                .map(item => `
                                    <div style="background: var(--secondary-black); padding: 1rem; border-radius: var(--border-radius-sm); margin: 0.5rem 0; display: flex; justify-content: between; align-items: center;">
                                        <div>
                                            <h6 style="color: var(--text-white); margin: 0 0 0.25rem 0;">${item.description}</h6>
                                            <p style="color: var(--text-gray); margin: 0; font-size: 0.9rem;">${item.category}  ${item.date}</p>
                                        </div>
                                        <div style="text-align: right;">
                                            <p style="margin: 0; font-weight: 600; color: ${item.type === 'income' ? 'var(--success-green)' : 'var(--error-red)'};">
                                                ${item.type === 'income' ? '+' : '-'}${formatCurrency(item.amount)}
                                            </p>
                                        </div>
                                    </div>
                                `).join('')}
                        </div>
                    </div>

                    <!-- Budget Analysis -->
                    <div style="background: ${netAmount >= 0 ? 'var(--success-green)' : 'var(--warning-orange)'}; background: ${netAmount >= 0 ? 'rgba(0, 255, 136, 0.1)' : 'rgba(255, 159, 67, 0.1)'}; border: 1px solid ${netAmount >= 0 ? 'var(--success-green)' : 'var(--warning-orange)'}; border-radius: var(--border-radius-md); padding: 1.5rem; margin-top: 2rem;">
                        <h6 style="color: ${netAmount >= 0 ? 'var(--success-green)' : 'var(--warning-orange)'}; margin-bottom: 1rem;">
                            <i class="fas fa-chart-line"></i> Budget Analysis
                        </h6>
                        <div style="color: ${netAmount >= 0 ? 'var(--success-green)' : 'var(--warning-orange)'};">
                            ${netAmount >= 0 ? 
                                `<p> Great job! You have a surplus of ${formatCurrency(netAmount)}. Consider investing this amount for future growth.</p>` :
                                `<p> You have a deficit of ${formatCurrency(Math.abs(netAmount))}. Review your expenses and look for areas to reduce spending.</p>`
                            }
                            <p style="margin-top: 1rem; font-weight: 600;">
                                Budget Health Score: ${totalIncome > 0 ? (netAmount >= 0 ? '85/100 - Excellent' : totalExpenses / totalIncome <= 1.1 ? '70/100 - Good' : '45/100 - Needs Improvement') : '0/100 - No Data'}
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateBudgetReport() {
            if (!clientData.budget || (!clientData.budget.income.length && !clientData.budget.expenses.length)) {
                showAlert('No budget data available to generate report', 'warning');
                return;
            }

            const budgetAnalysis = analyzeBudgetData();
            displayBudgetReport(budgetAnalysis);
        }

        function analyzeBudgetData() {
            const income = clientData.budget.income;
            const expenses = clientData.budget.expenses;
            
            const totalIncome = income.reduce((sum, item) => sum + item.amount, 0);
            const totalExpenses = expenses.reduce((sum, item) => sum + item.amount, 0);
            
            // Analyze spending patterns
            const categoryAnalysis = {};
            const monthlyTrends = {};
            
            expenses.forEach(expense => {
                // Category analysis
                if (!categoryAnalysis[expense.category]) {
                    categoryAnalysis[expense.category] = { total: 0, count: 0, average: 0 };
                }
                categoryAnalysis[expense.category].total += expense.amount;
                categoryAnalysis[expense.category].count += 1;
                
                // Monthly trends
                const month = expense.date.substring(0, 7); // YYYY-MM
                if (!monthlyTrends[month]) {
                    monthlyTrends[month] = { income: 0, expenses: 0 };
                }
                monthlyTrends[month].expenses += expense.amount;
            });
            
            income.forEach(incomeItem => {
                const month = incomeItem.date.substring(0, 7);
                if (!monthlyTrends[month]) {
                    monthlyTrends[month] = { income: 0, expenses: 0 };
                }
                monthlyTrends[month].income += incomeItem.amount;
            });
            
            // Calculate averages
            Object.keys(categoryAnalysis).forEach(category => {
                categoryAnalysis[category].average = categoryAnalysis[category].total / categoryAnalysis[category].count;
            });
            
            // Generate recommendations
            const recommendations = generateBudgetRecommendations(totalIncome, totalExpenses, categoryAnalysis);
            
            return {
                totalIncome,
                totalExpenses,
                netAmount: totalIncome - totalExpenses,
                categoryAnalysis,
                monthlyTrends,
                recommendations
            };
        }

        function generateBudgetRecommendations(totalIncome, totalExpenses, categoryAnalysis) {
            const recommendations = [];
            const expenseRatio = totalExpenses / totalIncome;
            
            // General budget recommendations
            if (expenseRatio > 0.9) {
                recommendations.push({
                    type: 'warning',
                    title: 'High Expense Ratio',
                    description: 'Your expenses are consuming more than 90% of your income. Consider reducing discretionary spending.'
                });
            }
            
            if (expenseRatio < 0.7) {
                recommendations.push({
                    type: 'success',
                    title: 'Great Savings Rate',
                    description: 'You\'re saving more than 30% of your income. Consider investing the surplus for long-term growth.'
                });
            }
            
            // Category-specific recommendations
            Object.entries(categoryAnalysis).forEach(([category, data]) => {
                const categoryPercentage = (data.total / totalExpenses) * 100;
                
                if (category === 'entertainment' && categoryPercentage > 15) {
                    recommendations.push({
                        type: 'info',
                        title: 'Entertainment Spending',
                        description: `Entertainment expenses are ${categoryPercentage.toFixed(1)}% of total expenses. Consider reducing to 10-15%.`
                    });
                }
                
                if (category === 'food' && categoryPercentage > 25) {
                    recommendations.push({
                        type: 'info',
                        title: 'Food Expenses',
                        description: `Food expenses are ${categoryPercentage.toFixed(1)}% of total expenses. Look for opportunities to cook at home more.`
                    });
                }
            });
            
            return recommendations;
        }

        function displayBudgetReport(analysis) {
            const reportContainer = document.getElementById('budget-overview');
            
            reportContainer.innerHTML = `
                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h4 class="card-title"><i class="fas fa-chart-bar"></i> Comprehensive Budget Report</h4>
                        <p class="card-subtitle">Financial Performance Analysis</p>
                    </div>
                    
                    <!-- Summary Metrics -->
                    <div style="margin: 2rem 0;">
                        <h5 style="color: var(--text-white); margin-bottom: 1rem;"> Financial Summary</h5>
                        <div class="widgets-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                            <div class="widget">
                                <div class="widget-icon"></div>
                                <div class="widget-value">${formatCurrency(analysis.totalIncome)}</div>
                                <div class="widget-label">Total Income</div>
                            </div>
                            <div class="widget">
                                <div class="widget-icon"></div>
                                <div class="widget-value">${formatCurrency(analysis.totalExpenses)}</div>
                                <div class="widget-label">Total Expenses</div>
                            </div>
                            <div class="widget">
                                <div class="widget-icon">${analysis.netAmount >= 0 ? '' : ''}</div>
                                <div class="widget-value" style="color: ${analysis.netAmount >= 0 ? 'var(--success-green)' : 'var(--error-red)'};">${formatCurrency(Math.abs(analysis.netAmount))}</div>
                                <div class="widget-label">${analysis.netAmount >= 0 ? 'Net Surplus' : 'Net Deficit'}</div>
                            </div>
                            <div class="widget">
                                <div class="widget-icon"></div>
                                <div class="widget-value">${((analysis.totalExpenses / analysis.totalIncome) * 100).toFixed(1)}%</div>
                                <div class="widget-label">Expense Ratio</div>
                            </div>
                        </div>
                    </div>

                    <!-- Category Analysis -->
                    <div style="margin: 2rem 0;">
                        <h5 style="color: var(--text-white); margin-bottom: 1rem;"> Category-wise Analysis</h5>
                        <div class="data-display">
                            ${Object.entries(analysis.categoryAnalysis).map(([category, data]) => `
                                <div class="data-row">
                                    <span class="data-label">
                                        ${category.charAt(0).toUpperCase() + category.slice(1)}:
                                        <br><small style="color: var(--text-gray);">${data.count} transactions  Avg: ${formatCurrency(data.average)}</small>
                                    </span>
                                    <span class="data-value">
                                        ${formatCurrency(data.total)}
                                        <br><small style="color: var(--text-gray);">${((data.total / analysis.totalExpenses) * 100).toFixed(1)}% of expenses</small>
                                    </span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Monthly Trends -->
                    ${Object.keys(analysis.monthlyTrends).length > 1 ? `
                        <div style="margin: 2rem 0;">
                            <h5 style="color: var(--text-white); margin-bottom: 1rem;"> Monthly Trends</h5>
                            <div class="data-display">
                                ${Object.entries(analysis.monthlyTrends).map(([month, data]) => `
                                    <div class="data-row">
                                        <span class="data-label">${month}:</span>
                                        <span class="data-value">
                                            Income: ${formatCurrency(data.income)} | Expenses: ${formatCurrency(data.expenses)}
                                            <br><small style="color: ${data.income - data.expenses >= 0 ? 'var(--success-green)' : 'var(--error-red)'};">
                                                Net: ${data.income - data.expenses >= 0 ? '+' : ''}${formatCurrency(data.income - data.expenses)}
                                            </small>
                                        </span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    ` : ''}

                    <!-- Recommendations -->
                    <div style="margin: 2rem 0;">
                        <h5 style="color: var(--text-white); margin-bottom: 1rem;"> Budget Recommendations</h5>
                        ${analysis.recommendations.map(rec => `
                            <div style="background: ${rec.type === 'warning' ? 'rgba(255, 159, 67, 0.1)' : rec.type === 'success' ? 'rgba(0, 255, 136, 0.1)' : 'rgba(0, 212, 255, 0.1)'}; 
                                        border: 1px solid ${rec.type === 'warning' ? 'var(--warning-orange)' : rec.type === 'success' ? 'var(--success-green)' : 'var(--info-blue)'}; 
                                        border-radius: var(--border-radius-md); padding: 1rem; margin: 1rem 0;">
                                <h6 style="color: ${rec.type === 'warning' ? 'var(--warning-orange)' : rec.type === 'success' ? 'var(--success-green)' : 'var(--info-blue)'}; margin-bottom: 0.5rem;">
                                    ${rec.title}
                                </h6>
                                <p style="color: ${rec.type === 'warning' ? 'var(--warning-orange)' : rec.type === 'success' ? 'var(--success-green)' : 'var(--info-blue)'}; margin: 0;">
                                    ${rec.description}
                                </p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // 6. Investment Tracker Functions
        function addInvestment() {
            const investmentName = document.getElementById('investment-name').value;
            const investmentType = document.getElementById('investment-type').value;
            const investmentAmount = parseFloat(document.getElementById('investment-amount').value);
            const purchaseDate = document.getElementById('purchase-date').value;
            const currentValue = parseFloat(document.getElementById('current-value').value);

            if (!investmentName || !investmentType || !investmentAmount || !purchaseDate) {
                showAlert('Please fill in all required investment fields', 'warning');
                return;
            }

            if (!clientData.investments) {
                clientData.investments = [];
            }

            const investment = {
                id: Date.now(),
                name: investmentName,
                type: investmentType,
                amount: investmentAmount,
                purchaseDate,
                currentValue: currentValue || investmentAmount,
                addedDate: new Date().toISOString().split('T')[0]
            };

            clientData.investments.push(investment);
            saveClientData();
            
            // Clear form
            document.getElementById('investment-name').value = '';
            document.getElementById('investment-amount').value = '';
            document.getElementById('current-value').value = '';
            document.getElementById('purchase-date').value = '';

            displayInvestmentPortfolio();
            showAlert('Investment added successfully!', 'success');
        }

        function displayInvestmentPortfolio() {
            const portfolioContainer = document.getElementById('investment-portfolio');
            
            if (!clientData.investments || clientData.investments.length === 0) {
                portfolioContainer.innerHTML = `
                    <div class="card" style="margin-top: 2rem;">
                        <div class="card-header">
                            <h4 class="card-title"><i class="fas fa-chart-line"></i> Investment Portfolio</h4>
                            <p class="card-subtitle">No investments added yet. Add some to track your portfolio.</p>
                        </div>
                    </div>
                `;
                return;
            }

            const totalInvestment = clientData.investments.reduce((sum, inv) => sum + inv.amount, 0);
            const totalCurrentValue = clientData.investments.reduce((sum, inv) => sum + inv.currentValue, 0);
            const totalGains = totalCurrentValue - totalInvestment;
            const totalReturn = ((totalGains / totalInvestment) * 100).toFixed(2);

            // Group by investment type
            const investmentsByType = {};
            clientData.investments.forEach(inv => {
                if (!investmentsByType[inv.type]) {
                    investmentsByType[inv.type] = { count: 0, invested: 0, current: 0 };
                }
                investmentsByType[inv.type].count++;
                investmentsByType[inv.type].invested += inv.amount;
                investmentsByType[inv.type].current += inv.currentValue;
            });

            portfolioContainer.innerHTML = `
                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h4 class="card-title"><i class="fas fa-chart-line"></i> Investment Portfolio Tracker</h4>
                        <p class="card-subtitle">Track and analyze your investment performance</p>
                    </div>
                    
                    <!-- Portfolio Summary -->
                    <div style="margin: 2rem 0;">
                        <h5 style="color: var(--text-white); margin-bottom: 1rem;"> Portfolio Summary</h5>
                        <div class="widgets-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                            <div class="widget">
                                <div class="widget-icon"></div>
                                <div class="widget-value">${formatCurrency(totalInvestment)}</div>
                                <div class="widget-label">Total Invested</div>
                            </div>
                            <div class="widget">
                                <div class="widget-icon"></div>
                                <div class="widget-value">${formatCurrency(totalCurrentValue)}</div>
                                <div class="widget-label">Current Value</div>
                            </div>
                            <div class="widget">
                                <div class="widget-icon">${totalGains >= 0 ? '' : ''}</div>
                                <div class="widget-value" style="color: ${totalGains >= 0 ? 'var(--success-green)' : 'var(--error-red)'};">
                                    ${totalGains >= 0 ? '+' : ''}${formatCurrency(totalGains)}
                                </div>
                                <div class="widget-label">Total Gains/Loss</div>
                            </div>
                            <div class="widget">
                                <div class="widget-icon"></div>
                                <div class="widget-value" style="color: ${totalGains >= 0 ? 'var(--success-green)' : 'var(--error-red)'};">
                                    ${totalReturn > 0 ? '+' : ''}${totalReturn}%
                                </div>
                                <div class="widget-label">Total Return</div>
                            </div>
                        </div>
                    </div>

                    <!-- Investment Type Breakdown -->
                    <div style="margin: 2rem 0;">
                        <h5 style="color: var(--text-white); margin-bottom: 1rem;"> Portfolio by Asset Type</h5>
                        <div class="data-display">
                            ${Object.entries(investmentsByType).map(([type, data]) => {
                                const gains = data.current - data.invested;
                                const returns = ((gains / data.invested) * 100).toFixed(1);
                                return `
                                    <div class="data-row">
                                        <span class="data-label">
                                            ${type.charAt(0).toUpperCase() + type.slice(1)}:
                                            <br><small style="color: var(--text-gray);">${data.count} investments</small>
                                        </span>
                                        <span class="data-value">
                                            ${formatCurrency(data.current)}
                                            <br><small style="color: ${gains >= 0 ? 'var(--success-green)' : 'var(--error-red)'};">
                                                ${gains >= 0 ? '+' : ''}${formatCurrency(gains)} (${returns}%)
                                            </small>
                                        </span>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>

                    <!-- Individual Investments -->
                    <div style="margin: 2rem 0;">
                        <h5 style="color: var(--text-white); margin-bottom: 1rem;"> Individual Investments</h5>
                        <div style="max-height: 400px; overflow-y: auto;">
                            ${clientData.investments.sort((a, b) => new Date(b.addedDate) - new Date(a.addedDate)).map(inv => {
                                const gains = inv.currentValue - inv.amount;
                                const returns = ((gains / inv.amount) * 100).toFixed(1);
                                const daysSincePurchase = Math.floor((new Date() - new Date(inv.purchaseDate)) / (1000 * 60 * 60 * 24));
                                return `
                                    <div style="background: var(--secondary-black); padding: 1.5rem; border-radius: var(--border-radius-md); margin: 1rem 0; border-left: 4px solid ${gains >= 0 ? 'var(--success-green)' : 'var(--error-red)'};">
                                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                                            <div>
                                                <h6 style="color: var(--text-white); margin: 0 0 0.25rem 0;">${inv.name}</h6>
                                                <p style="color: var(--text-gray); margin: 0; font-size: 0.9rem;">${inv.type}  Purchased: ${inv.purchaseDate}</p>
                                            </div>
                                            <div style="text-align: right;">
                                                <p style="margin: 0; font-weight: 600; color: ${gains >= 0 ? 'var(--success-green)' : 'var(--error-red)'};">
                                                    ${gains >= 0 ? '+' : ''}${formatCurrency(gains)}
                                                </p>
                                                <p style="margin: 0; font-size: 0.9rem; color: ${gains >= 0 ? 'var(--success-green)' : 'var(--error-red)'};">
                                                    ${returns}% return
                                                </p>
                                            </div>
                                        </div>
                                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; font-size: 0.9rem;">
                                            <div>
                                                <span style="color: var(--text-gray);">Invested:</span>
                                                <span style="color: var(--text-white); font-weight: 600;">${formatCurrency(inv.amount)}</span>
                                            </div>
                                            <div>
                                                <span style="color: var(--text-gray);">Current:</span>
                                                <span style="color: var(--text-white); font-weight: 600;">${formatCurrency(inv.currentValue)}</span>
                                            </div>
                                            <div>
                                                <span style="color: var(--text-gray);">Duration:</span>
                                                <span style="color: var(--text-white); font-weight: 600;">${daysSincePurchase} days</span>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>

                    <!-- Performance Analysis -->
                    <div style="background: ${totalGains >= 0 ? 'var(--success-green)' : 'var(--warning-orange)'}; background: ${totalGains >= 0 ? 'rgba(0, 255, 136, 0.1)' : 'rgba(255, 159, 67, 0.1)'}; border: 1px solid ${totalGains >= 0 ? 'var(--success-green)' : 'var(--warning-orange)'}; border-radius: var(--border-radius-md); padding: 1.5rem; margin-top: 2rem;">
                        <h6 style="color: ${totalGains >= 0 ? 'var(--success-green)' : 'var(--warning-orange)'}; margin-bottom: 1rem;">
                            <i class="fas fa-chart-line"></i> Portfolio Performance Analysis
                        </h6>
                        <div style="color: ${totalGains >= 0 ? 'var(--success-green)' : 'var(--warning-orange)'};">
                            <p>
                                ${totalGains >= 0 ? 
                                    ` Excellent! Your portfolio has gained ${formatCurrency(totalGains)} (${totalReturn}% return). Your investment strategy is working well.` :
                                    ` Your portfolio is currently down by ${formatCurrency(Math.abs(totalGains))} (${totalReturn}% loss). Consider reviewing your investment strategy or holding for long-term recovery.`
                                }
                            </p>
                            <ul style="margin-top: 1rem; padding-left: 1.5rem;">
                                <li>Diversification Score: ${Object.keys(investmentsByType).length >= 3 ? 'Good' : 'Needs Improvement'}</li>
                                <li>Best Performing: ${getBestPerformingInvestment()}</li>
                                <li>Portfolio Risk Level: ${calculatePortfolioRiskLevel()}</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }

        function getBestPerformingInvestment() {
            if (!clientData.investments || clientData.investments.length === 0) return 'N/A';
            
            let bestInvestment = clientData.investments[0];
            let bestReturn = (bestInvestment.currentValue - bestInvestment.amount) / bestInvestment.amount;
            
            clientData.investments.forEach(inv => {
                const returns = (inv.currentValue - inv.amount) / inv.amount;
                if (returns > bestReturn) {
                    bestReturn = returns;
                    bestInvestment = inv;
                }
            });
            
            return `${bestInvestment.name} (${(bestReturn * 100).toFixed(1)}%)`;
        }

        function calculatePortfolioRiskLevel() {
            if (!clientData.investments || clientData.investments.length === 0) return 'N/A';
            
            const riskScores = {
                'stocks': 8,
                'mutualfunds': 6,
                'bonds': 3,
                'gold': 4,
                'crypto': 10,
                'realestate': 5,
                'other': 5
            };
            
            let totalRisk = 0;
            let totalValue = 0;
            
            clientData.investments.forEach(inv => {
                const risk = riskScores[inv.type] || 5;
                totalRisk += risk * inv.currentValue;
                totalValue += inv.currentValue;
            });
            
            const avgRisk = totalRisk / totalValue;
            
            if (avgRisk <= 4) return 'Low Risk';
            if (avgRisk <= 6) return 'Moderate Risk';
            return 'High Risk';
        }

        // 7. Product Comparison Functions
        function generateSmartComparison() {
            const productType = document.getElementById('comparison-product-type').value;
            const comparisonCriteria = document.getElementById('comparison-criteria').value;
            const budgetRange = document.getElementById('budget-range').value;

            if (!productType || !comparisonCriteria) {
                showAlert('Please select product type and comparison criteria', 'warning');
                return;
            }

            const comparisonData = generateProductComparison(productType, comparisonCriteria, budgetRange);
            displayProductComparison(comparisonData);
        }

        function generateProductComparison(productType, criteria, budget) {
            const products = getProductData(productType, budget);
            const analysisResult = performComparativeAnalysis(products, criteria);
            
            return {
                productType,
                criteria,
                budget,
                products: analysisResult,
                recommendation: generateRecommendation(analysisResult, criteria)
            };
        }

        function getProductData(productType, budget) {
            const productDatabase = {
                'mutualfunds': [
                    {
                        name: 'Axis Bluechip Fund',
                        category: 'Large Cap',
                        returns1yr: 12.5,
                        returns3yr: 15.2,
                        returns5yr: 13.8,
                        expenseRatio: 1.05,
                        minInvestment: 5000,
                        riskLevel: 'Moderate',
                        rating: 4.5,
                        aum: 45000
                    },
                    {
                        name: 'HDFC Mid-Cap Opportunities Fund',
                        category: 'Mid Cap',
                        returns1yr: 18.3,
                        returns3yr: 22.1,
                        returns5yr: 16.7,
                        expenseRatio: 1.25,
                        minInvestment: 5000,
                        riskLevel: 'High',
                        rating: 4.2,
                        aum: 32000
                    },
                    {
                        name: 'HDFC Corporate Bond Fund',
                        category: 'Debt',
                        returns1yr: 7.2,
                        returns3yr: 8.1,
                        returns5yr: 7.8,
                        expenseRatio: 0.45,
                        minInvestment: 5000,
                        riskLevel: 'Low',
                        rating: 4.0,
                        aum: 28000
                    }
                ],
                'insurance': [
                    {
                        name: 'HDFC Life Term Insurance',
                        category: 'Term Life',
                        coverage: 1000000,
                        premium: 12000,
                        tenure: 30,
                        claimRatio: 98.2,
                        riskLevel: 'Low',
                        rating: 4.3,
                        features: ['Online policy', 'Quick claim settlement', '24/7 support']
                    },
                    {
                        name: 'ICICI Prudential Health Insurance',
                        category: 'Health',
                        coverage: 500000,
                        premium: 15000,
                        tenure: 1,
                        claimRatio: 95.8,
                        riskLevel: 'Low',
                        rating: 4.1,
                        features: ['Cashless treatment', 'No room rent limit', 'Pre-post hospitalization']
                    }
                ],
                'loans': [
                    {
                        name: 'HDFC Home Loan',
                        category: 'Home Loan',
                        interestRate: 8.5,
                        processingFee: 0.25,
                        maxTenure: 30,
                        maxLoanAmount: 10000000,
                        prepaymentPenalty: 'Nil after 6 months',
                        rating: 4.4,
                        features: ['Quick approval', 'Flexible EMI', 'Online tracking']
                    },
                    {
                        name: 'SBI Personal Loan',
                        category: 'Personal Loan',
                        interestRate: 11.5,
                        processingFee: 1.0,
                        maxTenure: 6,
                        maxLoanAmount: 2000000,
                        prepaymentPenalty: '2% of outstanding',
                        rating: 4.0,
                        features: ['Minimal documentation', 'Quick disbursal', 'Competitive rates']
                    }
                ]
            };

            return productDatabase[productType] || [];
        }

        function performComparativeAnalysis(products, criteria) {
            return products.map(product => {
                let score = 0;
                const factors = criteria.split(',');
                
                factors.forEach(factor => {
                    switch(factor.trim()) {
                        case 'returns':
                            if (product.returns3yr) score += product.returns3yr * 2;
                            break;
                        case 'cost':
                            if (product.expenseRatio) score += (2 - product.expenseRatio) * 10;
                            if (product.processingFee) score += (2 - product.processingFee) * 5;
                            break;
                        case 'risk':
                            const riskScores = { 'Low': 20, 'Moderate': 15, 'High': 10 };
                            score += riskScores[product.riskLevel] || 10;
                            break;
                        case 'rating':
                            if (product.rating) score += product.rating * 5;
                            break;
                        default:
                            score += 10; // Base score
                    }
                });
                
                return {
                    ...product,
                    analysisScore: score.toFixed(1),
                    recommendation: score > 50 ? 'Highly Recommended' : score > 30 ? 'Recommended' : 'Consider Alternatives'
                };
            }).sort((a, b) => b.analysisScore - a.analysisScore);
        }

        function generateRecommendation(products, criteria) {
            if (products.length === 0) return 'No products available for comparison';
            
            const topProduct = products[0];
            const recommendations = [];
            
            recommendations.push(` Top Pick: ${topProduct.name} with analysis score of ${topProduct.analysisScore}`);
            
            if (criteria.includes('returns')) {
                const highestReturn = products.reduce((max, p) => p.returns3yr > max ? p.returns3yr : max, 0);
                const bestReturns = products.find(p => p.returns3yr === highestReturn);
                if (bestReturns && bestReturns.name !== topProduct.name) {
                    recommendations.push(` Best Returns: ${bestReturns.name} with ${bestReturns.returns3yr}% 3-year returns`);
                }
            }
            
            if (criteria.includes('cost')) {
                const lowestCost = products.reduce((min, p) => {
                    const cost = p.expenseRatio || p.processingFee || Infinity;
                    return cost < min ? cost : min;
                }, Infinity);
                const cheapest = products.find(p => (p.expenseRatio || p.processingFee) === lowestCost);
                if (cheapest && cheapest.name !== topProduct.name) {
                    recommendations.push(` Most Cost-Effective: ${cheapest.name}`);
                }
            }
            
            return recommendations;
        }

        function displayProductComparison(comparison) {
            const resultsContainer = document.getElementById('product-comparison-results');
            
            resultsContainer.innerHTML = `
                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h4 class="card-title"><i class="fas fa-balance-scale"></i> Smart Product Comparison</h4>
                        <p class="card-subtitle">${comparison.productType} comparison based on ${comparison.criteria}</p>
                    </div>
                    
                    <!-- Recommendations -->
                    <div style="background: var(--info-blue); background: rgba(0, 212, 255, 0.1); border: 1px solid var(--info-blue); border-radius: var(--border-radius-md); padding: 1.5rem; margin: 2rem 0;">
                        <h6 style="color: var(--info-blue); margin-bottom: 1rem;"><i class="fas fa-trophy"></i> Smart Recommendations</h6>
                        <ul style="color: var(--info-blue); margin: 0; padding-left: 1.5rem;">
                            ${comparison.recommendation.map(rec => `<li>${rec}</li>`).join('')}
                        </ul>
                    </div>

                    <!-- Product Comparison Table -->
                    <div style="margin: 2rem 0;">
                        <h5 style="color: var(--text-white); margin-bottom: 1rem;"> Detailed Comparison</h5>
                        <div style="overflow-x: auto;">
                            <table style="width: 100%; border-collapse: collapse; color: var(--text-white); min-width: 800px;">
                                <thead style="background: var(--secondary-black);">
                                    <tr>
                                        <th style="padding: 1rem; text-align: left; border-bottom: 1px solid var(--accent-white);">Product</th>
                                        <th style="padding: 1rem; text-align: center; border-bottom: 1px solid var(--accent-white);">Score</th>
                                        <th style="padding: 1rem; text-align: center; border-bottom: 1px solid var(--accent-white);">Category</th>
                                        <th style="padding: 1rem; text-align: center; border-bottom: 1px solid var(--accent-white);">Key Metrics</th>
                                        <th style="padding: 1rem; text-align: center; border-bottom: 1px solid var(--accent-white);">Rating</th>
                                        <th style="padding: 1rem; text-align: center; border-bottom: 1px solid var(--accent-white);">Recommendation</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${comparison.products.map((product, index) => `
                                        <tr style="border-bottom: 1px solid rgba(255, 255, 255, 0.1); ${index === 0 ? 'background: rgba(0, 255, 136, 0.05);' : ''}">
                                            <td style="padding: 1rem;">
                                                <div>
                                                    <h6 style="margin: 0 0 0.25rem 0; color: var(--text-white);">${product.name}</h6>
                                                    <p style="margin: 0; font-size: 0.9rem; color: var(--text-gray);">${product.riskLevel} Risk</p>
                                                </div>
                                            </td>
                                            <td style="padding: 1rem; text-align: center;">
                                                <span style="background: ${index === 0 ? 'var(--success-green)' : index === 1 ? 'var(--info-blue)' : 'var(--warning-orange)'}; color: var(--primary-black); padding: 0.25rem 0.5rem; border-radius: 15px; font-weight: 600;">
                                                    ${product.analysisScore}
                                                </span>
                                            </td>
                                            <td style="padding: 1rem; text-align: center;">${product.category}</td>
                                            <td style="padding: 1rem; text-align: center; font-size: 0.9rem;">
                                                ${comparison.productType === 'mutualfunds' ? `
                                                    3Y Return: ${product.returns3yr}%<br>
                                                    Expense: ${product.expenseRatio}%
                                                ` : comparison.productType === 'insurance' ? `
                                                    Coverage: ${formatCurrency(product.coverage)}<br>
                                                    Premium: ${formatCurrency(product.premium)}
                                                ` : `
                                                    Interest: ${product.interestRate}%<br>
                                                    Processing: ${product.processingFee}%
                                                `}
                                            </td>
                                            <td style="padding: 1rem; text-align: center;">
                                                <span style="color: var(--success-green);">${product.rating}</span>
                                            </td>
                                            <td style="padding: 1rem; text-align: center;">
                                                <span style="color: ${product.recommendation === 'Highly Recommended' ? 'var(--success-green)' : product.recommendation === 'Recommended' ? 'var(--info-blue)' : 'var(--warning-orange)'}; font-weight: 600;">
                                                    ${product.recommendation}
                                                </span>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Detailed Analysis -->
                    ${comparison.products.length > 0 ? `
                        <div style="margin: 2rem 0;">
                            <h5 style="color: var(--text-white); margin-bottom: 1rem;"> Winner Analysis: ${comparison.products[0].name}</h5>
                            <div style="background: var(--gradient-card); padding: 1.5rem; border-radius: var(--border-radius-md);">
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                                    ${comparison.productType === 'mutualfunds' ? `
                                        <div>
                                            <span style="color: var(--text-gray);">1-Year Return:</span>
                                            <span style="color: var(--success-green); font-weight: 600;">${comparison.products[0].returns1yr}%</span>
                                        </div>
                                        <div>
                                            <span style="color: var(--text-gray);">3-Year Return:</span>
                                            <span style="color: var(--success-green); font-weight: 600;">${comparison.products[0].returns3yr}%</span>
                                        </div>
                                        <div>
                                            <span style="color: var(--text-gray);">Expense Ratio:</span>
                                            <span style="color: var(--text-white); font-weight: 600;">${comparison.products[0].expenseRatio}%</span>
                                        </div>
                                        <div>
                                            <span style="color: var(--text-gray);">AUM:</span>
                                            <span style="color: var(--text-white); font-weight: 600;">${comparison.products[0].aum} Cr</span>
                                        </div>
                                    ` : comparison.productType === 'insurance' ? `
                                        <div>
                                            <span style="color: var(--text-gray);">Coverage:</span>
                                            <span style="color: var(--success-green); font-weight: 600;">${formatCurrency(comparison.products[0].coverage)}</span>
                                        </div>
                                        <div>
                                            <span style="color: var(--text-gray);">Claim Ratio:</span>
                                            <span style="color: var(--success-green); font-weight: 600;">${comparison.products[0].claimRatio}%</span>
                                        </div>
                                        <div>
                                            <span style="color: var(--text-gray);">Annual Premium:</span>
                                            <span style="color: var(--text-white); font-weight: 600;">${formatCurrency(comparison.products[0].premium)}</span>
                                        </div>
                                    ` : `
                                        <div>
                                            <span style="color: var(--text-gray);">Interest Rate:</span>
                                            <span style="color: var(--info-blue); font-weight: 600;">${comparison.products[0].interestRate}%</span>
                                        </div>
                                        <div>
                                            <span style="color: var(--text-gray);">Max Tenure:</span>
                                            <span style="color: var(--text-white); font-weight: 600;">${comparison.products[0].maxTenure} years</span>
                                        </div>
                                        <div>
                                            <span style="color: var(--text-gray);">Processing Fee:</span>
                                            <span style="color: var(--text-white); font-weight: 600;">${comparison.products[0].processingFee}%</span>
                                        </div>
                                    `}
                                </div>
                                
                                ${comparison.products[0].features ? `
                                    <div style="margin-top: 1rem;">
                                        <h6 style="color: var(--text-white); margin-bottom: 0.5rem;">Key Features:</h6>
                                        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                            ${comparison.products[0].features.map(feature => `
                                                <span style="background: var(--accent-white); color: var(--primary-black); padding: 0.25rem 0.75rem; border-radius: 15px; font-size: 0.9rem;">
                                                    ${feature}
                                                </span>
                                            `).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        // 8. Financial Calendar and Alerts Functions
        function loadFinancialCalendar() {
            const calendarContainer = document.getElementById('financial-calendar');
            const upcomingEvents = generateFinancialEvents();
            
            calendarContainer.innerHTML = `
                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h4 class="card-title"><i class="fas fa-calendar-alt"></i> Financial Calendar</h4>
                        <p class="card-subtitle">Important financial dates and reminders</p>
                    </div>
                    
                    <!-- Upcoming Events -->
                    <div style="margin: 2rem 0;">
                        <h5 style="color: var(--text-white); margin-bottom: 1rem;"> Upcoming Financial Events</h5>
                        <div style="max-height: 400px; overflow-y: auto;">
                            ${upcomingEvents.map(event => `
                                <div style="background: var(--secondary-black); padding: 1rem; border-radius: var(--border-radius-md); margin: 1rem 0; border-left: 4px solid ${event.priority === 'high' ? 'var(--error-red)' : event.priority === 'medium' ? 'var(--warning-orange)' : 'var(--info-blue)'};">
                                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                        <div>
                                            <h6 style="color: var(--text-white); margin: 0 0 0.25rem 0;">${event.title}</h6>
                                            <p style="color: var(--text-gray); margin: 0 0 0.5rem 0; font-size: 0.9rem;">${event.description}</p>
                                            <span style="background: ${event.priority === 'high' ? 'var(--error-red)' : event.priority === 'medium' ? 'var(--warning-orange)' : 'var(--info-blue)'}; color: var(--primary-black); padding: 0.2rem 0.5rem; border-radius: 10px; font-size: 0.8rem; font-weight: 600;">
                                                ${event.priority.toUpperCase()} PRIORITY
                                            </span>
                                        </div>
                                        <div style="text-align: right;">
                                            <p style="margin: 0; font-weight: 600; color: var(--accent-white);">${event.date}</p>
                                            <p style="margin: 0; font-size: 0.9rem; color: var(--text-gray);">${event.daysLeft} days left</p>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Quick Actions -->
                    <div style="margin: 2rem 0;">
                        <h5 style="color: var(--text-white); margin-bottom: 1rem;"> Quick Financial Actions</h5>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                            <button onclick="scheduleFinancialReview()" style="background: var(--gradient-accent); color: var(--primary-black); padding: 1rem; border: none; border-radius: var(--border-radius-md); font-weight: 600; cursor: pointer;">
                                 Schedule Portfolio Review
                            </button>
                            <button onclick="setTaxReminder()" style="background: var(--gradient-card); color: var(--text-white); padding: 1rem; border: 1px solid var(--accent-white); border-radius: var(--border-radius-md); font-weight: 600; cursor: pointer;">
                                 Set Tax Filing Reminder
                            </button>
                            <button onclick="addCustomEvent()" style="background: var(--info-blue); color: var(--primary-black); padding: 1rem; border: none; border-radius: var(--border-radius-md); font-weight: 600; cursor: pointer;">
                                 Add Custom Event
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateFinancialEvents() {
            const events = [];
            const today = new Date();
            
            // Tax filing deadline
            const taxDeadline = new Date(today.getFullYear(), 6, 31); // July 31
            if (taxDeadline < today) {
                taxDeadline.setFullYear(today.getFullYear() + 1);
            }
            const taxDaysLeft = Math.ceil((taxDeadline - today) / (1000 * 60 * 60 * 24));
            
            events.push({
                title: 'Income Tax Filing Deadline',
                description: 'File your annual income tax return',
                date: taxDeadline.toLocaleDateString(),
                daysLeft: taxDaysLeft,
                priority: taxDaysLeft <= 30 ? 'high' : taxDaysLeft <= 90 ? 'medium' : 'low'
            });

            // Investment review
            const reviewDate = new Date(today);
            reviewDate.setDate(today.getDate() + 90);
            
            events.push({
                title: 'Quarterly Portfolio Review',
                description: 'Review and rebalance your investment portfolio',
                date: reviewDate.toLocaleDateString(),
                daysLeft: 90,
                priority: 'medium'
            });

            // Insurance premium
            const insuranceDate = new Date(today);
            insuranceDate.setMonth(today.getMonth() + 1);
            
            events.push({
                title: 'Insurance Premium Due',
                description: 'Renew your health and life insurance policies',
                date: insuranceDate.toLocaleDateString(),
                daysLeft: 30,
                priority: 'high'
            });

            // Financial goal review
            const goalReview = new Date(today.getFullYear(), 11, 31); // Dec 31
            const goalDaysLeft = Math.ceil((goalReview - today) / (1000 * 60 * 60 * 24));
            
            events.push({
                title: 'Annual Financial Goals Review',
                description: 'Assess progress on financial goals and set new targets',
                date: goalReview.toLocaleDateString(),
                daysLeft: goalDaysLeft,
                priority: goalDaysLeft <= 60 ? 'medium' : 'low'
            });

            return events.sort((a, b) => a.daysLeft - b.daysLeft);
        }

        function scheduleFinancialReview() {
            showAlert('Portfolio review scheduled for next quarter!', 'success');
        }

        function setTaxReminder() {
            showAlert('Tax filing reminder set for 30 days before deadline!', 'success');
        }

        function addCustomEvent() {
            const eventName = prompt('Enter event name:');
            if (eventName) {
                showAlert(`Custom event "${eventName}" added to your financial calendar!`, 'success');
                // In a real app, this would be saved to the client data
            }
        }

        function refreshAlerts() {
            const alertsContainer = document.getElementById('smart-alerts');
            const alerts = generateSmartAlerts();
            
            alertsContainer.innerHTML = `
                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h4 class="card-title"><i class="fas fa-bell"></i> Smart Financial Alerts</h4>
                        <p class="card-subtitle">Personalized notifications and recommendations</p>
                    </div>
                    
                    <div style="margin: 2rem 0;">
                        ${alerts.map(alert => `
                            <div style="background: ${alert.type === 'critical' ? 'rgba(255, 99, 132, 0.1)' : alert.type === 'warning' ? 'rgba(255, 159, 67, 0.1)' : alert.type === 'info' ? 'rgba(0, 212, 255, 0.1)' : 'rgba(0, 255, 136, 0.1)'}; 
                                        border: 1px solid ${alert.type === 'critical' ? 'var(--error-red)' : alert.type === 'warning' ? 'var(--warning-orange)' : alert.type === 'info' ? 'var(--info-blue)' : 'var(--success-green)'}; 
                                        border-radius: var(--border-radius-md); padding: 1rem; margin: 1rem 0;">
                                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                    <div>
                                        <h6 style="color: ${alert.type === 'critical' ? 'var(--error-red)' : alert.type === 'warning' ? 'var(--warning-orange)' : alert.type === 'info' ? 'var(--info-blue)' : 'var(--success-green)'}; margin: 0 0 0.5rem 0;">
                                            ${alert.icon} ${alert.title}
                                        </h6>
                                        <p style="color: ${alert.type === 'critical' ? 'var(--error-red)' : alert.type === 'warning' ? 'var(--warning-orange)' : alert.type === 'info' ? 'var(--info-blue)' : 'var(--success-green)'}; margin: 0;">
                                            ${alert.message}
                                        </p>
                                    </div>
                                    <button onclick="dismissAlert('${alert.id}')" style="background: none; border: 1px solid currentColor; color: ${alert.type === 'critical' ? 'var(--error-red)' : alert.type === 'warning' ? 'var(--warning-orange)' : alert.type === 'info' ? 'var(--info-blue)' : 'var(--success-green)'}; padding: 0.25rem 0.5rem; border-radius: var(--border-radius-sm); cursor: pointer; font-size: 0.8rem;">
                                        Dismiss
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function generateSmartAlerts() {
            const alerts = [];
            
            // Check if user has assets for portfolio rebalancing
            if (clientData.assets && clientData.assets.length > 0) {
                const totalValue = clientData.assets.reduce((sum, asset) => sum + asset.value, 0);
                const stocksValue = clientData.assets.filter(asset => asset.type === 'stocks').reduce((sum, asset) => sum + asset.value, 0);
                const stocksPercentage = (stocksValue / totalValue) * 100;
                
                if (stocksPercentage > 70) {
                    alerts.push({
                        id: 'portfolio_concentration',
                        type: 'warning',
                        icon: '',
                        title: 'Portfolio Concentration Risk',
                        message: `Your portfolio is ${stocksPercentage.toFixed(1)}% concentrated in stocks. Consider diversifying to reduce risk.`
                    });
                }
            }

            // Check for emergency fund
            if (clientData.financialStatus && clientData.financialStatus.monthlyExpenses) {
                const cashAssets = clientData.assets ? clientData.assets.filter(asset => asset.type === 'cash').reduce((sum, asset) => sum + asset.value, 0) : 0;
                const emergencyFundMonths = cashAssets / clientData.financialStatus.monthlyExpenses;
                
                if (emergencyFundMonths < 3) {
                    alerts.push({
                        id: 'emergency_fund',
                        type: 'critical',
                        icon: '',
                        title: 'Low Emergency Fund',
                        message: `You have only ${emergencyFundMonths.toFixed(1)} months of expenses in emergency fund. Aim for 6 months.`
                    });
                }
            }

            // Check for insurance coverage
            if (clientData.insuranceNeeds && clientData.insuranceNeeds.lifeInsuranceNeeded > 0) {
                alerts.push({
                    id: 'insurance_gap',
                    type: 'warning',
                    icon: '',
                    title: 'Insurance Coverage Gap',
                    message: `You need ${formatCurrency(clientData.insuranceNeeds.lifeInsuranceNeeded)} life insurance coverage. Consider getting adequate protection.`
                });
            }

            // Investment opportunity alert
            if (clientData.financialStatus && clientData.financialStatus.monthlySavings > 10000) {
                alerts.push({
                    id: 'investment_opportunity',
                    type: 'success',
                    icon: '',
                    title: 'Investment Opportunity',
                    message: `You're saving ${formatCurrency(clientData.financialStatus.monthlySavings)} monthly. Consider systematic investment plans for wealth building.`
                });
            }

            // Tax saving reminder
            const currentMonth = new Date().getMonth();
            if (currentMonth >= 10) { // Nov, Dec, Jan, Feb, Mar
                alerts.push({
                    id: 'tax_saving',
                    type: 'info',
                    icon: '',
                    title: 'Tax Saving Reminder',
                    message: 'Financial year ending soon! Review tax-saving investments under Section 80C before March 31st.'
                });
            }

            return alerts;
        }

        function dismissAlert(alertId) {
            showAlert('Alert dismissed', 'info');
            refreshAlerts(); // Refresh to remove dismissed alert
        }

        function configureAlerts() {
            const preferences = {
                portfolioAlerts: document.getElementById('portfolio-alerts')?.checked || false,
                taxReminders: document.getElementById('tax-reminders')?.checked || false,
                investmentOpportunities: document.getElementById('investment-opportunities')?.checked || false,
                insuranceReminders: document.getElementById('insurance-reminders')?.checked || false
            };
            
            // Save preferences (in real app, this would be saved to backend)
            localStorage.setItem('alertPreferences', JSON.stringify(preferences));
            showAlert('Alert preferences saved successfully!', 'success');
        }

        // Add CSS for typing indicator animation
        const typingCSS = `
            .typing-dots {
                display: inline-flex;
                gap: 4px;
                align-items: center;
            }
            .typing-dots span {
                width: 8px;
                height: 8px;
                border-radius: 50%;
                background: #aaa;
                animation: typing 1.4s infinite ease-in-out;
            }
            .typing-dots span:nth-child(2) {
                animation-delay: 0.2s;
            }
            .typing-dots span:nth-child(3) {
                animation-delay: 0.4s;
            }
            @keyframes typing {
                0%, 60%, 100% {
                    transform: translateY(0);
                    opacity: 0.5;
                }
                30% {
                    transform: translateY(-10px);
                    opacity: 1;
                }
            }
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
            .profile-status {
                color: #aaaaaa;
                margin-left: 0.5rem;
            }
        `;
        
        const styleSheet = document.createElement('style');
        styleSheet.textContent = typingCSS;
        document.head.appendChild(styleSheet);

    </script>
</body>
</html>
