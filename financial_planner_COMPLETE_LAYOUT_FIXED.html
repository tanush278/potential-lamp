<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Planner Pro - Advanced Edition</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js" defer></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet">
    <style>
        :root {
            --primary-black: #000000;
            --secondary-black: #0a0a0a;
            --card-black: #111111;
            --border-gray: #333333;
            --text-white: #ffffff;
            --text-gray: #aaaaaa;
            --accent-white: #ffffff;
            --accent-light: #f0f0f0;
            --accent-silver: #c0c0c0;
            --accent-gold: #ffd700;
            --success-color: #ffffff;
            --warning-color: #f0f0f0;
            --info-color: #e0e0e0;
            --highlight-color: #d0d0d0;
            --gradient-primary: linear-gradient(135deg, #000000 0%, #1a1a1a 50%, #000000 100%);
            --gradient-card: linear-gradient(145deg, #111111 0%, #1a1a1a 100%);
            --gradient-accent: linear-gradient(90deg, #ffffff 0%, #e0e0e0 100%);
            --gradient-silver: linear-gradient(90deg, #c0c0c0 0%, #ffffff 100%);
            --gradient-gold: linear-gradient(90deg, #ffd700 0%, #ffed4a 100%);
            --shadow-light: 0 4px 20px rgba(255, 255, 255, 0.1);
            --shadow-heavy: 0 20px 60px rgba(0, 0, 0, 0.8);
            --shadow-glow: 0 0 20px rgba(255, 255, 255, 0.2);
            --border-radius-sm: 8px;
            --border-radius-md: 15px;
            --border-radius-lg: 25px;
            --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-bounce: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--primary-black);
            color: var(--text-white);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* FIXED LAYOUT STRUCTURE - NO OVERLAPPING */
        .app-container {
            display: flex;
            height: 100vh;
            width: 100vw;
        }

        /* SIDEBAR - FIXED POSITION, NO OVERLAP */
        .sidebar {
            width: 280px;
            min-width: 280px;
            max-width: 280px;
            background: var(--gradient-primary);
            border-right: 2px solid var(--border-gray);
            height: 100vh;
            overflow-y: auto;
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1000;
            transition: var(--transition-smooth);
        }

        .sidebar.collapsed {
            width: 70px;
            min-width: 70px;
            max-width: 70px;
        }

        /* MAIN CONTENT - PROPER MARGIN */
        .main-content {
            margin-left: 280px;
            width: calc(100vw - 280px);
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
            transition: var(--transition-smooth);
        }

        .sidebar.collapsed ~ .main-content {
            margin-left: 70px;
            width: calc(100vw - 70px);
        }

        /* SIDEBAR HEADER - FIXED LAYOUT */
        .sidebar-header {
            padding: 1.2rem 1rem;
            border-bottom: 1px solid var(--border-gray);
            background: var(--card-black);
            position: sticky;
            top: 0;
            z-index: 1001;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }

        .sidebar.collapsed .sidebar-header {
            padding: 1rem;
            justify-content: center;
        }

        .sidebar-logo {
            font-family: 'Poppins', sans-serif;
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-white);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
            flex: 1;
            min-width: 0;
        }

        .sidebar.collapsed .sidebar-logo .sidebar-text {
            display: none;
        }

        .sidebar-logo i {
            font-size: 1.8rem;
            background: var(--gradient-accent);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            flex-shrink: 0;
        }

        /* TOGGLE BUTTON - NO OVERLAP */
        .sidebar-toggle {
            background: var(--border-gray);
            border: none;
            color: var(--text-white);
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition-smooth);
            font-size: 14px;
            flex-shrink: 0;
        }

        .sidebar.collapsed .sidebar-toggle {
            position: absolute;
            top: 1.2rem;
            right: 1rem;
        }

        .sidebar-toggle:hover {
            background: var(--accent-white);
            color: var(--primary-black);
        }

        /* NAVIGATION */
        .nav-section {
            padding: 1rem 0;
        }

        .nav-section-title {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            color: var(--text-gray);
            padding: 0 1.5rem 0.5rem;
            letter-spacing: 1px;
        }

        .sidebar.collapsed .nav-section-title {
            display: none;
        }

        .nav-item {
            margin-bottom: 0.25rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            padding: 0.8rem 1.5rem;
            color: var(--text-gray);
            text-decoration: none;
            cursor: pointer;
            transition: var(--transition-smooth);
            border-left: 3px solid transparent;
        }

        .sidebar.collapsed .nav-link {
            padding: 0.8rem;
            justify-content: center;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-white);
            border-left-color: var(--accent-white);
        }

        .nav-link.active {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-white);
            border-left-color: var(--accent-white);
        }

        .nav-icon {
            font-size: 1.1rem;
            margin-right: 0.75rem;
            width: 20px;
            text-align: center;
            flex-shrink: 0;
        }

        .sidebar.collapsed .nav-icon {
            margin-right: 0;
        }

        .nav-text {
            flex: 1;
            white-space: nowrap;
        }

        .sidebar.collapsed .nav-text {
            display: none;
        }

        .nav-arrow {
            font-size: 0.8rem;
            transition: var(--transition-smooth);
        }

        .sidebar.collapsed .nav-arrow {
            display: none;
        }

        .nav-submenu {
            background: rgba(0, 0, 0, 0.3);
            border-left: 2px solid var(--border-gray);
            margin-left: 1.5rem;
            overflow: hidden;
            max-height: 0;
            transition: var(--transition-smooth);
        }

        .sidebar.collapsed .nav-submenu {
            display: none;
        }

        .nav-submenu.active {
            max-height: 300px;
        }

        .nav-sublink {
            display: flex;
            align-items: center;
            padding: 0.6rem 1rem;
            color: var(--text-gray);
            text-decoration: none;
            cursor: pointer;
            transition: var(--transition-smooth);
            font-size: 0.9rem;
        }

        .nav-sublink:hover {
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-white);
        }

        .nav-sublink i {
            margin-right: 0.5rem;
            width: 16px;
            text-align: center;
        }

        /* HEADER */
        .app-header {
            background: var(--gradient-card);
            border-bottom: 2px solid var(--border-gray);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(20px);
            flex-shrink: 0;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .breadcrumb {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-white);
        }

        /* CONTENT AREA */
        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 0;
        }

        /* SECTIONS */
        .section {
            display: none;
            padding: 2rem;
            min-height: calc(100vh - 100px);
            width: 100%;
            box-sizing: border-box;
        }

        .section.active {
            display: block;
            animation: sectionFadeIn 0.5s ease-out;
        }

        @keyframes sectionFadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* SECTION HEADERS */
        .section-header {
            margin-bottom: 2rem;
            position: relative;
            padding-bottom: 1rem;
        }

        .section-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 60px;
            height: 3px;
            background: var(--gradient-accent);
            border-radius: 2px;
        }

        .section-title {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            background: var(--gradient-accent);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .section-subtitle {
            font-size: 1.1rem;
            color: var(--text-gray);
            font-weight: 400;
        }

        /* ENHANCED CARDS WITH ANIMATIONS */
        .card {
            background: var(--gradient-card);
            border: 1px solid var(--border-gray);
            border-radius: var(--border-radius-md);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow-light);
            transition: var(--transition-smooth);
            width: 100%;
            box-sizing: border-box;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }

        .card:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: var(--shadow-heavy);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .card:hover::before {
            left: 100%;
        }

        /* ENHANCED BUTTONS */
        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-smooth);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            font-size: 1rem;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transition: width 0.3s, height 0.3s;
            transform: translate(-50%, -50%);
            z-index: 0;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn > * {
            position: relative;
            z-index: 1;
        }

        /* FORM ELEMENTS */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
            width: 100%;
            box-sizing: border-box;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-input, .form-select {
            background: var(--card-black);
            border: 1px solid var(--border-gray);
            border-radius: var(--border-radius-sm);
            padding: 0.8rem 1rem;
            color: var(--text-white);
            font-size: 1rem;
            transition: var(--transition-smooth);
            width: 100%;
            box-sizing: border-box;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--accent-white);
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.1);
        }

        /* FREQUENCY TOGGLE BUTTONS */
        .frequency-btn {
            padding: 0.6rem 1rem;
            border: 2px solid var(--border-gray);
            background: var(--card-black);
            color: var(--text-gray);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 500;
            flex: 1;
            text-align: center;
        }

        .frequency-btn:hover {
            border-color: var(--accent-gold);
            color: var(--accent-white);
        }

        .frequency-btn.active {
            border-color: var(--accent-gold);
            background: var(--accent-gold);
            color: var(--primary-black);
            font-weight: 600;
        }

        .chart-period-btn {
            padding: 0.5rem 1rem;
            border: 2px solid var(--border-gray);
            background: var(--card-black);
            color: var(--text-gray);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .chart-period-btn:hover {
            border-color: var(--accent-white);
            color: var(--accent-white);
        }

        .chart-period-btn.active {
            border-color: var(--accent-white);
            background: var(--accent-white);
            color: var(--primary-black);
            font-weight: 600;
        }

        /* BUTTONS */
        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: var(--border-radius-sm);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-smooth);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            font-size: 1rem;
        }

        .btn-primary {
            background: var(--gradient-accent);
            color: var(--primary-black);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 255, 255, 0.3);
        }

        .btn-secondary {
            background: transparent;
            color: var(--text-white);
            border: 1px solid var(--border-gray);
        }

        .btn-secondary:hover {
            background: var(--border-gray);
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }

        /* DASHBOARD SPECIFIC */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .dashboard-card {
            background: var(--gradient-card);
            border: 1px solid var(--border-gray);
            border-radius: var(--border-radius-md);
            padding: 2rem;
            text-align: center;
            transition: var(--transition-smooth);
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-heavy);
        }

        .card-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            background: var(--gradient-accent);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: var(--text-white);
        }

        .card-description {
            color: var(--text-gray);
            margin-bottom: 2rem;
            line-height: 1.6;
        }

        /* QUICK STATS */
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: var(--gradient-card);
            border: 1px solid var(--border-gray);
            border-radius: var(--border-radius-md);
            padding: 1.5rem;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--accent-white);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-gray);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* PROFILE INFO */
        .profile-info-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .current-profile {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius-sm);
        }

        .profile-status {
            color: var(--success-green);
            font-size: 1.2rem;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -280px;
                z-index: 2000;
            }
            
            .sidebar.open {
                left: 0;
            }
            
            .main-content {
                margin-left: 0;
                width: 100vw;
            }
            
            .section {
                padding: 1rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .quick-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
                         <div class="sidebar-header">
                 <div class="sidebar-logo">
                     <i class="fas fa-chart-line"></i>
                     <span class="sidebar-text">FinPro</span>
                 </div>
                 <button class="sidebar-toggle" onclick="toggleSidebar()">
                     <i class="fas fa-bars"></i>
                 </button>
             </div>
            
                         <nav class="sidebar-nav">
                <!-- Dashboard Section -->
                <div class="nav-section">
                    <div class="nav-section-title">Overview</div>
                    <div class="nav-item">
                        <a class="nav-link active" onclick="showSection('dashboard')">
                            <i class="nav-icon fas fa-home"></i>
                            <span class="nav-text">Dashboard</span>
                        </a>
                    </div>
                </div>

                <!-- Client Data Section -->
                <div class="nav-section">
                    <div class="nav-section-title">Client Data</div>
                    <div class="nav-item">
                        <a class="nav-link" onclick="toggleNavItem(this)">
                            <i class="nav-icon fas fa-user-edit"></i>
                            <span class="nav-text">Client Profile</span>
                            <i class="nav-arrow fas fa-chevron-right"></i>
                        </a>
                        <div class="nav-submenu">
                            <a class="nav-sublink" onclick="showSection('personality')">
                                <i class="fas fa-brain"></i> Assessment
                            </a>
                            <a class="nav-sublink" onclick="showSection('profile')">
                                <i class="fas fa-id-card"></i> Basic Info
                            </a>
                            <a class="nav-sublink" onclick="showSection('financial')">
                                <i class="fas fa-wallet"></i> Financial Status
                            </a>
                            <a class="nav-sublink" onclick="showSection('networth')">
                                <i class="fas fa-calculator"></i> Net Worth
                            </a>
                            <a class="nav-sublink" onclick="showSection('goals')">
                                <i class="fas fa-bullseye"></i> Goals & Insurance
                            </a>
                            <a class="nav-sublink" onclick="showSection('risk')">
                                <i class="fas fa-chart-area"></i> Risk Profile
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Investment Advisory Section -->
                <div class="nav-section">
                    <div class="nav-section-title">Advisory</div>
                    <div class="nav-item">
                        <a class="nav-link" onclick="toggleNavItem(this)">
                            <i class="nav-icon fas fa-chart-line"></i>
                            <span class="nav-text">Investment Advisory</span>
                            <i class="nav-arrow fas fa-chevron-right"></i>
                        </a>
                        <div class="nav-submenu">
                            <a class="nav-sublink" onclick="showSection('recommendations')">
                                <i class="fas fa-lightbulb"></i> Investment Plan
                            </a>
                            <a class="nav-sublink" onclick="showSection('portfolio')">
                                <i class="fas fa-pie-chart"></i> Portfolio Analysis
                            </a>
                            <a class="nav-sublink" onclick="showSection('sip')">
                                <i class="fas fa-calendar-check"></i> SIP Calculator
                            </a>
                            <a class="nav-sublink" onclick="showSection('tax')">
                                <i class="fas fa-receipt"></i> Tax Planning
                            </a>
                            <a class="nav-sublink" onclick="showSection('retirement')">
                                <i class="fas fa-umbrella"></i> Retirement
                            </a>
                            <a class="nav-sublink" onclick="showSection('comparison')">
                                <i class="fas fa-balance-scale"></i> Product Compare
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Analytics & Reports Section -->
                <div class="nav-section">
                    <div class="nav-section-title">Reports</div>
                    <div class="nav-item">
                        <a class="nav-link" onclick="toggleNavItem(this)">
                            <i class="nav-icon fas fa-chart-bar"></i>
                            <span class="nav-text">Analytics & Reports</span>
                            <i class="nav-arrow fas fa-chevron-right"></i>
                        </a>
                        <div class="nav-submenu">
                            <a class="nav-sublink" onclick="showSection('analytics')">
                                <i class="fas fa-chart-bar"></i> Analytics
                            </a>
                            <a class="nav-sublink" onclick="showSection('reports')">
                                <i class="fas fa-file-alt"></i> Reports
                            </a>
                            <a class="nav-sublink" onclick="showSection('summary')">
                                <i class="fas fa-clipboard-list"></i> Executive Summary
                            </a>
                            <a class="nav-sublink" onclick="showSection('alerts')">
                                <i class="fas fa-bell"></i> Smart Alerts
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Financial Tools Section -->
                <div class="nav-section">
                    <div class="nav-section-title">Tools</div>
                    <div class="nav-item">
                        <a class="nav-link" onclick="toggleNavItem(this)">
                            <i class="nav-icon fas fa-tools"></i>
                            <span class="nav-text">Financial Tools</span>
                            <i class="nav-arrow fas fa-chevron-right"></i>
                        </a>
                        <div class="nav-submenu">
                            <a class="nav-sublink" onclick="showSection('loan-calculator')">
                                <i class="fas fa-home"></i> Loan Calculator
                            </a>
                            <a class="nav-sublink" onclick="showSection('budget-planner')">
                                <i class="fas fa-chart-pie"></i> Budget Planner
                            </a>
                            <a class="nav-sublink" onclick="showSection('investment-tracker')">
                                <i class="fas fa-trending-up"></i> Investment Tracker
                            </a>
                            <a class="nav-sublink" onclick="showSection('financial-calendar')">
                                <i class="fas fa-calendar-alt"></i> Financial Calendar
                            </a>
                        </div>
                    </div>
                </div>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Premium Header -->
            <header class="app-header">
                <div class="header-content">
                    <div class="breadcrumb">
                        <span id="current-section-title">Dashboard</span>
                    </div>
                    <div class="profile-info-header">
                        <div class="current-profile">
                            <i class="fas fa-user-circle"></i>
                            <span id="current-profile-name">Profile Name</span>
                            <span id="current-profile-status" class="profile-status">●</span>
                        </div>
                        <button class="btn btn-small btn-primary" onclick="saveCurrentProfile()">
                            <i class="fas fa-save"></i> Save
                        </button>
                        <button class="btn btn-small btn-secondary" onclick="showExportModal()">
                            <i class="fas fa-download"></i> Export
                        </button>
                        <button class="btn btn-small btn-secondary" onclick="showSettingsModal()">
                            <i class="fas fa-cog"></i> Settings
                        </button>
                        <button class="btn btn-small btn-secondary" onclick="goBackToProfiles()">
                            <i class="fas fa-home"></i> Home
                        </button>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <div class="content-area">
                <!-- Dashboard Section -->
                <section id="dashboard" class="section active">
                    <div class="section-header">
                        <h1 class="section-title">Financial Dashboard</h1>
                        <p class="section-subtitle">Your comprehensive financial overview and quick access to all planning tools</p>
                    </div>

                    <!-- Quick Stats -->
                    <div class="quick-stats">
                        <div class="stat-card">
                            <div class="stat-value" id="dashboard-net-worth">₹0</div>
                            <div class="stat-label">Net Worth</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="dashboard-monthly-savings">₹0</div>
                            <div class="stat-label">Monthly Savings</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="dashboard-investment-value">₹0</div>
                            <div class="stat-label">Investments</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="dashboard-financial-score">0%</div>
                            <div class="stat-label">Financial Health</div>
                        </div>
                    </div>

                    <!-- Dashboard Cards -->
                    <div class="dashboard-grid">
                        <div class="dashboard-card">
                            <div class="card-icon"><i class="fas fa-brain"></i></div>
                            <h3 class="card-title">Financial Assessment</h3>
                            <p class="card-description">Discover your investment personality and risk profile through our comprehensive behavioral finance assessment.</p>
                            <div class="card-action">
                                <button class="btn btn-primary" onclick="showSection('personality')">
                                    <i class="fas fa-play"></i> Start Assessment
                                </button>
                            </div>
                        </div>

                        <div class="dashboard-card">
                            <div class="card-icon"><i class="fas fa-user-edit"></i></div>
                            <h3 class="card-title">Client Profile</h3>
                            <p class="card-description">Build your comprehensive financial profile with personal information and financial status.</p>
                                                         <div class="card-action">
                                 <button class="btn btn-primary" onclick="showSection('profile')">
                                     <i class="fas fa-edit"></i> Update Profile
                                 </button>
                             </div>
                        </div>

                        <div class="dashboard-card">
                            <div class="card-icon"><i class="fas fa-lightbulb"></i></div>
                            <h3 class="card-title">Investment Recommendations</h3>
                            <p class="card-description">Get personalized investment strategies powered by advanced algorithms and market analysis.</p>
                                                         <div class="card-action">
                                 <button class="btn btn-primary" onclick="showSection('recommendations')">
                                     <i class="fas fa-magic"></i> Get Recommendations
                                 </button>
                             </div>
                        </div>

                        <div class="dashboard-card">
                            <div class="card-icon"><i class="fas fa-chart-bar"></i></div>
                            <h3 class="card-title">Portfolio Analytics</h3>
                            <p class="card-description">Advanced analytics and performance tracking for your investment portfolio.</p>
                            <div class="card-action">
                                <button class="btn btn-primary" onclick="showSection('analytics')">
                                    <i class="fas fa-chart-line"></i> View Analytics
                                </button>
                            </div>
                        </div>

                        <div class="dashboard-card">
                            <div class="card-icon"><i class="fas fa-file-alt"></i></div>
                            <h3 class="card-title">Professional Reports</h3>
                            <p class="card-description">Generate comprehensive financial reports with professional insights and recommendations.</p>
                            <div class="card-action">
                                <button class="btn btn-primary" onclick="showSection('reports')">
                                    <i class="fas fa-download"></i> Generate Reports
                                </button>
                            </div>
                        </div>

                        <div class="dashboard-card">
                            <div class="card-icon"><i class="fas fa-tools"></i></div>
                            <h3 class="card-title">Financial Tools</h3>
                            <p class="card-description">Access powerful calculators and planning tools for loans, SIPs, retirement, and more.</p>
                            <div class="card-action">
                                <button class="btn btn-primary" onclick="showSection('loan-calculator')">
                                    <i class="fas fa-calculator"></i> Use Tools
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Personality Assessment Section -->
                <section id="personality" class="section">
                    <div class="section-header">
                        <h1 class="section-title">
                            <i class="fas fa-brain"></i>
                            Advanced Financial Personality Assessment
                        </h1>
                        <p class="section-subtitle">Discover your investment personality and behavioral traits to optimize your financial strategy</p>
                    </div>
                    
                    <div class="card" id="assessment-intro">
                        <h3>Investment Personality Assessment</h3>
                        <p>This comprehensive assessment will help identify your financial personality type, risk tolerance, and investment preferences.</p>
                        <p><strong>Assessment includes:</strong></p>
                        <ul style="margin: 1rem 0; color: var(--text-gray);">
                            <li>Risk tolerance evaluation</li>
                            <li>Investment behavior analysis</li>
                            <li>Financial goals alignment</li>
                            <li>Personality-based recommendations</li>
                        </ul>
                        <button class="btn btn-primary" onclick="startPersonalityAssessment()">
                            <i class="fas fa-play"></i> Start Assessment
                        </button>
                    </div>

                    <div class="card" id="assessment-questions" style="display: none;">
                        <h3>Question <span id="current-question">1</span> of <span id="total-questions">10</span></h3>
                        <div class="progress-bar" style="background: var(--border-gray); height: 4px; border-radius: 2px; margin: 1rem 0;">
                            <div id="progress-fill" style="background: var(--accent-white); height: 100%; border-radius: 2px; width: 10%; transition: width 0.3s;"></div>
                        </div>
                        
                        <div id="question-content">
                            <h4 id="question-text">Loading question...</h4>
                            <div id="question-options" class="form-grid" style="margin-top: 2rem;">
                                <!-- Options will be populated by JS -->
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                            <button class="btn btn-secondary" id="prev-btn" onclick="previousQuestion()" disabled>
                                <i class="fas fa-arrow-left"></i> Previous
                            </button>
                            <button class="btn btn-primary" id="next-btn" onclick="nextQuestion()" disabled>
                                Next <i class="fas fa-arrow-right"></i>
                            </button>
                            <button class="btn btn-primary" id="finish-btn" onclick="finishAssessment()" style="display: none;">
                                <i class="fas fa-check"></i> Finish Assessment
                            </button>
                        </div>
                    </div>

                    <div class="card" id="assessment-results" style="display: none;">
                        <h3>Your Financial Personality Profile</h3>
                        <div id="personality-result">
                            <!-- Results will be populated by JS -->
                        </div>
                        <button class="btn btn-secondary" onclick="retakeAssessment()">
                            <i class="fas fa-redo"></i> Retake Assessment
                        </button>
                        <button class="btn btn-primary" onclick="showSection('profile')">
                            <i class="fas fa-arrow-right"></i> Continue to Profile Setup
                        </button>
                    </div>
                </section>

                <!-- Basic Information Section -->
                <section id="profile" class="section">
                    <div class="section-header">
                        <h1 class="section-title">Basic Information</h1>
                        <p class="section-subtitle">Tell us about yourself to create a personalized financial plan</p>
                    </div>
                    
                    <div class="card">
                        <h3>Personal Details</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Full Name</label>
                                <input type="text" class="form-input" id="client-name" placeholder="Enter your full name">
                            </div>
                            <div class="form-group">
                                <label>Age</label>
                                <input type="number" class="form-input" id="client-age" placeholder="Enter your age">
                            </div>
                            <div class="form-group">
                                <label>Occupation</label>
                                <input type="text" class="form-input" id="client-occupation" placeholder="Enter your occupation">
                            </div>
                            <div class="form-group">
                                <label>Annual Income</label>
                                <input type="number" class="form-input" id="client-income" placeholder="Enter annual income">
                            </div>
                            <div class="form-group">
                                <label>City</label>
                                <input type="text" class="form-input" id="client-city" placeholder="Enter your city">
                            </div>
                            <div class="form-group">
                                <label>Marital Status</label>
                                <select class="form-select" id="client-marital-status">
                                    <option value="">Select status</option>
                                    <option value="single">Single</option>
                                    <option value="married">Married</option>
                                    <option value="divorced">Divorced</option>
                                    <option value="widowed">Widowed</option>
                                </select>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="saveBasicInfo()">
                            <i class="fas fa-save"></i> Save Information
                        </button>
                    </div>
                </section>

                <!-- Financial Status Section -->
                <section id="financial" class="section">
                    <div class="section-header">
                        <h1 class="section-title">Financial Status</h1>
                        <p class="section-subtitle">Current financial position and monthly cash flow</p>
                    </div>
                    
                    <div class="card">
                        <h3>Current Financial Position</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Monthly Income</label>
                                <input type="number" class="form-input" id="monthly-income" placeholder="Enter monthly income">
                            </div>
                            <div class="form-group">
                                <label>Monthly Expenses</label>
                                <input type="number" class="form-input" id="monthly-expenses" placeholder="Enter monthly expenses">
                            </div>
                            <div class="form-group">
                                <label>Current Savings</label>
                                <input type="number" class="form-input" id="current-savings" placeholder="Enter current savings">
                            </div>
                            <div class="form-group">
                                <label>Current Investments</label>
                                <input type="number" class="form-input" id="current-investments" placeholder="Enter current investments">
                            </div>
                            <div class="form-group">
                                <label>Outstanding Loans</label>
                                <input type="number" class="form-input" id="outstanding-loans" placeholder="Enter loan amount">
                            </div>
                            <div class="form-group">
                                <label>Credit Card Debt</label>
                                <input type="number" class="form-input" id="credit-debt" placeholder="Enter credit card debt">
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="saveFinancialStatus()">
                            <i class="fas fa-save"></i> Save Financial Status
                        </button>
                    </div>
                </section>

                <!-- Risk Profile Section -->
                <section id="risk" class="section">
                    <div class="section-header">
                        <h1 class="section-title">Risk Assessment</h1>
                        <p class="section-subtitle">Determine your investment risk tolerance and profile</p>
                    </div>
                    
                    <div class="card" id="risk-assessment">
                        <h3>Risk Tolerance Calculator</h3>
                        <p>Complete this comprehensive risk assessment to determine your optimal investment strategy.</p>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Age Group</label>
                                <select class="form-select" id="age-group">
                                    <option value="">Select age group</option>
                                    <option value="20">Under 25 (High risk capacity)</option>
                                    <option value="15">25-35 (Moderate-High risk capacity)</option>
                                    <option value="10">36-45 (Moderate risk capacity)</option>
                                    <option value="5">46-55 (Moderate-Low risk capacity)</option>
                                    <option value="2">Over 55 (Low risk capacity)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Investment Experience</label>
                                <select class="form-select" id="investment-experience">
                                    <option value="">Select experience level</option>
                                    <option value="5">No experience</option>
                                    <option value="10">Basic knowledge</option>
                                    <option value="15">Moderate experience</option>
                                    <option value="20">Experienced investor</option>
                                    <option value="25">Expert level</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Investment Horizon</label>
                                <select class="form-select" id="investment-horizon">
                                    <option value="">Select time period</option>
                                    <option value="5">Less than 1 year</option>
                                    <option value="10">1-3 years</option>
                                    <option value="15">3-5 years</option>
                                    <option value="20">5-10 years</option>
                                    <option value="25">More than 10 years</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Income Stability</label>
                                <select class="form-select" id="income-stability">
                                    <option value="">Select stability level</option>
                                    <option value="5">Very unstable</option>
                                    <option value="10">Somewhat unstable</option>
                                    <option value="15">Stable</option>
                                    <option value="20">Very stable</option>
                                    <option value="25">Extremely stable (govt/pension)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Financial Goals Priority</label>
                                <select class="form-select" id="financial-goals">
                                    <option value="">Select primary goal</option>
                                    <option value="5">Capital preservation</option>
                                    <option value="10">Regular income</option>
                                    <option value="15">Balanced growth</option>
                                    <option value="20">Wealth accumulation</option>
                                    <option value="25">Maximum growth</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Market Loss Tolerance</label>
                                <select class="form-select" id="loss-tolerance">
                                    <option value="">How much loss can you handle?</option>
                                    <option value="5">Cannot handle any loss</option>
                                    <option value="10">Up to 5% loss</option>
                                    <option value="15">Up to 15% loss</option>
                                    <option value="20">Up to 25% loss</option>
                                    <option value="25">More than 25% loss</option>
                                </select>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" onclick="calculateRiskProfile()">
                            <i class="fas fa-chart-bar"></i> Calculate Risk Profile
                        </button>
                    </div>

                    <div class="card" id="risk-results" style="display: none;">
                        <h3>Your Risk Profile Analysis</h3>
                        <div id="risk-profile-result">
                            <!-- Results will be populated by JS -->
                        </div>
                        <button class="btn btn-secondary" onclick="recalculateRisk()">
                            <i class="fas fa-redo"></i> Recalculate
                        </button>
                        <button class="btn btn-primary" onclick="showSection('goals')">
                            <i class="fas fa-arrow-right"></i> Set Financial Goals
                        </button>
                    </div>
                </section>

                <!-- Goals & Insurance Section -->
                <section id="goals" class="section">
                    <div class="section-header">
                        <h1 class="section-title">Goals & Insurance Planning</h1>
                        <p class="section-subtitle">Set intelligent financial goals with inflation adjustment and comprehensive insurance planning</p>
                    </div>
                    
                    <!-- Goal Setting -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Smart Goal Planning</h3>
                            <p class="card-subtitle">Create and track your financial goals with inflation adjustment</p>
                        </div>
                        
                        <form id="goal-form">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>Goal Name</label>
                                    <input type="text" id="goal-name" class="form-input" placeholder="e.g., Dream Home, Child's Education" required>
                                </div>
                                <div class="form-group">
                                    <label>Goal Category</label>
                                    <select id="goal-category" class="form-input">
                                        <option value="lifestyle">Lifestyle</option>
                                        <option value="education">Education</option>
                                        <option value="property">Property</option>
                                        <option value="business">Business</option>
                                        <option value="retirement">Retirement</option>
                                        <option value="emergency">Emergency</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Target Amount (₹ today's value)</label>
                                    <input type="number" id="goal-amount" class="form-input" placeholder="Enter amount in current value" required>
                                </div>
                                <div class="form-group">
                                    <label>Time Frame (Years)</label>
                                    <input type="number" id="goal-timeframe" class="form-input" min="1" max="50" placeholder="Years to achieve goal" required>
                                </div>
                                <div class="form-group">
                                    <label>Expected Inflation Rate (%)</label>
                                    <input type="number" id="goal-inflation" class="form-input" value="6" min="0" max="20" step="0.1">
                                </div>
                                <div class="form-group">
                                    <label>Priority Level</label>
                                    <select id="goal-priority" class="form-input" required>
                                        <option value="">Select Priority</option>
                                        <option value="critical">Critical</option>
                                        <option value="high">High</option>
                                        <option value="medium">Medium</option>
                                        <option value="low">Low</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>Current Progress (₹)</label>
                                    <input type="number" id="goal-progress" class="form-input" min="0" placeholder="Amount already saved">
                                </div>
                                <div class="form-group">
                                    <label>Expected Return Rate (%)</label>
                                    <input type="number" id="goal-return" class="form-input" value="12" min="0" max="30" step="0.1">
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn-primary" onclick="calculateGoal()">Calculate Goal</button>
                                <button type="button" class="btn btn-secondary" onclick="addGoal()">Add Goal</button>
                            </div>
                        </form>
                        
                        <!-- Goal Calculation Results -->
                        <div id="goal-results" style="display: none; margin-top: 2rem;">
                            <h4 style="color: var(--accent-white); margin-bottom: 1rem;">Goal Analysis</h4>
                            <div class="results-summary" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                <div class="result-card" style="background: linear-gradient(135deg, #1a1a1a, #2a2a2a); border: 2px solid var(--accent-silver); border-radius: 12px; padding: 1.5rem; text-align: center;">
                                    <div style="font-size: 0.9rem; color: var(--accent-silver); margin-bottom: 0.5rem; text-transform: uppercase;">Future Value</div>
                                    <div id="goal-future-value" style="font-size: 1.6rem; font-weight: bold; color: var(--accent-white);">₹0</div>
                                </div>
                                <div class="result-card" style="background: linear-gradient(135deg, #1a1a1a, #2a2a2a); border: 2px solid var(--accent-gold); border-radius: 12px; padding: 1.5rem; text-align: center;">
                                    <div style="font-size: 0.9rem; color: var(--accent-gold); margin-bottom: 0.5rem; text-transform: uppercase;">Monthly SIP Required</div>
                                    <div id="goal-monthly-sip" style="font-size: 1.6rem; font-weight: bold; color: var(--accent-gold);">₹0</div>
                                </div>
                                <div class="result-card" style="background: linear-gradient(135deg, #1a1a1a, #2a2a2a); border: 2px solid var(--accent-white); border-radius: 12px; padding: 1.5rem; text-align: center;">
                                    <div style="font-size: 0.9rem; color: var(--accent-white); margin-bottom: 0.5rem; text-transform: uppercase;">Total Investment</div>
                                    <div id="goal-total-investment" style="font-size: 1.6rem; font-weight: bold; color: var(--accent-white);">₹0</div>
                                </div>
                                <div class="result-card" style="background: linear-gradient(135deg, #1a1a1a, #2a2a2a); border: 2px solid var(--accent-silver); border-radius: 12px; padding: 1.5rem; text-align: center;">
                                    <div style="font-size: 0.9rem; color: var(--accent-silver); margin-bottom: 0.5rem; text-transform: uppercase;">Gap Amount</div>
                                    <div id="goal-gap" style="font-size: 1.6rem; font-weight: bold; color: var(--accent-silver);">₹0</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Goals List -->
                    <div class="card" style="margin-top: 2rem;">
                        <h3>Your Financial Goals</h3>
                        <div id="goals-list">
                            <div style="text-align: center; color: var(--text-gray); padding: 2rem;">
                                No goals added yet. Create your first financial goal above.
                            </div>
                        </div>
                    </div>

                    <!-- Insurance Planning -->
                    <div class="card" style="margin-top: 2rem;">
                        <div class="card-header">
                            <h3 class="card-title">Insurance Planning</h3>
                            <p class="card-subtitle">Calculate your insurance needs for comprehensive coverage</p>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Current Age</label>
                                <input type="number" id="insurance-age" class="form-input" min="18" max="100" placeholder="Your current age" required>
                            </div>
                            <div class="form-group">
                                <label>Annual Income (₹)</label>
                                <input type="number" id="insurance-income" class="form-input" placeholder="Your annual income" required>
                            </div>
                            <div class="form-group">
                                <label>Number of Dependents</label>
                                <input type="number" id="insurance-dependents" class="form-input" min="0" placeholder="Number of dependents" required>
                            </div>
                            <div class="form-group">
                                <label>Outstanding Loans (₹)</label>
                                <input type="number" id="insurance-loans" class="form-input" min="0" placeholder="Total outstanding loans">
                            </div>
                            <div class="form-group">
                                <label>Current Liquid Assets (₹)</label>
                                <input type="number" id="insurance-assets" class="form-input" min="0" placeholder="Savings and investments">
                            </div>
                            <div class="form-group">
                                <label>Years of Coverage Needed</label>
                                <input type="number" id="insurance-years" class="form-input" min="5" max="40" placeholder="Years of coverage" required>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" onclick="calculateInsurance()">Calculate Insurance Need</button>
                        
                        <!-- Insurance Results -->
                        <div id="insurance-results" style="display: none; margin-top: 2rem;">
                            <h4 style="color: var(--accent-white); margin-bottom: 1rem;">Insurance Analysis</h4>
                            <div class="results-summary" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                                <div class="result-card" style="background: linear-gradient(135deg, #1a1a1a, #2a2a2a); border: 2px solid var(--accent-gold); border-radius: 12px; padding: 1.5rem; text-align: center;">
                                    <div style="font-size: 0.9rem; color: var(--accent-gold); margin-bottom: 0.5rem; text-transform: uppercase;">Recommended Life Cover</div>
                                    <div id="insurance-life-cover" style="font-size: 1.8rem; font-weight: bold; color: var(--accent-gold);">₹0</div>
                                </div>
                                <div class="result-card" style="background: linear-gradient(135deg, #1a1a1a, #2a2a2a); border: 2px solid var(--accent-white); border-radius: 12px; padding: 1.5rem; text-align: center;">
                                    <div style="font-size: 0.9rem; color: var(--accent-white); margin-bottom: 0.5rem; text-transform: uppercase;">Health Insurance</div>
                                    <div id="insurance-health-cover" style="font-size: 1.8rem; font-weight: bold; color: var(--accent-white);">₹0</div>
                                </div>
                                <div class="result-card" style="background: linear-gradient(135deg, #1a1a1a, #2a2a2a); border: 2px solid var(--accent-silver); border-radius: 12px; padding: 1.5rem; text-align: center;">
                                    <div style="font-size: 0.9rem; color: var(--accent-silver); margin-bottom: 0.5rem; text-transform: uppercase;">Estimated Premium</div>
                                    <div id="insurance-premium" style="font-size: 1.8rem; font-weight: bold; color: var(--accent-silver);">₹0</div>
                                </div>
                            </div>
                            
                            <!-- Insurance Breakdown -->
                            <div id="insurance-breakdown" style="margin-top: 2rem;">
                                <!-- Will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </section>

                <!-- SIP Calculator Section -->
                <section id="sip" class="section">
                    <div class="section-header">
                        <h1 class="section-title">Advanced SIP Calculator</h1>
                        <p class="section-subtitle">Calculate your Systematic Investment Plan with inflation adjustment and visual analysis</p>
                    </div>
                    
                    <div class="card">
                        <h3>SIP Investment Calculator</h3>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>SIP Investment Frequency</label>
                                <div class="frequency-toggle" style="display: flex; gap: 0.5rem; margin-top: 0.5rem;">
                                    <button type="button" class="frequency-btn active" data-frequency="monthly" onclick="selectFrequency('monthly')">Monthly</button>
                                    <button type="button" class="frequency-btn" data-frequency="quarterly" onclick="selectFrequency('quarterly')">Quarterly</button>
                                    <button type="button" class="frequency-btn" data-frequency="semi-annually" onclick="selectFrequency('semi-annually')">Semi-Annual</button>
                                    <button type="button" class="frequency-btn" data-frequency="annually" onclick="selectFrequency('annually')">Annual</button>
                                </div>
                                <input type="hidden" id="sip-frequency" value="monthly">
                            </div>
                            <div class="form-group">
                                <label id="sip-amount-label">Monthly Investment Amount (₹)</label>
                                <input type="number" class="form-input" id="sip-amount" placeholder="Enter your monthly SIP amount" value="5000">
                                <small id="sip-frequency-info" style="color: var(--text-gray); font-size: 0.85rem; margin-top: 0.5rem; display: block;">You invest this amount every month</small>
                            </div>
                            <div class="form-group">
                                <label>Investment Period (Years)</label>
                                <input type="number" class="form-input" id="sip-period" placeholder="Enter investment period" value="10">
                            </div>
                            <div class="form-group">
                                                        <label>Expected Annual CAGR (%)</label>
                        <input type="number" class="form-input" id="sip-return" placeholder="Enter expected CAGR (e.g., 14)" value="12" step="0.1">
                            </div>
                            <div class="form-group">
                                <label>Expected Inflation Rate (%)</label>
                                <input type="number" class="form-input" id="inflation-rate" placeholder="Enter expected inflation" value="6" step="0.1">
                            </div>
                            <div class="form-group">
                                <label>Annual SIP Increase (%)</label>
                                <input type="number" class="form-input" id="sip-increase" placeholder="Annual SIP increment" value="10" step="0.1">
                            </div>
                            <div class="form-group">
                                <label>Calculation Type</label>
                                <select class="form-select" id="calc-type">
                                    <option value="standard">Standard SIP</option>
                                    <option value="step-up">Step-up SIP</option>
                                    <option value="lumpsum">SIP + Lumpsum</option>
                                </select>
                            </div>
                        </div>
                        
                        <div id="lumpsum-inputs" class="form-grid" style="display: none; margin-top: 1rem;">
                            <div class="form-group">
                                <label>Initial Lumpsum Investment (₹)</label>
                                <input type="number" class="form-input" id="lumpsum-amount" placeholder="Enter lumpsum amount" value="100000">
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" onclick="calculateAdvancedSIP()">
                            <i class="fas fa-chart-line"></i> Calculate Advanced SIP
                        </button>
                    </div>

                    <div id="sip-results" class="card" style="display: none; margin-top: 2rem;">
                        <h3>SIP Analysis Results</h3>
                        
                        <!-- Results Summary -->
                        <div class="results-summary" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin: 2rem 0;">
                            <div class="result-card" style="background: linear-gradient(135deg, #1a1a1a, #2a2a2a); border: 2px solid var(--accent-silver); border-radius: 12px; padding: 1.5rem; text-align: center; box-shadow: var(--shadow-glow);">
                                <div style="font-size: 0.9rem; color: var(--accent-silver); margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 1px;">Total Investment</div>
                                <div id="total-investment" style="font-size: 1.8rem; font-weight: bold; color: var(--accent-white);">₹0</div>
                            </div>
                            <div class="result-card" style="background: linear-gradient(135deg, #1a1a1a, #2a2a2a); border: 2px solid var(--accent-light); border-radius: 12px; padding: 1.5rem; text-align: center; box-shadow: var(--shadow-glow);">
                                <div style="font-size: 0.9rem; color: var(--accent-light); margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 1px;">Nominal Value</div>
                                <div id="nominal-value" style="font-size: 1.8rem; font-weight: bold; color: var(--accent-white);">₹0</div>
                            </div>
                            <div class="result-card" style="background: linear-gradient(135deg, #1a1a1a, #2a2a2a); border: 2px solid var(--accent-gold); border-radius: 12px; padding: 1.5rem; text-align: center; box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);">
                                <div style="font-size: 0.9rem; color: var(--accent-gold); margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 1px;">Real Value (Inflation Adjusted)</div>
                                <div id="real-value" style="font-size: 1.8rem; font-weight: bold; color: var(--accent-gold);">₹0</div>
                            </div>
                            <div class="result-card" style="background: linear-gradient(135deg, #2a2a2a, #1a1a1a); border: 2px solid var(--accent-white); border-radius: 12px; padding: 1.5rem; text-align: center; box-shadow: var(--shadow-glow);">
                                <div style="font-size: 0.9rem; color: var(--text-gray); margin-bottom: 0.5rem; text-transform: uppercase; letter-spacing: 1px;">Total Returns</div>
                                <div id="total-returns" style="font-size: 1.8rem; font-weight: bold; background: var(--gradient-accent); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">₹0</div>
                            </div>
                        </div>

                        <!-- Chart Container -->
                        <div style="margin: 2rem 0;">
                            <h4 style="margin-bottom: 1rem;">SIP Growth Visualization</h4>
                            <div style="position: relative; height: 400px; background: rgba(255,255,255,0.05); border-radius: 8px; padding: 1rem;">
                                <canvas id="sipChart" width="800" height="400"></canvas>
                            </div>
                        </div>

                        <!-- Detailed Breakdown -->
                        <div id="detailed-breakdown" style="margin-top: 2rem;">
                            <h4 style="color: var(--accent-white); margin-bottom: 1rem; font-size: 1.3rem;">Year-wise Investment Breakdown</h4>
                            <div style="max-height: 400px; overflow-y: auto; margin-top: 1rem; border: 2px solid var(--border-gray); border-radius: 12px; background: var(--card-black);">
                                <table id="breakdown-table" style="width: 100%; border-collapse: collapse;">
                                    <thead style="position: sticky; top: 0; z-index: 100; background: linear-gradient(135deg, var(--secondary-black), var(--primary-black)); box-shadow: 0 2px 10px rgba(0,0,0,0.8);">
                                        <tr>
                                            <th style="padding: 1.2rem 1rem; text-align: left; color: var(--accent-white); border-bottom: 2px solid var(--accent-silver); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-size: 0.9rem; background: inherit;">Year</th>
                                            <th style="padding: 1.2rem 1rem; text-align: right; color: var(--accent-silver); border-bottom: 2px solid var(--accent-silver); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-size: 0.9rem; background: inherit;">Investment</th>
                                            <th style="padding: 1.2rem 1rem; text-align: right; color: var(--accent-white); border-bottom: 2px solid var(--accent-silver); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-size: 0.9rem; background: inherit;">Nominal Value</th>
                                            <th style="padding: 1.2rem 1rem; text-align: right; color: var(--accent-gold); border-bottom: 2px solid var(--accent-silver); font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; font-size: 0.9rem; background: inherit;">Real Value</th>
                                        </tr>
                                    </thead>
                                    <tbody id="breakdown-body">
                                        <!-- Will be populated by JS -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Investment Insights -->
                        <div id="investment-insights" style="margin-top: 2rem;">
                            <h4 style="color: var(--accent-white); margin-bottom: 1rem; font-size: 1.4rem;">Advanced Investment Analysis</h4>
                            <div id="insights-content">
                                <!-- Insights will be populated by JavaScript -->
                            </div>
                            
                            <!-- Additional SIP Strategy Insights -->
                            <div id="strategy-insights" style="margin-top: 2rem;">
                                <!-- Strategy-specific insights will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </section>

                                 <!-- Net Worth Section -->
                 <section id="networth" class="section">
                     <div class="section-header">
                         <h1 class="section-title">Net Worth Calculator</h1>
                         <p class="section-subtitle">Calculate and track your net worth over time</p>
                     </div>
                     
                     <div class="card">
                         <h3>Net Worth Calculation</h3>
                         <p>Track your assets and liabilities to calculate your net worth.</p>
                         <div class="form-grid">
                             <div class="form-group">
                                 <label>Cash & Bank Balance (₹)</label>
                                 <input type="number" id="cash-balance" class="form-input" placeholder="Enter cash and bank balance">
                             </div>
                             <div class="form-group">
                                 <label>Investments (₹)</label>
                                 <input type="number" id="investments" class="form-input" placeholder="Enter total investments">
                             </div>
                             <div class="form-group">
                                 <label>Property Value (₹)</label>
                                 <input type="number" id="property-value" class="form-input" placeholder="Enter property value">
                             </div>
                             <div class="form-group">
                                 <label>Outstanding Loans (₹)</label>
                                 <input type="number" id="outstanding-loans" class="form-input" placeholder="Enter total loans">
                             </div>
                             <div class="form-group">
                                 <label>Other Assets (₹)</label>
                                 <input type="number" id="other-assets" class="form-input" placeholder="Enter other assets">
                             </div>
                             <div class="form-group">
                                 <label>Credit Card Debt (₹)</label>
                                 <input type="number" id="credit-card-debt" class="form-input" placeholder="Enter credit card debt">
                             </div>
                         </div>
                         <button class="btn btn-primary" onclick="calculateNetWorth()">
                             <i class="fas fa-calculator"></i> Calculate Net Worth
                         </button>
                         
                         <div id="networth-results" style="display: none; margin-top: 2rem;">
                             <!-- Results will be displayed here -->
                         </div>
                     </div>
                 </section>

                <!-- Tax Planning Section -->
                <section id="tax" class="section">
                    <div class="section-header">
                        <h1 class="section-title">Tax Planning</h1>
                        <p class="section-subtitle">Optimize your tax savings and plan your investments</p>
                    </div>
                    
                    <div class="card">
                        <h3>Tax Optimization Strategies</h3>
                        <p>Plan your tax-saving investments and deductions to minimize your tax liability.</p>
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Annual Income</label>
                                <input type="number" class="form-input" placeholder="Enter annual income">
                            </div>
                            <div class="form-group">
                                <label>Current 80C Investments</label>
                                <input type="number" class="form-input" placeholder="Enter 80C investments">
                            </div>
                            <div class="form-group">
                                <label>HRA Received</label>
                                <input type="number" class="form-input" placeholder="Enter HRA amount">
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="calculateTaxSavings()">
                            <i class="fas fa-file-invoice-dollar"></i> Calculate Tax Savings
                        </button>
                    </div>
                </section>

                <!-- Reports Section -->
                <section id="reports" class="section">
                    <div class="section-header">
                        <h1 class="section-title">Financial Reports</h1>
                        <p class="section-subtitle">Generate comprehensive financial analysis reports</p>
                    </div>
                    
                    <div class="card">
                        <h3>Professional Financial Report</h3>
                        <p>Generate a comprehensive PDF report with all your financial analysis, recommendations, and projections.</p>
                        <button class="btn btn-primary" onclick="generateReport()">
                            <i class="fas fa-file-pdf"></i> Generate PDF Report
                        </button>
                        <button class="btn btn-secondary" onclick="previewReport()" style="margin-left: 1rem;">
                            <i class="fas fa-eye"></i> Preview Report
                        </button>
                    </div>
                </section>

                

                <section id="portfolio" class="section">
                    <div class="section-header">
                        <h1 class="section-title">Portfolio Analysis</h1>
                        <p class="section-subtitle">Comprehensive analysis of your investment portfolio performance and health</p>
                    </div>

                    <!-- Portfolio Input -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Portfolio Holdings</h3>
                            <p class="card-subtitle">Enter your current investment holdings for analysis</p>
                            <div id="portfolio-integration-notice" style="display: none; background: rgba(255,215,0,0.05); border: 1px solid var(--accent-gold); border-radius: 6px; padding: 1rem; margin-top: 1rem;">
                                <div style="color: var(--accent-gold); font-weight: bold; margin-bottom: 0.5rem;"><i class="fas fa-link"></i> Smart Integration Active</div>
                                <div style="color: var(--text-gray); font-size: 0.9rem;">Fields auto-populated based on your Investment Recommendations. You can modify any values for personalized analysis.</div>
                            </div>
                        </div>
                        
                        <div id="portfolio-input-section">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>Total Portfolio Value (₹)</label>
                                    <input type="number" id="total-portfolio-value" class="form-input" placeholder="Enter total portfolio value" onchange="calculatePortfolioMetrics()">
                                </div>
                                <div class="form-group">
                                    <label>Investment Start Date</label>
                                    <input type="date" id="investment-start-date" class="form-input" onchange="calculatePortfolioMetrics()">
                                    <script>
                                        // Immediate date initialization to fix input issues
                                        (function() {
                                            const dateInput = document.getElementById('investment-start-date');
                                            if (dateInput) {
                                                const today = new Date();
                                                const todayStr = today.toISOString().split('T')[0];
                                                const tenYearsAgo = new Date();
                                                tenYearsAgo.setFullYear(tenYearsAgo.getFullYear() - 10);
                                                const minDateStr = tenYearsAgo.toISOString().split('T')[0];
                                                
                                                dateInput.setAttribute('max', todayStr);
                                                dateInput.setAttribute('min', minDateStr);
                                                
                                                if (!dateInput.value) {
                                                    const twoYearsAgo = new Date();
                                                    twoYearsAgo.setFullYear(twoYearsAgo.getFullYear() - 2);
                                                    dateInput.value = twoYearsAgo.toISOString().split('T')[0];
                                                }
                                            }
                                        })();
                                    </script>
                                </div>
                                <div class="form-group">
                                    <label>Expected Inflation Rate (%)</label>
                                    <input type="number" id="inflation-rate" class="form-input" placeholder="Annual inflation rate" value="6" step="0.1" min="0" max="20" onchange="calculatePortfolioMetrics()">
                                </div>
                                <div class="form-group">
                                    <label>Portfolio Goal Target (₹)</label>
                                    <input type="number" id="portfolio-goal" class="form-input" placeholder="Your target portfolio value" onchange="calculatePortfolioMetrics()">
                                    <small style="color: var(--text-gray); font-size: 0.85rem; margin-top: 0.5rem; display: block;">Optional: Set your financial goal to track progress</small>
                                </div>
                                <div class="form-group">
                                    <label>Expected Annual Return (%)</label>
                                    <input type="number" id="expected-return" class="form-input" placeholder="Expected CAGR" value="12" step="0.1" min="0" max="30" onchange="calculatePortfolioMetrics()">
                                    <small style="color: var(--text-gray); font-size: 0.85rem; margin-top: 0.5rem; display: block;">Your portfolio's expected annual return (CAGR)</small>
                                </div>
                                <div class="form-group">
                                    <label>Total Amount Invested (₹)</label>
                                    <input type="number" id="total-invested" class="form-input" placeholder="Total amount invested" onchange="calculatePortfolioMetrics()">
                                </div>
                                <div class="form-group">
                                    <label>SIP Frequency</label>
                                    <div class="frequency-toggle" style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                                        <button type="button" class="frequency-btn active" data-frequency="monthly" onclick="selectPortfolioSIPFrequency('monthly')">Monthly</button>
                                        <button type="button" class="frequency-btn" data-frequency="quarterly" onclick="selectPortfolioSIPFrequency('quarterly')">Quarterly</button>
                                        <button type="button" class="frequency-btn" data-frequency="semi-annually" onclick="selectPortfolioSIPFrequency('semi-annually')">Semi-Annual</button>
                                        <button type="button" class="frequency-btn" data-frequency="annually" onclick="selectPortfolioSIPFrequency('annually')">Annual</button>
                                    </div>
                                    <input type="hidden" id="portfolio-sip-frequency" value="monthly">
                                </div>
                                <div class="form-group">
                                    <label id="portfolio-sip-label">Monthly SIP Amount (₹)</label>
                                    <input type="number" id="monthly-sip" class="form-input" placeholder="Current monthly SIP" onchange="calculatePortfolioMetrics()">
                                    <small id="portfolio-sip-info" style="color: var(--text-gray); font-size: 0.85rem; margin-top: 0.5rem; display: block;">Amount you invest every month</small>
                                </div>
                            </div>
                            
                            <h4 style="color: var(--accent-white); margin: 2rem 0 1rem 0;">Asset Allocation</h4>
                            <div class="form-grid">
                                <div class="form-group">
                                    <label>Equity Holdings (₹)</label>
                                    <input type="number" id="portfolio-equity" class="form-input" placeholder="Equity investments" onchange="calculatePortfolioMetrics()">
                                </div>
                                <div class="form-group">
                                    <label>Debt Holdings (₹)</label>
                                    <input type="number" id="portfolio-debt" class="form-input" placeholder="Debt investments" onchange="calculatePortfolioMetrics()">
                                </div>
                                <div class="form-group">
                                    <label>Gold Holdings (₹)</label>
                                    <input type="number" id="portfolio-gold" class="form-input" placeholder="Gold investments" onchange="calculatePortfolioMetrics()">
                                </div>
                                <div class="form-group">
                                    <label>Cash & Others (₹)</label>
                                    <input type="number" id="portfolio-cash" class="form-input" placeholder="Cash and other investments" onchange="calculatePortfolioMetrics()">
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                                <button class="btn btn-primary" onclick="analyzePortfolio()">
                                    Analyze Portfolio
                                </button>
                                                        <!-- Refresh button removed - was confusing and not needed -->
                            </div>
                        </div>
                    </div>

                    <!-- Portfolio Overview -->
                    <div class="card" id="portfolio-overview" style="margin-top: 2rem; display: none;">
                        <div class="card-header">
                            <h3 class="card-title">Portfolio Overview</h3>
                            <p class="card-subtitle">Advanced metrics and performance indicators</p>
                        </div>
                        
                        <div id="portfolio-notice-area">
                            <!-- Dynamic notice will be inserted here -->
                        </div>
                        
                        <div class="results-summary" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                            <div class="result-card" style="background: linear-gradient(135deg, #1a1a1a, #2a2a2a); border: 2px solid var(--accent-gold); border-radius: 12px; padding: 1.5rem; text-align: center;">
                                <div style="font-size: 0.9rem; color: var(--accent-gold); margin-bottom: 0.5rem; text-transform: uppercase;">Total Returns</div>
                                <div id="portfolio-total-returns" style="font-size: 1.8rem; font-weight: bold; color: var(--accent-gold);">₹2,50,000</div>
                                <div id="portfolio-returns-percentage" style="font-size: 0.9rem; color: var(--text-gray);">25% (Sample)</div>
                            </div>
                            <div class="result-card" style="background: linear-gradient(135deg, #1a1a1a, #2a2a2a); border: 2px solid var(--accent-white); border-radius: 12px; padding: 1.5rem; text-align: center;">
                                <div style="font-size: 0.9rem; color: var(--accent-white); margin-bottom: 0.5rem; text-transform: uppercase;">Annual Return</div>
                                <div id="portfolio-annual-return" style="font-size: 1.8rem; font-weight: bold; color: var(--accent-white);">12.5%</div>
                                <div style="font-size: 0.9rem; color: var(--text-gray);">CAGR</div>
                            </div>
                            <div class="result-card" style="background: linear-gradient(135deg, #1a1a1a, #2a2a2a); border: 2px solid var(--accent-silver); border-radius: 12px; padding: 1.5rem; text-align: center;">
                                <div style="font-size: 0.9rem; color: var(--accent-silver); margin-bottom: 0.5rem; text-transform: uppercase;">Portfolio Health</div>
                                <div id="portfolio-health-score" style="font-size: 1.8rem; font-weight: bold; color: var(--accent-silver);">78</div>
                                <div style="font-size: 0.9rem; color: var(--text-gray);">Score out of 100</div>
                            </div>
                            <div class="result-card" style="background: linear-gradient(135deg, #1a1a1a, #2a2a2a); border: 2px solid var(--accent-light); border-radius: 12px; padding: 1.5rem; text-align: center;">
                                <div style="font-size: 0.9rem; color: var(--accent-light); margin-bottom: 0.5rem; text-transform: uppercase;">Investment Duration</div>
                                <div id="portfolio-duration" style="font-size: 1.8rem; font-weight: bold; color: var(--accent-light);">24</div>
                                <div style="font-size: 0.9rem; color: var(--text-gray);">Months</div>
                            </div>
                        </div>
                        
                        <!-- Goal Progress Section -->
                        <div id="goal-progress-section" style="display: none; margin-top: 2rem; padding: 1.5rem; background: linear-gradient(135deg, rgba(255,215,0,0.03), rgba(0,0,0,0.3)); border: 1px solid var(--accent-gold); border-radius: 12px;">
                            <h4 style="color: var(--accent-gold); margin-bottom: 1rem;"><i class="fas fa-bullseye"></i> Goal Progress Tracking</h4>
                            <div id="goal-progress-content">
                                <!-- Goal progress will be populated here -->
                            </div>
                        </div>
                        
                        <!-- Advanced Analytics -->
                        <div id="advanced-analytics" style="margin-top: 2rem; padding: 1.5rem; background: linear-gradient(135deg, rgba(255,255,255,0.02), rgba(0,0,0,0.3)); border: 1px solid var(--border-gray); border-radius: 12px;">
                            <h4 style="color: var(--accent-white); margin-bottom: 1rem;"><i class="fas fa-chart-line"></i> Advanced Analytics</h4>
                            <div id="analytics-content">
                                <!-- Advanced analytics will be populated here -->
                            </div>
                        </div>
                        
                        <!-- Benchmark Comparison -->
                        <div id="benchmark-comparison" style="margin-top: 2rem; padding: 1.5rem; background: linear-gradient(135deg, rgba(192,192,192,0.03), rgba(0,0,0,0.3)); border: 1px solid var(--accent-silver); border-radius: 12px;">
                            <h4 style="color: var(--accent-silver); margin-bottom: 1rem;"><i class="fas fa-balance-scale"></i> Benchmark Comparison</h4>
                            <div id="benchmark-content">
                                <!-- Benchmark comparison will be populated here -->
                            </div>
                        </div>
                    </div>

                    <!-- Asset Allocation Analysis -->
                    <div class="card" id="allocation-analysis" style="margin-top: 2rem; display: none;">
                        <div class="card-header">
                            <h3 class="card-title">Asset Allocation Analysis</h3>
                            <p class="card-subtitle">Current allocation vs recommended allocation</p>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr 400px; gap: 2rem; align-items: start;">
                            <div>
                                <h4 style="color: var(--accent-white); margin-bottom: 1rem;">Current Allocation</h4>
                                <div id="current-allocation-breakdown">
                                    <!-- Current allocation will be populated by JavaScript -->
                                </div>
                            </div>
                            
                            <div>
                                <h4 style="color: var(--accent-gold); margin-bottom: 1rem;">Recommended Allocation</h4>
                                <div id="recommended-allocation-breakdown">
                                    <!-- Recommended allocation will be populated by JavaScript -->
                                </div>
                            </div>
                            
                            <div style="text-align: center;">
                                <canvas id="portfolioAllocationChart" width="350" height="350"></canvas>
                            </div>
                        </div>
                        
                        <div id="allocation-insights" style="margin-top: 2rem;">
                            <!-- Allocation insights will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Portfolio Health Check -->
                    <div class="card" id="portfolio-health" style="margin-top: 2rem; display: none;">
                        <div class="card-header">
                            <h3 class="card-title">Portfolio Health Check</h3>
                            <p class="card-subtitle">Comprehensive portfolio analysis and recommendations</p>
                        </div>
                        
                        <div id="health-metrics" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                            <!-- Health metrics will be populated by JavaScript -->
                        </div>
                        
                        <div id="portfolio-recommendations" style="margin-top: 2rem;">
                            <!-- Portfolio recommendations will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Performance Chart -->
                    <div class="card" id="performance-chart" style="margin-top: 2rem; display: none;">
                        <div class="card-header">
                            <h3 class="card-title">Performance Tracking</h3>
                            <p class="card-subtitle">Portfolio growth visualization and projections</p>
                            
                            <!-- Chart Time Period Controls -->
                            <div style="display: flex; gap: 0.5rem; margin-top: 1rem; justify-content: center;">
                                <button type="button" class="chart-period-btn active" data-period="yearly" onclick="selectChartPeriod('yearly')">Yearly View</button>
                                <button type="button" class="chart-period-btn" data-period="quarterly" onclick="selectChartPeriod('quarterly')">Quarterly View</button>
                                <button type="button" class="chart-period-btn" data-period="monthly" onclick="selectChartPeriod('monthly')">Monthly View</button>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 2rem;">
                            <canvas id="portfolioPerformanceChart" width="800" height="400"></canvas>
                        </div>
                        
                        <div id="performance-insights">
                            <!-- Performance insights will be populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Portfolio Rebalancing -->
                    <div class="card" id="rebalancing-card" style="margin-top: 2rem;">
                        <div class="card-header">
                            <h3 class="card-title">Portfolio Rebalancing</h3>
                            <p class="card-subtitle">Rebalance your portfolio according to Investment Recommendations</p>
                        </div>
                        
                        <div style="background: rgba(255,215,0,0.05); border: 1px solid var(--accent-gold); border-radius: 8px; padding: 1rem; margin-bottom: 2rem;">
                            <h5 style="color: var(--accent-gold); margin-bottom: 0.5rem;">Smart Rebalancing</h5>
                            <p style="color: var(--text-gray); margin: 0;">Uses your current portfolio holdings (from above) and compares with your recommended allocation from Investment Recommendations to suggest buy/sell actions.</p>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                            <div>
                                <h4 style="color: var(--accent-white); margin-bottom: 1rem;">Current vs Target Allocation</h4>
                                <div id="rebalancing-comparison" style="display: none;">
                                    <!-- Will show current vs recommended allocation -->
                                </div>
                                <button class="btn btn-primary" onclick="calculateSmartRebalancing()" style="margin-top: 1rem;">
                                    Calculate Rebalancing Actions
                                </button>
                            </div>
                            
                            <div>
                                <h4 style="color: var(--accent-gold); margin-bottom: 1rem;">Rebalancing Actions</h4>
                                <div id="rebalancing-results">
                                    <div style="text-align: center; color: var(--text-gray); padding: 2rem;">
                                        Click "Calculate Rebalancing Actions" to see what adjustments are needed.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="recommendations" class="section">
                    <div class="section-header">
                        <h1 class="section-title">Investment Recommendations</h1>
                        <p class="section-subtitle">Personalized investment strategies based on your risk profile and financial goals</p>
                    </div>

                    <!-- Risk Profile Summary -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Your Investment Profile</h3>
                            <p class="card-subtitle">Current risk assessment and investment preferences</p>
                        </div>
                        <div id="profile-summary">
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                                <div style="background: linear-gradient(135deg, #1a1a1a, #2a2a2a); border: 2px solid var(--accent-gold); border-radius: 12px; padding: 1.5rem; text-align: center;">
                                    <div style="font-size: 0.9rem; color: var(--text-gray); margin-bottom: 0.5rem;">Risk Profile</div>
                                    <div style="font-size: 1.4rem; font-weight: bold; color: var(--accent-gold);">Moderate</div>
                                </div>
                                <div style="background: linear-gradient(135deg, #1a1a1a, #2a2a2a); border: 2px solid var(--accent-white); border-radius: 12px; padding: 1.5rem; text-align: center;">
                                    <div style="font-size: 0.9rem; color: var(--text-gray); margin-bottom: 0.5rem;">Risk Score</div>
                                    <div style="font-size: 1.4rem; font-weight: bold; color: var(--accent-white);">60%</div>
                                </div>
                                <div style="background: linear-gradient(135deg, #1a1a1a, #2a2a2a); border: 2px solid var(--accent-silver); border-radius: 12px; padding: 1.5rem; text-align: center;">
                                    <div style="font-size: 0.9rem; color: var(--text-gray); margin-bottom: 0.5rem;">Investment Horizon</div>
                                    <div style="font-size: 1.4rem; font-weight: bold; color: var(--accent-silver);">Long Term</div>
                                </div>
                            </div>
                            <div style="margin-top: 1.5rem; padding: 1rem; background: rgba(255,215,0,0.05); border-left: 4px solid var(--accent-gold); border-radius: 4px;">
                                <h5 style="color: var(--accent-gold); margin-bottom: 0.5rem;">Profile Summary</h5>
                                <p style="color: var(--text-gray); line-height: 1.6; margin: 0;">Balanced investor seeking growth with moderate risk tolerance. Suitable for diversified portfolio with equity focus and debt stability.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Asset Allocation -->
                    <div class="card" id="asset-allocation-card" style="margin-top: 2rem;">
                        <div class="card-header">
                            <h3 class="card-title">Recommended Asset Allocation</h3>
                            <p class="card-subtitle">Optimal portfolio distribution based on your risk profile</p>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 400px; gap: 2rem; align-items: start;">
                            <div>
                                <div id="allocation-breakdown" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                                    <div style="background: linear-gradient(135deg, rgba(255,215,0,0.1), rgba(255,215,0,0.05)); border: 2px solid var(--accent-gold); border-radius: 12px; padding: 1.5rem; text-align: center;">
                                        <div style="font-size: 0.9rem; color: var(--accent-gold); margin-bottom: 0.5rem;">EQUITY</div>
                                        <div style="font-size: 2rem; font-weight: bold; color: var(--accent-gold);">50%</div>
                                        <div style="font-size: 0.8rem; color: var(--text-gray);">Growth focused</div>
                                    </div>
                                    <div style="background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05)); border: 2px solid var(--accent-white); border-radius: 12px; padding: 1.5rem; text-align: center;">
                                        <div style="font-size: 0.9rem; color: var(--accent-white); margin-bottom: 0.5rem;">DEBT</div>
                                        <div style="font-size: 2rem; font-weight: bold; color: var(--accent-white);">35%</div>
                                        <div style="font-size: 0.8rem; color: var(--text-gray);">Stability focused</div>
                                    </div>
                                    <div style="background: linear-gradient(135deg, rgba(192,192,192,0.1), rgba(192,192,192,0.05)); border: 2px solid var(--accent-silver); border-radius: 12px; padding: 1.5rem; text-align: center;">
                                        <div style="font-size: 0.9rem; color: var(--accent-silver); margin-bottom: 0.5rem;">GOLD</div>
                                        <div style="font-size: 2rem; font-weight: bold; color: var(--accent-silver);">10%</div>
                                        <div style="font-size: 0.8rem; color: var(--text-gray);">Hedge against inflation</div>
                                    </div>
                                    <div style="background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(0,0,0,0.3)); border: 2px solid var(--text-gray); border-radius: 12px; padding: 1.5rem; text-align: center;">
                                        <div style="font-size: 0.9rem; color: var(--text-gray); margin-bottom: 0.5rem;">CASH</div>
                                        <div style="font-size: 2rem; font-weight: bold; color: var(--text-gray);">5%</div>
                                        <div style="font-size: 0.8rem; color: var(--text-gray);">Emergency fund</div>
                                    </div>
                                </div>
                                
                                <div id="allocation-details" style="background: linear-gradient(135deg, rgba(255,255,255,0.02), rgba(0,0,0,0.3)); border-radius: 12px; padding: 1.5rem;">
                                    <h5 style="color: var(--accent-white); margin-bottom: 1rem;">Allocation Strategy</h5>
                                    <div style="display: grid; gap: 1rem;">
                                        <div style="display: flex; justify-content: space-between; padding: 0.8rem; background: rgba(255,215,0,0.05); border-radius: 8px;">
                                            <span style="color: var(--text-gray);">Expected Return</span>
                                            <span style="color: var(--accent-gold); font-weight: bold;">10-12%</span>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; padding: 0.8rem; background: rgba(255,255,255,0.02); border-radius: 8px;">
                                            <span style="color: var(--text-gray);">Risk Level</span>
                                            <span style="color: var(--accent-white); font-weight: bold;">Medium</span>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; padding: 0.8rem; background: rgba(192,192,192,0.05); border-radius: 8px;">
                                            <span style="color: var(--text-gray);">Time Horizon</span>
                                            <span style="color: var(--accent-silver); font-weight: bold;">5+ Years</span>
                                        </div>
                                        <div style="display: flex; justify-content: space-between; padding: 0.8rem; background: rgba(255,255,255,0.02); border-radius: 8px;">
                                            <span style="color: var(--text-gray);">Review Frequency</span>
                                            <span style="color: var(--text-gray); font-weight: bold;">Quarterly</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="text-align: center;">
                                <canvas id="allocationChart" width="350" height="350"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Fund Recommendations -->
                    <div class="card" id="fund-recommendations-card" style="margin-top: 2rem;">
                        <div class="card-header">
                            <h3 class="card-title">Recommended Investment Options</h3>
                            <p class="card-subtitle">Curated funds and investment products matching your profile</p>
                        </div>
                        
                        <div class="form-group" style="margin-bottom: 2rem;">
                            <label>Investment Amount (₹)</label>
                            <input type="number" id="investment-amount" class="form-input" placeholder="Enter amount to invest" value="100000">
                        </div>
                        
                        <div id="fund-categories">
                            <div style="margin-bottom: 2rem;">
                                <h4 style="color: var(--accent-gold); margin-bottom: 1rem;">Large Cap Funds (50% allocation)</h4>
                                <div style="display: grid; gap: 1rem;">
                                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 1rem; align-items: center; padding: 1rem; background: rgba(255,255,255,0.02); border-radius: 8px; border-left: 4px solid var(--accent-gold);">
                                        <div>
                                            <div style="color: var(--accent-white); font-weight: bold; margin-bottom: 0.2rem;">Axis Bluechip Fund</div>
                                            <div style="color: var(--text-gray); font-size: 0.9rem;">Large Cap</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="color: var(--accent-gold); font-weight: bold;">12-15%</div>
                                            <div style="color: var(--text-gray); font-size: 0.8rem;">Expected Return</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="color: #ffc107; font-weight: bold;">Medium</div>
                                            <div style="color: var(--text-gray); font-size: 0.8rem;">Risk Level</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <button class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.8rem;">View Details</button>
                                        </div>
                                    </div>
                                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 1rem; align-items: center; padding: 1rem; background: rgba(255,255,255,0.02); border-radius: 8px; border-left: 4px solid var(--accent-gold);">
                                        <div>
                                            <div style="color: var(--accent-white); font-weight: bold; margin-bottom: 0.2rem;">Mirae Asset Large Cap Fund</div>
                                            <div style="color: var(--text-gray); font-size: 0.9rem;">Large Cap</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="color: var(--accent-gold); font-weight: bold;">12-15%</div>
                                            <div style="color: var(--text-gray); font-size: 0.8rem;">Expected Return</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="color: #ffc107; font-weight: bold;">Medium</div>
                                            <div style="color: var(--text-gray); font-size: 0.8rem;">Risk Level</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <button class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.8rem;">View Details</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 2rem;">
                                <h4 style="color: var(--accent-white); margin-bottom: 1rem;">Debt Funds (35% allocation)</h4>
                                <div style="display: grid; gap: 1rem;">
                                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 1rem; align-items: center; padding: 1rem; background: rgba(255,255,255,0.02); border-radius: 8px; border-left: 4px solid var(--accent-white);">
                                        <div>
                                            <div style="color: var(--accent-white); font-weight: bold; margin-bottom: 0.2rem;">Axis Strategic Bond Fund</div>
                                            <div style="color: var(--text-gray); font-size: 0.9rem;">Debt</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="color: var(--accent-white); font-weight: bold;">7-9%</div>
                                            <div style="color: var(--text-gray); font-size: 0.8rem;">Expected Return</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="color: #17a2b8; font-weight: bold;">Low</div>
                                            <div style="color: var(--text-gray); font-size: 0.8rem;">Risk Level</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <button class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.8rem;">View Details</button>
                                        </div>
                                    </div>
                                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 1rem; align-items: center; padding: 1rem; background: rgba(255,255,255,0.02); border-radius: 8px; border-left: 4px solid var(--accent-white);">
                                        <div>
                                            <div style="color: var(--accent-white); font-weight: bold; margin-bottom: 0.2rem;">Kotak Dynamic Bond Fund</div>
                                            <div style="color: var(--text-gray); font-size: 0.9rem;">Debt</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="color: var(--accent-white); font-weight: bold;">7-9%</div>
                                            <div style="color: var(--text-gray); font-size: 0.8rem;">Expected Return</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="color: #17a2b8; font-weight: bold;">Low</div>
                                            <div style="color: var(--text-gray); font-size: 0.8rem;">Risk Level</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <button class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.8rem;">View Details</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 2rem;">
                                <h4 style="color: var(--accent-silver); margin-bottom: 1rem;">Gold Investments (10% allocation)</h4>
                                <div style="display: grid; gap: 1rem;">
                                    <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 1rem; align-items: center; padding: 1rem; background: rgba(255,255,255,0.02); border-radius: 8px; border-left: 4px solid var(--accent-silver);">
                                        <div>
                                            <div style="color: var(--accent-white); font-weight: bold; margin-bottom: 0.2rem;">SBI Gold ETF</div>
                                            <div style="color: var(--text-gray); font-size: 0.9rem;">Gold ETF</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="color: var(--accent-silver); font-weight: bold;">8-12%</div>
                                            <div style="color: var(--text-gray); font-size: 0.8rem;">Expected Return</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="color: #ffc107; font-weight: bold;">Medium</div>
                                            <div style="color: var(--text-gray); font-size: 0.8rem;">Risk Level</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <button class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.8rem;">View Details</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <button class="btn btn-primary" onclick="generateRecommendations()" style="margin-top: 1rem;">
                            Generate Detailed Recommendations
                        </button>
                        
                        <!-- Generated Recommendations Display -->
                        <div id="generated-recommendations" style="display: none; margin-top: 2rem; padding: 2rem; background: linear-gradient(135deg, rgba(255,255,255,0.02), rgba(0,0,0,0.3)); border-radius: 12px; border: 1px solid var(--accent-gold);">
                            <h4 style="color: var(--accent-gold); margin-bottom: 1.5rem; text-align: center;">
                                <i class="fas fa-chart-pie"></i> Your Personalized Investment Recommendations
                            </h4>
                            <div id="recommendation-content">
                                <!-- Dynamic content will be inserted here -->
                            </div>
                        </div>
                    </div>


                    <!-- Investment Strategy -->
                    <div class="card" id="strategy-card" style="margin-top: 2rem;">
                        <div class="card-header">
                            <h3 class="card-title">Investment Strategy & Insights</h3>
                            <p class="card-subtitle">Professional insights and market outlook for your portfolio</p>
                        </div>
                        
                        <div id="strategy-content">
                            <div style="background: linear-gradient(135deg, rgba(255,215,0,0.05), rgba(0,0,0,0.3)); border-radius: 12px; padding: 2rem;">
                                <h4 style="color: var(--accent-gold); margin-bottom: 1.5rem; text-align: center;">Balanced Growth Strategy</h4>
                                
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                                    <div style="background: rgba(255,255,255,0.02); border-radius: 8px; padding: 1.5rem;">
                                        <h5 style="color: var(--accent-white); margin-bottom: 1rem;">Strategy Focus</h5>
                                        <p style="color: var(--text-gray); line-height: 1.6;">Balance between growth and stability</p>
                                    </div>
                                    <div style="background: rgba(255,255,255,0.02); border-radius: 8px; padding: 1.5rem;">
                                        <h5 style="color: var(--accent-white); margin-bottom: 1rem;">Investment Approach</h5>
                                        <p style="color: var(--text-gray); line-height: 1.6;">Diversified allocation across asset classes</p>
                                    </div>
                                    <div style="background: rgba(255,255,255,0.02); border-radius: 8px; padding: 1.5rem;">
                                        <h5 style="color: var(--accent-white); margin-bottom: 1rem;">Time Horizon</h5>
                                        <p style="color: var(--accent-gold); font-size: 1.2rem; font-weight: bold;">5-10 years</p>
                                    </div>
                                </div>
                                
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                                    <div>
                                        <h5 style="color: var(--accent-silver); margin-bottom: 1rem;">Key Principles</h5>
                                        <ul style="color: var(--text-gray); line-height: 1.8; padding-left: 1.5rem;">
                                            <li>Balanced risk-return</li>
                                            <li>Diversification</li>
                                            <li>Regular reviews</li>
                                            <li>Goal-based investing</li>
                                        </ul>
                                    </div>
                                    <div>
                                        <h5 style="color: var(--accent-silver); margin-bottom: 1rem;">Action Items</h5>
                                        <ul style="color: var(--text-gray); line-height: 1.8; padding-left: 1.5rem;">
                                            <li>SIP in diversified equity funds</li>
                                            <li>Debt fund allocation</li>
                                            <li>Annual rebalancing</li>
                                            <li>Tax-efficient investing</li>
                                        </ul>
                                    </div>
                                </div>
                                
                                <div style="margin-top: 2rem; padding: 1.5rem; background: rgba(255,215,0,0.05); border-left: 4px solid var(--accent-gold); border-radius: 4px;">
                                    <h5 style="color: var(--accent-gold); margin-bottom: 0.5rem;">Market Outlook</h5>
                                    <p style="color: var(--text-gray); line-height: 1.6; margin: 0;">Mix of growth and value opportunities across market caps with focus on quality stocks and stable debt instruments.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="retirement" class="section">
                    <div class="section-header">
                        <h1 class="section-title">Retirement Planning</h1>
                        <p class="section-subtitle">Plan for your retirement goals</p>
                    </div>
                    <div class="card">
                        <h3>Retirement Calculator</h3>
                        <p>Calculate how much you need to save for a comfortable retirement.</p>
                        <button class="btn btn-primary">
                            <i class="fas fa-umbrella"></i> Plan Retirement
                        </button>
                    </div>
                </section>

                <section id="comparison" class="section">
                    <div class="section-header">
                        <h1 class="section-title">Product Comparison</h1>
                        <p class="section-subtitle">Compare different financial products</p>
                    </div>
                    <div class="card">
                        <h3>Financial Product Comparison</h3>
                        <p>Compare mutual funds, insurance products, and investment options.</p>
                        <button class="btn btn-primary">
                            <i class="fas fa-balance-scale"></i> Compare Products
                        </button>
                    </div>
                </section>

                <section id="analytics" class="section">
                    <div class="section-header">
                        <h1 class="section-title">Analytics Dashboard</h1>
                        <p class="section-subtitle">Advanced financial analytics and insights</p>
                    </div>
                    <div class="card">
                        <h3>Financial Analytics</h3>
                        <p>View detailed analytics and insights about your financial health.</p>
                        <button class="btn btn-primary">
                            <i class="fas fa-chart-bar"></i> View Analytics
                        </button>
                    </div>
                </section>

                <section id="summary" class="section">
                    <div class="section-header">
                        <h1 class="section-title">Executive Summary</h1>
                        <p class="section-subtitle">Comprehensive financial summary and recommendations</p>
                    </div>
                    <div class="card">
                        <h3>Financial Summary</h3>
                        <p>Get an executive summary of your complete financial picture.</p>
                        <button class="btn btn-primary">
                            <i class="fas fa-clipboard-list"></i> Generate Summary
                        </button>
                    </div>
                </section>

                <section id="alerts" class="section">
                    <div class="section-header">
                        <h1 class="section-title">Smart Alerts</h1>
                        <p class="section-subtitle">Financial alerts and notifications</p>
                    </div>
                    <div class="card">
                        <h3>Financial Alerts</h3>
                        <p>Set up smart alerts for your financial goals and milestones.</p>
                        <button class="btn btn-primary">
                            <i class="fas fa-bell"></i> Setup Alerts
                        </button>
                    </div>
                </section>

                <section id="loan-calculator" class="section">
                    <div class="section-header">
                        <h1 class="section-title">Loan Calculator</h1>
                        <p class="section-subtitle">Advanced loan calculations and analysis</p>
                    </div>
                    <div class="card">
                        <h3>Comprehensive Loan Calculator</h3>
                        <p>Calculate loan EMIs, prepayment benefits, and loan comparisons.</p>
                        <button class="btn btn-primary">
                            <i class="fas fa-home"></i> Calculate Loans
                        </button>
                    </div>
                </section>

                <section id="budget-planner" class="section">
                    <div class="section-header">
                        <h1 class="section-title">Budget Planner</h1>
                        <p class="section-subtitle">Plan and track your monthly budget</p>
                    </div>
                    <div class="card">
                        <h3>Monthly Budget Planner</h3>
                        <p>Create and track your monthly budget across different categories.</p>
                        <button class="btn btn-primary">
                            <i class="fas fa-chart-pie"></i> Plan Budget
                        </button>
                    </div>
                </section>

                <section id="investment-tracker" class="section">
                    <div class="section-header">
                        <h1 class="section-title">Investment Tracker</h1>
                        <p class="section-subtitle">Track all your investments in one place</p>
                    </div>
                    <div class="card">
                        <h3>Investment Portfolio Tracker</h3>
                        <p>Track and monitor all your investments and their performance.</p>
                        <button class="btn btn-primary">
                            <i class="fas fa-trending-up"></i> Track Investments
                        </button>
                    </div>
                </section>

                <section id="financial-calendar" class="section">
                    <div class="section-header">
                        <h1 class="section-title">Financial Calendar</h1>
                        <p class="section-subtitle">Important financial dates and reminders</p>
                    </div>
                    <div class="card">
                        <h3>Financial Calendar & Reminders</h3>
                        <p>Keep track of important financial dates, tax deadlines, and investment schedules.</p>
                        <button class="btn btn-primary">
                            <i class="fas fa-calendar-alt"></i> View Calendar
                        </button>
                    </div>
                </section>

                
            </div>
        </main>
    </div>

    <script>
        // Core variables
        let clientData = {
            profileInfo: {},
            basicInfo: {},
            financialStatus: {},
            riskProfile: {},
            goals: {},
            calculations: {}
        };
        let currentProfileId = null;

        // Sidebar toggle function
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.querySelector('.main-content');
            sidebar.classList.toggle('collapsed');
        }

        // Navigation functions
        function showSection(sectionId) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            // Show target section
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
                
                // Update breadcrumb
                const title = targetSection.querySelector('.section-title')?.textContent || sectionId;
                document.getElementById('current-section-title').textContent = title;
                
                // Update active nav link
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                });
                
                // Find and activate the corresponding nav link
                const navLinks = document.querySelectorAll('.nav-link, .nav-sublink');
                navLinks.forEach(link => {
                    if (link.getAttribute('onclick')?.includes(`'${sectionId}'`)) {
                        if (link.classList.contains('nav-link')) {
                            link.classList.add('active');
                        } else {
                            // For sublinks, activate the parent
                            const parentNav = link.closest('.nav-item').querySelector('.nav-link');
                            if (parentNav) parentNav.classList.add('active');
                        }
                    }
                });
            }
        }

        function toggleNavItem(element) {
            const submenu = element.parentElement.querySelector('.nav-submenu');
            const arrow = element.querySelector('.nav-arrow');
            
            if (submenu) {
                submenu.classList.toggle('active');
                arrow.style.transform = submenu.classList.contains('active') ? 'rotate(90deg)' : 'rotate(0deg)';
            }
        }

        // Advanced SIP Calculator Functions
        let sipChart = null;
        
        function selectFrequency(frequency) {
            // Update hidden input
            document.getElementById('sip-frequency').value = frequency;
            
            // Update button states
            document.querySelectorAll('.frequency-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-frequency="${frequency}"]`).classList.add('active');
            
            // Update labels and placeholders
            const label = document.getElementById('sip-amount-label');
            const input = document.getElementById('sip-amount');
            const info = document.getElementById('sip-frequency-info');
            
            switch(frequency) {
                case 'monthly':
                    label.textContent = 'Monthly Investment Amount (₹)';
                    input.placeholder = 'Enter your monthly SIP amount';
                    input.value = '5000';
                    info.textContent = 'You invest this amount every month (12 times per year)';
                    break;
                case 'quarterly':
                    label.textContent = 'Quarterly Investment Amount (₹)';
                    input.placeholder = 'Enter your quarterly SIP amount';
                    input.value = '15000';
                    info.textContent = 'You invest this amount every quarter (4 times per year)';
                    break;
                case 'semi-annually':
                    label.textContent = 'Semi-Annual Investment Amount (₹)';
                    input.placeholder = 'Enter your semi-annual SIP amount';
                    input.value = '30000';
                    info.textContent = 'You invest this amount every 6 months (2 times per year)';
                    break;
                case 'annually':
                    label.textContent = 'Annual Investment Amount (₹)';
                    input.placeholder = 'Enter your annual SIP amount';
                    input.value = '60000';
                    info.textContent = 'You invest this amount once per year';
                    break;
            }
        }

        // Show/hide lumpsum inputs based on calculation type
        document.addEventListener('DOMContentLoaded', function() {
            const calcType = document.getElementById('calc-type');
            if (calcType) {
                calcType.addEventListener('change', function() {
                    const lumpsumInputs = document.getElementById('lumpsum-inputs');
                    if (this.value === 'lumpsum') {
                        lumpsumInputs.style.display = 'block';
                    } else {
                        lumpsumInputs.style.display = 'none';
                    }
                });
            }
            
            // Load saved goals
            const savedGoals = localStorage.getItem('userGoals');
            if (savedGoals) {
                userGoals = JSON.parse(savedGoals);
                displayGoals();
            }
            
            // Load investment recommendations if risk profile exists
            loadInvestmentRecommendations();
        });

        function calculateAdvancedSIP() {
            try {
                const amount = parseFloat(document.getElementById('sip-amount').value) || 0;
                const period = parseFloat(document.getElementById('sip-period').value) || 0;
                const rate = parseFloat(document.getElementById('sip-return').value) || 0;
                const inflationRate = parseFloat(document.getElementById('inflation-rate').value) || 0;
                const sipIncrease = parseFloat(document.getElementById('sip-increase').value) || 0;
                const calcType = document.getElementById('calc-type').value;
                const lumpsumAmount = parseFloat(document.getElementById('lumpsum-amount').value) || 0;
                const frequency = document.getElementById('sip-frequency').value;

                if (!amount || !period || !rate) {
                    alert('Please fill all required SIP calculation fields');
                    return;
                }

                console.log('SIP Calculation Input:', { amount, period, rate, inflationRate, sipIncrease, calcType, lumpsumAmount, frequency });

                const calculations = performAdvancedSIPCalculation(amount, period, rate, inflationRate, sipIncrease, calcType, lumpsumAmount, frequency);
                
                console.log('SIP Calculation Result:', calculations);
                
                displaySIPResults(calculations);
                createSIPChart(calculations.yearlyData);
                createYearlyBreakdown(calculations.yearlyData);
                generateInvestmentInsights(calculations);
                generateStrategyInsights(calculations, calcType, amount, period, sipIncrease, lumpsumAmount);
                
            } catch (error) {
                console.error('Error in SIP calculation:', error);
                alert('An error occurred during SIP calculation. Please check your inputs and try again.');
            }
        }

        function performAdvancedSIPCalculation(sipAmount, years, annualRate, inflationRate, stepUpRate, calcType, lumpsumAmount, frequency) {
            // Define frequency parameters - compounding matches investment frequency
            // Monthly: 12 investments, 12 compounding periods
            // Quarterly: 4 investments, 4 compounding periods  
            // Semi-annual: 2 investments, 2 compounding periods
            // Annual: 1 investment, 1 compounding period
            const frequencyData = {
                'monthly': { installmentsPerYear: 12, compoundingPerYear: 12 },
                'quarterly': { installmentsPerYear: 4, compoundingPerYear: 4 },
                'semi-annually': { installmentsPerYear: 2, compoundingPerYear: 2 },
                'annually': { installmentsPerYear: 1, compoundingPerYear: 1 }
            };
            
            const { installmentsPerYear, compoundingPerYear } = frequencyData[frequency];
            
            // Calculate rates based on CAGR compounding frequency
            // For quarterly: (1.12)^(1/4) - 1 = 2.874% per quarter
            // For annual: (1.12)^(1/1) - 1 = 12% per year
            const periodRate = Math.pow(1 + annualRate / 100, 1 / compoundingPerYear) - 1;
            const inflationPeriodRate = Math.pow(1 + inflationRate / 100, 1 / compoundingPerYear) - 1;
            
            let totalInvestment = 0;
            let nominalValue = 0;
            let currentSIPAmount = sipAmount;
            
            const yearlyData = [];
            const totalPeriods = years * compoundingPerYear;
            
            for (let year = 1; year <= years; year++) {
                let yearInvestment = 0;
                let yearStartValue = nominalValue;
                
                // Add lumpsum in first year
                if (year === 1 && calcType === 'lumpsum' && lumpsumAmount > 0) {
                    nominalValue += lumpsumAmount;
                    totalInvestment += lumpsumAmount;
                    yearInvestment += lumpsumAmount;
                }
                
                // Adjust SIP amount for step-up at the beginning of each year (except first year)
                if (calcType === 'step-up' && year > 1) {
                    currentSIPAmount = currentSIPAmount * (1 + stepUpRate / 100);
                }
                
                // Calculate compounding and SIP investments for each period in the year
                for (let period = 1; period <= compoundingPerYear; period++) {
                    // Compound the existing amount
                    nominalValue = nominalValue * (1 + periodRate);
                    
                    // Add SIP investment at the end of each period
                    nominalValue += currentSIPAmount;
                    yearInvestment += currentSIPAmount;
                    totalInvestment += currentSIPAmount;
                }
                
                // Calculate real value (inflation adjusted)
                const realValue = nominalValue / Math.pow(1 + inflationRate / 100, year);
                
                yearlyData.push({
                    year: year,
                    investment: Math.round(yearInvestment),
                    cumulativeInvestment: Math.round(totalInvestment),
                    nominalValue: Math.round(nominalValue),
                    realValue: Math.round(realValue),
                    sipAmount: Math.round(currentSIPAmount)
                });
            }
            
            const finalNominalValue = nominalValue;
            const finalRealValue = finalNominalValue / Math.pow(1 + inflationRate / 100, years);
            const totalReturns = finalNominalValue - totalInvestment;
            
            return {
                totalInvestment: Math.round(totalInvestment),
                nominalValue: Math.round(finalNominalValue),
                realValue: Math.round(finalRealValue),
                totalReturns: Math.round(totalReturns),
                yearlyData: yearlyData
            };
        }

        function displaySIPResults(calculations) {
            document.getElementById('total-investment').textContent = `₹${calculations.totalInvestment.toLocaleString('en-IN')}`;
            document.getElementById('nominal-value').textContent = `₹${calculations.nominalValue.toLocaleString('en-IN')}`;
            document.getElementById('real-value').textContent = `₹${calculations.realValue.toLocaleString('en-IN')}`;
            document.getElementById('total-returns').textContent = `₹${calculations.totalReturns.toLocaleString('en-IN')}`;
            
            document.getElementById('sip-results').style.display = 'block';
            
            // Animate the result cards
            const resultCards = document.querySelectorAll('.result-card');
            resultCards.forEach((card, index) => {
                setTimeout(() => {
                    card.style.transform = 'scale(1.05)';
                    setTimeout(() => {
                        card.style.transform = 'scale(1)';
                    }, 200);
                }, index * 100);
            });
        }

        function createSIPChart(yearlyData) {
            const ctx = document.getElementById('sipChart').getContext('2d');
            
            // Destroy existing chart if it exists
            if (sipChart) {
                sipChart.destroy();
            }
            
            const years = yearlyData.map(data => `Year ${data.year}`);
            const investments = yearlyData.map(data => data.cumulativeInvestment);
            const nominalValues = yearlyData.map(data => data.nominalValue);
            const realValues = yearlyData.map(data => data.realValue);
            
            // Calculate gradient fills
            const gradientNominal = ctx.createLinearGradient(0, 0, 0, 400);
            gradientNominal.addColorStop(0, 'rgba(255, 255, 255, 0.2)');
            gradientNominal.addColorStop(1, 'rgba(255, 255, 255, 0.02)');
            
            const gradientReal = ctx.createLinearGradient(0, 0, 0, 400);
            gradientReal.addColorStop(0, 'rgba(255, 215, 0, 0.3)');
            gradientReal.addColorStop(1, 'rgba(255, 215, 0, 0.05)');
            
            const gradientInvestment = ctx.createLinearGradient(0, 0, 0, 400);
            gradientInvestment.addColorStop(0, 'rgba(192, 192, 192, 0.2)');
            gradientInvestment.addColorStop(1, 'rgba(192, 192, 192, 0.05)');
            
            sipChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [
                        {
                            label: 'Total Investment',
                            data: investments,
                            borderColor: '#c0c0c0',
                            backgroundColor: gradientInvestment,
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#c0c0c0',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 4,
                            pointHoverRadius: 8
                        },
                        {
                            label: 'Portfolio Value (at Expected CAGR)',
                            data: nominalValues,
                            borderColor: '#ffffff',
                            backgroundColor: gradientNominal,
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#ffffff',
                            pointBorderColor: '#000000',
                            pointBorderWidth: 2,
                            pointRadius: 5,
                            pointHoverRadius: 10
                        },
                        {
                            label: 'Real Value (Inflation Adjusted)',
                            data: realValues,
                            borderColor: '#ffd700',
                            backgroundColor: gradientReal,
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointBackgroundColor: '#ffd700',
                            pointBorderColor: '#ffffff',
                            pointBorderWidth: 2,
                            pointRadius: 5,
                            pointHoverRadius: 10
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                color: '#ffffff',
                                font: {
                                    size: 13,
                                    weight: '500'
                                },
                                padding: 20,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.9)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#ffd700',
                            borderWidth: 1,
                            cornerRadius: 8,
                            displayColors: true,
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ₹' + context.parsed.y.toLocaleString('en-IN');
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: '#aaaaaa',
                                font: {
                                    size: 11
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.08)',
                                lineWidth: 1
                            }
                        },
                        y: {
                            ticks: {
                                color: '#aaaaaa',
                                font: {
                                    size: 11
                                },
                                callback: function(value) {
                                    if (value >= 10000000) {
                                        return '₹' + (value / 10000000).toFixed(1) + 'Cr';
                                    } else if (value >= 100000) {
                                        return '₹' + (value / 100000).toFixed(1) + 'L';
                                    } else {
                                        return '₹' + (value / 1000).toFixed(0) + 'K';
                                    }
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.08)',
                                lineWidth: 1
                            }
                        }
                    },
                    elements: {
                        point: {
                            radius: 4,
                            hoverRadius: 8,
                            borderWidth: 2
                        },
                        line: {
                            borderCapStyle: 'round',
                            borderJoinStyle: 'round'
                        }
                    }
                }
            });
        }

        function createYearlyBreakdown(yearlyData) {
            const tbody = document.getElementById('breakdown-body');
            tbody.innerHTML = '';
            
            yearlyData.forEach((data, index) => {
                const row = document.createElement('tr');
                row.style.borderBottom = '1px solid var(--border-gray)';
                row.style.transition = 'all 0.3s ease';
                row.style.background = index % 2 === 0 ? 'rgba(255,255,255,0.02)' : 'transparent';
                
                // Add hover effect
                row.addEventListener('mouseenter', function() {
                    this.style.background = 'rgba(255,255,255,0.05)';
                    this.style.transform = 'scale(1.01)';
                });
                row.addEventListener('mouseleave', function() {
                    this.style.background = index % 2 === 0 ? 'rgba(255,255,255,0.02)' : 'transparent';
                    this.style.transform = 'scale(1)';
                });
                
                row.innerHTML = `
                    <td style="padding: 1rem 0.8rem; color: var(--text-white); font-weight: 500;">Year ${data.year}</td>
                    <td style="padding: 1rem 0.8rem; text-align: right; color: var(--accent-silver); font-weight: 500;">₹${data.investment.toLocaleString('en-IN')}</td>
                    <td style="padding: 1rem 0.8rem; text-align: right; color: var(--accent-white); font-weight: 600;">₹${data.nominalValue.toLocaleString('en-IN')}</td>
                    <td style="padding: 1rem 0.8rem; text-align: right; color: var(--accent-gold); font-weight: 600;">₹${data.realValue.toLocaleString('en-IN')}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function generateInvestmentInsights(calculations) {
            const insights = document.getElementById('insights-content');
            const annualRate = parseFloat(document.getElementById('sip-return').value) || 0;
            const inflationRate = parseFloat(document.getElementById('inflation-rate').value) || 0;
            
            // Correct CAGR calculations
            const nominalCAGR = annualRate; // This is the expected annual return entered by user
            const realCAGR = ((1 + nominalCAGR/100) / (1 + inflationRate/100) - 1) * 100; // Real CAGR formula
            const inflationImpact = ((calculations.nominalValue - calculations.realValue) / calculations.nominalValue * 100).toFixed(1);
            
            insights.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                    <div style="padding: 1.5rem; background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02)); border: 1px solid var(--accent-silver); border-radius: 12px; box-shadow: var(--shadow-glow);">
                        <h5 style="color: var(--accent-white); margin-bottom: 0.8rem; text-transform: uppercase; letter-spacing: 1px; font-size: 0.9rem;">Expected Annual CAGR</h5>
                        <div style="font-size: 2rem; font-weight: bold; color: var(--accent-white); margin-bottom: 0.3rem;">${nominalCAGR.toFixed(2)}%</div>
                        <div style="font-size: 0.85rem; color: var(--text-gray);">Nominal CAGR (Pre-inflation)</div>
                    </div>
                    <div style="padding: 1.5rem; background: linear-gradient(135deg, rgba(255,215,0,0.15), rgba(255,215,0,0.05)); border: 1px solid var(--accent-gold); border-radius: 12px; box-shadow: 0 0 20px rgba(255,215,0,0.2);">
                        <h5 style="color: var(--accent-gold); margin-bottom: 0.8rem; text-transform: uppercase; letter-spacing: 1px; font-size: 0.9rem;">Real Annual Return</h5>
                        <div style="font-size: 2rem; font-weight: bold; color: var(--accent-gold); margin-bottom: 0.3rem;">${realCAGR.toFixed(2)}%</div>
                        <div style="font-size: 0.85rem; color: var(--text-gray);">After ${inflationRate}% inflation impact</div>
                    </div>
                    <div style="padding: 1.5rem; background: linear-gradient(135deg, rgba(192,192,192,0.1), rgba(192,192,192,0.05)); border: 1px solid var(--accent-silver); border-radius: 12px;">
                        <h5 style="color: var(--accent-silver); margin-bottom: 0.8rem; text-transform: uppercase; letter-spacing: 1px; font-size: 0.9rem;">Purchasing Power Loss</h5>
                        <div style="font-size: 2rem; font-weight: bold; color: var(--accent-silver); margin-bottom: 0.3rem;">${inflationImpact}%</div>
                        <div style="font-size: 0.85rem; color: var(--text-gray);">Due to inflation erosion</div>
                    </div>
                </div>
                <div style="margin-top: 2rem; padding: 1.5rem; background: linear-gradient(135deg, rgba(255,255,255,0.02), rgba(0,0,0,0.3)); border-left: 4px solid var(--accent-gold); border-radius: 8px; box-shadow: var(--shadow-light);">
                                         <h5 style="color: var(--accent-white); margin-bottom: 1rem; font-size: 1.1rem;">Investment Analysis:</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                                                 <ul style="color: var(--text-gray); line-height: 1.8; margin: 0; padding-left: 1.5rem; list-style-type: none;">
                             <li style="margin-bottom: 0.5rem;"><strong style="color: var(--accent-white);">Growth Multiple:</strong> ${(calculations.nominalValue / calculations.totalInvestment).toFixed(1)}x nominal growth</li>
                             <li style="margin-bottom: 0.5rem;"><strong style="color: var(--accent-gold);">Real Growth:</strong> ${(calculations.realValue / calculations.totalInvestment).toFixed(1)}x after inflation</li>
                             <li style="margin-bottom: 0.5rem;"><strong style="color: var(--accent-silver);">Inflation Cost:</strong> ₹${(calculations.nominalValue - calculations.realValue).toLocaleString('en-IN')} purchasing power loss</li>
                         </ul>
                        <div style="padding: 1rem; background: rgba(255,215,0,0.05); border-radius: 8px; border: 1px solid var(--accent-gold);">
                                                         <div style="font-size: 0.9rem; color: var(--accent-gold); font-weight: bold; margin-bottom: 0.5rem;">
                                 ${realCAGR > 5 ? 'EXCELLENT STRATEGY' : realCAGR > 2 ? 'GOOD STRATEGY' : 'REVIEW STRATEGY'}
                             </div>
                            <div style="font-size: 0.85rem; color: var(--text-gray);">
                                ${realCAGR > 5 ? 'Your real returns significantly beat inflation. This is a strong wealth-building strategy.' : 
                                  realCAGR > 2 ? 'Your returns are beating inflation, ensuring wealth preservation and growth.' : 
                                  'Your returns barely beat inflation. Consider higher-return investments or review your strategy.'}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateStrategyInsights(calculations, calcType, monthlyAmount, years, sipIncrease, lumpsumAmount) {
            const strategyInsights = document.getElementById('strategy-insights');
            const inflationRate = parseFloat(document.getElementById('inflation-rate').value) || 0;
            const annualRate = parseFloat(document.getElementById('sip-return').value) || 0;
            
            let strategyContent = '';
            
            if (calcType === 'step-up') {
                const finalMonthlyAmount = monthlyAmount * Math.pow(1 + sipIncrease/100, years - 1);
                const totalWithoutStepUp = monthlyAmount * 12 * years * Math.pow(1 + annualRate/12/100, years * 12);
                const stepUpBenefit = calculations.nominalValue - totalWithoutStepUp;
                
                strategyContent = `
                    <div style="background: linear-gradient(135deg, rgba(255,215,0,0.05), rgba(0,0,0,0.3)); border: 2px solid var(--accent-gold); border-radius: 12px; padding: 2rem;">
                                                 <h5 style="color: var(--accent-gold); margin-bottom: 1.5rem; font-size: 1.2rem;">Step-up SIP Strategy Analysis</h5>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                            <div style="background: rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 8px;">
                                <h6 style="color: var(--accent-white); margin-bottom: 1rem;">Monthly SIP Growth</h6>
                                <div style="font-size: 1.1rem; color: var(--text-gray); margin-bottom: 0.5rem;">Starting: <span style="color: var(--accent-white); font-weight: bold;">₹${monthlyAmount.toLocaleString('en-IN')}</span></div>
                                <div style="font-size: 1.1rem; color: var(--text-gray); margin-bottom: 0.5rem;">Final: <span style="color: var(--accent-gold); font-weight: bold;">₹${Math.round(finalMonthlyAmount).toLocaleString('en-IN')}</span></div>
                                <div style="font-size: 0.9rem; color: var(--text-gray);">Annual increase: ${sipIncrease}%</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 8px;">
                                <h6 style="color: var(--accent-white); margin-bottom: 1rem;">Step-up Advantage</h6>
                                <div style="font-size: 1.5rem; color: var(--accent-gold); font-weight: bold; margin-bottom: 0.5rem;">₹${Math.round(stepUpBenefit).toLocaleString('en-IN')}</div>
                                <div style="font-size: 0.9rem; color: var(--text-gray);">Extra corpus vs standard SIP</div>
                            </div>
                        </div>
                        <div style="margin-top: 1.5rem; padding: 1rem; background: rgba(255,215,0,0.1); border-radius: 6px;">
                                                         <p style="color: var(--text-gray); margin: 0; line-height: 1.6;">
                                 <strong style="color: var(--accent-gold);">Strategy Benefit:</strong> By increasing your SIP by ${sipIncrease}% annually, 
                                 you're building a corpus that's ₹${Math.round(stepUpBenefit).toLocaleString('en-IN')} larger than a standard SIP. 
                                 This strategy helps you keep pace with inflation and salary increments.
                             </p>
                        </div>
                    </div>
                `;
            } else if (calcType === 'lumpsum' && lumpsumAmount > 0) {
                const sipOnlyValue = monthlyAmount * 12 * years * Math.pow(1 + annualRate/12/100, years * 12);
                const lumpsumGrowth = lumpsumAmount * Math.pow(1 + annualRate/100, years);
                const lumpsumContribution = ((lumpsumGrowth / calculations.nominalValue) * 100);
                
                strategyContent = `
                    <div style="background: linear-gradient(135deg, rgba(192,192,192,0.05), rgba(0,0,0,0.3)); border: 2px solid var(--accent-silver); border-radius: 12px; padding: 2rem;">
                                                 <h5 style="color: var(--accent-silver); margin-bottom: 1.5rem; font-size: 1.2rem;">Lumpsum + SIP Hybrid Strategy</h5>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                            <div style="background: rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 8px;">
                                <h6 style="color: var(--accent-white); margin-bottom: 1rem;">Lumpsum Impact</h6>
                                <div style="font-size: 1.1rem; color: var(--text-gray); margin-bottom: 0.5rem;">Initial: <span style="color: var(--accent-white); font-weight: bold;">₹${lumpsumAmount.toLocaleString('en-IN')}</span></div>
                                <div style="font-size: 1.1rem; color: var(--text-gray); margin-bottom: 0.5rem;">Growth: <span style="color: var(--accent-silver); font-weight: bold;">₹${Math.round(lumpsumGrowth).toLocaleString('en-IN')}</span></div>
                                <div style="font-size: 0.9rem; color: var(--text-gray);">Contributes ${lumpsumContribution.toFixed(1)}% to total corpus</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 8px;">
                                <h6 style="color: var(--accent-white); margin-bottom: 1rem;">Time Value Benefit</h6>
                                <div style="font-size: 1.5rem; color: var(--accent-silver); font-weight: bold; margin-bottom: 0.5rem;">${((lumpsumGrowth / lumpsumAmount) - 1).toFixed(1)}x</div>
                                <div style="font-size: 0.9rem; color: var(--text-gray);">Lumpsum growth multiple over ${years} years</div>
                            </div>
                        </div>
                        <div style="margin-top: 1.5rem; padding: 1rem; background: rgba(192,192,192,0.1); border-radius: 6px;">
                                                         <p style="color: var(--text-gray); margin: 0; line-height: 1.6;">
                                 <strong style="color: var(--accent-silver);">Strategy Benefit:</strong> Your lumpsum investment of ₹${lumpsumAmount.toLocaleString('en-IN')} 
                                 gets the maximum time to compound, growing to ₹${Math.round(lumpsumGrowth).toLocaleString('en-IN')}. 
                                 Combined with systematic SIPs, this creates a powerful wealth-building strategy.
                             </p>
                        </div>
                    </div>
                `;
            } else {
                // Standard SIP
                const monthlyCompounding = ((Math.pow(1 + annualRate/12/100, 12) - 1) * 100);
                const powerOfCompounding = calculations.nominalValue - calculations.totalInvestment;
                
                strategyContent = `
                    <div style="background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(0,0,0,0.3)); border: 2px solid var(--accent-white); border-radius: 12px; padding: 2rem;">
                                                 <h5 style="color: var(--accent-white); margin-bottom: 1.5rem; font-size: 1.2rem;">Standard SIP Strategy Analysis</h5>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                            <div style="background: rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 8px;">
                                <h6 style="color: var(--accent-white); margin-bottom: 1rem;">Compounding Power</h6>
                                <div style="font-size: 1.5rem; color: var(--accent-white); font-weight: bold; margin-bottom: 0.5rem;">₹${powerOfCompounding.toLocaleString('en-IN')}</div>
                                <div style="font-size: 0.9rem; color: var(--text-gray);">Wealth created by compounding</div>
                            </div>
                            <div style="background: rgba(255,255,255,0.05); padding: 1.5rem; border-radius: 8px;">
                                <h6 style="color: var(--accent-white); margin-bottom: 1rem;">Effective Annual Return</h6>
                                <div style="font-size: 1.5rem; color: var(--accent-white); font-weight: bold; margin-bottom: 0.5rem;">${monthlyCompounding.toFixed(2)}%</div>
                                <div style="font-size: 0.9rem; color: var(--text-gray);">With monthly compounding</div>
                            </div>
                        </div>
                        <div style="margin-top: 1.5rem; padding: 1rem; background: rgba(255,255,255,0.08); border-radius: 6px;">
                                                         <p style="color: var(--text-gray); margin: 0; line-height: 1.6;">
                                 <strong style="color: var(--accent-white);">SIP Advantage:</strong> Your disciplined monthly investment of ₹${monthlyAmount.toLocaleString('en-IN')} 
                                 creates ₹${powerOfCompounding.toLocaleString('en-IN')} of additional wealth through the power of compounding. 
                                 Consistency and time are your greatest allies in wealth creation.
                             </p>
                        </div>
                    </div>
                `;
            }
            
            strategyInsights.innerHTML = strategyContent;
        }

        function calculateEMI() {
            const principal = parseFloat(document.getElementById('loan-amount').value) || 0;
            const rate = parseFloat(document.getElementById('interest-rate').value) || 0;
            const tenure = parseFloat(document.getElementById('loan-tenure').value) || 0;

            if (principal && rate && tenure) {
                const monthlyRate = rate / 12 / 100;
                const months = tenure * 12;
                
                const emi = principal * monthlyRate * (Math.pow(1 + monthlyRate, months)) / (Math.pow(1 + monthlyRate, months) - 1);
                const totalAmount = emi * months;
                const totalInterest = totalAmount - principal;

                document.getElementById('monthly-emi').textContent = `₹${Math.round(emi).toLocaleString('en-IN')}`;
                document.getElementById('total-interest').textContent = `₹${Math.round(totalInterest).toLocaleString('en-IN')}`;
                document.getElementById('total-amount').textContent = `₹${Math.round(totalAmount).toLocaleString('en-IN')}`;
                
                document.getElementById('emi-results').style.display = 'block';
            } else {
                alert('Please fill all EMI calculation fields');
            }
        }

        // Goals & Insurance Functions
        let userGoals = [];

        function calculateGoal() {
            const goalName = document.getElementById('goal-name').value;
            const goalAmount = parseFloat(document.getElementById('goal-amount').value) || 0;
            const timeframe = parseFloat(document.getElementById('goal-timeframe').value) || 0;
            const inflationRate = parseFloat(document.getElementById('goal-inflation').value) || 0;
            const currentProgress = parseFloat(document.getElementById('goal-progress').value) || 0;
            const expectedReturn = parseFloat(document.getElementById('goal-return').value) || 0;

            if (!goalName || !goalAmount || !timeframe) {
                alert('Please fill all required fields');
                return;
            }

            // Calculate future value with inflation
            const futureValue = goalAmount * Math.pow(1 + inflationRate/100, timeframe);
            
            // Calculate current progress future value
            const progressFutureValue = currentProgress * Math.pow(1 + expectedReturn/100, timeframe);
            
            // Calculate gap amount
            const gapAmount = Math.max(0, futureValue - progressFutureValue);
            
            // Calculate monthly SIP required for gap
            const monthlyRate = expectedReturn / 12 / 100;
            const months = timeframe * 12;
            let monthlySIP = 0;
            
            if (gapAmount > 0 && monthlyRate > 0) {
                monthlySIP = gapAmount * monthlyRate / (Math.pow(1 + monthlyRate, months) - 1);
            }
            
            // Calculate total investment needed
            const totalInvestment = monthlySIP * months;

            // Display results
            document.getElementById('goal-future-value').textContent = `₹${Math.round(futureValue).toLocaleString('en-IN')}`;
            document.getElementById('goal-monthly-sip').textContent = `₹${Math.round(monthlySIP).toLocaleString('en-IN')}`;
            document.getElementById('goal-total-investment').textContent = `₹${Math.round(totalInvestment).toLocaleString('en-IN')}`;
            document.getElementById('goal-gap').textContent = `₹${Math.round(gapAmount).toLocaleString('en-IN')}`;
            
            document.getElementById('goal-results').style.display = 'block';
        }

        function addGoal() {
            const goalName = document.getElementById('goal-name').value;
            const goalCategory = document.getElementById('goal-category').value;
            const goalAmount = parseFloat(document.getElementById('goal-amount').value) || 0;
            const timeframe = parseFloat(document.getElementById('goal-timeframe').value) || 0;
            const inflationRate = parseFloat(document.getElementById('goal-inflation').value) || 0;
            const priority = document.getElementById('goal-priority').value;
            const currentProgress = parseFloat(document.getElementById('goal-progress').value) || 0;
            const expectedReturn = parseFloat(document.getElementById('goal-return').value) || 0;

            if (!goalName || !goalAmount || !timeframe || !priority) {
                alert('Please fill all required fields');
                return;
            }

            // Calculate goal metrics
            const futureValue = goalAmount * Math.pow(1 + inflationRate/100, timeframe);
            const progressFutureValue = currentProgress * Math.pow(1 + expectedReturn/100, timeframe);
            const gapAmount = Math.max(0, futureValue - progressFutureValue);
            
            const monthlyRate = expectedReturn / 12 / 100;
            const months = timeframe * 12;
            let monthlySIP = 0;
            
            if (gapAmount > 0 && monthlyRate > 0) {
                monthlySIP = gapAmount * monthlyRate / (Math.pow(1 + monthlyRate, months) - 1);
            }

            const goal = {
                id: Date.now(),
                name: goalName,
                category: goalCategory,
                amount: goalAmount,
                timeframe: timeframe,
                inflationRate: inflationRate,
                priority: priority,
                currentProgress: currentProgress,
                expectedReturn: expectedReturn,
                futureValue: futureValue,
                monthlySIP: monthlySIP,
                gapAmount: gapAmount
            };

            userGoals.push(goal);
            displayGoals();
            clearGoalForm();
            
            // Save to localStorage
            localStorage.setItem('userGoals', JSON.stringify(userGoals));
        }

        function displayGoals() {
            const goalsList = document.getElementById('goals-list');
            
            if (userGoals.length === 0) {
                goalsList.innerHTML = '<div style="text-align: center; color: var(--text-gray); padding: 2rem;">No goals added yet. Create your first financial goal above.</div>';
                return;
            }

            let goalsHTML = '';
            userGoals.forEach(goal => {
                const priorityColor = {
                    'critical': 'var(--accent-gold)',
                    'high': 'var(--accent-white)',
                    'medium': 'var(--accent-silver)',
                    'low': 'var(--text-gray)'
                };

                const progressPercentage = ((goal.currentProgress / goal.amount) * 100).toFixed(1);

                goalsHTML += `
                    <div class="goal-card" style="background: linear-gradient(135deg, #1a1a1a, #2a2a2a); border: 2px solid ${priorityColor[goal.priority]}; border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                            <div>
                                <h4 style="color: var(--accent-white); margin: 0 0 0.5rem 0;">${goal.name}</h4>
                                <div style="color: var(--text-gray); font-size: 0.9rem; text-transform: capitalize;">${goal.category} • ${goal.priority} Priority</div>
                            </div>
                            <button onclick="removeGoal(${goal.id})" style="background: none; border: none; color: var(--text-gray); cursor: pointer; font-size: 1.2rem;" title="Remove Goal">×</button>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                            <div>
                                <div style="color: var(--text-gray); font-size: 0.8rem;">Target (Today's Value)</div>
                                <div style="color: var(--accent-white); font-weight: bold;">₹${goal.amount.toLocaleString('en-IN')}</div>
                            </div>
                            <div>
                                <div style="color: var(--text-gray); font-size: 0.8rem;">Future Value</div>
                                <div style="color: var(--accent-gold); font-weight: bold;">₹${Math.round(goal.futureValue).toLocaleString('en-IN')}</div>
                            </div>
                            <div>
                                <div style="color: var(--text-gray); font-size: 0.8rem;">Time Frame</div>
                                <div style="color: var(--accent-white); font-weight: bold;">${goal.timeframe} years</div>
                            </div>
                            <div>
                                <div style="color: var(--text-gray); font-size: 0.8rem;">Monthly SIP</div>
                                <div style="color: var(--accent-gold); font-weight: bold;">₹${Math.round(goal.monthlySIP).toLocaleString('en-IN')}</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 1rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span style="color: var(--text-gray); font-size: 0.9rem;">Progress: ${progressPercentage}%</span>
                                <span style="color: var(--text-gray); font-size: 0.9rem;">₹${goal.currentProgress.toLocaleString('en-IN')} / ₹${goal.amount.toLocaleString('en-IN')}</span>
                            </div>
                            <div style="background: var(--border-gray); border-radius: 10px; height: 8px; overflow: hidden;">
                                <div style="background: ${priorityColor[goal.priority]}; height: 100%; width: ${Math.min(progressPercentage, 100)}%; transition: width 0.3s ease;"></div>
                            </div>
                        </div>
                    </div>
                `;
            });

            goalsList.innerHTML = goalsHTML;
        }

        function removeGoal(goalId) {
            userGoals = userGoals.filter(goal => goal.id !== goalId);
            displayGoals();
            localStorage.setItem('userGoals', JSON.stringify(userGoals));
        }

        function clearGoalForm() {
            document.getElementById('goal-form').reset();
            document.getElementById('goal-inflation').value = '6';
            document.getElementById('goal-return').value = '12';
            document.getElementById('goal-results').style.display = 'none';
        }

        function calculateInsurance() {
            const age = parseFloat(document.getElementById('insurance-age').value) || 0;
            const income = parseFloat(document.getElementById('insurance-income').value) || 0;
            const dependents = parseFloat(document.getElementById('insurance-dependents').value) || 0;
            const loans = parseFloat(document.getElementById('insurance-loans').value) || 0;
            const assets = parseFloat(document.getElementById('insurance-assets').value) || 0;
            const coverageYears = parseFloat(document.getElementById('insurance-years').value) || 0;

            if (!age || !income || coverageYears === 0) {
                alert('Please fill all required fields');
                return;
            }

            // Life Insurance Calculation (Human Life Value Method + Income Replacement)
            const incomeReplacement = income * coverageYears;
            const dependentFactor = 1 + (dependents * 0.3); // 30% additional for each dependent
            const inflationAdjustment = 1.06; // 6% inflation adjustment
            
            let lifeCover = (incomeReplacement * dependentFactor * inflationAdjustment) + loans - assets;
            lifeCover = Math.max(lifeCover, income * 10); // Minimum 10x annual income
            
            // Age factor adjustment
            if (age < 30) lifeCover *= 1.2;
            else if (age > 50) lifeCover *= 0.8;

            // Health Insurance Calculation
            let healthCover = 500000; // Base amount
            if (dependents > 0) healthCover += dependents * 300000;
            if (age > 45) healthCover *= 1.5;
            if (income > 1000000) healthCover = Math.max(healthCover, income * 0.5);

            // Premium Estimation (rough calculation)
            const lifeInsurancePremium = (lifeCover * 0.01 * (age / 30)) / 12; // Monthly
            const healthInsurancePremium = (healthCover * 0.015) / 12; // Monthly
            const totalPremium = lifeInsurancePremium + healthInsurancePremium;

            // Display results
            document.getElementById('insurance-life-cover').textContent = `₹${Math.round(lifeCover).toLocaleString('en-IN')}`;
            document.getElementById('insurance-health-cover').textContent = `₹${Math.round(healthCover).toLocaleString('en-IN')}`;
            document.getElementById('insurance-premium').textContent = `₹${Math.round(totalPremium).toLocaleString('en-IN')}/month`;

            // Generate breakdown
            generateInsuranceBreakdown(lifeCover, healthCover, lifeInsurancePremium, healthInsurancePremium, income, dependents, loans, assets);
            
            document.getElementById('insurance-results').style.display = 'block';
        }

        function generateInsuranceBreakdown(lifeCover, healthCover, lifePremium, healthPremium, income, dependents, loans, assets) {
            const breakdown = document.getElementById('insurance-breakdown');
            
            breakdown.innerHTML = `
                <div style="background: linear-gradient(135deg, rgba(255,255,255,0.02), rgba(0,0,0,0.3)); border-radius: 12px; padding: 1.5rem;">
                    <h5 style="color: var(--accent-white); margin-bottom: 1.5rem;">Insurance Analysis Breakdown</h5>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
                        <div>
                            <h6 style="color: var(--accent-gold); margin-bottom: 1rem;">Life Insurance Components</h6>
                            <div style="space-y: 0.5rem;">
                                <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--border-gray);">
                                    <span style="color: var(--text-gray);">Income Replacement (${income > 0 ? Math.round(lifeCover / income) : 0}x annual income)</span>
                                    <span style="color: var(--accent-white);">₹${Math.round(income * 10).toLocaleString('en-IN')}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--border-gray);">
                                    <span style="color: var(--text-gray);">Outstanding Loans</span>
                                    <span style="color: var(--accent-white);">₹${loans.toLocaleString('en-IN')}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--border-gray);">
                                    <span style="color: var(--text-gray);">Dependent Factor (${dependents} dependents)</span>
                                    <span style="color: var(--accent-white)">${((1 + dependents * 0.3) * 100).toFixed(0)}%</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--border-gray);">
                                    <span style="color: var(--text-gray);">Less: Liquid Assets</span>
                                    <span style="color: var(--accent-silver);">-₹${assets.toLocaleString('en-IN')}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 0.8rem 0; font-weight: bold;">
                                    <span style="color: var(--accent-gold);">Recommended Life Cover</span>
                                    <span style="color: var(--accent-gold);">₹${Math.round(lifeCover).toLocaleString('en-IN')}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h6 style="color: var(--accent-white); margin-bottom: 1rem;">Health Insurance & Premiums</h6>
                            <div style="space-y: 0.5rem;">
                                <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--border-gray);">
                                    <span style="color: var(--text-gray);">Base Health Coverage</span>
                                    <span style="color: var(--accent-white);">₹5,00,000</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--border-gray);">
                                    <span style="color: var(--text-gray);">Family Coverage (${dependents} members)</span>
                                    <span style="color: var(--accent-white);">₹${(dependents * 300000).toLocaleString('en-IN')}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--border-gray);">
                                    <span style="color: var(--text-gray);">Life Insurance Premium</span>
                                    <span style="color: var(--accent-silver);">₹${Math.round(lifePremium).toLocaleString('en-IN')}/month</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 0.5rem 0; border-bottom: 1px solid var(--border-gray);">
                                    <span style="color: var(--text-gray);">Health Insurance Premium</span>
                                    <span style="color: var(--accent-silver);">₹${Math.round(healthPremium).toLocaleString('en-IN')}/month</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; padding: 0.8rem 0; font-weight: bold;">
                                    <span style="color: var(--accent-white);">Total Monthly Premium</span>
                                    <span style="color: var(--accent-white);">₹${Math.round(lifePremium + healthPremium).toLocaleString('en-IN')}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 2rem; padding: 1rem; background: rgba(255,215,0,0.05); border-left: 4px solid var(--accent-gold); border-radius: 4px;">
                        <h6 style="color: var(--accent-gold); margin-bottom: 0.5rem;">Insurance Recommendations</h6>
                        <ul style="color: var(--text-gray); line-height: 1.6; margin: 0; padding-left: 1.5rem;">
                            <li>Consider term life insurance for maximum coverage at lowest cost</li>
                            <li>${dependents > 0 ? 'Include family floater health insurance for dependents' : 'Individual health insurance is sufficient for now'}</li>
                            <li>Review coverage annually or on major life events</li>
                            <li>Maintain emergency fund alongside insurance coverage</li>
                            ${income > 1000000 ? '<li>Consider additional critical illness coverage given higher income</li>' : ''}
                        </ul>
                    </div>
                </div>
            `;
        }

        // Investment Recommendations Functions
        let allocationChart = null;

        // Check if user has completed risk assessment and load recommendations
        function loadInvestmentRecommendations() {
            const clientData = JSON.parse(localStorage.getItem('clientData') || '{}');
            const riskProfile = clientData.riskProfile;
            
            if (riskProfile && riskProfile.riskCategory) {
                // User has completed risk assessment - show personalized recommendations
                displayProfileSummary(riskProfile);
                generateAssetAllocation(riskProfile);
                generateFundRecommendations(riskProfile);
                generateInvestmentStrategy(riskProfile);
            } else {
                // No risk profile - show sample/default recommendations with prompt
                displayDefaultProfileSummary();
                generateDefaultAssetAllocation();
                generateDefaultFundRecommendations();
                generateDefaultInvestmentStrategy();
            }
            
            // Always show recommendation cards (except rebalancing which is now in Portfolio Analysis)
            document.getElementById('asset-allocation-card').style.display = 'block';
            document.getElementById('fund-recommendations-card').style.display = 'block';
            document.getElementById('strategy-card').style.display = 'block';
        }

        function displayDefaultProfileSummary() {
            const profileSummary = document.getElementById('profile-summary');
            profileSummary.innerHTML = `
                <div style="text-align: center; padding: 2rem; background: linear-gradient(135deg, rgba(255,69,0,0.1), rgba(0,0,0,0.3)); border-radius: 12px; border: 2px solid #ff4500;">
                    <h4 style="color: #ff4500; margin-bottom: 1rem;"><i class="fas fa-exclamation-triangle"></i> Get Your Personalized Recommendations</h4>
                    <p style="color: var(--text-gray); margin-bottom: 1.5rem;">The recommendations below are generic samples. To get recommendations tailored specifically for your financial situation and risk tolerance, please complete your risk assessment.</p>
                    <button class="btn btn-primary" onclick="showSection('risk-assessment')" style="background: #ff4500; border-color: #ff4500;">
                        <i class="fas fa-user-check"></i> Complete Risk Assessment Now
                    </button>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 2rem;">
                    <div style="background: linear-gradient(135deg, #1a1a1a, #2a2a2a); border: 2px solid var(--accent-gold); border-radius: 12px; padding: 1.5rem; text-align: center;">
                        <div style="font-size: 0.9rem; color: var(--text-gray); margin-bottom: 0.5rem;">Risk Profile</div>
                        <div style="font-size: 1.4rem; font-weight: bold; color: var(--text-gray);">Generic Sample</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #1a1a1a, #2a2a2a); border: 2px solid var(--accent-white); border-radius: 12px; padding: 1.5rem; text-align: center;">
                        <div style="font-size: 0.9rem; color: var(--text-gray); margin-bottom: 0.5rem;">Risk Score</div>
                        <div style="font-size: 1.4rem; font-weight: bold; color: var(--text-gray);">Not Assessed</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #1a1a1a, #2a2a2a); border: 2px solid var(--accent-silver); border-radius: 12px; padding: 1.5rem; text-align: center;">
                        <div style="font-size: 0.9rem; color: var(--text-gray); margin-bottom: 0.5rem;">Investment Horizon</div>
                        <div style="font-size: 1.4rem; font-weight: bold; color: var(--accent-silver);">Long Term</div>
                    </div>
                </div>
            `;
        }

        function generateDefaultAssetAllocation() {
            // Use moderate allocation as default
            const allocation = { equity: 50, debt: 35, gold: 10, cash: 5 };
            
            // Update the static HTML with dynamic content but keep the structure
            const breakdown = document.getElementById('allocation-breakdown');
            if (breakdown) {
                breakdown.innerHTML = `
                    <div style="background: linear-gradient(135deg, rgba(255,215,0,0.1), rgba(255,215,0,0.05)); border: 2px solid var(--accent-gold); border-radius: 12px; padding: 1.5rem; text-align: center;">
                        <div style="font-size: 0.9rem; color: var(--accent-gold); margin-bottom: 0.5rem;">EQUITY</div>
                        <div style="font-size: 2rem; font-weight: bold; color: var(--accent-gold);">${allocation.equity}%</div>
                        <div style="font-size: 0.8rem; color: var(--text-gray);">Growth focused (Sample)</div>
                    </div>
                    <div style="background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05)); border: 2px solid var(--accent-white); border-radius: 12px; padding: 1.5rem; text-align: center;">
                        <div style="font-size: 0.9rem; color: var(--accent-white); margin-bottom: 0.5rem;">DEBT</div>
                        <div style="font-size: 2rem; font-weight: bold; color: var(--accent-white);">${allocation.debt}%</div>
                        <div style="font-size: 0.8rem; color: var(--text-gray);">Stability focused (Sample)</div>
                    </div>
                    <div style="background: linear-gradient(135deg, rgba(192,192,192,0.1), rgba(192,192,192,0.05)); border: 2px solid var(--accent-silver); border-radius: 12px; padding: 1.5rem; text-align: center;">
                        <div style="font-size: 0.9rem; color: var(--accent-silver); margin-bottom: 0.5rem;">GOLD</div>
                        <div style="font-size: 2rem; font-weight: bold; color: var(--accent-silver);">${allocation.gold}%</div>
                        <div style="font-size: 0.8rem; color: var(--text-gray);">Hedge (Sample)</div>
                    </div>
                    <div style="background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(0,0,0,0.3)); border: 2px solid var(--text-gray); border-radius: 12px; padding: 1.5rem; text-align: center;">
                        <div style="font-size: 0.9rem; color: var(--text-gray); margin-bottom: 0.5rem;">CASH</div>
                        <div style="font-size: 2rem; font-weight: bold; color: var(--text-gray);">${allocation.cash}%</div>
                        <div style="font-size: 0.8rem; color: var(--text-gray);">Emergency (Sample)</div>
                    </div>
                `;
            }
            
            // Create allocation chart
            createAllocationChart(allocation);
        }

        function generateDefaultFundRecommendations() {
            const fundCategories = document.getElementById('fund-categories');
            if (fundCategories) {
                fundCategories.innerHTML = `
                    <div style="background: rgba(255,215,0,0.05); border: 1px solid var(--accent-gold); border-radius: 8px; padding: 1rem; margin-bottom: 2rem;">
                        <h5 style="color: var(--accent-gold); margin-bottom: 0.5rem;">Sample Recommendations for Moderate Investor</h5>
                        <p style="color: var(--text-gray); margin: 0;">Complete your Risk Assessment to get personalized fund recommendations based on your specific risk tolerance and goals.</p>
                    </div>
                    <div style="margin-bottom: 2rem;">
                        <h4 style="color: var(--accent-gold); margin-bottom: 1rem;">Large Cap Funds (50% allocation)</h4>
                        <div style="display: grid; gap: 1rem;">
                            <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 1rem; align-items: center; padding: 1rem; background: rgba(255,255,255,0.02); border-radius: 8px; border-left: 4px solid var(--accent-gold);">
                                <div>
                                    <div style="color: var(--accent-white); font-weight: bold; margin-bottom: 0.2rem;">Axis Bluechip Fund</div>
                                    <div style="color: var(--text-gray); font-size: 0.9rem;">Large Cap (Sample)</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="color: var(--accent-gold); font-weight: bold;">12-15%</div>
                                    <div style="color: var(--text-gray); font-size: 0.8rem;">Expected Return</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="color: #ffc107; font-weight: bold;">Medium</div>
                                    <div style="color: var(--text-gray); font-size: 0.8rem;">Risk Level</div>
                                </div>
                                <div style="text-align: center;">
                                    <button class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.8rem;">Sample Fund</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 2rem;">
                        <h4 style="color: var(--accent-white); margin-bottom: 1rem;">Debt Funds (35% allocation)</h4>
                        <div style="display: grid; gap: 1rem;">
                            <div style="display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 1rem; align-items: center; padding: 1rem; background: rgba(255,255,255,0.02); border-radius: 8px; border-left: 4px solid var(--accent-white);">
                                <div>
                                    <div style="color: var(--accent-white); font-weight: bold; margin-bottom: 0.2rem;">Axis Strategic Bond Fund</div>
                                    <div style="color: var(--text-gray); font-size: 0.9rem;">Debt (Sample)</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="color: var(--accent-white); font-weight: bold;">7-9%</div>
                                    <div style="color: var(--text-gray); font-size: 0.8rem;">Expected Return</div>
                                </div>
                                <div style="text-align: center;">
                                    <div style="color: #17a2b8; font-weight: bold;">Low</div>
                                    <div style="color: var(--text-gray); font-size: 0.8rem;">Risk Level</div>
                                </div>
                                <div style="text-align: center;">
                                    <button class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.8rem;">Sample Fund</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function generateDefaultInvestmentStrategy() {
            const strategyContent = document.getElementById('strategy-content');
            if (strategyContent) {
                strategyContent.innerHTML = `
                    <div style="background: linear-gradient(135deg, rgba(255,215,0,0.05), rgba(0,0,0,0.3)); border-radius: 12px; padding: 2rem;">
                        <h4 style="color: var(--accent-gold); margin-bottom: 1rem; text-align: center;">Sample: Balanced Growth Strategy</h4>
                        <div style="text-align: center; margin-bottom: 2rem; padding: 1rem; background: rgba(255,215,0,0.05); border-radius: 8px;">
                            <p style="color: var(--text-gray); margin: 0;">This is a sample strategy for moderate investors. Complete your Risk Assessment to get a personalized investment strategy.</p>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                            <div style="background: rgba(255,255,255,0.02); border-radius: 8px; padding: 1.5rem;">
                                <h5 style="color: var(--accent-white); margin-bottom: 1rem;">Strategy Focus</h5>
                                <p style="color: var(--text-gray); line-height: 1.6;">Balance between growth and stability</p>
                            </div>
                            <div style="background: rgba(255,255,255,0.02); border-radius: 8px; padding: 1.5rem;">
                                <h5 style="color: var(--accent-white); margin-bottom: 1rem;">Investment Approach</h5>
                                <p style="color: var(--text-gray); line-height: 1.6;">Diversified allocation across asset classes</p>
                            </div>
                            <div style="background: rgba(255,255,255,0.02); border-radius: 8px; padding: 1.5rem;">
                                <h5 style="color: var(--accent-white); margin-bottom: 1rem;">Time Horizon</h5>
                                <p style="color: var(--accent-gold); font-size: 1.2rem; font-weight: bold;">5-10 years</p>
                            </div>
                        </div>
                        
                        <div style="margin-top: 2rem; padding: 1.5rem; background: rgba(255,215,0,0.05); border-left: 4px solid var(--accent-gold); border-radius: 4px;">
                            <h5 style="color: var(--accent-gold); margin-bottom: 0.5rem;">Get Your Personalized Strategy</h5>
                            <p style="color: var(--text-gray); line-height: 1.6; margin: 0;">Your actual investment strategy will be customized based on your risk tolerance, financial goals, investment experience, and time horizon. Complete the Risk Assessment to unlock personalized recommendations.</p>
                        </div>
                    </div>
                `;
            }
        }

        function displayProfileSummary(riskProfile) {
            const summary = document.getElementById('profile-summary');
            const riskColors = {
                'Conservative': 'var(--accent-silver)',
                'Moderate Conservative': 'var(--accent-light)',
                'Moderate': 'var(--accent-white)',
                'Moderate Aggressive': 'var(--accent-gold)',
                'Aggressive': 'var(--accent-gold)'
            };
            
            summary.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                    <div style="background: linear-gradient(135deg, #1a1a1a, #2a2a2a); border: 2px solid ${riskColors[riskProfile.riskCategory]}; border-radius: 12px; padding: 1.5rem; text-align: center;">
                        <div style="font-size: 0.9rem; color: var(--text-gray); margin-bottom: 0.5rem;">Risk Profile</div>
                        <div style="font-size: 1.4rem; font-weight: bold; color: ${riskColors[riskProfile.riskCategory]};">${riskProfile.riskCategory}</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #1a1a1a, #2a2a2a); border: 2px solid var(--accent-white); border-radius: 12px; padding: 1.5rem; text-align: center;">
                        <div style="font-size: 0.9rem; color: var(--text-gray); margin-bottom: 0.5rem;">Risk Score</div>
                        <div style="font-size: 1.4rem; font-weight: bold; color: var(--accent-white);">${riskProfile.riskScore || riskProfile.riskPercentage || '60'}%</div>
                    </div>
                    <div style="background: linear-gradient(135deg, #1a1a1a, #2a2a2a); border: 2px solid var(--accent-silver); border-radius: 12px; padding: 1.5rem; text-align: center;">
                        <div style="font-size: 0.9rem; color: var(--text-gray); margin-bottom: 0.5rem;">Investment Horizon</div>
                        <div style="font-size: 1.4rem; font-weight: bold; color: var(--accent-silver);">Long Term</div>
                    </div>
                </div>
            `;
        }

        function generateAssetAllocation(riskProfile) {
            // Asset allocation based on risk profile
            const allocations = {
                'Conservative': { equity: 20, debt: 60, gold: 10, cash: 10 },
                'Moderate Conservative': { equity: 35, debt: 50, gold: 10, cash: 5 },
                'Moderate': { equity: 50, debt: 35, gold: 10, cash: 5 },
                'Moderate Aggressive': { equity: 65, debt: 25, gold: 7, cash: 3 },
                'Aggressive': { equity: 80, debt: 15, gold: 3, cash: 2 }
            };
            
            const allocation = allocations[riskProfile.riskCategory] || allocations['Moderate'];
            
            // Display allocation breakdown
            const breakdown = document.getElementById('allocation-breakdown');
            breakdown.innerHTML = `
                <div style="background: linear-gradient(135deg, rgba(255,215,0,0.1), rgba(255,215,0,0.05)); border: 2px solid var(--accent-gold); border-radius: 12px; padding: 1.5rem; text-align: center;">
                    <div style="font-size: 0.9rem; color: var(--accent-gold); margin-bottom: 0.5rem;">EQUITY</div>
                    <div style="font-size: 2rem; font-weight: bold; color: var(--accent-gold);">${allocation.equity}%</div>
                    <div style="font-size: 0.8rem; color: var(--text-gray);">Growth focused</div>
                </div>
                <div style="background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05)); border: 2px solid var(--accent-white); border-radius: 12px; padding: 1.5rem; text-align: center;">
                    <div style="font-size: 0.9rem; color: var(--accent-white); margin-bottom: 0.5rem;">DEBT</div>
                    <div style="font-size: 2rem; font-weight: bold; color: var(--accent-white);">${allocation.debt}%</div>
                    <div style="font-size: 0.8rem; color: var(--text-gray);">Stability focused</div>
                </div>
                <div style="background: linear-gradient(135deg, rgba(192,192,192,0.1), rgba(192,192,192,0.05)); border: 2px solid var(--accent-silver); border-radius: 12px; padding: 1.5rem; text-align: center;">
                    <div style="font-size: 0.9rem; color: var(--accent-silver); margin-bottom: 0.5rem;">GOLD</div>
                    <div style="font-size: 2rem; font-weight: bold; color: var(--accent-silver);">${allocation.gold}%</div>
                    <div style="font-size: 0.8rem; color: var(--text-gray);">Hedge against inflation</div>
                </div>
                <div style="background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(0,0,0,0.3)); border: 2px solid var(--text-gray); border-radius: 12px; padding: 1.5rem; text-align: center;">
                    <div style="font-size: 0.9rem; color: var(--text-gray); margin-bottom: 0.5rem;">CASH</div>
                    <div style="font-size: 2rem; font-weight: bold; color: var(--text-gray);">${allocation.cash}%</div>
                    <div style="font-size: 0.8rem; color: var(--text-gray);">Emergency fund</div>
                </div>
            `;
            
            // Display allocation details
            const details = document.getElementById('allocation-details');
            details.innerHTML = `
                <h5 style="color: var(--accent-white); margin-bottom: 1rem;">Allocation Strategy</h5>
                <div style="display: grid; gap: 1rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.8rem; background: rgba(255,215,0,0.05); border-radius: 8px;">
                        <span style="color: var(--text-gray);">Equity (${allocation.equity}%)</span>
                        <span style="color: var(--accent-gold);">High growth potential, higher volatility</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.8rem; background: rgba(255,255,255,0.02); border-radius: 8px;">
                        <span style="color: var(--text-gray);">Debt (${allocation.debt}%)</span>
                        <span style="color: var(--accent-white);">Stable returns, capital protection</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.8rem; background: rgba(192,192,192,0.05); border-radius: 8px;">
                        <span style="color: var(--text-gray);">Gold (${allocation.gold}%)</span>
                        <span style="color: var(--accent-silver);">Portfolio diversification, inflation hedge</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.8rem; background: rgba(255,255,255,0.02); border-radius: 8px;">
                        <span style="color: var(--text-gray);">Cash (${allocation.cash}%)</span>
                        <span style="color: var(--text-gray);">Liquidity and opportunities</span>
                    </div>
                </div>
            `;
            
            // Create allocation chart
            createAllocationChart(allocation);
        }

        function createAllocationChart(allocation) {
            const ctx = document.getElementById('allocationChart').getContext('2d');
            
            if (allocationChart) {
                allocationChart.destroy();
            }
            
            allocationChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Equity', 'Debt', 'Gold', 'Cash'],
                    datasets: [{
                        data: [allocation.equity, allocation.debt, allocation.gold, allocation.cash],
                        backgroundColor: ['#ffd700', '#ffffff', '#c0c0c0', '#666666'],
                        borderColor: ['#000000', '#000000', '#000000', '#000000'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: false,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#ffffff',
                                font: { size: 12 },
                                padding: 20
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.9)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#ffd700',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.parsed + '%';
                                }
                            }
                        }
                    },
                    cutout: '60%'
                }
            });
        }

        function generateFundRecommendations(riskProfile) {
            const fundCategories = document.getElementById('fund-categories');
            const allocation = {
                'Conservative': { equity: 20, debt: 60, gold: 10, cash: 10 },
                'Moderate Conservative': { equity: 35, debt: 50, gold: 10, cash: 5 },
                'Moderate': { equity: 50, debt: 35, gold: 10, cash: 5 },
                'Moderate Aggressive': { equity: 65, debt: 25, gold: 7, cash: 3 },
                'Aggressive': { equity: 80, debt: 15, gold: 3, cash: 2 }
            }[riskProfile.riskCategory] || { equity: 50, debt: 35, gold: 10, cash: 5 };
            
            // Comprehensive fund database with all risk categories
            const fundDatabase = {
                equity: {
                    'Conservative': [
                        { name: "SBI Bluechip Fund", category: "Large Cap", risk: "Low", returns: "10-12%", rating: "★★★★☆", expense: "0.50%" },
                        { name: "HDFC Top 100 Fund", category: "Large Cap", risk: "Low", returns: "9-11%", rating: "★★★★☆", expense: "0.52%" },
                        { name: "Nippon India Large Cap Fund", category: "Large Cap", risk: "Low", returns: "10-11%", rating: "★★★★☆", expense: "0.49%" }
                    ],
                    'Moderate Conservative': [
                        { name: "ICICI Prudential Bluechip Fund", category: "Large Cap", risk: "Low-Medium", returns: "11-13%", rating: "★★★★☆", expense: "0.55%" },
                        { name: "UTI Mastershare Fund", category: "Large Cap", risk: "Low-Medium", returns: "10-12%", rating: "★★★★☆", expense: "0.58%" },
                        { name: "Kotak Bluechip Fund", category: "Large Cap", risk: "Low-Medium", returns: "11-12%", rating: "★★★★☆", expense: "0.65%" },
                        { name: "HDFC Balanced Advantage Fund", category: "Hybrid", risk: "Medium", returns: "10-13%", rating: "★★★★☆", expense: "0.75%" }
                    ],
                    'Moderate': [
                        { name: "Axis Bluechip Fund", category: "Large Cap", risk: "Medium", returns: "12-15%", rating: "★★★★★", expense: "0.46%" },
                        { name: "Mirae Asset Large Cap Fund", category: "Large Cap", risk: "Medium", returns: "11-14%", rating: "★★★★☆", expense: "0.52%" },
                        { name: "Parag Parikh Long Term Equity Fund", category: "Multi Cap", risk: "Medium", returns: "13-16%", rating: "★★★★★", expense: "0.68%" },
                        { name: "HDFC Mid-Cap Opportunities Fund", category: "Mid Cap", risk: "Medium-High", returns: "14-17%", rating: "★★★★☆", expense: "0.82%" }
                    ],
                    'Moderate Aggressive': [
                        { name: "Axis Midcap Fund", category: "Mid Cap", risk: "High", returns: "15-18%", rating: "★★★★★", expense: "0.69%" },
                        { name: "DSP Midcap Fund", category: "Mid Cap", risk: "High", returns: "14-17%", rating: "★★★★☆", expense: "0.75%" },
                        { name: "Kotak Emerging Equity Fund", category: "Mid Cap", risk: "High", returns: "15-19%", rating: "★★★★☆", expense: "0.71%" },
                        { name: "Franklin India Focused Equity Fund", category: "Focused", risk: "High", returns: "16-20%", rating: "★★★★☆", expense: "0.89%" }
                    ],
                    'Aggressive': [
                        { name: "SBI Small Cap Fund", category: "Small Cap", risk: "Very High", returns: "16-20%", rating: "★★★★☆", expense: "0.95%" },
                        { name: "Axis Small Cap Fund", category: "Small Cap", risk: "Very High", returns: "17-22%", rating: "★★★★★", expense: "0.87%" },
                        { name: "ICICI Prudential Technology Fund", category: "Sectoral", risk: "Very High", returns: "18-25%", rating: "★★★★☆", expense: "1.05%" },
                        { name: "Quant ELSS Tax Saver Fund", category: "ELSS", risk: "Very High", returns: "19-24%", rating: "★★★★☆", expense: "0.65%" },
                        { name: "PGIM India Midcap Opportunities Fund", category: "Mid Cap", risk: "Very High", returns: "18-23%", rating: "★★★★☆", expense: "0.79%" }
                    ]
                },
                debt: {
                    'Conservative': [
                        { name: "HDFC Liquid Fund", category: "Liquid", risk: "Very Low", returns: "3-4%", rating: "★★★★★", expense: "0.13%" },
                        { name: "SBI Liquid Fund", category: "Liquid", risk: "Very Low", returns: "3-4%", rating: "★★★★☆", expense: "0.15%" },
                        { name: "ICICI Prudential Ultra Short Term Fund", category: "Ultra Short", risk: "Very Low", returns: "4-5%", rating: "★★★★★", expense: "0.25%" },
                        { name: "Axis Treasury Advantage Fund", category: "Ultra Short", risk: "Very Low", returns: "4-5%", rating: "★★★★☆", expense: "0.28%" }
                    ],
                    'Moderate Conservative': [
                        { name: "SBI Short Term Debt Fund", category: "Short Term", risk: "Low", returns: "6-8%", rating: "★★★★☆", expense: "0.45%" },
                        { name: "ICICI Prudential Corporate Bond Fund", category: "Corporate Bond", risk: "Low", returns: "6-7%", rating: "★★★★☆", expense: "0.42%" },
                        { name: "Axis Corporate Debt Fund", category: "Corporate Bond", risk: "Low", returns: "6-8%", rating: "★★★★☆", expense: "0.48%" }
                    ],
                    'Moderate': [
                        { name: "Axis Strategic Bond Fund", category: "Strategic", risk: "Medium", returns: "7-9%", rating: "★★★★★", expense: "0.65%" },
                        { name: "Kotak Dynamic Bond Fund", category: "Dynamic", risk: "Medium", returns: "7-9%", rating: "★★★★☆", expense: "0.68%" },
                        { name: "HDFC Medium Term Debt Fund", category: "Medium Term", risk: "Medium", returns: "7-9%", rating: "★★★★☆", expense: "0.55%" }
                    ],
                    'Moderate Aggressive': [
                        { name: "Axis Strategic Bond Fund", category: "Strategic", risk: "Medium", returns: "8-10%", rating: "★★★★★", expense: "0.65%" },
                        { name: "ICICI Prudential All Seasons Bond Fund", category: "Dynamic", risk: "Medium", returns: "8-10%", rating: "★★★★☆", expense: "0.72%" }
                    ],
                    'Aggressive': [
                        { name: "Axis Strategic Bond Fund", category: "Strategic", risk: "Medium", returns: "8-10%", rating: "★★★★★", expense: "0.65%" },
                        { name: "HDFC Corporate Bond Fund", category: "Corporate", risk: "Low", returns: "7-9%", rating: "★★★★☆", expense: "0.45%" }
                    ]
                },
                gold: {
                    all: [
                        { name: "SBI Gold ETF", category: "Gold ETF", risk: "Medium", returns: "8-12%", rating: "★★★★☆", expense: "0.40%" },
                        { name: "HDFC Gold ETF", category: "Gold ETF", risk: "Medium", returns: "8-12%", rating: "★★★★☆", expense: "0.50%" },
                        { name: "Nippon India Gold Savings Fund", category: "Gold Fund", risk: "Medium", returns: "8-11%", rating: "★★★★☆", expense: "0.82%" }
                    ]
                }
            };
            
            // Select funds specifically for user's exact risk category
            const selectedFunds = {
                equity: fundDatabase.equity[riskProfile.riskCategory] || fundDatabase.equity['Moderate'],
                debt: fundDatabase.debt[riskProfile.riskCategory] || fundDatabase.debt['Moderate'], 
                gold: fundDatabase.gold.all
            };
            
            let fundHTML = '';
            
            if (allocation.equity > 0) {
                fundHTML += `
                    <div style="margin-bottom: 2rem;">
                        <h4 style="color: var(--accent-gold); margin-bottom: 1rem;">Equity Funds (${allocation.equity}% allocation)</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                `;
                selectedFunds.equity.forEach(fund => {
                    fundHTML += `
                        <div style="background: linear-gradient(135deg, rgba(255,215,0,0.05), rgba(0,0,0,0.3)); border: 1px solid var(--accent-gold); border-radius: 8px; padding: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                                <h6 style="color: var(--accent-white); margin: 0; font-size: 0.9rem;">${fund.name}</h6>
                                <span style="color: var(--accent-gold); font-size: 0.8rem;">${fund.rating}</span>
                            </div>
                            <div style="color: var(--text-gray); font-size: 0.8rem; margin-bottom: 0.8rem; padding: 0.3rem 0.6rem; background: rgba(255,255,255,0.05); border-radius: 4px; display: inline-block;">${fund.category}</div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; font-size: 0.75rem; margin-bottom: 0.5rem;">
                                <div style="color: var(--text-gray);">Risk: <span style="color: var(--accent-white);">${fund.risk}</span></div>
                                <div style="color: var(--text-gray);">Returns: <span style="color: var(--accent-gold);">${fund.returns}</span></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 0.75rem; padding-top: 0.5rem; border-top: 1px solid rgba(255,255,255,0.1);">
                                <span style="color: var(--text-gray);">Expense Ratio: <span style="color: var(--accent-silver);">${fund.expense}</span></span>
                                <span style="color: var(--accent-gold); font-weight: bold;">Recommended for ${riskProfile.riskCategory}</span>
                            </div>
                        </div>
                    `;
                });
                fundHTML += '</div></div>';
            }
            
            if (allocation.debt > 0) {
                fundHTML += `
                    <div style="margin-bottom: 2rem;">
                        <h4 style="color: var(--accent-white); margin-bottom: 1rem;">Debt Funds (${allocation.debt}% allocation)</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                `;
                selectedFunds.debt.forEach(fund => {
                    fundHTML += `
                        <div style="background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(0,0,0,0.3)); border: 1px solid var(--accent-white); border-radius: 8px; padding: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                                <h6 style="color: var(--accent-white); margin: 0; font-size: 0.9rem;">${fund.name}</h6>
                                <span style="color: var(--accent-white); font-size: 0.8rem;">${fund.rating}</span>
                            </div>
                            <div style="color: var(--text-gray); font-size: 0.8rem; margin-bottom: 0.8rem; padding: 0.3rem 0.6rem; background: rgba(255,255,255,0.05); border-radius: 4px; display: inline-block;">${fund.category}</div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; font-size: 0.75rem; margin-bottom: 0.5rem;">
                                <div style="color: var(--text-gray);">Risk: <span style="color: var(--accent-white);">${fund.risk}</span></div>
                                <div style="color: var(--text-gray);">Returns: <span style="color: var(--accent-white);">${fund.returns}</span></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 0.75rem; padding-top: 0.5rem; border-top: 1px solid rgba(255,255,255,0.1);">
                                <span style="color: var(--text-gray);">Expense Ratio: <span style="color: var(--accent-silver);">${fund.expense}</span></span>
                                <span style="color: var(--accent-white); font-weight: bold;">Recommended for ${riskProfile.riskCategory}</span>
                            </div>
                        </div>
                    `;
                });
                fundHTML += '</div></div>';
            }
            
            if (allocation.gold > 0) {
                fundHTML += `
                    <div style="margin-bottom: 2rem;">
                        <h4 style="color: var(--accent-silver); margin-bottom: 1rem;">Gold Investments (${allocation.gold}% allocation)</h4>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem;">
                `;
                selectedFunds.gold.forEach(fund => {
                    fundHTML += `
                        <div style="background: linear-gradient(135deg, rgba(192,192,192,0.05), rgba(0,0,0,0.3)); border: 1px solid var(--accent-silver); border-radius: 8px; padding: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                                <h6 style="color: var(--accent-white); margin: 0; font-size: 0.9rem;">${fund.name}</h6>
                                <span style="color: var(--accent-silver); font-size: 0.8rem;">${fund.rating}</span>
                            </div>
                            <div style="color: var(--text-gray); font-size: 0.8rem; margin-bottom: 0.8rem; padding: 0.3rem 0.6rem; background: rgba(255,255,255,0.05); border-radius: 4px; display: inline-block;">${fund.category}</div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; font-size: 0.75rem; margin-bottom: 0.5rem;">
                                <div style="color: var(--text-gray);">Risk: <span style="color: var(--accent-silver);">${fund.risk}</span></div>
                                <div style="color: var(--text-gray);">Returns: <span style="color: var(--accent-silver);">${fund.returns}</span></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; font-size: 0.75rem; padding-top: 0.5rem; border-top: 1px solid rgba(255,255,255,0.1);">
                                <span style="color: var(--text-gray);">Expense Ratio: <span style="color: var(--accent-silver);">${fund.expense}</span></span>
                                <span style="color: var(--accent-silver); font-weight: bold;">Recommended for ${riskProfile.riskCategory}</span>
                            </div>
                        </div>
                    `;
                });
                fundHTML += '</div></div>';
            }
            
            fundCategories.innerHTML = fundHTML;
        }

        function generateRecommendations() {
            try {
                const amount = parseFloat(document.getElementById('investment-amount').value) || 0;
                if (amount <= 0) {
                    alert('Please enter a valid investment amount');
                    return;
                }
                
                const clientData = JSON.parse(localStorage.getItem('clientData') || '{}');
                const riskProfile = clientData.riskProfile;
                
                if (!riskProfile) {
                    alert('Please complete your risk assessment first');
                    return;
                }
                
                const allocation = {
                    'Conservative': { equity: 20, debt: 60, gold: 10, cash: 10 },
                    'Moderate Conservative': { equity: 35, debt: 50, gold: 10, cash: 5 },
                    'Moderate': { equity: 50, debt: 35, gold: 10, cash: 5 },
                    'Moderate Aggressive': { equity: 65, debt: 25, gold: 7, cash: 3 },
                    'Aggressive': { equity: 80, debt: 15, gold: 3, cash: 2 }
                }[riskProfile.riskCategory] || { equity: 50, debt: 35, gold: 10, cash: 5 };
                
                const equityAmount = Math.round(amount * allocation.equity / 100);
                const debtAmount = Math.round(amount * allocation.debt / 100);
                const goldAmount = Math.round(amount * allocation.gold / 100);
                const cashAmount = Math.round(amount * allocation.cash / 100);
                
                // Display recommendations in interface
                displayRecommendationsInInterface(amount, allocation, equityAmount, debtAmount, goldAmount, cashAmount, riskProfile);
                
            } catch (error) {
                console.error('Error generating recommendations:', error);
                alert('An error occurred while generating recommendations. Please try again.');
            }
        }
        
        function displayRecommendationsInInterface(amount, allocation, equityAmount, debtAmount, goldAmount, cashAmount, riskProfile) {
            const recommendationContent = document.getElementById('recommendation-content');
            
            recommendationContent.innerHTML = `
                <div style="display: grid; gap: 2rem;">
                    <!-- Investment Summary -->
                    <div style="background: rgba(255,215,0,0.05); border-radius: 12px; padding: 1.5rem; border: 1px solid var(--accent-gold);">
                        <h5 style="color: var(--accent-gold); margin-bottom: 1rem;">
                            <i class="fas fa-coins"></i> Investment Summary
                        </h5>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                            <div style="text-align: center; padding: 1rem; background: rgba(255,255,255,0.02); border-radius: 8px;">
                                <div style="color: var(--text-gray); font-size: 0.9rem;">Total Investment</div>
                                <div style="color: var(--accent-gold); font-size: 1.5rem; font-weight: bold;">₹${amount.toLocaleString('en-IN')}</div>
                            </div>
                            <div style="text-align: center; padding: 1rem; background: rgba(255,255,255,0.02); border-radius: 8px;">
                                <div style="color: var(--text-gray); font-size: 0.9rem;">Risk Profile</div>
                                <div style="color: var(--accent-white); font-size: 1.2rem; font-weight: bold;">${riskProfile.riskCategory}</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Asset Allocation Breakdown -->
                    <div style="background: rgba(255,255,255,0.02); border-radius: 12px; padding: 1.5rem;">
                        <h5 style="color: var(--accent-white); margin-bottom: 1rem;">
                            <i class="fas fa-chart-pie"></i> Recommended Asset Allocation
                        </h5>
                        <div style="display: grid; gap: 1rem;">
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: rgba(255,215,0,0.05); border-radius: 8px;">
                                <div>
                                    <div style="color: var(--accent-gold); font-weight: bold;">Equity</div>
                                    <div style="color: var(--text-gray); font-size: 0.9rem;">Growth-oriented investments</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="color: var(--accent-gold); font-size: 1.3rem; font-weight: bold;">₹${equityAmount.toLocaleString('en-IN')}</div>
                                    <div style="color: var(--text-gray); font-size: 0.9rem;">${allocation.equity}%</div>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: rgba(255,255,255,0.02); border-radius: 8px;">
                                <div>
                                    <div style="color: var(--accent-white); font-weight: bold;">Debt</div>
                                    <div style="color: var(--text-gray); font-size: 0.9rem;">Stable income investments</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="color: var(--accent-white); font-size: 1.3rem; font-weight: bold;">₹${debtAmount.toLocaleString('en-IN')}</div>
                                    <div style="color: var(--text-gray); font-size: 0.9rem;">${allocation.debt}%</div>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: rgba(192,192,192,0.05); border-radius: 8px;">
                                <div>
                                    <div style="color: var(--accent-silver); font-weight: bold;">Gold</div>
                                    <div style="color: var(--text-gray); font-size: 0.9rem;">Inflation hedge</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="color: var(--accent-silver); font-size: 1.3rem; font-weight: bold;">₹${goldAmount.toLocaleString('en-IN')}</div>
                                    <div style="color: var(--text-gray); font-size: 0.9rem;">${allocation.gold}%</div>
                                </div>
                            </div>
                            <div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: rgba(255,255,255,0.02); border-radius: 8px;">
                                <div>
                                    <div style="color: var(--text-gray); font-weight: bold;">Cash</div>
                                    <div style="color: var(--text-gray); font-size: 0.9rem;">Emergency fund</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="color: var(--text-gray); font-size: 1.3rem; font-weight: bold;">₹${cashAmount.toLocaleString('en-IN')}</div>
                                    <div style="color: var(--text-gray); font-size: 0.9rem;">${allocation.cash}%</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Action Steps -->
                    <div style="background: rgba(255,215,0,0.05); border-radius: 12px; padding: 1.5rem; border-left: 4px solid var(--accent-gold);">
                        <h5 style="color: var(--accent-gold); margin-bottom: 1rem;">
                            <i class="fas fa-tasks"></i> Next Steps
                        </h5>
                        <div style="display: grid; gap: 0.8rem;">
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <i class="fas fa-check-circle" style="color: var(--accent-gold);"></i>
                                <span style="color: var(--text-gray);">Start with ${allocation.equity}% equity allocation through diversified mutual funds</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <i class="fas fa-check-circle" style="color: var(--accent-gold);"></i>
                                <span style="color: var(--text-gray);">Allocate ${allocation.debt}% to debt instruments for stability</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <i class="fas fa-check-circle" style="color: var(--accent-gold);"></i>
                                <span style="color: var(--text-gray);">Maintain ${allocation.gold}% gold exposure for portfolio diversification</span>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <i class="fas fa-check-circle" style="color: var(--accent-gold);"></i>
                                <span style="color: var(--text-gray);">Keep ${allocation.cash}% in liquid funds for emergency needs</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Show the recommendations section
            document.getElementById('generated-recommendations').style.display = 'block';
            
            // Smooth scroll to recommendations
            document.getElementById('generated-recommendations').scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
        }

        function calculateSmartRebalancing() {
            // Get current portfolio from Portfolio Analysis input fields
            const currentEquity = parseFloat(document.getElementById('portfolio-equity').value) || 0;
            const currentDebt = parseFloat(document.getElementById('portfolio-debt').value) || 0;
            const currentGold = parseFloat(document.getElementById('portfolio-gold').value) || 0;
            const currentCash = parseFloat(document.getElementById('portfolio-cash').value) || 0;
            
            const totalPortfolio = currentEquity + currentDebt + currentGold + currentCash;
            
            if (totalPortfolio <= 0) {
                alert('Please enter your current portfolio values in the Portfolio Analysis section first');
                return;
            }
            
            const clientData = JSON.parse(localStorage.getItem('clientData') || '{}');
            const riskProfile = clientData.riskProfile;
            
            if (!riskProfile) {
                alert('Please complete your risk assessment first');
                return;
            }
            
            const targetAllocation = {
                'Conservative': { equity: 20, debt: 60, gold: 10, cash: 10 },
                'Moderate Conservative': { equity: 35, debt: 50, gold: 10, cash: 5 },
                'Moderate': { equity: 50, debt: 35, gold: 10, cash: 5 },
                'Moderate Aggressive': { equity: 65, debt: 25, gold: 7, cash: 3 },
                'Aggressive': { equity: 80, debt: 15, gold: 3, cash: 2 }
            }[riskProfile.riskCategory] || { equity: 50, debt: 35, gold: 10, cash: 5 };
            
            const currentAllocation = {
                equity: (currentEquity / totalPortfolio * 100).toFixed(1),
                debt: (currentDebt / totalPortfolio * 100).toFixed(1),
                gold: (currentGold / totalPortfolio * 100).toFixed(1),
                cash: (currentCash / totalPortfolio * 100).toFixed(1)
            };
            
            const targetAmounts = {
                equity: Math.round(totalPortfolio * targetAllocation.equity / 100),
                debt: Math.round(totalPortfolio * targetAllocation.debt / 100),
                gold: Math.round(totalPortfolio * targetAllocation.gold / 100),
                cash: Math.round(totalPortfolio * targetAllocation.cash / 100)
            };
            
            const rebalanceActions = {
                equity: targetAmounts.equity - currentEquity,
                debt: targetAmounts.debt - currentDebt,
                gold: targetAmounts.gold - currentGold,
                cash: targetAmounts.cash - currentCash
            };
            
            const results = document.getElementById('rebalancing-results');
            
            // Show rebalancing comparison when user clicks calculate
            updateRebalancingComparison(currentAllocation, targetAllocation);
            document.getElementById('rebalancing-comparison').style.display = 'block';
            
            // Clear any existing content and ensure results section is ready to display
            results.innerHTML = '';
            
            let actionsHTML = `
                <div style="background: linear-gradient(135deg, rgba(255,255,255,0.02), rgba(0,0,0,0.3)); border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem;">
                    <h5 style="color: var(--accent-white); margin-bottom: 1rem;">Current vs Target Allocation</h5>
                    <div style="display: grid; gap: 0.8rem;">
                        <div style="display: flex; justify-content: space-between; padding: 0.5rem; border-bottom: 1px solid var(--border-gray);">
                            <span style="color: var(--text-gray);">Equity</span>
                            <span style="color: var(--accent-gold);">${currentAllocation.equity}% → ${targetAllocation.equity}%</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 0.5rem; border-bottom: 1px solid var(--border-gray);">
                            <span style="color: var(--text-gray);">Debt</span>
                            <span style="color: var(--accent-white);">${currentAllocation.debt}% → ${targetAllocation.debt}%</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 0.5rem; border-bottom: 1px solid var(--border-gray);">
                            <span style="color: var(--text-gray);">Gold</span>
                            <span style="color: var(--accent-silver);">${currentAllocation.gold}% → ${targetAllocation.gold}%</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 0.5rem;">
                            <span style="color: var(--text-gray);">Cash</span>
                            <span style="color: var(--text-gray);">${currentAllocation.cash}% → ${targetAllocation.cash}%</span>
                        </div>
                    </div>
                </div>
                
                <div style="background: linear-gradient(135deg, rgba(255,215,0,0.05), rgba(0,0,0,0.3)); border: 1px solid var(--accent-gold); border-radius: 12px; padding: 1.5rem;">
                    <h5 style="color: var(--accent-gold); margin-bottom: 1rem;">Recommended Actions</h5>
                    <div style="display: grid; gap: 0.8rem;">
            `;
            
            Object.entries(rebalanceActions).forEach(([asset, amount]) => {
                const action = amount > 0 ? 'Buy' : amount < 0 ? 'Sell' : 'Hold';
                const color = amount > 0 ? 'var(--accent-gold)' : amount < 0 ? 'var(--accent-silver)' : 'var(--text-gray)';
                const absAmount = Math.abs(amount);
                
                if (absAmount > 1000) { // Only show if significant rebalancing needed
                    actionsHTML += `
                        <div style="display: flex; justify-content: space-between; padding: 0.8rem; background: rgba(255,255,255,0.02); border-radius: 6px;">
                            <span style="color: var(--text-gray); text-transform: capitalize;">${asset}</span>
                            <span style="color: ${color}; font-weight: bold;">${action} ₹${absAmount.toLocaleString('en-IN')}</span>
                        </div>
                    `;
                }
            });
            
            actionsHTML += '</div></div>';
            
            // Display the results
            results.innerHTML = actionsHTML;
            results.style.display = 'block';
        }

        function getInvestmentGuidance(riskCategory) {
            const guidance = {
                'Conservative': 'Focus on capital preservation with stable, low-risk investments. Consider high-grade corporate bonds, government securities, and liquid funds for steady returns with minimal volatility.',
                'Moderate Conservative': 'Balance safety with modest growth through conservative equity exposure. Allocate 70% to debt and 30% to large-cap equity funds for steady growth with controlled risk.',
                'Moderate': 'Achieve balanced growth through diversified portfolio. Equal focus on equity and debt instruments with systematic investment approach for optimal risk-adjusted returns.',
                'Moderate Aggressive': 'Target higher growth with strategic equity allocation. Emphasize quality mid-cap and large-cap funds while maintaining some debt for stability during market cycles.',
                'Aggressive': 'Maximize wealth creation through high equity exposure. Focus on growth-oriented funds across market caps, accepting short-term volatility for superior long-term wealth generation.'
            };
            return guidance[riskCategory] || guidance['Moderate'];
        }

        function getActionItems(riskCategory) {
            const actions = {
                'Conservative': [
                    'Start SIP in high-grade debt funds',
                    'Maintain 6-month emergency fund',
                    'Review portfolio every 6 months',
                    'Consider PPF for tax benefits'
                ],
                'Moderate Conservative': [
                    'Begin with large-cap equity SIPs',
                    'Allocate 70% debt, 30% equity gradually',
                    'Review and rebalance quarterly',
                    'Use debt funds for tax efficiency'
                ],
                'Moderate': [
                    'Start balanced SIP in equity & debt',
                    'Maintain 50-35-10-5 allocation',
                    'Rebalance portfolio annually',
                    'Track performance against benchmarks'
                ],
                'Moderate Aggressive': [
                    'Focus on diversified equity SIPs',
                    'Include mid-cap funds for growth',
                    'Rebalance during major market movements',
                    'Increase SIP amount annually'
                ],
                'Aggressive': [
                    'Maximize equity SIP allocation',
                    'Include small & mid-cap opportunities',
                    'Stay invested through market cycles',
                    'Top-up investments during market dips'
                ]
            };
            return actions[riskCategory] || actions['Moderate'];
        }

        function generateInvestmentStrategy(riskProfile) {
            const strategy = document.getElementById('strategy-content');
            const strategies = {
                'Conservative': {
                    title: 'Capital Preservation Strategy',
                    focus: 'Stability and Capital Protection',
                    approach: 'Low-risk investments with steady returns',
                    timeHorizon: 'Short to Medium term (1-5 years)',
                    keyPrinciples: [
                        'Prioritize capital preservation over growth',
                        'Focus on high-grade debt instruments',
                        'Maintain sufficient liquidity for emergencies',
                        'Avoid high-volatility investments'
                    ]
                },
                'Moderate Conservative': {
                    title: 'Balanced Conservative Strategy',
                    focus: 'Steady Growth with Low Risk',
                    approach: 'Balanced mix of debt and selective equity',
                    timeHorizon: 'Medium term (3-7 years)',
                    keyPrinciples: [
                        'Balance between safety and growth',
                        'Gradual equity exposure through large-cap funds',
                        'Regular monitoring and rebalancing',
                        'Focus on dividend-paying stocks'
                    ]
                },
                'Moderate': {
                    title: 'Balanced Growth Strategy',
                    focus: 'Balanced Risk-Return Profile',
                    approach: 'Equal emphasis on growth and stability',
                    timeHorizon: 'Medium to Long term (5-10 years)',
                    keyPrinciples: [
                        'Diversified portfolio across asset classes',
                        'Regular SIP in equity and debt funds',
                        'Annual portfolio rebalancing',
                        'Tax-efficient investment planning'
                    ]
                },
                'Moderate Aggressive': {
                    title: 'Growth-Oriented Strategy',
                    focus: 'Long-term Wealth Creation',
                    approach: 'Growth-focused with calculated risks',
                    timeHorizon: 'Long term (7-15 years)',
                    keyPrinciples: [
                        'Higher equity allocation for growth',
                        'Diversified across market caps',
                        'Stay invested through market cycles',
                        'Focus on quality growth companies'
                    ]
                },
                'Aggressive': {
                    title: 'High Growth Strategy',
                    focus: 'Maximum Wealth Creation',
                    approach: 'High-risk, high-reward investments',
                    timeHorizon: 'Long term (10+ years)',
                    keyPrinciples: [
                        'Maximum equity exposure for growth',
                        'Include mid and small-cap opportunities',
                        'Accept short-term volatility for long-term gains',
                        'Regular top-up investments during market dips'
                    ]
                }
            };
            
            const currentStrategy = strategies[riskProfile.riskCategory] || strategies['Moderate'];
            
            strategy.innerHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <div>
                        <h4 style="color: var(--accent-gold); margin-bottom: 1rem;">${currentStrategy.title}</h4>
                        <div style="background: linear-gradient(135deg, rgba(255,215,0,0.05), rgba(0,0,0,0.3)); border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem;">
                            <div style="display: grid; gap: 1rem;">
                                <div>
                                    <div style="color: var(--text-gray); font-size: 0.9rem; margin-bottom: 0.3rem;">Primary Focus</div>
                                    <div style="color: var(--accent-white); font-weight: bold;">${currentStrategy.focus}</div>
                                </div>
                                <div>
                                    <div style="color: var(--text-gray); font-size: 0.9rem; margin-bottom: 0.3rem;">Investment Approach</div>
                                    <div style="color: var(--accent-white);">${currentStrategy.approach}</div>
                                </div>
                                <div>
                                    <div style="color: var(--text-gray); font-size: 0.9rem; margin-bottom: 0.3rem;">Recommended Time Horizon</div>
                                    <div style="color: var(--accent-gold); font-weight: bold;">${currentStrategy.timeHorizon}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h4 style="color: var(--accent-white); margin-bottom: 1rem;">Key Investment Principles</h4>
                        <div style="background: linear-gradient(135deg, rgba(255,255,255,0.02), rgba(0,0,0,0.3)); border-radius: 12px; padding: 1.5rem;">
                            <ul style="color: var(--text-gray); line-height: 1.8; margin: 0; padding-left: 1.5rem;">
                                ${currentStrategy.keyPrinciples.map(principle => `<li style="margin-bottom: 0.5rem;">${principle}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 2rem; padding: 1.5rem; background: linear-gradient(135deg, rgba(255,255,255,0.02), rgba(0,0,0,0.3)); border-left: 4px solid var(--accent-gold); border-radius: 8px;">
                    <h5 style="color: var(--accent-gold); margin-bottom: 1rem;">Personalized Recommendations for ${riskProfile.riskCategory} Investor</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                        <div>
                            <h6 style="color: var(--accent-white); margin-bottom: 0.5rem;">Investment Guidance</h6>
                            <p style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.6; margin: 0;">
                                ${getInvestmentGuidance(riskProfile.riskCategory)}
                            </p>
                        </div>
                        <div>
                            <h6 style="color: var(--accent-white); margin-bottom: 0.5rem;">Key Action Items</h6>
                            <ul style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.6; margin: 0; padding-left: 1.2rem;">
                                ${getActionItems(riskProfile.riskCategory).map(item => `<li>${item}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }

        // Initialize Portfolio Analysis with integration from Investment Recommendations
        function initializePortfolioAnalysis() {
            // Set date constraints for investment start date
            const dateInput = document.getElementById('investment-start-date');
            if (dateInput) {
                const today = new Date();
                const todayStr = today.toISOString().split('T')[0];
                
                // Set reasonable date range (10 years ago to today)
                const tenYearsAgo = new Date();
                tenYearsAgo.setFullYear(tenYearsAgo.getFullYear() - 10);
                const minDateStr = tenYearsAgo.toISOString().split('T')[0];
                
                dateInput.setAttribute('max', todayStr);
                dateInput.setAttribute('min', minDateStr);
                
                // Set default to 2 years ago if no value
                if (!dateInput.value) {
                    const twoYearsAgo = new Date();
                    twoYearsAgo.setFullYear(twoYearsAgo.getFullYear() - 2);
                    dateInput.value = twoYearsAgo.toISOString().split('T')[0];
                }
                
                console.log('Date input initialized:', {
                    min: minDateStr,
                    max: todayStr,
                    defaultValue: dateInput.value
                });
            }
            
            // Ensure rebalancing results are hidden initially
            const rebalancingResults = document.getElementById('rebalancing-results');
            if (rebalancingResults) {
                rebalancingResults.innerHTML = `
                    <div style="text-align: center; color: var(--text-gray); padding: 2rem;">
                        Click "Calculate Rebalancing Actions" to see what adjustments are needed.
                    </div>
                `;
            }
            
            const clientData = JSON.parse(localStorage.getItem('clientData') || '{}');
            const riskProfile = clientData.riskProfile;
            
            if (riskProfile && riskProfile.riskCategory) {
                // User has risk profile - use personalized data
                loadPortfolioFromRiskProfile(riskProfile);
            } else {
                // No risk profile - show sample data with integration prompt
                showSamplePortfolioWithPrompt();
            }
        }

        function loadPortfolioFromRiskProfile(riskProfile) {
            // Get recommended allocation from Investment Recommendations
            const allocations = {
                'Conservative': { equity: 20, debt: 60, gold: 10, cash: 10 },
                'Moderate Conservative': { equity: 35, debt: 50, gold: 10, cash: 5 },
                'Moderate': { equity: 50, debt: 35, gold: 10, cash: 5 },
                'Moderate Aggressive': { equity: 65, debt: 25, gold: 7, cash: 3 },
                'Aggressive': { equity: 80, debt: 15, gold: 3, cash: 2 }
            };
            
            const recommendedAllocation = allocations[riskProfile.riskCategory] || allocations['Moderate'];
            
            // Create integrated portfolio data based on recommended allocation
            const totalValue = 1000000; // Default portfolio value
            const portfolioData = {
                totalValue: totalValue,
                totalInvested: totalValue * 0.8, // Assume 20% returns
                monthlySIP: 20000,
                startDate: '2022-01-01',
                allocation: {
                    equity: Math.round((totalValue * recommendedAllocation.equity) / 100),
                    debt: Math.round((totalValue * recommendedAllocation.debt) / 100),
                    gold: Math.round((totalValue * recommendedAllocation.gold) / 100),
                    cash: Math.round((totalValue * recommendedAllocation.cash) / 100)
                },
                totalReturns: totalValue * 0.2,
                riskProfile: riskProfile
            };
            
            // Auto-populate input fields with recommended values
            autoPopulatePortfolioInputs(portfolioData);
            
            // Update portfolio overview with integration message
            updatePortfolioOverviewWithIntegration(portfolioData);
            
            // Generate analysis based on user's risk profile
            analyzeAssetAllocation(portfolioData);
            generatePortfolioHealthCheck(portfolioData);
            createPerformanceChart(portfolioData);
        }

        function autoPopulatePortfolioInputs(data) {
            // Auto-fill the input fields with recommended/sample values
            const inputs = {
                'total-portfolio-value': data.totalValue,
                'total-invested': data.totalInvested,
                'monthly-sip': data.monthlySIP,
                'investment-start-date': data.startDate,
                'portfolio-equity': data.allocation.equity,
                'portfolio-debt': data.allocation.debt,
                'portfolio-gold': data.allocation.gold,
                'portfolio-cash': data.allocation.cash
            };
            
            Object.keys(inputs).forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.value = inputs[id];
                    // Add visual indicator that this is auto-populated
                    element.style.backgroundColor = 'rgba(255, 215, 0, 0.05)';
                    element.style.border = '1px solid rgba(255, 215, 0, 0.3)';
                }
            });
            
            // Show integration notice
            const notice = document.getElementById('portfolio-integration-notice');
            if (notice) {
                notice.style.display = 'block';
            }
            
            // Show refresh button
            const refreshBtn = document.getElementById('refresh-portfolio-btn');
            if (refreshBtn) {
                refreshBtn.style.display = 'block';
            }
        }

        // Function removed - refresh button was confusing and not needed

        function showSamplePortfolioWithPrompt() {
            // Show sample notice
            showSamplePortfolioNotice();
            
            // Sample portfolio data for demonstration
            const sampleData = {
                totalValue: 1250000,
                totalInvested: 1000000,
                monthlySIP: 20000,
                startDate: '2022-01-01',
                allocation: { equity: 625000, debt: 437500, gold: 125000, cash: 62500 },
                totalReturns: 250000
            };
            
            // Generate sample analysis
            analyzeAssetAllocation(sampleData);
            generatePortfolioHealthCheck(sampleData);
            createPerformanceChart(sampleData);
        }

        function updatePortfolioOverviewWithIntegration(data) {
            const noticeArea = document.getElementById('portfolio-notice-area');
            if (noticeArea && data.riskProfile) {
                noticeArea.innerHTML = `
                    <div style="text-align: center; padding: 1.5rem; background: rgba(255,215,0,0.05); border: 1px solid var(--accent-gold); border-radius: 8px; margin-bottom: 2rem;">
                        <h5 style="color: var(--accent-gold); margin-bottom: 0.5rem;">Your Portfolio Analysis</h5>
                        <p style="color: var(--text-gray); margin: 0;">Portfolio analysis based on your ${data.riskProfile.riskCategory} risk profile from Investment Recommendations. Values auto-populated from your risk assessment.</p>
                    </div>
                `;
            }
        }

        function updatePortfolioNoticeForUserData() {
            const noticeArea = document.getElementById('portfolio-notice-area');
            if (noticeArea) {
                noticeArea.innerHTML = `
                    <div style="text-align: center; padding: 1.5rem; background: rgba(255,215,0,0.05); border: 1px solid var(--accent-gold); border-radius: 8px; margin-bottom: 2rem;">
                        <h5 style="color: var(--accent-gold); margin-bottom: 0.5rem;">Your Portfolio Analysis</h5>
                        <p style="color: var(--text-gray); margin: 0;">Analysis based on your entered portfolio details. Results calculated using your actual investment data.</p>
                    </div>
                `;
            }
        }

        function showSamplePortfolioNotice() {
            const noticeArea = document.getElementById('portfolio-notice-area');
            if (noticeArea) {
                noticeArea.innerHTML = `
                    <div style="text-align: center; padding: 1.5rem; background: rgba(255,69,0,0.1); border: 2px solid #ff4500; border-radius: 8px; margin-bottom: 2rem;">
                        <h5 style="color: #ff4500; margin-bottom: 0.5rem;"><i class="fas fa-info-circle"></i> Enter Your Portfolio Details</h5>
                        <p style="color: var(--text-gray); margin: 0;">Fill in your actual portfolio values above to get personalized analysis. The data below is just a sample for demonstration purposes.</p>
                    </div>
                `;
            }
        }

        // Portfolio Analysis Functions
        let portfolioAllocationChart = null;
        let portfolioPerformanceChart = null;
        let currentChartPeriod = 'yearly';
        let currentPortfolioData = null;
        
        function selectPortfolioSIPFrequency(frequency) {
            // Update hidden input
            document.getElementById('portfolio-sip-frequency').value = frequency;
            
            // Update button states
            document.querySelectorAll('.frequency-btn').forEach(btn => {
                if (btn.getAttribute('data-frequency')) {
                    btn.classList.remove('active');
                }
            });
            document.querySelector(`[data-frequency="${frequency}"][onclick*="selectPortfolioSIPFrequency"]`).classList.add('active');
            
            // Update labels and placeholders
            const label = document.getElementById('portfolio-sip-label');
            const input = document.getElementById('monthly-sip');
            const info = document.getElementById('portfolio-sip-info');
            
            switch(frequency) {
                case 'monthly':
                    label.textContent = 'Monthly SIP Amount (₹)';
                    input.placeholder = 'Current monthly SIP';
                    info.textContent = 'Amount you invest every month';
                    break;
                case 'quarterly':
                    label.textContent = 'Quarterly SIP Amount (₹)';
                    input.placeholder = 'Current quarterly SIP';
                    info.textContent = 'Amount you invest every quarter (4 times per year)';
                    break;
                case 'semi-annually':
                    label.textContent = 'Semi-Annual SIP Amount (₹)';
                    input.placeholder = 'Current semi-annual SIP';
                    info.textContent = 'Amount you invest every 6 months (2 times per year)';
                    break;
                case 'annually':
                    label.textContent = 'Annual SIP Amount (₹)';
                    input.placeholder = 'Current annual SIP';
                    info.textContent = 'Amount you invest once per year';
                    break;
            }
            
            // Recalculate metrics if there's data
            calculatePortfolioMetrics();
        }
        
        function selectChartPeriod(period) {
            currentChartPeriod = period;
            
            // Update button states
            document.querySelectorAll('.chart-period-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-period="${period}"]`).classList.add('active');
            
            // Recreate chart with new period if data exists
            if (currentPortfolioData) {
                createPerformanceChart(currentPortfolioData);
            }
        }

        function calculatePortfolioMetrics() {
            // Real-time calculation as user types
            const totalValue = parseFloat(document.getElementById('total-portfolio-value').value) || 0;
            const equity = parseFloat(document.getElementById('portfolio-equity').value) || 0;
            const debt = parseFloat(document.getElementById('portfolio-debt').value) || 0;
            const gold = parseFloat(document.getElementById('portfolio-gold').value) || 0;
            const cash = parseFloat(document.getElementById('portfolio-cash').value) || 0;
            
            const allocatedTotal = equity + debt + gold + cash;
            
            // Check if user has entered any real data
            if (totalValue > 0 || allocatedTotal > 0) {
                updatePortfolioNoticeForUserData();
            }
            
            // Removed auto-fill functionality - users must enter their own allocation values
            
            // Update advanced analytics in real-time
            updateAdvancedAnalytics();
        }
        
        function updateAdvancedAnalytics() {
            const totalValue = parseFloat(document.getElementById('total-portfolio-value').value) || 0;
            const totalInvested = parseFloat(document.getElementById('total-invested').value) || 0;
            const goalTarget = parseFloat(document.getElementById('portfolio-goal').value) || 0;
            const expectedReturn = parseFloat(document.getElementById('expected-return').value) || 12;
            const inflationRate = parseFloat(document.getElementById('inflation-rate').value) || 6;
            
            if (totalValue > 0) {
                // Calculate advanced metrics
                const absoluteReturns = totalValue - totalInvested;
                const returnsPercentage = totalInvested > 0 ? ((absoluteReturns / totalInvested) * 100) : 0;
                const realReturn = expectedReturn - inflationRate;
                
                // Update goal progress if goal is set
                if (goalTarget > 0) {
                    updateGoalProgress(totalValue, goalTarget, expectedReturn, inflationRate);
                }
                
                // Calculate portfolio CAGR for fair benchmark comparison
                const portfolioCAGR = calculatePortfolioCAGR(totalValue, totalInvested);
                
                // Update benchmark comparison with CAGR
                updateBenchmarkComparison(portfolioCAGR, expectedReturn);
                
                // Update analytics content
                updateAnalyticsContent(absoluteReturns, returnsPercentage, realReturn, expectedReturn, inflationRate, portfolioCAGR);
            }
        }
        
        function updateGoalProgress(currentValue, goalTarget, expectedReturn, inflationRate) {
            const progressPercentage = (currentValue / goalTarget) * 100;
            const remainingAmount = goalTarget - currentValue;
            
            // Calculate time to goal with current SIP
            const monthlySIP = parseFloat(document.getElementById('monthly-sip').value) || 0;
            const sipFrequency = document.getElementById('portfolio-sip-frequency').value || 'monthly';
            
            const frequencyMultiplier = {
                'monthly': 12,
                'quarterly': 4,
                'semi-annually': 2,
                'annually': 1
            };
            
            const annualSIP = monthlySIP * frequencyMultiplier[sipFrequency];
            
            let timeToGoal = 'N/A';
            if (annualSIP > 0 && expectedReturn > 0) {
                // PMT formula to calculate time
                const monthlyRate = expectedReturn / 12 / 100;
                const pv = currentValue;
                const fv = goalTarget;
                const pmt = monthlySIP * (sipFrequency === 'monthly' ? 1 : frequencyMultiplier[sipFrequency] / 12);
                
                if (pmt > 0) {
                    const months = Math.log((fv * monthlyRate + pmt) / (pv * monthlyRate + pmt)) / Math.log(1 + monthlyRate);
                    const years = Math.floor(months / 12);
                    const remainingMonths = Math.floor(months % 12);
                    timeToGoal = years > 0 ? `${years}y ${remainingMonths}m` : `${remainingMonths}m`;
                }
            }
            
            const goalProgressHTML = `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                    <div>
                        <div style="margin-bottom: 1rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span style="color: var(--text-gray);">Progress</span>
                                <span style="color: var(--accent-gold); font-weight: bold;">${progressPercentage.toFixed(1)}%</span>
                            </div>
                            <div style="background: var(--primary-black); border-radius: 10px; height: 20px; overflow: hidden;">
                                <div style="background: linear-gradient(90deg, var(--accent-gold), #ffed4a); height: 100%; width: ${Math.min(progressPercentage, 100)}%; transition: width 0.3s ease;"></div>
                            </div>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; text-align: center;">
                            <div style="padding: 1rem; background: rgba(255,215,0,0.1); border-radius: 8px;">
                                <div style="color: var(--accent-gold); font-size: 1.2rem; font-weight: bold;">₹${currentValue.toLocaleString('en-IN')}</div>
                                <div style="color: var(--text-gray); font-size: 0.85rem;">Current Value</div>
                            </div>
                            <div style="padding: 1rem; background: rgba(255,215,0,0.05); border: 1px solid var(--accent-gold); border-radius: 8px;">
                                <div style="color: var(--accent-gold); font-size: 1.2rem; font-weight: bold;">₹${goalTarget.toLocaleString('en-IN')}</div>
                                <div style="color: var(--text-gray); font-size: 0.85rem;">Target Goal</div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <div style="display: grid; gap: 1rem;">
                            <div style="padding: 1rem; background: rgba(255,255,255,0.02); border-radius: 8px; text-align: center;">
                                <div style="color: var(--accent-white); font-size: 1.2rem; font-weight: bold;">₹${remainingAmount.toLocaleString('en-IN')}</div>
                                <div style="color: var(--text-gray); font-size: 0.85rem;">Remaining Amount</div>
                            </div>
                            <div style="padding: 1rem; background: rgba(255,255,255,0.02); border-radius: 8px; text-align: center;">
                                <div style="color: var(--accent-white); font-size: 1.2rem; font-weight: bold;">${timeToGoal}</div>
                                <div style="color: var(--text-gray); font-size: 0.85rem;">Time to Goal</div>
                            </div>
                        </div>
                        
                        ${progressPercentage >= 100 ? 
                            '<div style="margin-top: 1rem; padding: 1rem; background: rgba(0,255,0,0.1); border: 1px solid #00ff00; border-radius: 8px; text-align: center;"><div style="color: #00ff00; font-weight: bold;"><i class="fas fa-trophy"></i> Goal Achieved!</div></div>' :
                            progressPercentage >= 75 ? 
                            '<div style="margin-top: 1rem; padding: 1rem; background: rgba(255,215,0,0.1); border: 1px solid var(--accent-gold); border-radius: 8px; text-align: center;"><div style="color: var(--accent-gold); font-weight: bold;"><i class="fas fa-fire"></i> Almost There!</div></div>' :
                            '<div style="margin-top: 1rem; padding: 1rem; background: rgba(255,255,255,0.02); border-radius: 8px; text-align: center;"><div style="color: var(--text-gray);"><i class="fas fa-chart-line"></i> Keep Building!</div></div>'
                        }
                    </div>
                </div>
            `;
            
            document.getElementById('goal-progress-content').innerHTML = goalProgressHTML;
            document.getElementById('goal-progress-section').style.display = 'block';
        }
        
        function calculatePortfolioCAGR(currentValue, totalInvested) {
            const startDate = document.getElementById('investment-start-date').value;
            
            if (!startDate || totalInvested <= 0 || currentValue <= 0) {
                return 0;
            }
            
            // Calculate investment duration in years
            const startDateObj = new Date(startDate);
            const currentDate = new Date();
            const timeDiffMs = currentDate - startDateObj;
            const years = timeDiffMs / (1000 * 60 * 60 * 24 * 365.25); // Account for leap years
            
            if (years <= 0) {
                return 0;
            }
            
            // CAGR formula: ((Final Value / Initial Value)^(1/years)) - 1
            const cagr = (Math.pow(currentValue / totalInvested, 1 / years) - 1) * 100;
            
            return cagr;
        }

        function updateBenchmarkComparison(portfolioCAGR, expectedReturn) {
            const niftyReturn = 12; // Nifty 50 historical average
            const sensexReturn = 11.5; // Sensex historical average
            const fdReturn = 6.5; // FD average return
            
            const benchmarkHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                    <div style="padding: 1rem; background: ${portfolioCAGR > niftyReturn ? 'rgba(0,255,0,0.1)' : 'rgba(255,107,107,0.1)'}; border: 1px solid ${portfolioCAGR > niftyReturn ? '#00ff00' : '#ff6b6b'}; border-radius: 8px; text-align: center;">
                        <div style="color: var(--text-gray); font-size: 0.85rem; margin-bottom: 0.5rem;">vs Nifty 50 CAGR</div>
                        <div style="color: ${portfolioCAGR > niftyReturn ? '#00ff00' : '#ff6b6b'}; font-size: 1.2rem; font-weight: bold;">
                            ${portfolioCAGR > niftyReturn ? '+' : ''}${(portfolioCAGR - niftyReturn).toFixed(1)}%
                        </div>
                        <div style="color: var(--text-gray); font-size: 0.8rem;">${portfolioCAGR.toFixed(1)}% vs ${niftyReturn}%</div>
                    </div>
                    
                    <div style="padding: 1rem; background: ${portfolioCAGR > sensexReturn ? 'rgba(0,255,0,0.1)' : 'rgba(255,107,107,0.1)'}; border: 1px solid ${portfolioCAGR > sensexReturn ? '#00ff00' : '#ff6b6b'}; border-radius: 8px; text-align: center;">
                        <div style="color: var(--text-gray); font-size: 0.85rem; margin-bottom: 0.5rem;">vs Sensex CAGR</div>
                        <div style="color: ${portfolioCAGR > sensexReturn ? '#00ff00' : '#ff6b6b'}; font-size: 1.2rem; font-weight: bold;">
                            ${portfolioCAGR > sensexReturn ? '+' : ''}${(portfolioCAGR - sensexReturn).toFixed(1)}%
                        </div>
                        <div style="color: var(--text-gray); font-size: 0.8rem;">${portfolioCAGR.toFixed(1)}% vs ${sensexReturn}%</div>
                    </div>
                    
                    <div style="padding: 1rem; background: ${portfolioCAGR > fdReturn ? 'rgba(0,255,0,0.1)' : 'rgba(255,107,107,0.1)'}; border: 1px solid ${portfolioCAGR > fdReturn ? '#00ff00' : '#ff6b6b'}; border-radius: 8px; text-align: center;">
                        <div style="color: var(--text-gray); font-size: 0.85rem; margin-bottom: 0.5rem;">vs Fixed Deposits</div>
                        <div style="color: ${portfolioCAGR > fdReturn ? '#00ff00' : '#ff6b6b'}; font-size: 1.2rem; font-weight: bold;">
                            ${portfolioCAGR > fdReturn ? '+' : ''}${(portfolioCAGR - fdReturn).toFixed(1)}%
                        </div>
                        <div style="color: var(--text-gray); font-size: 0.8rem;">${portfolioCAGR.toFixed(1)}% vs ${fdReturn}%</div>
                    </div>
                </div>
                
                <div style="margin-top: 1rem; padding: 1rem; background: rgba(255,255,255,0.02); border-radius: 8px;">
                    <div style="color: var(--accent-silver); font-weight: bold; margin-bottom: 0.5rem;"><i class="fas fa-info-circle"></i> CAGR Performance Analysis</div>
                    <div style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.5;">
                        ${portfolioCAGR > niftyReturn && portfolioCAGR > sensexReturn ? 
                            'Excellent! Your portfolio CAGR is outperforming major market indices. Keep up the good work!' :
                            portfolioCAGR > fdReturn ?
                            'Good performance! Your portfolio CAGR is beating traditional investments like FDs, but there\'s room for improvement against market indices.' :
                            portfolioCAGR > 0 ?
                            'Your portfolio CAGR needs attention. Consider reviewing your asset allocation and investment strategy.' :
                            'Please ensure you have entered valid investment start date and amounts to calculate CAGR.'
                        }
                    </div>
                </div>
            `;
            
            document.getElementById('benchmark-content').innerHTML = benchmarkHTML;
        }
        
        function updateAnalyticsContent(absoluteReturns, returnsPercentage, realReturn, expectedReturn, inflationRate, portfolioCAGR) {
            const analyticsHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                    <div style="padding: 1rem; background: rgba(255,215,0,0.05); border: 1px solid var(--accent-gold); border-radius: 8px;">
                        <div style="color: var(--accent-gold); font-weight: bold; margin-bottom: 0.5rem;"><i class="fas fa-chart-line"></i> Return Analysis</div>
                        <div style="display: grid; gap: 0.5rem;">
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: var(--text-gray);">Absolute Returns:</span>
                                <span style="color: var(--accent-gold); font-weight: bold;">₹${absoluteReturns.toLocaleString('en-IN')}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: var(--text-gray);">Returns %:</span>
                                <span style="color: var(--accent-gold); font-weight: bold;">${returnsPercentage.toFixed(2)}%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: var(--text-gray);">Portfolio CAGR:</span>
                                <span style="color: var(--accent-gold); font-weight: bold;">${portfolioCAGR.toFixed(1)}%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: var(--text-gray);">Real Return:</span>
                                <span style="color: var(--accent-white); font-weight: bold;">${realReturn.toFixed(1)}%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="padding: 1rem; background: rgba(255,255,255,0.02); border: 1px solid var(--border-gray); border-radius: 8px;">
                        <div style="color: var(--accent-white); font-weight: bold; margin-bottom: 0.5rem;"><i class="fas fa-calculator"></i> Risk Metrics</div>
                        <div style="display: grid; gap: 0.5rem;">
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: var(--text-gray);">Expected Return:</span>
                                <span style="color: var(--accent-white); font-weight: bold;">${expectedReturn}%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: var(--text-gray);">Inflation Rate:</span>
                                <span style="color: var(--accent-silver); font-weight: bold;">${inflationRate}%</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: var(--text-gray);">Risk Premium:</span>
                                <span style="color: var(--accent-gold); font-weight: bold;">${(expectedReturn - 6.5).toFixed(1)}%</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 1rem; padding: 1rem; background: rgba(192,192,192,0.03); border: 1px solid var(--accent-silver); border-radius: 8px;">
                    <div style="color: var(--accent-silver); font-weight: bold; margin-bottom: 0.5rem;"><i class="fas fa-lightbulb"></i> Smart Insights</div>
                    <div style="color: var(--text-gray); font-size: 0.9rem; line-height: 1.5;">
                        ${realReturn > 6 ? 
                            'Your portfolio is generating strong real returns after inflation. This is excellent for long-term wealth building.' :
                            realReturn > 3 ?
                            'Your portfolio is beating inflation moderately. Consider optimizing for higher real returns.' :
                            'Your portfolio may not be keeping pace with inflation effectively. Review your asset allocation strategy.'
                        }
                    </div>
                </div>
            `;
            
            document.getElementById('analytics-content').innerHTML = analyticsHTML;
        }

        function analyzePortfolio() {
            try {
                const totalValue = parseFloat(document.getElementById('total-portfolio-value').value) || 0;
                const totalInvested = parseFloat(document.getElementById('total-invested').value) || 0;
                const monthlySIP = parseFloat(document.getElementById('monthly-sip').value) || 0;
                const startDate = document.getElementById('investment-start-date').value;
                
                const equity = parseFloat(document.getElementById('portfolio-equity').value) || 0;
                const debt = parseFloat(document.getElementById('portfolio-debt').value) || 0;
                const gold = parseFloat(document.getElementById('portfolio-gold').value) || 0;
                const cash = parseFloat(document.getElementById('portfolio-cash').value) || 0;
                
                // Validation
                if (totalValue <= 0) {
                    alert('Please enter your total portfolio value');
                    return;
                }
                
                const totalAllocation = equity + debt + gold + cash;
                if (totalAllocation <= 0) {
                    alert('Please enter your asset allocation details');
                    return;
                }
            
            // Calculate portfolio metrics
            const actualInvested = totalInvested || (totalValue * 0.8); // Default to 80% if not provided (assume 20% returns)
            const portfolioData = {
                totalValue: totalValue,
                totalInvested: actualInvested,
                monthlySIP: monthlySIP,
                startDate: startDate,
                allocation: { equity, debt, gold, cash },
                totalReturns: totalValue - actualInvested
            };
            
            // Update notice to show this is user's real data analysis
            updatePortfolioNoticeForUserData();
            
            // Show loading message
            const loadingMessage = document.createElement('div');
            loadingMessage.id = 'portfolio-loading';
            loadingMessage.style.cssText = 'text-align: center; padding: 2rem; color: var(--accent-gold); font-size: 1.2rem;';
            loadingMessage.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyzing your portfolio...';
            document.getElementById('portfolio-overview').style.display = 'block';
            document.getElementById('portfolio-overview').appendChild(loadingMessage);
            
            // Perform analysis with a small delay for better UX
            setTimeout(() => {
                generatePortfolioOverview(portfolioData);
                analyzeAssetAllocation(portfolioData);
                generatePortfolioHealthCheck(portfolioData);
                createPerformanceChart(portfolioData);
                
                // Remove loading message
                const loading = document.getElementById('portfolio-loading');
                if (loading) loading.remove();
            }, 500);
            
            // Show analysis sections
            document.getElementById('portfolio-overview').style.display = 'block';
            document.getElementById('allocation-analysis').style.display = 'block';
            document.getElementById('portfolio-health').style.display = 'block';
            document.getElementById('performance-chart').style.display = 'block';
            
            console.log('Portfolio analysis completed successfully');
            
        } catch (error) {
            console.error('Error in portfolio analysis:', error);
            alert('An error occurred during portfolio analysis. Please check your inputs and try again.');
        }
    }

        function generatePortfolioOverview(data) {
            try {
                const returnPercentage = ((data.totalReturns / data.totalInvested) * 100).toFixed(2);
            
            // Calculate investment duration
            let months = 12; // Default if no start date
            let years = 1;
            
            if (data.startDate && data.startDate !== '') {
                const start = new Date(data.startDate);
                const now = new Date();
                
                // Validate dates
                if (!isNaN(start.getTime()) && start <= now) {
                    const diffTime = Math.abs(now - start);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    months = Math.max(1, Math.round(diffDays / 30.44)); // More accurate month calculation
                    years = Math.max(0.08, months / 12); // Minimum 1 month for calculation
                } else {
                    // Invalid date, use default
                    console.warn('Invalid start date provided:', data.startDate);
                }
            }
            
            // Calculate CAGR (Nominal)
            const nominalCAGR = years > 0 ? (Math.pow(data.totalValue / data.totalInvested, 1 / years) - 1) * 100 : 0;
            
            // Get inflation rate and calculate Real CAGR
            const inflationRate = parseFloat(document.getElementById('inflation-rate').value) || 6;
            const realCAGR = ((1 + nominalCAGR/100) / (1 + inflationRate/100) - 1) * 100;
            
            // Debug logging
            console.log('Portfolio Analysis Debug:', {
                startDate: data.startDate,
                months, years,
                nominalCAGR: nominalCAGR.toFixed(2),
                inflationRate,
                realCAGR: realCAGR.toFixed(2),
                totalValue: data.totalValue,
                totalInvested: data.totalInvested
            });
            
            // Calculate inflation-adjusted returns
            const inflationAdjustedValue = data.totalInvested * Math.pow(1 + inflationRate/100, years);
            const realReturns = data.totalValue - inflationAdjustedValue;
            const realReturnPercentage = ((realReturns / data.totalInvested) * 100).toFixed(2);
            
            // Calculate portfolio health score
            const healthScore = calculatePortfolioHealthScore(data);
            
            // Update display with both nominal and real values
            document.getElementById('portfolio-total-returns').innerHTML = `
                <div style="display: flex; flex-direction: column; gap: 0.3rem;">
                    <div style="color: var(--accent-gold);">₹${Math.round(data.totalReturns).toLocaleString('en-IN')}</div>
                    <div style="font-size: 0.85rem; color: var(--text-gray);">Real: ₹${Math.round(realReturns).toLocaleString('en-IN')}</div>
                </div>
            `;
            
            document.getElementById('portfolio-returns-percentage').innerHTML = `
                <div style="display: flex; flex-direction: column; gap: 0.3rem;">
                    <div style="color: var(--accent-gold);">${returnPercentage}%</div>
                    <div style="font-size: 0.85rem; color: var(--text-gray);">Real: ${realReturnPercentage}%</div>
                </div>
            `;
            
            document.getElementById('portfolio-annual-return').innerHTML = `
                <div style="display: flex; flex-direction: column; gap: 0.3rem;">
                    <div style="color: var(--accent-gold);">${nominalCAGR.toFixed(2)}%</div>
                    <div style="font-size: 0.85rem; color: var(--text-gray);">Real: ${realCAGR.toFixed(2)}%</div>
                </div>
            `;
            
            document.getElementById('portfolio-health-score').textContent = healthScore;
            document.getElementById('portfolio-duration').textContent = `${months} months (${years.toFixed(1)} years)`;
            
        } catch (error) {
            console.error('Error in generatePortfolioOverview:', error);
            // Show error message to user
            document.getElementById('portfolio-total-returns').innerHTML = '<span style="color: #ff6b6b;">Error calculating returns</span>';
        }
    }

        function calculatePortfolioHealthScore(data) {
            let score = 0;
            const allocation = data.allocation;
            const total = allocation.equity + allocation.debt + allocation.gold + allocation.cash;
            
            if (total <= 0) return 0;
            
            // Get user's risk profile for optimal allocation
            const clientData = JSON.parse(localStorage.getItem('clientData') || '{}');
            const riskProfile = clientData.riskProfile;
            
            const optimalAllocation = riskProfile ? {
                'Conservative': { equity: 20, debt: 60, gold: 10, cash: 10 },
                'Moderate Conservative': { equity: 35, debt: 50, gold: 10, cash: 5 },
                'Moderate': { equity: 50, debt: 35, gold: 10, cash: 5 },
                'Moderate Aggressive': { equity: 65, debt: 25, gold: 7, cash: 3 },
                'Aggressive': { equity: 80, debt: 15, gold: 3, cash: 2 }
            }[riskProfile.riskCategory] : { equity: 50, debt: 35, gold: 10, cash: 5 };
            
            // Calculate current allocation percentages
            const currentAllocation = {
                equity: (allocation.equity / total) * 100,
                debt: (allocation.debt / total) * 100,
                gold: (allocation.gold / total) * 100,
                cash: (allocation.cash / total) * 100
            };
            
            // Score based on allocation alignment (40 points)
            Object.keys(optimalAllocation).forEach(asset => {
                const diff = Math.abs(currentAllocation[asset] - optimalAllocation[asset]);
                const alignment = Math.max(0, 10 - diff); // 10 points per asset
                score += alignment;
            });
            
            // Score based on diversification (20 points)
            const nonZeroAssets = Object.values(currentAllocation).filter(val => val > 0).length;
            score += nonZeroAssets * 5; // 5 points per diversified asset
            
            // Score based on returns (40 points)
            const returnPercentage = (data.totalReturns / data.totalInvested) * 100;
            if (returnPercentage > 15) score += 40;
            else if (returnPercentage > 10) score += 30;
            else if (returnPercentage > 5) score += 20;
            else if (returnPercentage > 0) score += 10;
            
            return Math.min(100, Math.round(score));
        }

        function analyzeAssetAllocation(data) {
            const allocation = data.allocation;
            const total = allocation.equity + allocation.debt + allocation.gold + allocation.cash;
            
            if (total <= 0) return;
            
            // Calculate current allocation percentages
            const currentAllocation = {
                equity: ((allocation.equity / total) * 100).toFixed(1),
                debt: ((allocation.debt / total) * 100).toFixed(1),
                gold: ((allocation.gold / total) * 100).toFixed(1),
                cash: ((allocation.cash / total) * 100).toFixed(1)
            };
            
            // Get recommended allocation
            const clientData = JSON.parse(localStorage.getItem('clientData') || '{}');
            const riskProfile = clientData.riskProfile;
            const recommendedAllocation = riskProfile ? {
                'Conservative': { equity: 20, debt: 60, gold: 10, cash: 10 },
                'Moderate Conservative': { equity: 35, debt: 50, gold: 10, cash: 5 },
                'Moderate': { equity: 50, debt: 35, gold: 10, cash: 5 },
                'Moderate Aggressive': { equity: 65, debt: 25, gold: 7, cash: 3 },
                'Aggressive': { equity: 80, debt: 15, gold: 3, cash: 2 }
            }[riskProfile.riskCategory] : { equity: 50, debt: 35, gold: 10, cash: 5 };
            
            // Display current allocation
            const currentBreakdown = document.getElementById('current-allocation-breakdown');
            currentBreakdown.innerHTML = `
                <div style="display: grid; gap: 1rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.8rem; background: rgba(255,215,0,0.05); border-radius: 8px;">
                        <span style="color: var(--text-gray);">Equity</span>
                        <span style="color: var(--accent-gold); font-weight: bold;">${currentAllocation.equity}%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.8rem; background: rgba(255,255,255,0.02); border-radius: 8px;">
                        <span style="color: var(--text-gray);">Debt</span>
                        <span style="color: var(--accent-white); font-weight: bold;">${currentAllocation.debt}%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.8rem; background: rgba(192,192,192,0.05); border-radius: 8px;">
                        <span style="color: var(--text-gray);">Gold</span>
                        <span style="color: var(--accent-silver); font-weight: bold;">${currentAllocation.gold}%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.8rem; background: rgba(255,255,255,0.02); border-radius: 8px;">
                        <span style="color: var(--text-gray);">Cash</span>
                        <span style="color: var(--text-gray); font-weight: bold;">${currentAllocation.cash}%</span>
                    </div>
                </div>
            `;
            
            // Display recommended allocation
            const recommendedBreakdown = document.getElementById('recommended-allocation-breakdown');
            recommendedBreakdown.innerHTML = `
                <div style="display: grid; gap: 1rem;">
                    <div style="display: flex; justify-content: space-between; padding: 0.8rem; background: rgba(255,215,0,0.05); border-radius: 8px;">
                        <span style="color: var(--text-gray);">Equity</span>
                        <span style="color: var(--accent-gold); font-weight: bold;">${recommendedAllocation.equity}%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.8rem; background: rgba(255,255,255,0.02); border-radius: 8px;">
                        <span style="color: var(--text-gray);">Debt</span>
                        <span style="color: var(--accent-white); font-weight: bold;">${recommendedAllocation.debt}%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.8rem; background: rgba(192,192,192,0.05); border-radius: 8px;">
                        <span style="color: var(--text-gray);">Gold</span>
                        <span style="color: var(--accent-silver); font-weight: bold;">${recommendedAllocation.gold}%</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 0.8rem; background: rgba(255,255,255,0.02); border-radius: 8px;">
                        <span style="color: var(--text-gray);">Cash</span>
                        <span style="color: var(--text-gray); font-weight: bold;">${recommendedAllocation.cash}%</span>
                    </div>
                </div>
            `;
            
            // Create allocation chart
            createPortfolioAllocationChart(currentAllocation);
            
            // Generate allocation insights
            generateAllocationInsights(currentAllocation, recommendedAllocation, data.totalValue);
            
            // Don't show rebalancing comparison automatically - only when user clicks calculate
        }

        function createPortfolioAllocationChart(allocation) {
            const ctx = document.getElementById('portfolioAllocationChart').getContext('2d');
            
            if (portfolioAllocationChart) {
                portfolioAllocationChart.destroy();
            }
            
            portfolioAllocationChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Equity', 'Debt', 'Gold', 'Cash'],
                    datasets: [{
                        data: [allocation.equity, allocation.debt, allocation.gold, allocation.cash],
                        backgroundColor: ['#ffd700', '#ffffff', '#c0c0c0', '#666666'],
                        borderColor: ['#000000', '#000000', '#000000', '#000000'],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: false,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#ffffff',
                                font: { size: 12 },
                                padding: 20
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.9)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#ffd700',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + parseFloat(context.parsed).toFixed(1) + '%';
                                }
                            }
                        }
                    },
                    cutout: '60%'
                }
            });
        }

        function generateAllocationInsights(current, recommended, totalValue) {
            const insights = document.getElementById('allocation-insights');
            
            // Removed rebalancing calculation - only calculated when user clicks "Calculate Rebalancing Actions"
            
            let insightsHTML = `
                <div style="background: linear-gradient(135deg, rgba(255,255,255,0.02), rgba(0,0,0,0.3)); border-radius: 12px; padding: 1.5rem;">
                    <h5 style="color: var(--accent-white); margin-bottom: 1rem;">Allocation Analysis</h5>
            `;
            
            // Removed automatic rebalancing recommendations - only show when user clicks "Calculate Rebalancing Actions"
            
            insightsHTML += `
                    <div style="padding: 1rem; background: rgba(255,215,0,0.05); border-left: 4px solid var(--accent-gold); border-radius: 4px;">
                        <h6 style="color: var(--accent-gold); margin-bottom: 0.5rem;">Portfolio Insights</h6>
                        <ul style="color: var(--text-gray); line-height: 1.6; margin: 0; padding-left: 1.5rem;">
                            <li>Current allocation shows ${parseFloat(current.equity) > 50 ? 'growth-oriented' : 'conservative'} approach</li>
                            <li>${parseFloat(current.debt) > 40 ? 'Strong debt allocation provides stability' : 'Consider increasing debt for stability'}</li>
                            <li>${parseFloat(current.gold) > 5 ? 'Good inflation hedge with gold allocation' : 'Consider adding gold for diversification'}</li>
                            <li>Review allocation quarterly to maintain optimal balance</li>
                        </ul>
                    </div>
                </div>
            `;
            
            insights.innerHTML = insightsHTML;
        }
        
        function updateRebalancingComparison(current, recommended) {
            const comparison = document.getElementById('rebalancing-comparison');
            if (!comparison) return;
            
            comparison.innerHTML = `
                <div style="background: linear-gradient(135deg, rgba(255,255,255,0.02), rgba(0,0,0,0.3)); border-radius: 12px; padding: 1.5rem;">
                    <h5 style="color: var(--accent-white); margin-bottom: 1rem;">Current vs Target Allocation</h5>
                    <div style="display: grid; gap: 1rem;">
                        ${Object.keys(recommended).map(asset => {
                            const currentPercent = parseFloat(current[asset]);
                            const targetPercent = recommended[asset];
                            const difference = targetPercent - currentPercent;
                            const status = Math.abs(difference) <= 2 ? 'balanced' : difference > 0 ? 'underweight' : 'overweight';
                            const statusColor = status === 'balanced' ? 'var(--accent-gold)' : status === 'underweight' ? 'var(--accent-white)' : 'var(--accent-silver)';
                            
                            return `
                                <div style="display: grid; grid-template-columns: 1fr 2fr 1fr; gap: 1rem; align-items: center; padding: 1rem; background: rgba(255,255,255,0.02); border-radius: 8px;">
                                    <div style="text-transform: capitalize; color: var(--accent-white); font-weight: bold;">${asset}</div>
                                    <div style="display: flex; align-items: center; gap: 1rem;">
                                        <div style="flex: 1; background: var(--border-gray); height: 8px; border-radius: 4px; overflow: hidden;">
                                            <div style="background: var(--accent-gold); height: 100%; width: ${currentPercent}%; transition: width 0.3s ease;"></div>
                                        </div>
                                        <div style="color: var(--text-gray); font-size: 0.9rem; min-width: 80px;">${currentPercent}% → ${targetPercent}%</div>
                                    </div>
                                    <div style="color: ${statusColor}; font-weight: bold; text-align: center; font-size: 0.9rem;">
                                        ${status === 'balanced' ? 'Balanced' : status === 'underweight' ? `+${Math.abs(difference).toFixed(1)}%` : `-${Math.abs(difference).toFixed(1)}%`}
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        function generatePortfolioHealthCheck(data) {
            const healthScore = calculatePortfolioHealthScore(data);
            const returnPercentage = (data.totalReturns / data.totalInvested) * 100;
            
            // Health metrics
            const metrics = document.getElementById('health-metrics');
            metrics.innerHTML = `
                <div style="background: linear-gradient(135deg, rgba(255,215,0,0.05), rgba(0,0,0,0.3)); border: 1px solid var(--accent-gold); border-radius: 12px; padding: 1.5rem;">
                    <h5 style="color: var(--accent-gold); margin-bottom: 1rem;">Performance Rating</h5>
                    <div style="font-size: 2rem; font-weight: bold; color: var(--accent-gold); text-align: center; margin: 1rem 0;">
                        ${healthScore >= 80 ? 'Excellent' : healthScore >= 60 ? 'Good' : healthScore >= 40 ? 'Average' : 'Needs Improvement'}
                    </div>
                    <div style="background: var(--border-gray); border-radius: 10px; height: 10px; overflow: hidden;">
                        <div style="background: var(--accent-gold); height: 100%; width: ${healthScore}%; transition: width 0.3s ease;"></div>
                    </div>
                    <div style="text-align: center; color: var(--text-gray); margin-top: 0.5rem;">${healthScore}/100</div>
                </div>
                
                <div style="background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(0,0,0,0.3)); border: 1px solid var(--accent-white); border-radius: 12px; padding: 1.5rem;">
                    <h5 style="color: var(--accent-white); margin-bottom: 1rem;">Risk Assessment</h5>
                    <div style="display: grid; gap: 0.8rem;">
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--text-gray);">Volatility Risk</span>
                            <span style="color: var(--accent-white);">${parseFloat(document.getElementById('portfolio-equity').value || 0) > 70 ? 'High' : parseFloat(document.getElementById('portfolio-equity').value || 0) > 40 ? 'Medium' : 'Low'}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--text-gray);">Diversification</span>
                            <span style="color: var(--accent-white);">${Object.values(data.allocation).filter(v => v > 0).length >= 3 ? 'Good' : 'Needs Improvement'}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--text-gray);">Return Potential</span>
                            <span style="color: var(--accent-white);">${returnPercentage > 12 ? 'High' : returnPercentage > 8 ? 'Medium' : 'Low'}</span>
                        </div>
                    </div>
                </div>
                
                <div style="background: linear-gradient(135deg, rgba(192,192,192,0.05), rgba(0,0,0,0.3)); border: 1px solid var(--accent-silver); border-radius: 12px; padding: 1.5rem;">
                    <h5 style="color: var(--accent-silver); margin-bottom: 1rem;">Portfolio Statistics</h5>
                    <div style="display: grid; gap: 0.8rem;">
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--text-gray);">Total Assets</span>
                            <span style="color: var(--accent-silver);">${Object.values(data.allocation).filter(v => v > 0).length}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--text-gray);">Largest Holding</span>
                            <span style="color: var(--accent-silver);">${Math.max(...Object.values(data.allocation)) === data.allocation.equity ? 'Equity' : Math.max(...Object.values(data.allocation)) === data.allocation.debt ? 'Debt' : Math.max(...Object.values(data.allocation)) === data.allocation.gold ? 'Gold' : 'Cash'}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: var(--text-gray);">Risk Level</span>
                            <span style="color: var(--accent-silver);">${parseFloat(document.getElementById('portfolio-equity').value || 0) / data.totalValue * 100 > 60 ? 'Aggressive' : parseFloat(document.getElementById('portfolio-equity').value || 0) / data.totalValue * 100 > 40 ? 'Moderate' : 'Conservative'}</span>
                        </div>
                    </div>
                </div>
            `;
            
            // Generate recommendations
            const recommendations = document.getElementById('portfolio-recommendations');
            let recommendationHTML = `
                <div style="background: linear-gradient(135deg, rgba(255,255,255,0.02), rgba(0,0,0,0.3)); border-left: 4px solid var(--accent-gold); border-radius: 8px; padding: 1.5rem;">
                    <h5 style="color: var(--accent-gold); margin-bottom: 1rem;">Portfolio Recommendations</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                        <div>
                            <h6 style="color: var(--accent-white); margin-bottom: 0.5rem;">Immediate Actions</h6>
                            <ul style="color: var(--text-gray); line-height: 1.6; margin: 0; padding-left: 1.2rem;">
            `;
            
            if (healthScore < 60) {
                recommendationHTML += '<li>Rebalance portfolio to align with risk profile</li>';
            }
            if (returnPercentage < 8) {
                recommendationHTML += '<li>Consider increasing equity allocation for better returns</li>';
            }
            if (Object.values(data.allocation).filter(v => v > 0).length < 3) {
                recommendationHTML += '<li>Improve diversification across asset classes</li>';
            }
            if (data.monthlySIP === 0) {
                recommendationHTML += '<li>Start regular SIP investments for better accumulation</li>';
            }
            
            recommendationHTML += `
                            </ul>
                        </div>
                        <div>
                            <h6 style="color: var(--accent-white); margin-bottom: 0.5rem;">Long-term Strategy</h6>
                            <ul style="color: var(--text-gray); line-height: 1.6; margin: 0; padding-left: 1.2rem;">
                                <li>Review portfolio quarterly for rebalancing</li>
                                <li>Increase SIP amount with salary increments</li>
                                <li>Monitor fund performance and replace underperformers</li>
                                <li>Maintain emergency fund separate from investments</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
            
            recommendations.innerHTML = recommendationHTML;
        }

        function createPerformanceChart(data) {
            const ctx = document.getElementById('portfolioPerformanceChart').getContext('2d');
            
            // Store data for chart period switching
            currentPortfolioData = data;
            
            if (portfolioPerformanceChart) {
                portfolioPerformanceChart.destroy();
            }
            
            // Get inflation rate and SIP frequency
            const inflationRate = parseFloat(document.getElementById('inflation-rate').value) || 6;
            const sipFrequency = document.getElementById('portfolio-sip-frequency').value || 'monthly';
            
            // Generate historical performance simulation
            const months = data.startDate ? Math.round((new Date() - new Date(data.startDate)) / (1000 * 60 * 60 * 24 * 30.44)) : 12;
            const monthlyData = [];
            const monthlyReturn = 0.01; // Assume 12% annual return
            const monthlyInflation = inflationRate / 12 / 100; // Monthly inflation rate
            
            // Convert SIP to monthly equivalent
            const sipMultiplier = {
                'monthly': 1,
                'quarterly': 1/3,
                'semi-annually': 1/6,
                'annually': 1/12
            };
            const monthlySIP = (data.monthlySIP || (data.totalInvested / months)) * sipMultiplier[sipFrequency];
            
            let invested = 0;
            let nominalValue = 0;
            let realValue = 0;
            
            for (let i = 0; i <= months; i++) {
                invested += monthlySIP;
                nominalValue = invested * Math.pow(1 + monthlyReturn, i);
                // Calculate real value (inflation-adjusted)
                realValue = nominalValue / Math.pow(1 + monthlyInflation, i);
                
                monthlyData.push({
                    month: i,
                    invested: invested,
                    nominalValue: nominalValue,
                    realValue: realValue
                });
            }
            
            // Adjust final values to match current portfolio
            const adjustmentFactor = data.totalValue / nominalValue;
            monthlyData.forEach(point => {
                point.nominalValue *= adjustmentFactor;
                point.realValue *= adjustmentFactor;
            });
            
            // Filter data based on selected period
            let chartData = monthlyData;
            let labels = [];
            
            switch(currentChartPeriod) {
                case 'yearly':
                    chartData = monthlyData.filter((_, index) => index % 12 === 0 || index === monthlyData.length - 1);
                    labels = chartData.map((_, index) => `Year ${Math.floor(index)}`);
                    break;
                case 'quarterly':
                    chartData = monthlyData.filter((_, index) => index % 3 === 0 || index === monthlyData.length - 1);
                    labels = chartData.map((_, index) => `Q${Math.floor(index/3) + 1}`);
                    break;
                case 'monthly':
                default:
                    labels = monthlyData.map(d => `Month ${d.month}`);
                    break;
            }
            
            portfolioPerformanceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Amount Invested',
                            data: chartData.map(d => d.invested),
                            borderColor: '#c0c0c0',
                            backgroundColor: 'rgba(192, 192, 192, 0.1)',
                            borderWidth: 2,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 0
                        },
                        {
                            label: 'Nominal Portfolio Value',
                            data: chartData.map(d => d.nominalValue),
                            borderColor: '#ffd700',
                            backgroundColor: 'rgba(255, 215, 0, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 0
                        },
                        {
                            label: 'Real Portfolio Value (Inflation-Adjusted)',
                            data: chartData.map(d => d.realValue),
                            borderColor: '#ff6b6b',
                            backgroundColor: 'rgba(255, 107, 107, 0.1)',
                            borderWidth: 2,
                            fill: false,
                            tension: 0.4,
                            borderDash: [5, 5],
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: {
                                color: '#ffffff',
                                font: { size: 12 }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.95)',
                            titleColor: '#ffd700',
                            bodyColor: '#ffffff',
                            borderColor: '#ffd700',
                            borderWidth: 2,
                            cornerRadius: 8,
                            displayColors: true,
                            titleFont: { size: 14, weight: 'bold' },
                            bodyFont: { size: 12 },
                            padding: 12,
                            callbacks: {
                                title: function(context) {
                                    return `Period: ${context[0].label}`;
                                },
                                beforeBody: function(context) {
                                    const dataIndex = context[0].dataIndex;
                                    
                                    // Get data from the chart datasets directly
                                    const investedData = context[0].chart.data.datasets[0].data;
                                    const nominalData = context[0].chart.data.datasets[1].data;
                                    const realData = context[0].chart.data.datasets[2].data;
                                    
                                    const invested = investedData[dataIndex];
                                    const nominalValue = nominalData[dataIndex];
                                    const realValue = realData[dataIndex];
                                    
                                    const nominalGains = nominalValue - invested;
                                    const realGains = realValue - invested;
                                    const nominalReturn = invested > 0 ? ((nominalGains / invested) * 100) : 0;
                                    const realReturn = invested > 0 ? ((realGains / invested) * 100) : 0;
                                    
                                    return [
                                        `💰 Amount Invested: ₹${Math.round(invested).toLocaleString('en-IN')}`,
                                        `📈 Nominal Value: ₹${Math.round(nominalValue).toLocaleString('en-IN')}`,
                                        `🔥 Real Value: ₹${Math.round(realValue).toLocaleString('en-IN')}`,
                                        ``,
                                        `💵 Nominal Gains: ₹${Math.round(nominalGains).toLocaleString('en-IN')} (${nominalReturn.toFixed(1)}%)`,
                                        `⚡ Real Gains: ₹${Math.round(realGains).toLocaleString('en-IN')} (${realReturn.toFixed(1)}%)`,
                                        ``,
                                        `🎯 Inflation Impact: ₹${Math.round(nominalValue - realValue).toLocaleString('en-IN')}`
                                    ];
                                },
                                label: function(context) {
                                    // Return empty string since we're showing everything in beforeBody
                                    return '';
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#aaaaaa' },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y: {
                            ticks: {
                                color: '#aaaaaa',
                                callback: function(value) {
                                    return '₹' + (value / 100000).toFixed(1) + 'L';
                                }
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });
            
            // Generate performance insights
            const insights = document.getElementById('performance-insights');
            const totalGrowth = ((data.totalValue / data.totalInvested - 1) * 100).toFixed(2);
            insights.innerHTML = `
                <div style="background: linear-gradient(135deg, rgba(255,215,0,0.05), rgba(0,0,0,0.3)); border-radius: 12px; padding: 1.5rem;">
                    <h5 style="color: var(--accent-gold); margin-bottom: 1rem;">Performance Analysis</h5>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                        <div style="text-align: center; padding: 1rem; background: rgba(255,255,255,0.02); border-radius: 8px;">
                            <div style="color: var(--text-gray); font-size: 0.9rem;">Total Growth</div>
                            <div style="color: var(--accent-gold); font-size: 1.8rem; font-weight: bold;">${totalGrowth}%</div>
                        </div>
                        <div style="text-align: center; padding: 1rem; background: rgba(255,255,255,0.02); border-radius: 8px;">
                            <div style="color: var(--text-gray); font-size: 0.9rem;">Wealth Multiplier</div>
                            <div style="color: var(--accent-white); font-size: 1.8rem; font-weight: bold;">${(data.totalValue / data.totalInvested).toFixed(2)}x</div>
                        </div>
                        <div style="text-align: center; padding: 1rem; background: rgba(255,255,255,0.02); border-radius: 8px;">
                            <div style="color: var(--text-gray); font-size: 0.9rem;">Monthly Growth</div>
                            <div style="color: var(--accent-silver); font-size: 1.8rem; font-weight: bold;">${(totalGrowth / months).toFixed(2)}%</div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Save functions (placeholders)
        function saveBasicInfo() {
            const basicInfo = {
                name: document.getElementById('client-name').value,
                age: document.getElementById('client-age').value,
                occupation: document.getElementById('client-occupation').value,
                income: document.getElementById('client-income').value,
                city: document.getElementById('client-city').value,
                maritalStatus: document.getElementById('client-marital-status').value
            };
            
            clientData.basicInfo = basicInfo;
            localStorage.setItem('clientData', JSON.stringify(clientData));
            alert('Basic information saved successfully!');
        }

        function saveFinancialStatus() {
            const financialStatus = {
                monthlyIncome: document.getElementById('monthly-income').value,
                monthlyExpenses: document.getElementById('monthly-expenses').value,
                currentSavings: document.getElementById('current-savings').value,
                currentInvestments: document.getElementById('current-investments').value,
                outstandingLoans: document.getElementById('outstanding-loans').value,
                creditDebt: document.getElementById('credit-debt').value
            };
            
            clientData.financialStatus = financialStatus;
            localStorage.setItem('clientData', JSON.stringify(clientData));
            alert('Financial status saved successfully!');
        }

        function saveGoals() {
            alert('Goals saved successfully!');
        }

        // Personality Assessment System
        const assessmentQuestions = [
            {
                question: "How do you typically react when your investments lose value?",
                options: [
                    { text: "I panic and want to sell immediately", score: 1 },
                    { text: "I feel worried but try to stay calm", score: 3 },
                    { text: "I review my strategy and hold steady", score: 5 },
                    { text: "I see it as a buying opportunity", score: 7 }
                ]
            },
            {
                question: "What is your primary investment goal?",
                options: [
                    { text: "Capital preservation - don't lose money", score: 1 },
                    { text: "Steady income with some growth", score: 3 },
                    { text: "Balanced growth with moderate risk", score: 5 },
                    { text: "Maximum growth, willing to take risks", score: 7 }
                ]
            },
            {
                question: "How much of your portfolio would you invest in stocks?",
                options: [
                    { text: "0-20% - I prefer safe investments", score: 1 },
                    { text: "20-40% - Some stocks for growth", score: 3 },
                    { text: "40-70% - Balanced stock allocation", score: 5 },
                    { text: "70%+ - Stocks are the best long-term investment", score: 7 }
                ]
            },
            {
                question: "How often do you check your investment portfolio?",
                options: [
                    { text: "Daily - I need to stay updated", score: 2 },
                    { text: "Weekly - Regular monitoring", score: 4 },
                    { text: "Monthly - Periodic reviews", score: 6 },
                    { text: "Quarterly or less - Long-term focus", score: 8 }
                ]
            },
            {
                question: "What would you do if a stock you own dropped 30%?",
                options: [
                    { text: "Sell immediately to prevent further loss", score: 1 },
                    { text: "Sell half to limit losses", score: 3 },
                    { text: "Hold and wait for recovery", score: 5 },
                    { text: "Buy more at the lower price", score: 7 }
                ]
            },
            {
                question: "How do you prefer to make investment decisions?",
                options: [
                    { text: "Follow expert recommendations", score: 2 },
                    { text: "Extensive research and analysis", score: 6 },
                    { text: "Based on market trends", score: 4 },
                    { text: "Gut feeling and intuition", score: 3 }
                ]
            },
            {
                question: "What is your investment time horizon?",
                options: [
                    { text: "Less than 2 years", score: 1 },
                    { text: "2-5 years", score: 3 },
                    { text: "5-10 years", score: 5 },
                    { text: "More than 10 years", score: 7 }
                ]
            },
            {
                question: "How important is it to have access to your money quickly?",
                options: [
                    { text: "Very important - need immediate access", score: 1 },
                    { text: "Somewhat important", score: 3 },
                    { text: "Not very important", score: 5 },
                    { text: "Not important at all", score: 7 }
                ]
            },
            {
                question: "What best describes your financial knowledge?",
                options: [
                    { text: "Beginner - learning the basics", score: 2 },
                    { text: "Intermediate - understand key concepts", score: 4 },
                    { text: "Advanced - well-versed in finance", score: 6 },
                    { text: "Expert - finance professional", score: 8 }
                ]
            },
            {
                question: "How do you feel about borrowing money to invest?",
                options: [
                    { text: "Never - too risky", score: 1 },
                    { text: "Only for very safe investments", score: 3 },
                    { text: "If the potential return is high enough", score: 5 },
                    { text: "It's a smart way to leverage returns", score: 7 }
                ]
            }
        ];

        let currentQuestionIndex = 0;
        let assessmentAnswers = [];

        function startPersonalityAssessment() {
            document.getElementById('assessment-intro').style.display = 'none';
            document.getElementById('assessment-questions').style.display = 'block';
            document.getElementById('assessment-results').style.display = 'none';
            
            currentQuestionIndex = 0;
            assessmentAnswers = [];
            document.getElementById('total-questions').textContent = assessmentQuestions.length;
            
            showCurrentQuestion();
        }

        function showCurrentQuestion() {
            const question = assessmentQuestions[currentQuestionIndex];
            document.getElementById('current-question').textContent = currentQuestionIndex + 1;
            document.getElementById('question-text').textContent = question.question;
            
            // Update progress bar
            const progress = ((currentQuestionIndex + 1) / assessmentQuestions.length) * 100;
            document.getElementById('progress-fill').style.width = progress + '%';
            
            // Create options
            const optionsContainer = document.getElementById('question-options');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'form-group';
                optionDiv.innerHTML = `
                    <label class="option-label" style="display: flex; align-items: center; padding: 1rem; border: 1px solid var(--border-gray); border-radius: 8px; cursor: pointer; transition: var(--transition-smooth);">
                        <input type="radio" name="question-${currentQuestionIndex}" value="${option.score}" style="margin-right: 0.5rem;" onchange="selectOption(this)">
                        <span>${option.text}</span>
                    </label>
                `;
                optionsContainer.appendChild(optionDiv);
            });
            
            // Update button states
            document.getElementById('prev-btn').disabled = currentQuestionIndex === 0;
            document.getElementById('next-btn').disabled = true;
            document.getElementById('next-btn').style.display = currentQuestionIndex === assessmentQuestions.length - 1 ? 'none' : 'inline-flex';
            document.getElementById('finish-btn').style.display = currentQuestionIndex === assessmentQuestions.length - 1 ? 'inline-flex' : 'none';
        }

        function selectOption(radio) {
            assessmentAnswers[currentQuestionIndex] = parseInt(radio.value);
            document.getElementById('next-btn').disabled = false;
            document.getElementById('finish-btn').disabled = false;
            
            // Style selected option
            document.querySelectorAll('.option-label').forEach(label => {
                label.style.background = 'transparent';
                label.style.borderColor = 'var(--border-gray)';
            });
            radio.parentElement.style.background = 'rgba(255, 255, 255, 0.1)';
            radio.parentElement.style.borderColor = 'var(--accent-white)';
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showCurrentQuestion();
                
                // Pre-select previous answer if exists
                const previousAnswer = assessmentAnswers[currentQuestionIndex];
                if (previousAnswer) {
                    const radio = document.querySelector(`input[value="${previousAnswer}"]`);
                    if (radio) {
                        radio.checked = true;
                        selectOption(radio);
                    }
                }
            }
        }

        function nextQuestion() {
            if (currentQuestionIndex < assessmentQuestions.length - 1) {
                currentQuestionIndex++;
                showCurrentQuestion();
                
                // Pre-select previous answer if exists
                const previousAnswer = assessmentAnswers[currentQuestionIndex];
                if (previousAnswer) {
                    const radio = document.querySelector(`input[value="${previousAnswer}"]`);
                    if (radio) {
                        radio.checked = true;
                        selectOption(radio);
                    }
                }
            }
        }

        function finishAssessment() {
            const totalScore = assessmentAnswers.reduce((sum, score) => sum + score, 0);
            const averageScore = totalScore / assessmentQuestions.length;
            
            let personalityType, description, recommendations;
            
            if (averageScore <= 2.5) {
                personalityType = "Conservative Investor";
                description = "You prioritize capital preservation and prefer low-risk investments. You value stability over growth and are comfortable with modest returns.";
                recommendations = [
                    "Focus on Fixed Deposits, Government Bonds, and PPF",
                    "Consider conservative mutual funds",
                    "Maintain 6-month emergency fund",
                    "Gradually increase risk tolerance with education"
                ];
            } else if (averageScore <= 4.5) {
                personalityType = "Moderate Investor";
                description = "You seek a balance between growth and security. You're willing to accept some risk for potentially higher returns but prefer steady progress.";
                recommendations = [
                    "Balanced mutual funds (60% equity, 40% debt)",
                    "SIP in large-cap equity funds",
                    "Mix of FDs and equity investments",
                    "Consider ELSS for tax saving"
                ];
            } else if (averageScore <= 6.5) {
                personalityType = "Growth-Oriented Investor";
                description = "You're focused on long-term wealth creation and comfortable with market volatility. You understand that higher returns come with higher risks.";
                recommendations = [
                    "Equity-heavy portfolio (70-80% stocks)",
                    "Mid-cap and large-cap mutual funds",
                    "Direct equity investments",
                    "International diversification"
                ];
            } else {
                personalityType = "Aggressive Investor";
                description = "You're a high-risk, high-reward investor who seeks maximum growth. You're comfortable with significant volatility and have strong market knowledge.";
                recommendations = [
                    "Small-cap and mid-cap funds",
                    "Direct stock investments",
                    "Sector-specific funds",
                    "Alternative investments (REITs, commodities)"
                ];
            }
            
            // Save results to clientData
            clientData.riskProfile = {
                personalityType: personalityType,
                riskScore: Math.round(averageScore * 10) / 10,
                totalScore: totalScore,
                averageScore: averageScore,
                description: description,
                recommendations: recommendations,
                assessmentDate: new Date().toISOString()
            };
            
            localStorage.setItem('clientData', JSON.stringify(clientData));
            
            // Display results
            document.getElementById('assessment-questions').style.display = 'none';
            document.getElementById('assessment-results').style.display = 'block';
            
            const resultsContainer = document.getElementById('personality-result');
            resultsContainer.innerHTML = `
                <div style="text-align: center; margin-bottom: 2rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem; color: var(--accent-gold);">
                        ${personalityType === 'Conservative Investor' ? '<i class="fas fa-shield-alt"></i>' : 
                          personalityType === 'Moderate Investor' ? '<i class="fas fa-balance-scale"></i>' : 
                          personalityType === 'Growth-Oriented Investor' ? '<i class="fas fa-chart-line"></i>' : '<i class="fas fa-rocket"></i>'}
                    </div>
                    <h2 style="color: var(--accent-white); margin-bottom: 0.5rem;">${personalityType}</h2>
                    <div style="font-size: 1.2rem; color: var(--text-gray);">Risk Score: ${Math.round(averageScore * 10) / 10}/7.0</div>
                </div>
                
                <div style="margin-bottom: 2rem;">
                    <h4>About Your Profile:</h4>
                    <p style="color: var(--text-gray); line-height: 1.6;">${description}</p>
                </div>
                
                <div>
                    <h4>Recommended Investment Strategy:</h4>
                    <ul style="color: var(--text-gray); line-height: 1.6;">
                        ${recommendations.map(rec => `<li>${rec}</li>`).join('')}
                    </ul>
                </div>
            `;
        }

        function retakeAssessment() {
            document.getElementById('assessment-results').style.display = 'none';
            document.getElementById('assessment-intro').style.display = 'block';
            currentQuestionIndex = 0;
            assessmentAnswers = [];
        }

        // Risk Assessment System
        function calculateRiskProfile() {
            const ageGroup = parseInt(document.getElementById('age-group').value) || 0;
            const experience = parseInt(document.getElementById('investment-experience').value) || 0;
            const horizon = parseInt(document.getElementById('investment-horizon').value) || 0;
            const stability = parseInt(document.getElementById('income-stability').value) || 0;
            const goals = parseInt(document.getElementById('financial-goals').value) || 0;
            const tolerance = parseInt(document.getElementById('loss-tolerance').value) || 0;
            
            if (!ageGroup || !experience || !horizon || !stability || !goals || !tolerance) {
                alert('Please complete all fields before calculating your risk profile.');
                return;
            }
            
            const totalScore = ageGroup + experience + horizon + stability + goals + tolerance;
            const maxScore = 150;
            const riskPercentage = Math.round((totalScore / maxScore) * 100);
            
            let riskCategory, riskDescription, portfolioRecommendation, investmentOptions;
            
            if (riskPercentage <= 30) {
                riskCategory = "Conservative";
                riskDescription = "You prefer safety and capital preservation over growth. You're comfortable with lower returns in exchange for stability.";
                portfolioRecommendation = {
                    equity: 20,
                    debt: 60,
                    gold: 10,
                    cash: 10
                };
                investmentOptions = [
                    "Fixed Deposits and Savings Accounts",
                    "Government Bonds and Treasury Bills",
                    "Conservative Debt Mutual Funds",
                    "PPF and EPF",
                    "Bank Fixed Deposits"
                ];
            } else if (riskPercentage <= 50) {
                riskCategory = "Moderate Conservative";
                riskDescription = "You seek steady growth with minimal risk. You're willing to accept slight volatility for better returns than pure conservative investments.";
                portfolioRecommendation = {
                    equity: 35,
                    debt: 50,
                    gold: 10,
                    cash: 5
                };
                investmentOptions = [
                    "Hybrid/Balanced Mutual Funds",
                    "Large Cap Equity Funds",
                    "Corporate Bond Funds",
                    "Monthly Income Plans",
                    "Debt-oriented ELSS"
                ];
            } else if (riskPercentage <= 70) {
                riskCategory = "Moderate";
                riskDescription = "You seek a balance between growth and stability. You can handle moderate market fluctuations for potentially higher returns.";
                portfolioRecommendation = {
                    equity: 50,
                    debt: 35,
                    gold: 10,
                    cash: 5
                };
                investmentOptions = [
                    "Diversified Equity Funds",
                    "Large & Mid Cap Funds",
                    "Balanced Advantage Funds",
                    "ELSS Tax Saving Funds",
                    "Index Funds"
                ];
            } else if (riskPercentage <= 85) {
                riskCategory = "Moderate Aggressive";
                riskDescription = "You're focused on long-term wealth creation and can handle significant market volatility. You prioritize growth over stability.";
                portfolioRecommendation = {
                    equity: 65,
                    debt: 25,
                    gold: 7,
                    cash: 3
                };
                investmentOptions = [
                    "Mid Cap and Small Cap Funds",
                    "Sector-specific Equity Funds",
                    "International Equity Funds",
                    "Growth-oriented Mutual Funds",
                    "Direct Equity Investments"
                ];
            } else {
                riskCategory = "Aggressive";
                riskDescription = "You're a high-risk, high-reward investor seeking maximum growth. You can handle significant volatility and losses for potential high returns.";
                portfolioRecommendation = {
                    equity: 80,
                    debt: 15,
                    gold: 3,
                    cash: 2
                };
                investmentOptions = [
                    "Small Cap and Micro Cap Funds",
                    "Sector and Thematic Funds",
                    "International Markets",
                    "Direct Stock Investments",
                    "Alternative Investments (REITs, etc.)"
                ];
            }
            
            // Save to clientData
            const clientData = JSON.parse(localStorage.getItem('clientData') || '{}');
            clientData.riskProfile = {
                ...clientData.riskProfile,
                riskCategory: riskCategory,
                riskScore: riskPercentage,
                totalScore: totalScore,
                maxScore: maxScore,
                portfolioRecommendation: portfolioRecommendation,
                investmentOptions: investmentOptions,
                assessmentDate: new Date().toISOString()
            };
            
            localStorage.setItem('clientData', JSON.stringify(clientData));
            
            // Refresh Investment Recommendations with new risk profile
            loadInvestmentRecommendations();
            
            // Display results
            document.getElementById('risk-assessment').style.display = 'none';
            document.getElementById('risk-results').style.display = 'block';
            
            const resultsContainer = document.getElementById('risk-profile-result');
            resultsContainer.innerHTML = `
                <div style="text-align: center; margin-bottom: 2rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem; color: var(--accent-gold);">
                        ${riskCategory === 'Conservative' ? '<i class="fas fa-shield-alt"></i>' : 
                          riskCategory === 'Moderate Conservative' ? '<i class="fas fa-university"></i>' : 
                          riskCategory === 'Moderate' ? '<i class="fas fa-balance-scale"></i>' : 
                          riskCategory === 'Moderate Aggressive' ? '<i class="fas fa-chart-line"></i>' : '<i class="fas fa-rocket"></i>'}
                    </div>
                    <h2 style="color: var(--accent-white); margin-bottom: 0.5rem;">${riskCategory} Investor</h2>
                    <div style="font-size: 1.2rem; color: var(--text-gray);">Risk Score: ${riskPercentage}/100</div>
                    <div style="background: var(--border-gray); height: 8px; border-radius: 4px; margin: 1rem auto; width: 200px;">
                        <div style="background: var(--accent-white); height: 100%; border-radius: 4px; width: ${riskPercentage}%; transition: width 1s ease;"></div>
                    </div>
                </div>
                
                <div style="margin-bottom: 2rem;">
                    <h4>Profile Description:</h4>
                    <p style="color: var(--text-gray); line-height: 1.6;">${riskDescription}</p>
                </div>
                
                <div style="margin-bottom: 2rem;">
                    <h4>Recommended Portfolio Allocation:</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 1rem; margin: 1rem 0;">
                        <div style="text-align: center; padding: 1rem; background: rgba(255,255,255,0.05); border-radius: 8px;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: var(--accent-white);">${portfolioRecommendation.equity}%</div>
                            <div style="color: var(--text-gray);">Equity</div>
                        </div>
                        <div style="text-align: center; padding: 1rem; background: rgba(255,255,255,0.05); border-radius: 8px;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: var(--accent-white);">${portfolioRecommendation.debt}%</div>
                            <div style="color: var(--text-gray);">Debt</div>
                        </div>
                        <div style="text-align: center; padding: 1rem; background: rgba(255,255,255,0.05); border-radius: 8px;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: var(--accent-white);">${portfolioRecommendation.gold}%</div>
                            <div style="color: var(--text-gray);">Gold</div>
                        </div>
                        <div style="text-align: center; padding: 1rem; background: rgba(255,255,255,0.05); border-radius: 8px;">
                            <div style="font-size: 1.5rem; font-weight: bold; color: var(--accent-white);">${portfolioRecommendation.cash}%</div>
                            <div style="color: var(--text-gray);">Cash</div>
                        </div>
                    </div>
                </div>
                
                <div>
                    <h4>Suitable Investment Options:</h4>
                    <ul style="color: var(--text-gray); line-height: 1.6;">
                        ${investmentOptions.map(option => `<li>${option}</li>`).join('')}
                    </ul>
                </div>
            `;
        }

        function recalculateRisk() {
            document.getElementById('risk-results').style.display = 'none';
            document.getElementById('risk-assessment').style.display = 'block';
            
            // Clear form
            document.getElementById('age-group').value = '';
            document.getElementById('investment-experience').value = '';
            document.getElementById('investment-horizon').value = '';
            document.getElementById('income-stability').value = '';
            document.getElementById('financial-goals').value = '';
            document.getElementById('loss-tolerance').value = '';
        }

        function calculateNetWorth() {
            const cashBalance = parseFloat(document.getElementById('cash-balance').value) || 0;
            const investments = parseFloat(document.getElementById('investments').value) || 0;
            const propertyValue = parseFloat(document.getElementById('property-value').value) || 0;
            const outstandingLoans = parseFloat(document.getElementById('outstanding-loans').value) || 0;
            const otherAssets = parseFloat(document.getElementById('other-assets').value) || 0;
            const creditCardDebt = parseFloat(document.getElementById('credit-card-debt').value) || 0;
            
            // Calculate totals
            const totalAssets = cashBalance + investments + propertyValue + otherAssets;
            const totalLiabilities = outstandingLoans + creditCardDebt;
            const netWorth = totalAssets - totalLiabilities;
            
            // Display results
            const resultsDiv = document.getElementById('networth-results');
            resultsDiv.style.display = 'block';
            
            resultsDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                    <div class="result-card" style="background: linear-gradient(135deg, #1a1a1a, #2a2a2a); border: 2px solid var(--accent-gold); border-radius: 12px; padding: 1.5rem; text-align: center;">
                        <div style="font-size: 0.9rem; color: var(--accent-gold); margin-bottom: 0.5rem; text-transform: uppercase;">Total Assets</div>
                        <div style="font-size: 1.8rem; font-weight: bold; color: var(--accent-gold);">₹${totalAssets.toLocaleString('en-IN')}</div>
                    </div>
                    <div class="result-card" style="background: linear-gradient(135deg, #1a1a1a, #2a2a2a); border: 2px solid var(--accent-silver); border-radius: 12px; padding: 1.5rem; text-align: center;">
                        <div style="font-size: 0.9rem; color: var(--accent-silver); margin-bottom: 0.5rem; text-transform: uppercase;">Total Liabilities</div>
                        <div style="font-size: 1.8rem; font-weight: bold; color: var(--accent-silver);">₹${totalLiabilities.toLocaleString('en-IN')}</div>
                    </div>
                    <div class="result-card" style="background: linear-gradient(135deg, #1a1a1a, #2a2a2a); border: 2px solid var(--accent-white); border-radius: 12px; padding: 1.5rem; text-align: center;">
                        <div style="font-size: 0.9rem; color: var(--accent-white); margin-bottom: 0.5rem; text-transform: uppercase;">Net Worth</div>
                        <div style="font-size: 2rem; font-weight: bold; color: ${netWorth >= 0 ? 'var(--accent-gold)' : '#ff6b6b'};">₹${netWorth.toLocaleString('en-IN')}</div>
                    </div>
                </div>
                
                <div style="margin-top: 2rem; background: linear-gradient(135deg, rgba(255,255,255,0.02), rgba(0,0,0,0.3)); border-radius: 12px; padding: 1.5rem;">
                    <h4 style="color: var(--accent-white); margin-bottom: 1rem;">Asset Breakdown</h4>
                    <div style="display: grid; gap: 0.8rem;">
                        <div style="display: flex; justify-content: space-between; padding: 0.5rem; border-bottom: 1px solid var(--border-gray);">
                            <span style="color: var(--text-gray);">Cash & Bank Balance</span>
                            <span style="color: var(--accent-white); font-weight: bold;">₹${cashBalance.toLocaleString('en-IN')}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 0.5rem; border-bottom: 1px solid var(--border-gray);">
                            <span style="color: var(--text-gray);">Investments</span>
                            <span style="color: var(--accent-white); font-weight: bold;">₹${investments.toLocaleString('en-IN')}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 0.5rem; border-bottom: 1px solid var(--border-gray);">
                            <span style="color: var(--text-gray);">Property Value</span>
                            <span style="color: var(--accent-white); font-weight: bold;">₹${propertyValue.toLocaleString('en-IN')}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 0.5rem; border-bottom: 1px solid var(--border-gray);">
                            <span style="color: var(--text-gray);">Other Assets</span>
                            <span style="color: var(--accent-white); font-weight: bold;">₹${otherAssets.toLocaleString('en-IN')}</span>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 1rem; background: linear-gradient(135deg, rgba(255,255,255,0.02), rgba(0,0,0,0.3)); border-radius: 12px; padding: 1.5rem;">
                    <h4 style="color: var(--accent-white); margin-bottom: 1rem;">Liability Breakdown</h4>
                    <div style="display: grid; gap: 0.8rem;">
                        <div style="display: flex; justify-content: space-between; padding: 0.5rem; border-bottom: 1px solid var(--border-gray);">
                            <span style="color: var(--text-gray);">Outstanding Loans</span>
                            <span style="color: var(--accent-silver); font-weight: bold;">₹${outstandingLoans.toLocaleString('en-IN')}</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 0.5rem;">
                            <span style="color: var(--text-gray);">Credit Card Debt</span>
                            <span style="color: var(--accent-silver); font-weight: bold;">₹${creditCardDebt.toLocaleString('en-IN')}</span>
                        </div>
                    </div>
                </div>
                
                <div style="margin-top: 1.5rem; padding: 1rem; background: rgba(255,215,0,0.05); border-left: 4px solid var(--accent-gold); border-radius: 4px;">
                    <h5 style="color: var(--accent-gold); margin-bottom: 0.5rem;">Net Worth Analysis</h5>
                    <p style="color: var(--text-gray); line-height: 1.6; margin: 0;">
                        ${netWorth >= 0 
                            ? `Your net worth is positive at ₹${netWorth.toLocaleString('en-IN')}. This indicates good financial health with assets exceeding liabilities.`
                            : `Your net worth is negative at ₹${Math.abs(netWorth).toLocaleString('en-IN')}. Focus on reducing liabilities and increasing assets to improve your financial position.`
                        }
                    </p>
                </div>
            `;
        }

        function calculateTaxSavings() {
            alert('Tax calculation functionality will be implemented');
        }

        function generateReport() {
            alert('PDF report generation functionality will be implemented');
        }

        function previewReport() {
            alert('Report preview functionality will be implemented');
        }

        function saveCurrentProfile() {
            alert('Profile saved successfully!');
        }

        function showExportModal() {
            alert('Export functionality coming soon!');
        }

        function showSettingsModal() {
            alert('Settings functionality coming soon!');
        }

        function goBackToProfiles() {
            alert('Profile navigation functionality coming soon!');
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Financial Planner Pro initialized');
            
            // Initialize Investment Recommendations dynamically
            loadInvestmentRecommendations();
            
            // Initialize Portfolio Analysis with sample data
            initializePortfolioAnalysis();
            
            // Load saved goals
            loadSavedGoals();
            
            // Initialize AOS if available
            if (typeof AOS !== 'undefined') {
                AOS.init({
                    duration: 600,
                    easing: 'ease-in-out-cubic',
                    once: true
                });
            }
            
            // Load saved data
            const savedData = localStorage.getItem('clientData');
            if (savedData) {
                clientData = JSON.parse(savedData);
            }
            
            // Set initial state
            showSection('dashboard');
        });

        // Mobile responsive handling
        window.addEventListener('resize', function() {
            if (window.innerWidth <= 768) {
                document.getElementById('sidebar').classList.add('collapsed');
            }
        });

        // Additional CSS for results sections
        const additionalCSS = `
            .results-section {
                background: var(--card-black);
                border: 1px solid var(--border-gray);
                border-radius: var(--border-radius-sm);
                padding: 1.5rem;
                margin-top: 2rem;
            }
            
            .results-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1rem;
                margin-top: 1rem;
            }
            
            .result-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.5rem 0;
                border-bottom: 1px solid var(--border-gray);
            }
            
            .result-label {
                color: var(--text-gray);
                font-weight: 500;
            }
            
            .result-value {
                color: var(--accent-white);
                font-weight: 700;
                font-size: 1.1rem;
            }
        `;
        
        // Add the additional CSS to the page
        const style = document.createElement('style');
        style.textContent = additionalCSS;
        document.head.appendChild(style);
    </script>

    <!-- Version Footer -->
    <footer style="
        position: fixed; 
        bottom: 0; 
        right: 0; 
        background: rgba(0,0,0,0.8); 
        color: var(--text-gray); 
        padding: 0.5rem 1rem; 
        font-size: 0.75rem; 
        border-top-left-radius: 8px;
        border: 1px solid var(--border-gray);
        z-index: 1000;
        backdrop-filter: blur(10px);
    ">
        <div style="display: flex; gap: 1rem; align-items: center;">
                            <span style="color: var(--accent-gold);">Financial Planner Pro v3.6 - Rebalancing Fixed</span>
            <span>•</span>
                            <span>Last Updated: Dec 24, 2024 - 11:30 UTC</span>
            <span>•</span>
                            <span style="color: var(--accent-silver);">Git: ca030bc</span>
        </div>
    </footer>
</body>
</html>