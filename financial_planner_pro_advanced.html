<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Planner Pro - Million Dollar Edition</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-black: #000000;
            --secondary-black: #0a0a0a;
            --card-black: #111111;
            --border-gray: #333333;
            --text-white: #ffffff;
            --text-gray: #aaaaaa;
            --accent-white: #ffffff;
            --success-green: #00ff88;
            --warning-orange: #ff9f43;
            --error-red: #ff6b6b;
            --info-blue: #00d4ff;
            --gradient-primary: linear-gradient(135deg, #000000 0%, #1a1a1a 50%, #000000 100%);
            --gradient-card: linear-gradient(145deg, #111111 0%, #1a1a1a 100%);
            --gradient-accent: linear-gradient(90deg, #ffffff 0%, #e0e0e0 100%);
            --shadow-light: 0 4px 20px rgba(255, 255, 255, 0.1);
            --shadow-heavy: 0 20px 60px rgba(0, 0, 0, 0.8);
            --border-radius-sm: 6px;
            --border-radius-md: 12px;
            --border-radius-lg: 20px;
            --transition-smooth: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-bounce: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--primary-black);
            color: var(--text-white);
            line-height: 1.6;
            overflow-x: hidden;
            scroll-behavior: smooth;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 0.5rem; /* Ultra compact container padding */
        }

        /* COMPACT Profile Management Screen */
        .profile-management {
            min-height: 100vh;
            background: var(--primary-black);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .profile-management::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(255, 255, 255, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.04) 0%, transparent 50%);
            animation: backgroundPulse 8s ease-in-out infinite;
        }

        @keyframes backgroundPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .profile-card {
            background: var(--gradient-card);
            border: 2px solid var(--border-gray);
            border-radius: var(--border-radius-lg);
            padding: 2rem;
            max-width: 800px;
            width: 95%;
            position: relative;
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow-heavy);
            z-index: 2;
            animation: slideInUp 0.8s ease-out;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .profile-header {
            text-align: center;
            margin-bottom: 2rem;
            position: relative;
        }

        .profile-header::after {
            content: '';
            position: absolute;
            bottom: -0.5rem;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 2px;
            background: var(--gradient-accent);
            border-radius: 2px;
        }

        .profile-header h1 {
            font-size: clamp(2rem, 4vw, 3rem);
            font-weight: 800;
            margin-bottom: 0.5rem;
            background: var(--gradient-accent);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.02em;
            line-height: 1.1;
        }

        .profile-header .subtitle {
            font-size: 1rem;
            color: var(--text-gray);
            font-weight: 400;
            margin-bottom: 0.25rem;
        }

        .profile-header .tagline {
            font-size: 0.9rem;
            color: var(--text-gray);
            font-style: italic;
            opacity: 0.8;
        }

        /* COMPACT Welcome Section */
        .welcome-section {
            text-align: center;
            margin: 1.5rem 0 2rem;
            padding: 1.5rem;
            background: var(--gradient-card);
            border-radius: var(--border-radius-md);
            border: 1px solid var(--border-gray);
            position: relative;
            overflow: hidden;
        }

        .welcome-section h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
            color: var(--text-white);
        }

        .welcome-section p {
            font-size: 1rem;
            color: var(--text-gray);
            line-height: 1.6;
            max-width: 500px;
            margin: 0 auto;
        }

        /* COMPACT Profile List */
        .profile-list {
            margin: 1.5rem 0;
        }

        .profile-list h3 {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-white);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .profiles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .profile-item {
            background: var(--gradient-card);
            border: 2px solid var(--border-gray);
            border-radius: var(--border-radius-md);
            padding: 1rem;
            position: relative;
            transition: var(--transition-smooth);
            overflow: hidden;
        }

        .profile-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--gradient-accent);
            transform: scaleX(0);
            transition: var(--transition-smooth);
        }

        .profile-item:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-light);
            border-color: var(--accent-white);
        }

        .profile-item:hover::before {
            transform: scaleX(1);
        }

        .profile-item-info h4 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-white);
            margin-bottom: 0.25rem;
        }

        .profile-item-info p {
            color: var(--text-gray);
            font-size: 0.85rem;
            margin-bottom: 0.15rem;
        }

        .profile-item-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        /* COMPACT Action Buttons */
        .action-buttons {
            display: flex;
            gap: 0.75rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 1.5rem;
        }

        /* COMPACT Cover Page */
        .cover-page {
            min-height: 100vh;
            background: var(--primary-black);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .cover-page::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 30% 70%, rgba(255, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 70% 30%, rgba(255, 255, 255, 0.06) 0%, transparent 50%);
            animation: coverAnimation 12s ease-in-out infinite;
        }

        @keyframes coverAnimation {
            0%, 100% { transform: rotate(0deg) scale(1); }
            33% { transform: rotate(0.5deg) scale(1.01); }
            66% { transform: rotate(-0.5deg) scale(0.99); }
        }

        .cover-content {
            max-width: 700px;
            text-align: center;
            padding: 1.5rem;
            position: relative;
            z-index: 2;
        }

        .app-title {
            font-size: clamp(2.5rem, 6vw, 4.5rem);
            font-weight: 900;
            margin-bottom: 1rem;
            background: var(--gradient-accent);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.03em;
            line-height: 1;
            animation: titleGlow 3s ease-in-out infinite;
        }

        @keyframes titleGlow {
            0%, 100% { filter: brightness(1); }
            50% { filter: brightness(1.1); }
        }

        .app-subtitle {
            font-size: clamp(1rem, 2.5vw, 1.5rem);
            color: var(--text-gray);
            margin-bottom: 1.5rem;
            font-weight: 400;
            line-height: 1.4;
        }

        .features-highlight {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.75rem;
            margin: 1.5rem 0 2rem;
        }

        .feature-item {
            background: var(--gradient-card);
            border: 1px solid var(--border-gray);
            border-radius: var(--border-radius-md);
            padding: 1rem;
            text-align: center;
            transition: var(--transition-bounce);
        }

        .feature-item:hover {
            transform: translateY(-5px) scale(1.03);
            box-shadow: var(--shadow-light);
        }

        .feature-icon {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: var(--accent-white);
        }

        .feature-title {
            font-size: 0.95rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .feature-desc {
            font-size: 0.8rem;
            color: var(--text-gray);
        }

        /* ULTRA COMPACT Button System */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.3rem;
            padding: 0.5rem 1rem; /* Ultra compact padding */
            border: none;
            border-radius: var(--border-radius-md);
            font-weight: 600;
            font-size: 0.8rem; /* Smaller font */
            cursor: pointer;
            transition: var(--transition-bounce);
            text-decoration: none;
            position: relative;
            overflow: hidden;
            min-width: 100px; /* Smaller minimum width */
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: var(--transition-smooth);
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: var(--gradient-accent);
            color: var(--primary-black);
            box-shadow: 0 6px 20px rgba(255, 255, 255, 0.25);
        }

        .btn-primary:hover {
            transform: translateY(-2px) scale(1.03);
            box-shadow: 0 10px 25px rgba(255, 255, 255, 0.35);
        }

        .btn-secondary {
            background: var(--gradient-card);
            color: var(--text-white);
            border: 2px solid var(--border-gray);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.25);
        }

        .btn-secondary:hover {
            transform: translateY(-2px) scale(1.03);
            border-color: var(--accent-white);
            box-shadow: 0 10px 25px rgba(255, 255, 255, 0.08);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--error-red), #ff5252);
            color: var(--text-white);
            box-shadow: 0 6px 20px rgba(255, 107, 107, 0.25);
        }

        .btn-danger:hover {
            transform: translateY(-2px) scale(1.03);
            box-shadow: 0 10px 25px rgba(255, 107, 107, 0.35);
        }

        .btn-small {
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
            min-width: 80px;
        }

        .btn-large {
            padding: 1rem 2rem;
            font-size: 1rem;
            min-width: 160px;
        }

        /* COMPACT Main App Layout */
        .main-app {
            display: none;
            min-height: 100vh;
            background: var(--primary-black);
        }

        /* COMPACT Header */
        .app-header {
            background: var(--gradient-card);
            border-bottom: 2px solid var(--border-gray);
            padding: 0.9rem 0; /* Original header padding - just slightly reduced */
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(20px);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .app-logo {
            font-size: 1.4rem; /* Original logo font size */
            font-weight: 700;
            color: var(--text-white);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .app-logo i {
            font-size: 1.5rem;
            background: var(--gradient-accent);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .profile-info-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .current-profile {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.4rem 0.75rem;
            background: var(--secondary-black);
            border-radius: var(--border-radius-md);
            border: 1px solid var(--border-gray);
            font-size: 0.85rem;
        }

        /* SUPER COMPACT Navigation - This is the key fix! */
        .main-nav, .sub-nav {
            background: var(--secondary-black);
            border-bottom: 2px solid var(--border-gray);
            padding: 0.8rem 0; /* Original comfortable padding - just slightly reduced */
            position: sticky;
            top: 65px; /* Adjusted for original header */
            z-index: 99;
            backdrop-filter: blur(10px);
        }

        .nav-buttons, .sub-nav-buttons {
            display: flex;
            gap: 0.5rem; /* Original comfortable gap */
            flex-wrap: wrap;
            justify-content: center;
            overflow-x: auto;
            padding: 0 1rem;
            scrollbar-width: thin;
        }

        .nav-btn, .sub-nav-btn {
            background: var(--card-black);
            color: var(--text-white);
            border: 2px solid var(--border-gray);
            padding: 0.6rem 1.2rem; /* Original comfortable padding - just slightly reduced */
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-weight: 500;
            font-size: 0.9rem; /* Original readable size */
            transition: var(--transition-smooth);
            position: relative;
            overflow: hidden;
            white-space: nowrap;
            flex-shrink: 0;
            min-width: fit-content;
            line-height: 1.4;
        }

        .nav-btn i, .sub-nav-btn i {
            font-size: 0.8rem; /* Original icon size */
            margin-right: 0.4rem;
        }

        .nav-btn::before, .sub-nav-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: var(--transition-smooth);
        }

        .nav-btn:hover, .sub-nav-btn:hover {
            transform: translateY(-1px); /* Reduced transform */
            border-color: var(--accent-white);
            box-shadow: 0 2px 8px rgba(255, 255, 255, 0.1); /* Smaller shadow */
        }

        .nav-btn:hover::before, .sub-nav-btn:hover::before {
            left: 100%;
        }

        .nav-btn.active, .sub-nav-btn.active {
            background: var(--gradient-accent);
            color: var(--primary-black);
            border-color: var(--accent-white);
            box-shadow: 0 3px 12px rgba(255, 255, 255, 0.2); /* Smaller active shadow */
        }

        /* COMPACT Section Layout */
        .section {
            display: none;
            padding: 1.2rem 0; /* Original comfortable padding - just slightly reduced */
            min-height: calc(100vh - 160px); /* Adjusted for original header/nav */
        }

        .section.active {
            display: block;
            animation: sectionFadeIn 0.4s ease-out;
        }

        @keyframes sectionFadeIn {
            from {
                opacity: 0;
                transform: translateY(15px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-header {
            text-align: center;
            margin-bottom: 2rem; /* Reduced margin */
            position: relative;
        }

        .section-header::after {
            content: '';
            position: absolute;
            bottom: -0.75rem;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 2px;
            background: var(--gradient-accent);
            border-radius: 2px;
        }

        .section-title {
            font-size: clamp(1.5rem, 3vw, 2.2rem); /* Reduced size */
            font-weight: 700;
            margin-bottom: 0.75rem;
            color: var(--text-white);
            letter-spacing: -0.01em;
        }

        .section-subtitle {
            font-size: 1rem; /* Reduced size */
            color: var(--text-gray);
            max-width: 600px;
            margin: 0 auto;
            line-height: 1.5;
        }

        /* COMPACT Card Design */
        .card {
            background: var(--gradient-card);
            border: 2px solid var(--border-gray);
            border-radius: var(--border-radius-md);
            padding: 1.2rem; /* Standard comfortable padding */
            margin: 0.8rem 0; /* Standard comfortable margin */
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            position: relative;
            overflow: hidden;
            transition: var(--transition-smooth);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--gradient-accent);
            transform: scaleX(0);
            transition: var(--transition-smooth);
        }

        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.6);
            border-color: var(--accent-white);
        }

        .card:hover::before {
            transform: scaleX(1);
        }

        .card-header {
            margin-bottom: 1rem; /* Standard comfortable margin */
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border-gray);
            position: relative;
        }

        .card-title {
            font-size: 1.3rem; /* Reduced size */
            font-weight: 600;
            color: var(--text-white);
            margin-bottom: 0.4rem;
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }

        .card-subtitle {
            color: var(--text-gray);
            font-size: 0.9rem;
            line-height: 1.4;
        }

        /* COMPACT Form System */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); /* Reduced min width */
            gap: 1.5rem; /* Reduced gap */
            margin: 1.5rem 0;
        }

        .form-group {
            margin-bottom: 0.8rem; /* Standard comfortable margin */
        }

        .form-label {
            display: block;
            margin-bottom: 0.4rem;
            font-weight: 500;
            color: var(--text-white);
            font-size: 0.9rem;
        }

        .required {
            color: var(--error-red);
            margin-left: 0.2rem;
        }

        .form-input, .form-select {
            width: 100%;
            padding: 0.5rem 0.75rem; /* Ultra compact padding */
            background: var(--secondary-black);
            border: 2px solid var(--border-gray);
            border-radius: var(--border-radius-sm);
            color: var(--text-white);
            font-size: 0.85rem; /* Smaller font */
            transition: var(--transition-smooth);
            font-family: inherit;
        }

        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: var(--accent-white);
            background: var(--card-black);
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.1);
        }

        .form-input::placeholder {
            color: var(--text-gray);
        }

        /* COMPACT Assessment Design */
        .assessment-container {
            max-width: 800px; /* Reduced width */
            margin: 0 auto;
        }

        .progress-bar {
            width: 100%;
            height: 6px; /* Reduced height */
            background: var(--secondary-black);
            border-radius: 3px;
            margin-bottom: 1.5rem;
            overflow: hidden;
            border: 1px solid var(--border-gray);
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-accent);
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 3px;
        }

        .question-card {
            background: var(--gradient-card);
            border: 2px solid var(--border-gray);
            border-radius: var(--border-radius-md);
            padding: 2rem; /* Reduced padding */
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .question-number {
            color: var(--text-gray);
            font-size: 0.9rem;
            margin-bottom: 1rem;
            font-weight: 500;
        }

        .question-text {
            font-size: 1.3rem; /* Reduced size */
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--text-white);
            line-height: 1.4;
        }

        .options-grid {
            display: grid;
            gap: 0.75rem; /* Reduced gap */
            margin: 1.5rem 0;
        }

        .option-btn {
            background: var(--secondary-black);
            color: var(--text-white);
            border: 2px solid var(--border-gray);
            padding: 1rem 1.25rem; /* Reduced padding */
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition-bounce);
            text-align: left;
            position: relative;
            overflow: hidden;
        }

        .option-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: var(--transition-smooth);
        }

        .option-btn:hover {
            transform: translateY(-1px) scale(1.01);
            border-color: var(--accent-white);
            box-shadow: var(--shadow-light);
        }

        .option-btn:hover::before {
            left: 100%;
        }

        .option-btn.selected {
            background: var(--gradient-accent);
            color: var(--primary-black);
            border-color: var(--accent-white);
            transform: translateY(-1px) scale(1.01);
            box-shadow: 0 8px 25px rgba(255, 255, 255, 0.25);
        }

        .results-container {
            text-align: center;
            padding: 2rem; /* Reduced padding */
            background: var(--gradient-card);
            border-radius: var(--border-radius-md);
            border: 2px solid var(--border-gray);
        }

        .personality-type {
            font-size: 2rem; /* Reduced size */
            font-weight: 700;
            color: var(--text-white);
            margin: 1rem 0;
            background: var(--gradient-accent);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .personality-description {
            font-size: 1.1rem;
            color: var(--text-gray);
            margin-bottom: 1.5rem;
            line-height: 1.6;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        /* COMPACT Data Display */
        .data-display {
            background: var(--secondary-black);
            border: 1px solid var(--border-gray);
            border-radius: var(--border-radius-sm);
            padding: 1rem; /* Reduced padding */
            margin: 0.75rem 0;
        }

        .data-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0; /* Reduced padding */
            border-bottom: 1px solid var(--border-gray);
        }

        .data-row:last-child {
            border-bottom: none;
        }

        .data-label {
            font-weight: 500;
            color: var(--text-gray);
            flex: 1;
            font-size: 0.9rem;
        }

        .data-value {
            font-weight: 600;
            color: var(--text-white);
            text-align: right;
            flex: 1;
            font-size: 0.9rem;
        }

        /* COMPACT List Items */
        .items-list {
            margin: 1rem 0;
        }

        .list-item {
            background: var(--gradient-card);
            border: 2px solid var(--border-gray);
            border-radius: var(--border-radius-sm);
            padding: 1rem; /* Reduced padding */
            margin: 0.75rem 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition-smooth);
            position: relative;
            overflow: hidden;
        }

        .list-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
            background: var(--gradient-accent);
            transform: scaleY(0);
            transition: var(--transition-smooth);
        }

        .list-item:hover {
            transform: translateX(3px);
            border-color: var(--accent-white);
            box-shadow: var(--shadow-light);
        }

        .list-item:hover::before {
            transform: scaleY(1);
        }

        .item-info {
            flex: 1;
        }

        .item-title {
            font-weight: 600;
            color: var(--text-white);
            margin-bottom: 0.3rem;
            font-size: 1rem;
        }

        .item-details {
            color: var(--text-gray);
            font-size: 0.85rem;
            line-height: 1.3;
        }

        .item-actions {
            display: flex;
            gap: 0.5rem;
            flex-shrink: 0;
        }

        /* COMPACT Charts */
        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin: 1.5rem 0;
        }

        .chart-container {
            background: var(--gradient-card);
            border: 2px solid var(--border-gray);
            border-radius: var(--border-radius-md);
            padding: 1.5rem;
            position: relative;
            overflow: hidden;
        }

        .chart-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--gradient-accent);
            transform: scaleX(0);
            transition: var(--transition-smooth);
        }

        .chart-container:hover::before {
            transform: scaleX(1);
        }

        .chart-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            text-align: center;
            color: var(--text-white);
        }

        /* COMPACT Widgets */
        .widgets-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .widget {
            background: var(--gradient-card);
            border: 2px solid var(--border-gray);
            border-radius: var(--border-radius-md);
            padding: 1.5rem;
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: var(--transition-bounce);
        }

        .widget::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--gradient-accent);
            transform: scaleX(0);
            transition: var(--transition-smooth);
        }

        .widget:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: var(--shadow-light);
        }

        .widget:hover::before {
            transform: scaleX(1);
        }

        .widget-icon {
            font-size: 2rem;
            margin-bottom: 0.75rem;
            color: var(--accent-white);
        }

        .widget-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 0.4rem;
            color: var(--text-white);
        }

        .widget-label {
            color: var(--text-gray);
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* COMPACT Chatbot */
        .chatbot-container {
            position: fixed;
            bottom: 1.5rem;
            right: 1.5rem;
            z-index: 1000;
        }

        .chatbot-toggle {
            width: 60px; /* Reduced size */
            height: 60px;
            border-radius: 50%;
            background: var(--gradient-accent);
            color: var(--primary-black);
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(255, 255, 255, 0.25);
            transition: var(--transition-bounce);
            position: relative;
            overflow: hidden;
        }

        .chatbot-toggle::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transform: translateX(-100%);
            transition: var(--transition-smooth);
        }

        .chatbot-toggle:hover {
            transform: scale(1.08) rotate(3deg);
            box-shadow: 0 12px 30px rgba(255, 255, 255, 0.35);
        }

        .chatbot-toggle:hover::before {
            transform: translateX(100%);
        }

        .chatbot-window {
            display: none;
            position: absolute;
            bottom: 75px;
            right: 0;
            width: 350px; /* Reduced width */
            height: 500px; /* Reduced height */
            background: var(--gradient-card);
            border: 2px solid var(--border-gray);
            border-radius: var(--border-radius-md);
            box-shadow: var(--shadow-heavy);
            overflow: hidden;
        }

        .chatbot-header {
            background: var(--secondary-black);
            padding: 1rem;
            border-bottom: 1px solid var(--border-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chatbot-header h4 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            font-size: 1rem;
        }

        .chatbot-messages {
            height: 350px; /* Adjusted for smaller window */
            overflow-y: auto;
            padding: 1rem;
            scroll-behavior: smooth;
        }

        .chat-message {
            margin: 0.75rem 0;
            display: flex;
            align-items: flex-start;
            gap: 0.6rem;
            animation: messageSlideIn 0.3s ease-out;
        }

        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateY(8px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .chat-message.user {
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 32px; /* Reduced size */
            height: 32px;
            border-radius: 50%;
            background: var(--gradient-accent);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            color: var(--primary-black);
            flex-shrink: 0;
        }

        .chat-message.user .message-avatar {
            background: var(--secondary-black);
            color: var(--text-white);
            border: 2px solid var(--border-gray);
        }

        .message-content {
            background: var(--secondary-black);
            color: var(--text-white);
            padding: 0.75rem 1rem; /* Reduced padding */
            border-radius: var(--border-radius-sm);
            max-width: 80%;
            word-wrap: break-word;
            line-height: 1.4;
            border: 1px solid var(--border-gray);
            font-size: 0.9rem;
        }

        .chat-message.user .message-content {
            background: var(--gradient-accent);
            color: var(--primary-black);
            border-color: var(--accent-white);
        }

        .chatbot-input {
            display: flex;
            padding: 0.75rem;
            border-top: 1px solid var(--border-gray);
            gap: 0.5rem;
            background: var(--secondary-black);
        }

        .chatbot-input input {
            flex: 1;
            padding: 0.6rem 0.8rem;
            background: var(--card-black);
            border: 1px solid var(--border-gray);
            border-radius: var(--border-radius-sm);
            color: var(--text-white);
            font-size: 0.9rem;
        }

        .chatbot-input input:focus {
            outline: none;
            border-color: var(--accent-white);
        }

        /* COMPACT Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }

        .modal-content {
            background: var(--gradient-card);
            border: 2px solid var(--border-gray);
            border-radius: var(--border-radius-md);
            padding: 2rem;
            max-width: 500px; /* Reduced width */
            width: 95%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border-gray);
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-white);
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-gray);
            font-size: 1.3rem;
            cursor: pointer;
            transition: var(--transition-smooth);
            padding: 0.4rem;
            border-radius: 50%;
        }

        .close-btn:hover {
            color: var(--text-white);
            background: var(--secondary-black);
        }

        /* COMPACT Alerts */
        .alert {
            padding: 1rem 1.25rem; /* Reduced padding */
            border-radius: var(--border-radius-sm);
            margin: 0.75rem 0;
            font-weight: 500;
            border: 2px solid;
            position: relative;
            overflow: hidden;
            font-size: 0.9rem;
        }

        .alert::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 3px;
            height: 100%;
            background: currentColor;
        }

        .alert-success {
            background: rgba(0, 255, 136, 0.1);
            border-color: var(--success-green);
            color: var(--success-green);
        }

        .alert-danger {
            background: rgba(255, 107, 107, 0.1);
            border-color: var(--error-red);
            color: var(--error-red);
        }

        .alert-info {
            background: rgba(0, 212, 255, 0.1);
            border-color: var(--info-blue);
            color: var(--info-blue);
        }

        .alert-warning {
            background: rgba(255, 159, 67, 0.1);
            border-color: var(--warning-orange);
            color: var(--warning-orange);
        }

        /* COMPACT File Upload */
        .file-upload {
            border: 2px dashed var(--border-gray);
            border-radius: var(--border-radius-md);
            padding: 2rem 1.5rem; /* Reduced padding */
            text-align: center;
            background: var(--secondary-black);
            transition: var(--transition-smooth);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .file-upload::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.05), transparent);
            transition: var(--transition-smooth);
        }

        .file-upload:hover {
            border-color: var(--accent-white);
            background: var(--card-black);
            transform: scale(1.01);
        }

        .file-upload:hover::before {
            left: 100%;
        }

        .file-upload.dragover {
            border-color: var(--success-green);
            background: rgba(0, 255, 136, 0.05);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 3rem; /* Reduced size */
            color: var(--text-gray);
            margin-bottom: 1rem;
            transition: var(--transition-smooth);
        }

        .file-upload:hover .upload-icon {
            color: var(--accent-white);
            transform: scale(1.05);
        }

        .upload-text {
            color: var(--text-gray);
            margin-bottom: 0.75rem;
            font-size: 1rem;
            font-weight: 500;
        }

        .upload-formats {
            color: var(--text-gray);
            font-size: 0.85rem;
            opacity: 0.7;
        }

        /* COMPACT Export Options */
        .export-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .export-option {
            background: var(--gradient-card);
            border: 2px solid var(--border-gray);
            border-radius: var(--border-radius-md);
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition-bounce);
            position: relative;
            overflow: hidden;
        }

        .export-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--gradient-accent);
            transform: scaleX(0);
            transition: var(--transition-smooth);
        }

        .export-option:hover {
            transform: translateY(-3px) scale(1.02);
            border-color: var(--accent-white);
            box-shadow: var(--shadow-light);
        }

        .export-option:hover::before {
            transform: scaleX(1);
        }

        .export-icon {
            font-size: 2rem;
            margin-bottom: 0.75rem;
            color: var(--accent-white);
            transition: var(--transition-smooth);
        }

        .export-option:hover .export-icon {
            transform: scale(1.05) rotate(3deg);
        }

        .export-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .export-description {
            color: var(--text-gray);
            font-size: 0.85rem;
            line-height: 1.3;
        }

        /* Responsive Design - OPTIMIZED */
        @media (max-width: 1200px) {
            .container {
                max-width: 1140px;
                padding: 0 1rem;
            }
        }

        @media (max-width: 992px) {
            .container {
                max-width: 960px;
                padding: 0 0.75rem;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .charts-grid {
                grid-template-columns: 1fr;
            }
            
            .widgets-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .profile-card {
                padding: 1.5rem;
            }
            
            .cover-content {
                padding: 1rem;
            }
            
            .features-highlight {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                max-width: 280px;
            }
            
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 0.5rem;
            }
            
            .profile-info-header {
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .nav-buttons, .sub-nav-buttons {
                justify-content: flex-start;
                overflow-x: auto;
                padding-bottom: 0.25rem;
            }
            
            .nav-btn, .sub-nav-btn {
                flex-shrink: 0;
                font-size: 0.75rem;
                padding: 0.4rem 0.6rem;
            }
            
            .widgets-grid {
                grid-template-columns: 1fr;
            }
            
            .chatbot-window {
                width: 320px;
                height: 450px;
            }
            
            .chatbot-messages {
                height: 300px;
            }
            
            .modal-content {
                padding: 1.5rem;
                margin: 1rem;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 0 0.5rem;
            }
            
            .profile-card {
                padding: 1rem;
            }
            
            .card {
                padding: 1rem;
            }
            
            .section {
                padding: 1rem 0;
            }
            
            .question-card {
                padding: 1.5rem;
            }
            
            .chatbot-container {
                bottom: 1rem;
                right: 1rem;
            }
            
            .chatbot-window {
                width: 300px;
                height: 400px;
            }
            
            .chatbot-messages {
                height: 260px;
            }
            
            .app-title {
                font-size: 2rem;
            }
            
            .section-title {
                font-size: 1.5rem;
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-gray);
            border-radius: 50%;
            border-top-color: var(--accent-white);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 6px; /* Thinner scrollbar */
        }

        ::-webkit-scrollbar-track {
            background: var(--secondary-black);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-gray);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-gray);
        }

        /* Selection Styling */
        ::selection {
            background: rgba(255, 255, 255, 0.2);
            color: var(--text-white);
        }

        /* Focus Styling */
        *:focus {
            outline: 2px solid rgba(255, 255, 255, 0.3);
            outline-offset: 1px;
        }

        /* Print Styles */
        @media print {
            .chatbot-container,
            .app-header,
            .main-nav,
            .sub-nav {
                display: none !important;
            }
            
            .card {
                break-inside: avoid;
            }
        }
    </style>
</head>
<body>
</body>
</html>
    <!-- COMPACT Profile Management Screen -->
    <div id="profile-management" class="profile-management">
        <div class="profile-card">
            <div class="profile-header">
                <h1><i class="fas fa-chart-line"></i> Financial Planner Pro</h1>
                <p class="subtitle">Million Dollar Financial Planning Platform</p>
                <p class="tagline">Your Gateway to Financial Freedom</p>
            </div>

            <!-- COMPACT Welcome Section -->
            <div id="welcome-message" class="welcome-section">
                <h3><i class="fas fa-rocket"></i> Welcome to Your Financial Journey!</h3>
                <p>Experience the most advanced financial planning platform designed to transform your financial future. Create your personalized profile and unlock powerful insights.</p>
            </div>

            <!-- COMPACT Saved Profiles List -->
            <div id="saved-profiles" class="profile-list" style="display: none;">
                <h3><i class="fas fa-folder-open"></i> Your Saved Profiles</h3>
                <div id="profiles-container" class="profiles-grid"></div>
            </div>

            <!-- COMPACT Action Buttons -->
            <div class="action-buttons">
                <button class="btn btn-primary btn-large" onclick="createNewProfile()">
                    <i class="fas fa-plus-circle"></i> Create New Profile
                </button>
                <button class="btn btn-secondary btn-large" onclick="showImportModal()">
                    <i class="fas fa-cloud-upload-alt"></i> Import Data
                </button>
            </div>
        </div>
    </div>

    <!-- COMPACT Cover Page -->
    <div id="cover-page" class="cover-page" style="display: none;">
        <div class="cover-content">
            <h1 class="app-title">Financial Planner Pro</h1>
            <p class="app-subtitle">Your Complete Financial Planning & Wealth Management Solution</p>
            
            <!-- Features Highlight -->
            <div class="features-highlight">
                <div class="feature-item">
                    <div class="feature-icon"><i class="fas fa-brain"></i></div>
                    <div class="feature-title">Smart Assessment</div>
                    <div class="feature-desc">Advanced personality analysis</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon"><i class="fas fa-chart-bar"></i></div>
                    <div class="feature-title">Advanced Analytics</div>
                    <div class="feature-desc">Real-time financial insights</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon"><i class="fas fa-file-pdf"></i></div>
                    <div class="feature-title">Professional Reports</div>
                    <div class="feature-desc">Export-ready PDF reports</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon"><i class="fas fa-shield-alt"></i></div>
                    <div class="feature-title">Secure Storage</div>
                    <div class="feature-desc">Bank-grade data protection</div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-primary btn-large" onclick="startPersonalityAssessment()">
                    <i class="fas fa-play-circle"></i> Start Assessment
                </button>
                <button class="btn btn-secondary" onclick="startClientProfiling()">
                    <i class="fas fa-user-cog"></i> Skip to Profiling
                </button>
                <button class="btn btn-secondary" onclick="goBackToProfiles()">
                    <i class="fas fa-arrow-left"></i> Back to Profiles
                </button>
            </div>
        </div>
    </div>

    <!-- COMPACT Main Application -->
    <div id="main-app" class="main-app">
        <!-- COMPACT Header -->
        <header class="app-header">
            <div class="container">
                <div class="header-content">
                    <div class="app-logo">
                        <i class="fas fa-chart-line"></i>
                        Financial Planner Pro
                    </div>
                    <div class="profile-info-header">
                        <div class="current-profile">
                            <i class="fas fa-user-circle"></i>
                            <span id="current-profile-name">Profile Name</span>
                            <span id="current-profile-status" class="profile-status">●</span>
                        </div>
                        <button class="btn btn-small btn-primary" onclick="saveCurrentProfile()">
                            <i class="fas fa-save"></i> Save
                        </button>
                        <button class="btn btn-small btn-secondary" onclick="showExportModal()">
                            <i class="fas fa-download"></i> Export
                        </button>
                        <button class="btn btn-small btn-secondary" onclick="showSettingsModal()">
                            <i class="fas fa-cog"></i> Settings
                        </button>
                        <button class="btn btn-small btn-secondary" onclick="goBackToProfiles()">
                            <i class="fas fa-home"></i> Home
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- SUPER COMPACT Navigation -->
        <nav class="main-nav">
            <div class="container">
                <div class="nav-buttons">
                    <button class="nav-btn active" onclick="showMainSection('client-data')">
                        <i class="fas fa-user-edit"></i> Client Data
                    </button>
                    <button class="nav-btn" onclick="showMainSection('investment-advisory')">
                        <i class="fas fa-chart-line"></i> Investment
                    </button>
                    <button class="nav-btn" onclick="showMainSection('analytics-reports')">
                        <i class="fas fa-analytics"></i> Analytics
                    </button>
                    <button class="nav-btn" onclick="showMainSection('advanced-tools')">
                        <i class="fas fa-tools"></i> Tools
                    </button>
                </div>
            </div>
        </nav>

        <!-- SUPER COMPACT Sub Navigation -->
        <nav class="sub-nav">
            <div class="container">
                <!-- Client Data Sub-nav -->
                <div id="client-data-subnav" class="sub-nav-buttons">
                    <button class="sub-nav-btn active" onclick="showSubSection('personality', this)">
                        <i class="fas fa-brain"></i> Assessment
                    </button>
                    <button class="sub-nav-btn" onclick="showSubSection('profile', this)">
                        <i class="fas fa-id-card"></i> Basic Info
                    </button>
                    <button class="sub-nav-btn" onclick="showSubSection('financial', this)">
                        <i class="fas fa-wallet"></i> Financial
                    </button>
                    <button class="sub-nav-btn" onclick="showSubSection('networth', this)">
                        <i class="fas fa-calculator"></i> Net Worth
                    </button>
                    <button class="sub-nav-btn" onclick="showSubSection('goals', this)">
                        <i class="fas fa-bullseye"></i> Goals
                    </button>
                    <button class="sub-nav-btn" onclick="showSubSection('risk', this)">
                        <i class="fas fa-chart-area"></i> Risk
                    </button>
                </div>

                <!-- Investment Advisory Sub-nav -->
                <div id="investment-advisory-subnav" class="sub-nav-buttons" style="display: none;">
                    <button class="sub-nav-btn active" onclick="showSubSection('recommendations', this)">
                        <i class="fas fa-lightbulb"></i> Plan
                    </button>
                    <button class="sub-nav-btn" onclick="showSubSection('portfolio', this)">
                        <i class="fas fa-pie-chart"></i> Portfolio
                    </button>
                    <button class="sub-nav-btn" onclick="showSubSection('sip', this)">
                        <i class="fas fa-calendar-check"></i> SIP
                    </button>
                    <button class="sub-nav-btn" onclick="showSubSection('tax', this)">
                        <i class="fas fa-receipt"></i> Tax
                    </button>
                    <button class="sub-nav-btn" onclick="showSubSection('retirement', this)">
                        <i class="fas fa-umbrella"></i> Retirement
                    </button>
                    <button class="sub-nav-btn" onclick="showSubSection('comparison', this)">
                        <i class="fas fa-balance-scale"></i> Compare
                    </button>
                </div>

                <!-- Analytics & Reports Sub-nav -->
                <div id="analytics-reports-subnav" class="sub-nav-buttons" style="display: none;">
                    <button class="sub-nav-btn active" onclick="showSubSection('analytics', this)">
                        <i class="fas fa-chart-bar"></i> Analytics
                    </button>
                    <button class="sub-nav-btn" onclick="showSubSection('reports', this)">
                        <i class="fas fa-file-alt"></i> Reports
                    </button>
                    <button class="sub-nav-btn" onclick="showSubSection('summary', this)">
                        <i class="fas fa-clipboard-list"></i> Summary
                    </button>
                    <button class="sub-nav-btn" onclick="showSubSection('alerts', this)">
                        <i class="fas fa-bell"></i> Alerts
                    </button>
                </div>

                <!-- Advanced Tools Sub-nav -->
                <div id="advanced-tools-subnav" class="sub-nav-buttons" style="display: none;">
                    <button class="sub-nav-btn active" onclick="showSubSection('loan-calculator', this)">
                        <i class="fas fa-home"></i> Loan Calc
                    </button>
                    <button class="sub-nav-btn" onclick="showSubSection('budget-planner', this)">
                        <i class="fas fa-chart-pie"></i> Budget
                    </button>
                    <button class="sub-nav-btn" onclick="showSubSection('investment-tracker', this)">
                        <i class="fas fa-trending-up"></i> Tracker
                    </button>
                    <button class="sub-nav-btn" onclick="showSubSection('financial-calendar', this)">
                        <i class="fas fa-calendar-alt"></i> Calendar
                    </button>
                </div>
            </div>
        </nav>

        <!-- Sections Container -->
        <main class="container">
            <!-- Personality Assessment Section -->
            <section id="personality" class="section active">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-brain"></i>
                        Financial Personality Assessment
                    </h2>
                    <p class="section-subtitle">
                        Discover your unique financial DNA through our scientifically-designed assessment.
                    </p>
                </div>

                <div class="assessment-container">
                    <!-- Progress Indicator -->
                    <div class="progress-bar">
                        <div class="progress-fill" id="assessment-progress" style="width: 0%"></div>
                    </div>

                    <!-- Assessment Questions -->
                    <div id="assessment-questions">
                        <div class="question-card">
                            <div class="question-number" id="question-number">Question 1 of 10</div>
                            <div class="question-text" id="question-text">Loading question...</div>
                            <div class="options-grid" id="question-options">
                                <!-- Options will be loaded here -->
                            </div>
                        </div>

                        <div style="text-align: center; margin-top: 1.5rem;">
                            <button class="btn btn-secondary" id="prev-btn" onclick="previousQuestion()" style="display: none;">
                                <i class="fas fa-arrow-left"></i> Previous
                            </button>
                            <button class="btn btn-primary" id="next-btn" onclick="nextQuestion()" style="display: none;">
                                Next <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Assessment Results -->
                    <div id="assessment-results" style="display: none;">
                        <div class="results-container">
                            <div style="text-align: center; margin-bottom: 1.5rem;">
                                <i class="fas fa-trophy" style="font-size: 2.5rem; color: var(--warning-orange); margin-bottom: 1rem;"></i>
                                <h3>Your Financial Personality Revealed</h3>
                            </div>
                            <div class="personality-type" id="personality-type"></div>
                            <div class="personality-description" id="personality-description"></div>
                            
                            <!-- Personality Insights -->
                            <div id="personality-insights" class="card" style="margin-top: 1.5rem;">
                                <div class="card-header">
                                    <h4 class="card-title"><i class="fas fa-lightbulb"></i> Personalized Insights</h4>
                                </div>
                                <div id="insights-content"></div>
                            </div>
                            
                            <div style="text-align: center; margin-top: 1.5rem;">
                                <button class="btn btn-primary btn-large" onclick="proceedToClientProfiling()">
                                    Continue to Profile Setup <i class="fas fa-arrow-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Basic Client Information -->
            <section id="profile" class="section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-user-edit"></i>
                        Client Profile
                    </h2>
                    <p class="section-subtitle">
                        Build your detailed financial profile for personalized recommendations.
                    </p>
                </div>

                <div class="card">
                    <form id="basic-info-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Full Name <span class="required">*</span></label>
                                <input type="text" id="client-name" class="form-input" placeholder="Enter your full name" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Age <span class="required">*</span></label>
                                <input type="number" id="client-age" class="form-input" min="18" max="100" placeholder="Enter your age" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Occupation <span class="required">*</span></label>
                                <input type="text" id="client-occupation" class="form-input" placeholder="Enter your occupation" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Marital Status <span class="required">*</span></label>
                                <select id="marital-status" class="form-select" required>
                                    <option value="">Select Status</option>
                                    <option value="single">Single</option>
                                    <option value="married">Married</option>
                                    <option value="divorced">Divorced</option>
                                    <option value="widowed">Widowed</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Number of Dependents <span class="required">*</span></label>
                                <input type="number" id="dependents" class="form-input" min="0" placeholder="Enter number of dependents" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">City <span class="required">*</span></label>
                                <input type="text" id="client-city" class="form-input" placeholder="Enter your city" required>
                            </div>
                        </div>
                        <div style="text-align: center; margin-top: 1.5rem;">
                            <button type="submit" class="btn btn-primary btn-large">
                                <i class="fas fa-save"></i> Save Profile Information
                            </button>
                        </div>
                    </form>

                    <div id="saved-basic-info" style="display: none;">
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle"></i> Profile information saved successfully!
                        </div>
                        <div id="basic-info-display"></div>
                        <div style="text-align: center; margin-top: 1rem;">
                            <button class="btn btn-secondary" onclick="editBasicInfo()">
                                <i class="fas fa-edit"></i> Modify Information
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Financial Status -->
            <section id="financial" class="section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-chart-line"></i>
                        Financial Status Analysis
                    </h2>
                    <p class="section-subtitle">
                        Provide details about your current financial situation for accurate planning.
                    </p>
                </div>

                <div class="card">
                    <form id="financial-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Monthly Income (₹) <span class="required">*</span></label>
                                <input type="number" id="monthly-income" class="form-input" min="0" placeholder="Enter monthly income" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Monthly Expenses (₹) <span class="required">*</span></label>
                                <input type="number" id="monthly-expenses" class="form-input" min="0" placeholder="Enter monthly expenses" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Current Savings (₹) <span class="required">*</span></label>
                                <input type="number" id="current-savings" class="form-input" min="0" placeholder="Enter current savings" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Annual Income (₹) <span class="required">*</span></label>
                                <input type="number" id="annual-income" class="form-input" min="0" placeholder="Enter annual income" required>
                            </div>
                        </div>
                        <div style="text-align: center; margin-top: 1.5rem;">
                            <button type="submit" class="btn btn-primary btn-large">
                                <i class="fas fa-chart-bar"></i> Analyze Financial Status
                            </button>
                        </div>
                    </form>

                    <div id="saved-financial-info" style="display: none;">
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle"></i> Financial status analyzed successfully!
                        </div>
                        <div id="financial-info-display"></div>
                        <div id="financial-insights" class="card" style="margin-top: 1rem;">
                            <div class="card-header">
                                <h4 class="card-title"><i class="fas fa-lightbulb"></i> Financial Health Insights</h4>
                            </div>
                            <div id="financial-insights-content"></div>
                        </div>
                        <div style="text-align: center; margin-top: 1rem;">
                            <button class="btn btn-secondary" onclick="editFinancialInfo()">
                                <i class="fas fa-edit"></i> Modify Financial Status
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Net Worth Calculator -->
            <section id="networth" class="section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-calculator"></i>
                        Net Worth Calculator
                    </h2>
                    <p class="section-subtitle">
                        Build a comprehensive picture of your financial position with real-time calculations.
                    </p>
                </div>

                <div class="form-grid">
                    <!-- Assets Section -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-plus-circle"></i>
                                Asset Portfolio
                            </h3>
                        </div>
                        
                        <form id="asset-form">
                            <div class="form-group">
                                <label class="form-label">Asset Type <span class="required">*</span></label>
                                <select id="asset-type" class="form-select" required>
                                    <option value="">Select Asset Type</option>
                                    <option value="cash">💰 Cash & Bank Deposits</option>
                                    <option value="stocks">📈 Stocks & Mutual Funds</option>
                                    <option value="property">🏠 Real Estate</option>
                                    <option value="gold">🥇 Gold & Precious Metals</option>
                                    <option value="other">📦 Other Assets</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Description <span class="required">*</span></label>
                                <input type="text" id="asset-name" class="form-input" placeholder="e.g., HDFC Equity Fund" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Current Value (₹) <span class="required">*</span></label>
                                <input type="number" id="asset-value" class="form-input" min="0" placeholder="Enter current value" required>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Add Asset
                            </button>
                        </form>

                        <div id="assets-list" class="items-list">
                            <!-- Assets will be displayed here -->
                        </div>
                    </div>

                    <!-- Liabilities Section -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-minus-circle"></i>
                                Liability Management
                            </h3>
                        </div>
                        
                        <form id="loan-form">
                            <div class="form-group">
                                <label class="form-label">Loan Type <span class="required">*</span></label>
                                <select id="loan-type" class="form-select" required>
                                    <option value="">Select Loan Type</option>
                                    <option value="home">🏠 Home Loan</option>
                                    <option value="car">🚗 Car Loan</option>
                                    <option value="personal">💳 Personal Loan</option>
                                    <option value="credit">💳 Credit Card Debt</option>
                                    <option value="other">📋 Other Loans</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Outstanding Amount (₹) <span class="required">*</span></label>
                                <input type="number" id="loan-amount" class="form-input" min="0" placeholder="Enter outstanding amount" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Interest Rate (%) <span class="required">*</span></label>
                                <input type="number" id="loan-rate" class="form-input" min="0" max="50" step="0.1" placeholder="Enter interest rate" required>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Add Liability
                            </button>
                        </form>

                        <div id="loans-list" class="items-list">
                            <!-- Loans will be displayed here -->
                        </div>
                    </div>
                </div>

                <!-- Net Worth Summary -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-chart-pie"></i>
                            Net Worth Analysis
                        </h3>
                    </div>
                    
                    <div id="networth-summary">
                        <div class="data-display">
                            <div class="data-row">
                                <span class="data-label">💰 Total Assets:</span>
                                <span class="data-value" id="total-assets">₹0</span>
                            </div>
                            <div class="data-row">
                                <span class="data-label">📉 Total Liabilities:</span>
                                <span class="data-value" id="total-liabilities">₹0</span>
                            </div>
                            <div class="data-row" style="border-top: 2px solid var(--accent-white); font-weight: bold; padding-top: 0.75rem;">
                                <span class="data-label">🎯 Net Worth:</span>
                                <span class="data-value" id="net-worth">₹0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Goals and Insurance -->
            <section id="goals" class="section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-bullseye"></i>
                        Goals & Insurance Planning
                    </h2>
                    <p class="section-subtitle">
                        Set intelligent financial goals and plan comprehensive insurance coverage.
                    </p>
                </div>

                <div class="form-grid">
                    <!-- Financial Goals -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-target"></i>
                                Financial Goals
                            </h3>
                        </div>
                        
                        <form id="goal-form">
                            <div class="form-group">
                                <label class="form-label">Goal Name <span class="required">*</span></label>
                                <input type="text" id="goal-name" class="form-input" placeholder="e.g., Dream Home, Child's Education" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Target Amount (₹) <span class="required">*</span></label>
                                <input type="number" id="goal-amount" class="form-input" min="0" placeholder="Enter target amount" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Time Frame (Years) <span class="required">*</span></label>
                                <input type="number" id="goal-timeframe" class="form-input" min="1" max="50" placeholder="Years to achieve goal" required>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Add Goal
                            </button>
                        </form>

                        <div id="goals-list" class="items-list">
                            <!-- Goals will be displayed here -->
                        </div>
                    </div>

                    <!-- Insurance Planning -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-shield-alt"></i>
                                Insurance Analysis
                            </h3>
                        </div>
                        
                        <form id="insurance-form">
                            <div class="form-group">
                                <label class="form-label">Current Life Insurance (₹)</label>
                                <input type="number" id="current-life-insurance" class="form-input" min="0" placeholder="Enter current coverage">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Current Health Insurance (₹)</label>
                                <input type="number" id="current-health-insurance" class="form-input" min="0" placeholder="Enter current coverage">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Family Annual Expenses (₹) <span class="required">*</span></label>
                                <input type="number" id="family-expenses" class="form-input" min="0" placeholder="Annual family expenses" required>
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Save Insurance Profile
                            </button>
                        </form>

                        <div id="saved-insurance-info" style="display: none;">
                            <div class="alert alert-success">
                                <i class="fas fa-check-circle"></i> Insurance profile saved successfully!
                            </div>
                            <div id="insurance-info-display"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Risk Profile -->
            <section id="risk" class="section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-chart-area"></i>
                        Risk Profile Analysis
                    </h2>
                    <p class="section-subtitle">
                        Determine your optimal investment strategy and risk tolerance levels.
                    </p>
                </div>

                <div class="card">
                    <form id="risk-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Investment Experience <span class="required">*</span></label>
                                <select id="investment-experience" class="form-select" required>
                                    <option value="">Select Experience Level</option>
                                    <option value="beginner">🌱 Beginner (0-2 years)</option>
                                    <option value="intermediate">📈 Intermediate (3-7 years)</option>
                                    <option value="experienced">🎯 Experienced (8-15 years)</option>
                                    <option value="expert">🏆 Expert (15+ years)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Risk Tolerance <span class="required">*</span></label>
                                <select id="risk-tolerance" class="form-select" required>
                                    <option value="">Select Risk Level</option>
                                    <option value="conservative">🔒 Conservative - Stable returns</option>
                                    <option value="moderate">⚖️ Moderate - Balanced approach</option>
                                    <option value="aggressive">🚀 Aggressive - Growth focused</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Investment Horizon <span class="required">*</span></label>
                                <select id="investment-horizon" class="form-select" required>
                                    <option value="">Select Time Horizon</option>
                                    <option value="short">⏰ Short Term (1-3 years)</option>
                                    <option value="medium">📅 Medium Term (3-7 years)</option>
                                    <option value="long">🗓️ Long Term (7+ years)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Monthly Investment Capacity (₹) <span class="required">*</span></label>
                                <input type="number" id="monthly-investment" class="form-input" min="0" placeholder="Amount you can invest monthly" required>
                            </div>
                        </div>
                        <div style="text-align: center; margin-top: 1.5rem;">
                            <button type="submit" class="btn btn-primary btn-large">
                                <i class="fas fa-chart-area"></i> Analyze Risk Profile
                            </button>
                        </div>
                    </form>

                    <div id="saved-risk-info" style="display: none;">
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle"></i> Risk profile analyzed successfully!
                        </div>
                        <div id="risk-info-display"></div>
                    </div>
                </div>
            </section>

            <!-- Investment Recommendations -->
            <section id="recommendations" class="section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-lightbulb"></i>
                        Investment Recommendations
                    </h2>
                    <p class="section-subtitle">
                        Get personalized investment strategies based on your complete financial profile.
                    </p>
                </div>

                <div class="card">
                    <div style="text-align: center; margin-bottom: 1.5rem;">
                        <button class="btn btn-primary btn-large" onclick="generateInvestmentPlan()">
                            <i class="fas fa-magic"></i> Generate Investment Plan
                        </button>
                        <button class="btn btn-secondary" onclick="generateQuickRecommendations()">
                            <i class="fas fa-bolt"></i> Quick Recommendations
                        </button>
                    </div>
                    
                    <div id="investment-plan-results">
                        <!-- Investment plan will be displayed here -->
                    </div>
                </div>
            </section>

            <!-- Portfolio Analysis -->
            <section id="portfolio" class="section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-pie-chart"></i>
                        Portfolio Analysis
                    </h2>
                    <p class="section-subtitle">
                        Comprehensive portfolio analysis with performance tracking and rebalancing recommendations.
                    </p>
                </div>

                <div class="card">
                    <div style="text-align: center; margin-bottom: 1.5rem;">
                        <button class="btn btn-primary" onclick="analyzePortfolio()">
                            <i class="fas fa-search-plus"></i> Analyze Portfolio
                        </button>
                        <button class="btn btn-secondary" onclick="generateRebalancingPlan()">
                            <i class="fas fa-balance-scale"></i> Rebalancing Plan
                        </button>
                    </div>
                    
                    <div id="portfolio-analysis-results">
                        <!-- Portfolio analysis will be displayed here -->
                    </div>
                </div>
            </section>

            <!-- SIP Calculator -->
            <section id="sip" class="section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-calendar-check"></i>
                        SIP Calculator
                    </h2>
                    <p class="section-subtitle">
                        Calculate SIP returns with inflation adjustment and step-up options.
                    </p>
                </div>

                <div class="card">
                    <form id="sip-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Monthly SIP Amount (₹) <span class="required">*</span></label>
                                <input type="number" id="sip-amount" class="form-input" min="500" placeholder="Minimum ₹500" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Expected Annual Return (%) <span class="required">*</span></label>
                                <input type="number" id="sip-return" class="form-input" value="12" min="1" max="30" step="0.1" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Investment Period (Years) <span class="required">*</span></label>
                                <input type="number" id="sip-period" class="form-input" min="1" max="50" placeholder="Investment duration" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Annual Step-up (%)</label>
                                <input type="number" id="sip-stepup" class="form-input" value="10" min="0" max="50" step="0.1">
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin: 1.5rem 0;">
                            <button type="submit" class="btn btn-primary btn-large">
                                <i class="fas fa-calculator"></i> Calculate SIP Returns
                            </button>
                        </div>
                    </form>

                    <div id="sip-results" style="display: none;">
                        <!-- SIP calculation results will be displayed here -->
                    </div>
                </div>
            </section>

            <!-- Tax Planning -->
            <section id="tax" class="section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-receipt"></i>
                        Tax Planning
                    </h2>
                    <p class="section-subtitle">
                        Optimize your tax strategy with detailed analysis and smart investment recommendations.
                    </p>
                </div>

                <div class="card">
                    <form id="tax-planning-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Annual Gross Income (₹) <span class="required">*</span></label>
                                <input type="number" id="taxable-income" class="form-input" min="0" placeholder="Enter gross annual income" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Current 80C Investments (₹)</label>
                                <input type="number" id="current-80c" class="form-input" min="0" max="150000" placeholder="Current 80C investments">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Health Insurance Premium (₹)</label>
                                <input type="number" id="health-premium" class="form-input" min="0" placeholder="Health insurance premium">
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin: 1.5rem 0;">
                            <button type="submit" class="btn btn-primary btn-large">
                                <i class="fas fa-calculator"></i> Generate Tax Plan
                            </button>
                        </div>
                    </form>

                    <div id="tax-plan-results" style="display: none;">
                        <!-- Tax planning results will be displayed here -->
                    </div>
                </div>
            </section>

            <!-- Retirement Planning -->
            <section id="retirement" class="section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-umbrella"></i>
                        Retirement Planning
                    </h2>
                    <p class="section-subtitle">
                        Plan your retirement with inflation modeling and lifestyle adjustments.
                    </p>
                </div>

                <div class="card">
                    <form id="retirement-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Current Age <span class="required">*</span></label>
                                <input type="number" id="current-age" class="form-input" min="18" max="65" placeholder="Your current age" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Retirement Age <span class="required">*</span></label>
                                <input type="number" id="retirement-age" class="form-input" min="50" max="75" placeholder="When you plan to retire" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Current Monthly Expenses (₹) <span class="required">*</span></label>
                                <input type="number" id="current-monthly-expenses" class="form-input" min="0" placeholder="Current monthly expenses" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Life Expectancy <span class="required">*</span></label>
                                <input type="number" id="life-expectancy" class="form-input" value="85" min="65" max="100" placeholder="Expected life expectancy" required>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin: 1.5rem 0;">
                            <button type="submit" class="btn btn-primary btn-large">
                                <i class="fas fa-calculator"></i> Calculate Retirement Needs
                            </button>
                        </div>
                    </form>

                    <div id="retirement-results" style="display: none;">
                        <!-- Retirement planning results will be displayed here -->
                    </div>
                </div>
            </section>

            <!-- Product Comparison -->
            <section id="comparison" class="section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-balance-scale"></i>
                        Product Comparison
                    </h2>
                    <p class="section-subtitle">
                        Compare financial products to find the perfect match for your profile.
                    </p>
                </div>

                <div class="card">
                    <div style="text-align: center; margin-bottom: 1.5rem;">
                        <button class="btn btn-primary btn-large" onclick="generateSmartComparison()">
                            <i class="fas fa-magic"></i> Smart Recommendations
                        </button>
                        <button class="btn btn-secondary" onclick="compareSpecificProducts()">
                            <i class="fas fa-search"></i> Compare Products
                        </button>
                    </div>
                    
                    <div id="product-comparison-results">
                        <!-- Product comparison will be displayed here -->
                    </div>
                </div>
            </section>

            <!-- Analytics Dashboard -->
            <section id="analytics" class="section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-chart-bar"></i>
                        Financial Analytics
                    </h2>
                    <p class="section-subtitle">
                        Comprehensive analytics with real-time insights and interactive visualizations.
                    </p>
                </div>

                <!-- Financial Health Widgets -->
                <div class="widgets-grid">
                    <div class="widget">
                        <div class="widget-icon"><i class="fas fa-heartbeat"></i></div>
                        <div class="widget-value" id="financial-score">0</div>
                        <div class="widget-label">Financial Health Score</div>
                    </div>
                    <div class="widget">
                        <div class="widget-icon"><i class="fas fa-wallet"></i></div>
                        <div class="widget-value" id="net-worth-widget">₹0</div>
                        <div class="widget-label">Net Worth</div>
                    </div>
                    <div class="widget">
                        <div class="widget-icon"><i class="fas fa-piggy-bank"></i></div>
                        <div class="widget-value" id="savings-rate">0%</div>
                        <div class="widget-label">Savings Rate</div>
                    </div>
                    <div class="widget">
                        <div class="widget-icon"><i class="fas fa-shield"></i></div>
                        <div class="widget-value" id="emergency-fund-months">0</div>
                        <div class="widget-label">Emergency Fund (Months)</div>
                    </div>
                </div>

                <div style="text-align: center; margin: 1.5rem 0;">
                    <button class="btn btn-primary" onclick="updateAllCharts()">
                        <i class="fas fa-sync-alt"></i> Refresh Analytics
                    </button>
                    <button class="btn btn-secondary" onclick="exportAnalytics()">
                        <i class="fas fa-download"></i> Export Analytics
                    </button>
                </div>
            </section>

            <!-- Professional Reports -->
            <section id="reports" class="section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-file-alt"></i>
                        Professional Reports
                    </h2>
                    <p class="section-subtitle">
                        Generate comprehensive financial reports with advanced analytics and insights.
                    </p>
                </div>

                <div class="form-grid">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-chart-bar"></i>
                                Financial Report
                            </h3>
                            <p class="card-subtitle">Complete analysis with detailed insights</p>
                        </div>
                        <div style="text-align: center;">
                            <button class="btn btn-primary" onclick="generateDetailedReport()">
                                <i class="fas fa-eye"></i> Preview Report
                            </button>
                            <button class="btn btn-secondary" onclick="downloadDetailedReport()">
                                <i class="fas fa-download"></i> Download PDF
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-lightbulb"></i>
                                Investment Strategy
                            </h3>
                            <p class="card-subtitle">Personalized investment recommendations</p>
                        </div>
                        <div style="text-align: center;">
                            <button class="btn btn-primary" onclick="generateInvestmentReport()">
                                <i class="fas fa-eye"></i> Preview Report
                            </button>
                            <button class="btn btn-secondary" onclick="downloadInvestmentReport()">
                                <i class="fas fa-download"></i> Download PDF
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Executive Summary -->
            <section id="summary" class="section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-clipboard-list"></i>
                        Executive Summary
                    </h2>
                    <p class="section-subtitle">
                        Key insights and strategic recommendations for optimal financial decisions.
                    </p>
                </div>

                <div class="card">
                    <div style="text-align: center; margin-bottom: 1.5rem;">
                        <button class="btn btn-primary btn-large" onclick="generateExecutiveSummary()">
                            <i class="fas fa-magic"></i> Generate Summary
                        </button>
                        <button class="btn btn-secondary" onclick="generateQuickInsights()">
                            <i class="fas fa-bolt"></i> Quick Insights
                        </button>
                    </div>
                    
                    <div id="executive-summary-content">
                        <!-- Executive summary will be displayed here -->
                    </div>
                </div>
            </section>

            <!-- Smart Alerts -->
            <section id="alerts" class="section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-bell"></i>
                        Smart Financial Alerts
                    </h2>
                    <p class="section-subtitle">
                        Intelligent alerts for important financial decisions and opportunities.
                    </p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-exclamation-triangle"></i>
                            Active Financial Alerts
                        </h3>
                    </div>
                    <div id="financial-alerts">
                        <!-- Alerts will be displayed here -->
                    </div>
                    
                    <div style="text-align: center; margin-top: 1.5rem;">
                        <button class="btn btn-primary" onclick="refreshAlerts()">
                            <i class="fas fa-sync-alt"></i> Refresh Alerts
                        </button>
                        <button class="btn btn-secondary" onclick="configureAlerts()">
                            <i class="fas fa-cog"></i> Configure Alerts
                        </button>
                    </div>
                </div>
            </section>

            <!-- Loan Calculator -->
            <section id="loan-calculator" class="section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-home"></i>
                        Loan Calculator
                    </h2>
                    <p class="section-subtitle">
                        Calculate EMI, interest, and total payments with prepayment analysis.
                    </p>
                </div>

                <div class="card">
                    <form id="loan-calculator-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Loan Amount (₹) <span class="required">*</span></label>
                                <input type="number" id="loan-principal" class="form-input" min="0" placeholder="Enter loan amount" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Interest Rate (% per annum) <span class="required">*</span></label>
                                <input type="number" id="loan-interest-rate" class="form-input" min="0" max="50" step="0.1" placeholder="Enter interest rate" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Loan Tenure (Years) <span class="required">*</span></label>
                                <input type="number" id="loan-tenure-years" class="form-input" min="1" max="50" placeholder="Enter tenure in years" required>
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin: 1.5rem 0;">
                            <button type="submit" class="btn btn-primary btn-large">
                                <i class="fas fa-calculator"></i> Calculate EMI
                            </button>
                        </div>
                    </form>

                    <div id="loan-calculator-results" style="display: none;">
                        <!-- Loan calculator results will be displayed here -->
                    </div>
                </div>
            </section>

            <!-- Budget Planner -->
            <section id="budget-planner" class="section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-chart-pie"></i>
                        Budget Planner
                    </h2>
                    <p class="section-subtitle">
                        Plan and track your budget with expense categorization and analysis.
                    </p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-plus"></i>
                            Budget Categories
                        </h3>
                    </div>
                    
                    <form id="budget-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Category</label>
                                <select id="budget-category" class="form-select">
                                    <option value="housing">🏠 Housing</option>
                                    <option value="food">🍽️ Food & Dining</option>
                                    <option value="transportation">🚗 Transportation</option>
                                    <option value="utilities">⚡ Utilities</option>
                                    <option value="healthcare">🏥 Healthcare</option>
                                    <option value="entertainment">🎬 Entertainment</option>
                                    <option value="savings">💰 Savings</option>
                                    <option value="other">📋 Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Budgeted Amount (₹)</label>
                                <input type="number" id="budget-amount" class="form-input" min="0" placeholder="Enter budget amount">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Actual Spent (₹)</label>
                                <input type="number" id="actual-spent" class="form-input" min="0" placeholder="Enter actual spending">
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin: 1rem 0;">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Add Budget Item
                            </button>
                        </div>
                    </form>

                    <div id="budget-list" class="items-list">
                        <!-- Budget items will be displayed here -->
                    </div>
                </div>
            </section>

            <!-- Investment Tracker -->
            <section id="investment-tracker" class="section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-trending-up"></i>
                        Investment Tracker
                    </h2>
                    <p class="section-subtitle">
                        Track investment performance with real-time data and portfolio insights.
                    </p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-plus"></i>
                            Add Investment
                        </h3>
                    </div>
                    
                    <form id="investment-form">
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Investment Name</label>
                                <input type="text" id="investment-name" class="form-input" placeholder="e.g., HDFC Top 100 Fund">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Investment Type</label>
                                <select id="investment-type" class="form-select">
                                    <option value="mutual-fund">📊 Mutual Fund</option>
                                    <option value="stock">📈 Stock</option>
                                    <option value="bond">🏦 Bond</option>
                                    <option value="fd">🏛️ Fixed Deposit</option>
                                    <option value="other">📋 Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Investment Amount (₹)</label>
                                <input type="number" id="investment-amount" class="form-input" min="0" placeholder="Enter investment amount">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Current Value (₹)</label>
                                <input type="number" id="current-value" class="form-input" min="0" placeholder="Enter current value">
                            </div>
                        </div>
                        
                        <div style="text-align: center; margin: 1rem 0;">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-plus"></i> Add Investment
                            </button>
                        </div>
                    </form>

                    <div id="investment-list" class="items-list">
                        <!-- Investment items will be displayed here -->
                    </div>
                </div>
            </section>

            <!-- Financial Calendar -->
            <section id="financial-calendar" class="section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-calendar-alt"></i>
                        Financial Calendar
                    </h2>
                    <p class="section-subtitle">
                        Track important financial dates, deadlines, and milestones.
                    </p>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-calendar-plus"></i>
                            Financial Events & Reminders
                        </h3>
                    </div>
                    
                    <div id="financial-calendar-content">
                        <!-- Calendar content will be displayed here -->
                    </div>
                    
                    <div style="text-align: center; margin: 1.5rem 0;">
                        <button class="btn btn-primary" onclick="loadFinancialCalendar()">
                            <i class="fas fa-calendar"></i> Load Calendar
                        </button>
                        <button class="btn btn-secondary" onclick="addFinancialEvent()">
                            <i class="fas fa-plus"></i> Add Event
                        </button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- COMPACT Chatbot -->
    <div class="chatbot-container">
        <button class="chatbot-toggle" onclick="toggleChatbot()">
            <i class="fas fa-robot"></i>
        </button>
        <div class="chatbot-window" id="chatbot-window">
            <div class="chatbot-header">
                <h4><i class="fas fa-robot"></i> Financial Assistant</h4>
                <button class="close-btn" onclick="toggleChatbot()">×</button>
            </div>
            <div class="chatbot-messages" id="chat-messages">
                <!-- Messages will be added here -->
            </div>
            <div class="chatbot-input">
                <input type="text" id="chat-input" placeholder="Ask me about finance..." onkeypress="handleChatKeyPress(event)">
                <button class="btn btn-primary btn-small" onclick="sendMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- COMPACT Modals -->
    <!-- Save Profile Modal -->
    <div id="save-profile-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-save"></i> Save Profile</h3>
                <button class="close-btn" onclick="hideProfileModal()">&times;</button>
            </div>
            <form id="save-profile-form">
                <div class="form-group">
                    <label class="form-label">Profile Name <span class="required">*</span></label>
                    <input type="text" id="profile-name-input" class="form-input" placeholder="Enter a memorable name for this profile" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea id="profile-description" class="form-input" rows="3" placeholder="Optional description or notes"></textarea>
                </div>
                <div style="text-align: center; margin-top: 1rem;">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Save Profile
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="hideProfileModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="export-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-download"></i> Export Your Data</h3>
                <button class="close-btn" onclick="hideExportModal()">&times;</button>
            </div>
            <div class="export-options">
                <div class="export-option" onclick="exportCurrentData('json')">
                    <div class="export-icon"><i class="fas fa-file-code"></i></div>
                    <div class="export-title">JSON Data File</div>
                    <div class="export-description">Complete backup for import and data portability</div>
                </div>
                <div class="export-option" onclick="exportCurrentData('pdf')">
                    <div class="export-icon"><i class="fas fa-file-pdf"></i></div>
                    <div class="export-title">PDF Summary</div>
                    <div class="export-description">Professional report format for sharing</div>
                </div>
                <div class="export-option" onclick="exportCurrentData('excel')">
                    <div class="export-icon"><i class="fas fa-file-excel"></i></div>
                    <div class="export-title">Excel Spreadsheet</div>
                    <div class="export-description">Structured data for analysis</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Import Modal -->
    <div id="import-data-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-upload"></i> Import Your Data</h3>
                <button class="close-btn" onclick="hideImportModal()">&times;</button>
            </div>
            <div class="file-upload" onclick="document.getElementById('import-file-input').click()">
                <div class="upload-icon"><i class="fas fa-cloud-upload-alt"></i></div>
                <div class="upload-text">Click to select or drag & drop your file here</div>
                <div class="upload-formats">Supported formats: JSON, CSV, Excel</div>
                <input type="file" id="import-file-input" accept=".json,.csv,.xlsx" style="display: none;" onchange="handleFileUpload(event)">
            </div>
            <div style="text-align: center; margin-top: 1rem;">
                <button class="btn btn-primary" onclick="importFromFile()">
                    <i class="fas fa-upload"></i> Import Data
                </button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-cog"></i> Application Settings</h3>
                <button class="close-btn" onclick="hideSettingsModal()">&times;</button>
            </div>
            <div class="form-group">
                <label class="form-label">Currency</label>
                <select id="currency-setting" class="form-select">
                    <option value="INR">₹ Indian Rupee (INR)</option>
                    <option value="USD">$ US Dollar (USD)</option>
                    <option value="EUR">€ Euro (EUR)</option>
                    <option value="GBP">£ British Pound (GBP)</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Default Inflation Rate (%)</label>
                <input type="number" id="default-inflation" class="form-input" value="6" min="0" max="20" step="0.1">
            </div>
            <div style="text-align: center; margin-top: 1rem;">
                <button class="btn btn-primary" onclick="saveSettings()">
                    <i class="fas fa-save"></i> Save Settings
                </button>
                <button class="btn btn-secondary" onclick="hideSettingsModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        // Global Variables
        let currentProfileId = null;
        let clientData = {
            profileInfo: {},
            basicInfo: {},
            financialStatus: {},
            assets: [],
            loans: [],
            goals: [],
            insuranceProfile: {},
            riskProfile: {},
            assessmentResults: {},
            budgetItems: [],
            investments: [],
            settings: { currency: 'INR', defaultInflation: 6, autoSaveInterval: 60 }
        };

        // Assessment Questions
        let assessmentQuestions = [
            {
                question: "How do you react when your investments lose 20% of their value in a market downturn?",
                options: [
                    { text: "I panic and sell everything immediately to prevent further losses", score: 1 },
                    { text: "I feel very uncomfortable but hold on, hoping for recovery", score: 2 },
                    { text: "I stay calm and continue with my original investment plan", score: 3 },
                    { text: "I see it as an opportunity and invest more money", score: 4 },
                    { text: "I'm completely comfortable and might even increase my risk exposure", score: 5 }
                ]
            },
            {
                question: "What's your primary investment objective?",
                options: [
                    { text: "Preserve my capital at all costs, even if returns are minimal", score: 1 },
                    { text: "Generate steady income with minimal risk to principal", score: 2 },
                    { text: "Achieve moderate growth while maintaining some stability", score: 3 },
                    { text: "Maximize long-term wealth creation with higher risk tolerance", score: 4 },
                    { text: "Pursue maximum returns regardless of volatility or risk", score: 5 }
                ]
            },
            {
                question: "How much of your investment portfolio would you be comfortable putting in high-risk, high-reward investments?",
                options: [
                    { text: "0% - I prefer guaranteed returns only", score: 1 },
                    { text: "10-20% - Just a small portion for potential upside", score: 2 },
                    { text: "30-50% - A balanced approach with moderate risk", score: 3 },
                    { text: "60-80% - Majority in growth investments", score: 4 },
                    { text: "90-100% - Almost everything in high-growth opportunities", score: 5 }
                ]
            },
            {
                question: "What percentage of your monthly income can you comfortably invest without affecting your lifestyle?",
                options: [
                    { text: "Less than 5% - I have very tight finances", score: 1 },
                    { text: "5-10% - I can invest a small amount regularly", score: 2 },
                    { text: "10-20% - I have decent savings capacity", score: 3 },
                    { text: "20-30% - I have good surplus for investments", score: 4 },
                    { text: "More than 30% - I have substantial excess funds", score: 5 }
                ]
            },
            {
                question: "How important is it for you to access your invested money quickly if needed?",
                options: [
                    { text: "Extremely important - I need immediate access anytime", score: 1 },
                    { text: "Very important - I might need access within a few months", score: 2 },
                    { text: "Somewhat important - I can wait 1-2 years if needed", score: 3 },
                    { text: "Not very important - I can wait 3-5 years", score: 4 },
                    { text: "Not important at all - I can lock money for 10+ years", score: 5 }
                ]
            },
            {
                question: "How would you describe your investment knowledge and experience?",
                options: [
                    { text: "Complete beginner - I know very little about investing", score: 1 },
                    { text: "Basic knowledge - I understand simple investment concepts", score: 2 },
                    { text: "Moderate knowledge - I've made some investments before", score: 3 },
                    { text: "Good knowledge - I actively manage my investments", score: 4 },
                    { text: "Expert level - I have extensive investment experience", score: 5 }
                ]
            },
            {
                question: "If you had ₹1 lakh to invest today, what would you do?",
                options: [
                    { text: "Put it all in a fixed deposit or savings account", score: 1 },
                    { text: "Invest mostly in bonds and a little in mutual funds", score: 2 },
                    { text: "Split equally between debt and equity mutual funds", score: 3 },
                    { text: "Invest mostly in equity funds with some debt allocation", score: 4 },
                    { text: "Put it all in high-growth stocks or aggressive funds", score: 5 }
                ]
            },
            {
                question: "How do you feel about the possibility of losing money in the short term for potentially higher long-term gains?",
                options: [
                    { text: "Completely unacceptable - I cannot afford any losses", score: 1 },
                    { text: "Very uncomfortable - I prefer predictable returns", score: 2 },
                    { text: "Somewhat acceptable - if the potential gains justify it", score: 3 },
                    { text: "Quite comfortable - long-term growth is my priority", score: 4 },
                    { text: "Perfectly fine - I understand volatility is part of growth", score: 5 }
                ]
            },
            {
                question: "What's your typical reaction to financial news about market crashes or economic uncertainty?",
                options: [
                    { text: "I get very anxious and want to move everything to safe investments", score: 1 },
                    { text: "I worry but try to stick to my original plan", score: 2 },
                    { text: "I pay attention but don't make hasty decisions", score: 3 },
                    { text: "I see it as temporary and focus on long-term trends", score: 4 },
                    { text: "I view it as a buying opportunity and consider investing more", score: 5 }
                ]
            },
            {
                question: "How do you prefer to make investment decisions?",
                options: [
                    { text: "I want guaranteed returns and complete safety", score: 1 },
                    { text: "I prefer professional advice and conservative strategies", score: 2 },
                    { text: "I like balanced approaches with professional guidance", score: 3 },
                    { text: "I enjoy researching and making informed decisions myself", score: 4 },
                    { text: "I'm comfortable with complex strategies and high-risk investments", score: 5 }
                ]
            }
        ];

        let currentQuestion = 0;
        let selectedAnswers = [];
        let isChatbotOpen = false;
        let autoSaveInterval = null;

        // Application Initialization
        document.addEventListener('DOMContentLoaded', function() {
            loadProfiles();
            initializeEventListeners();
            loadSettings();
            startAutoSave();
            loadAssessmentQuestion();
        });

        // Event Listeners
        function initializeEventListeners() {
            document.getElementById('basic-info-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveBasicInfo();
            });
            
            document.getElementById('financial-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveFinancialStatus();
            });
            
            document.getElementById('asset-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addAsset();
            });
            
            document.getElementById('loan-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addLoan();
            });
            
            document.getElementById('goal-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addGoal();
            });
            
            document.getElementById('insurance-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveInsuranceProfile();
            });
            
            document.getElementById('risk-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveRiskProfile();
            });
            
            document.getElementById('sip-form').addEventListener('submit', function(e) {
                e.preventDefault();
                calculateSIPReturns();
            });
            
            document.getElementById('tax-planning-form').addEventListener('submit', function(e) {
                e.preventDefault();
                generateTaxPlan();
            });
            
            document.getElementById('retirement-form').addEventListener('submit', function(e) {
                e.preventDefault();
                calculateRetirement();
            });
            
            document.getElementById('save-profile-form').addEventListener('submit', function(e) {
                e.preventDefault();
                saveProfile();
            });
            
            document.getElementById('loan-calculator-form').addEventListener('submit', function(e) {
                e.preventDefault();
                calculateLoanDetails();
            });
            
            document.getElementById('budget-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addBudgetItem();
            });
            
            document.getElementById('investment-form').addEventListener('submit', function(e) {
                e.preventDefault();
                addInvestment();
            });
        }

        // Profile Management
        function loadProfiles() {
            const profiles = JSON.parse(localStorage.getItem('financialPlannerProfiles') || '{}');
            const profilesContainer = document.getElementById('profiles-container');
            const welcomeMessage = document.getElementById('welcome-message');
            const savedProfiles = document.getElementById('saved-profiles');

            if (Object.keys(profiles).length === 0) {
                welcomeMessage.style.display = 'block';
                savedProfiles.style.display = 'none';
            } else {
                welcomeMessage.style.display = 'none';
                savedProfiles.style.display = 'block';
                
                profilesContainer.innerHTML = '';
                
                Object.entries(profiles).forEach(([id, profile]) => {
                    const profileCard = document.createElement('div');
                    profileCard.className = 'profile-item';
                    profileCard.innerHTML = `
                        <div class="profile-item-info">
                            <h4>${profile.profileInfo.name || 'Unnamed Profile'}</h4>
                            <p><i class="fas fa-calendar"></i> Created: ${new Date(profile.profileInfo.createdDate).toLocaleDateString()}</p>
                            <p><i class="fas fa-clock"></i> Last Modified: ${new Date(profile.profileInfo.lastModified).toLocaleDateString()}</p>
                            <p><i class="fas fa-info-circle"></i> ${profile.profileInfo.description || 'No description'}</p>
                        </div>
                        <div class="profile-item-actions">
                            <button class="btn btn-primary btn-small" onclick="loadProfile('${id}')">
                                <i class="fas fa-folder-open"></i> Open
                            </button>
                            <button class="btn btn-danger btn-small" onclick="deleteProfile('${id}')">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    `;
                    profilesContainer.appendChild(profileCard);
                });
            }
        }

        function createNewProfile() {
            currentProfileId = null;
            clientData = {
                profileInfo: {},
                basicInfo: {},
                financialStatus: {},
                assets: [],
                loans: [],
                goals: [],
                insuranceProfile: {},
                riskProfile: {},
                assessmentResults: {},
                budgetItems: [],
                investments: [],
                settings: { currency: 'INR', defaultInflation: 6, autoSaveInterval: 60 }
            };
            
            document.getElementById('profile-management').style.display = 'none';
            document.getElementById('cover-page').style.display = 'flex';
        }

        function loadProfile(profileId) {
            const profiles = JSON.parse(localStorage.getItem('financialPlannerProfiles') || '{}');
            const profile = profiles[profileId];
            
            if (profile) {
                currentProfileId = profileId;
                clientData = { ...clientData, ...profile };
                
                document.getElementById('profile-management').style.display = 'none';
                document.getElementById('main-app').style.display = 'block';
                
                loadClientData();
                updateHeaderProfileInfo();
                showAlert(`Profile "${profile.profileInfo.name}" loaded successfully!`, 'success');
            }
        }

        function deleteProfile(profileId) {
            if (confirm('Are you sure you want to delete this profile? This action cannot be undone.')) {
                const profiles = JSON.parse(localStorage.getItem('financialPlannerProfiles') || '{}');
                delete profiles[profileId];
                localStorage.setItem('financialPlannerProfiles', JSON.stringify(profiles));
                loadProfiles();
                showAlert('Profile deleted successfully!', 'success');
            }
        }

        function goBackToProfiles() {
            document.getElementById('profile-management').style.display = 'flex';
            document.getElementById('cover-page').style.display = 'none';
            document.getElementById('main-app').style.display = 'none';
            loadProfiles();
        }

        // Navigation Functions
        function startPersonalityAssessment() {
            document.getElementById('cover-page').style.display = 'none';
            document.getElementById('main-app').style.display = 'block';
            showMainSection('client-data');
            showSubSection('personality', document.querySelector('[onclick="showSubSection(\'personality\', this)"]'));
            loadAssessmentQuestion();
        }

        function startClientProfiling() {
            document.getElementById('cover-page').style.display = 'none';
            document.getElementById('main-app').style.display = 'block';
            showMainSection('client-data');
            showSubSection('profile', document.querySelector('[onclick="showSubSection(\'profile\', this)"]'));
        }

        function showMainSection(section) {
            // Hide all sub-nav groups
            document.querySelectorAll('[id$="-subnav"]').forEach(nav => nav.style.display = 'none');
            
            // Show selected sub-nav
            document.getElementById(section + '-subnav').style.display = 'flex';
            
            // Update main navigation
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Show first sub-section of the selected main section
            const firstSubBtn = document.querySelector(`#${section}-subnav .sub-nav-btn`);
            if (firstSubBtn) {
                firstSubBtn.click();
            }
        }

        function showSubSection(section, element) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
            
            // Show selected section
            document.getElementById(section).classList.add('active');

            // Update sub-navigation
            document.querySelectorAll('.sub-nav-btn').forEach(btn => btn.classList.remove('active'));
            if (element) element.classList.add('active');

            // Auto-save when switching sections
            if (currentProfileId) {
                autoSave();
            }
        }

        // Auto-save System
        function startAutoSave() {
            const interval = clientData.settings?.autoSaveInterval || 60;
            if (interval > 0) {
                autoSaveInterval = setInterval(() => {
                    if (currentProfileId) {
                        autoSave();
                    }
                }, interval * 1000);
            }
        }

        function autoSave() {
            if (!currentProfileId) return;
            
            clientData.profileInfo.lastModified = new Date().toISOString();
            const profiles = JSON.parse(localStorage.getItem('financialPlannerProfiles') || '{}');
            profiles[currentProfileId] = clientData;
            localStorage.setItem('financialPlannerProfiles', JSON.stringify(profiles));
            
            // Update profile status indicator
            const statusIndicator = document.getElementById('current-profile-status');
            if (statusIndicator) {
                statusIndicator.style.color = '#00ff88';
                setTimeout(() => {
                    statusIndicator.style.color = '#aaaaaa';
                }, 1000);
            }
        }

        // Assessment Functions
        function loadAssessmentQuestion() {
            if (currentQuestion >= assessmentQuestions.length) {
                completeAssessment();
                return;
            }

            const question = assessmentQuestions[currentQuestion];
            document.getElementById('question-number').textContent = `Question ${currentQuestion + 1} of ${assessmentQuestions.length}`;
            document.getElementById('question-text').textContent = question.question;

            const optionsContainer = document.getElementById('question-options');
            optionsContainer.innerHTML = '';

            question.options.forEach((option, index) => {
                const optionBtn = document.createElement('button');
                optionBtn.className = 'option-btn';
                optionBtn.textContent = option.text;
                optionBtn.onclick = () => selectOption(index);
                optionsContainer.appendChild(optionBtn);
            });

            // Update progress bar
            const progress = ((currentQuestion) / assessmentQuestions.length) * 100;
            document.getElementById('assessment-progress').style.width = progress + '%';

            // Show/hide navigation buttons
            document.getElementById('prev-btn').style.display = currentQuestion > 0 ? 'inline-flex' : 'none';
            document.getElementById('next-btn').style.display = 'none';
        }

        function selectOption(optionIndex) {
            // Remove previous selection
            document.querySelectorAll('.option-btn').forEach(btn => btn.classList.remove('selected'));
            
            // Add selection to clicked option
            event.target.classList.add('selected');
            
            // Store answer
            selectedAnswers[currentQuestion] = {
                questionIndex: currentQuestion,
                optionIndex: optionIndex,
                score: assessmentQuestions[currentQuestion].options[optionIndex].score
            };

            // Show next button
            document.getElementById('next-btn').style.display = 'inline-flex';
        }

        function nextQuestion() {
            if (selectedAnswers[currentQuestion]) {
                currentQuestion++;
                loadAssessmentQuestion();
            }
        }

        function previousQuestion() {
            if (currentQuestion > 0) {
                currentQuestion--;
                loadAssessmentQuestion();
                
                // Restore previous selection
                if (selectedAnswers[currentQuestion]) {
                    const optionBtns = document.querySelectorAll('.option-btn');
                    optionBtns[selectedAnswers[currentQuestion].optionIndex].classList.add('selected');
                    document.getElementById('next-btn').style.display = 'inline-flex';
                }
            }
        }

        function completeAssessment() {
            // Calculate total score
            const totalScore = selectedAnswers.reduce((sum, answer) => sum + answer.score, 0);
            const averageScore = totalScore / assessmentQuestions.length;

            let personalityType, description, insights;

            if (averageScore <= 1.5) {
                personalityType = "Ultra Conservative Investor";
                description = "You prioritize capital preservation above all else. Your investment strategy should focus on guaranteed returns through fixed deposits, government bonds, and conservative debt funds.";
                insights = [
                    "🛡️ Focus on capital protection strategies",
                    "🏦 Consider government securities and high-grade bonds",
                    "💰 Build a substantial emergency fund",
                    "📈 Start with small equity exposure (5-10%) to build confidence"
                ];
            } else if (averageScore <= 2.5) {
                personalityType = "Conservative Investor";
                description = "You prefer stability and steady returns. A balanced approach with emphasis on debt instruments and gradual equity exposure suits your profile.";
                insights = [
                    "⚖️ Maintain 70% debt, 30% equity allocation",
                    "🏛️ Focus on large-cap mutual funds for equity exposure",
                    "💼 Consider hybrid funds for balanced growth",
                    "📊 Regular portfolio reviews to build confidence"
                ];
            } else if (averageScore <= 3.5) {
                personalityType = "Moderate Investor";
                description = "You seek balanced growth with moderate risk. A diversified portfolio with equal emphasis on growth and stability aligns with your investment philosophy.";
                insights = [
                    "🎯 Balanced 50-60% equity, 40-50% debt allocation",
                    "🌍 Include international diversification",
                    "📈 Mix of large-cap and mid-cap funds",
                    "⏰ Perfect for long-term SIP strategies"
                ];
            } else if (averageScore <= 4.5) {
                personalityType = "Growth Investor";
                description = "You're comfortable with higher risk for better returns. Equity-focused investments with some debt allocation for stability suits your profile.";
                insights = [
                    "🚀 Aggressive 70-80% equity allocation",
                    "💡 Include mid-cap and small-cap exposure",
                    "🌟 Consider ELSS funds for tax benefits",
                    "📊 Regular rebalancing for optimal returns"
                ];
            } else {
                personalityType = "Aggressive Investor";
                description = "You're willing to take high risks for maximum returns. Focus on high-growth equity investments, emerging markets, and alternative investments.";
                insights = [
                    "🔥 Maximum equity exposure (80-90%)",
                    "🌐 Include international and emerging market funds",
                    "💎 Consider alternative investments",
                    "⚡ High-risk, high-reward strategies"
                ];
            }

            // Store results
            clientData.assessmentResults = {
                personalityType: personalityType,
                description: description,
                score: averageScore,
                insights: insights,
                completedDate: new Date().toISOString()
            };

            // Display results
            document.getElementById('assessment-questions').style.display = 'none';
            document.getElementById('assessment-results').style.display = 'block';
            document.getElementById('personality-type').textContent = personalityType;
            document.getElementById('personality-description').textContent = description;
            
            // Display insights
            const insightsContent = document.getElementById('insights-content');
            insightsContent.innerHTML = `
                <ul style="list-style: none; padding: 0; margin: 1rem 0;">
                    ${insights.map(insight => `<li style="padding: 0.5rem 0; border-bottom: 1px solid var(--border-gray);">${insight}</li>`).join('')}
                </ul>
            `;

            // Update progress bar to 100%
            document.getElementById('assessment-progress').style.width = '100%';
            
            // Auto-save results
            if (currentProfileId) {
                autoSave();
            }
        }

        function proceedToClientProfiling() {
            showSubSection('profile', document.querySelector('[onclick="showSubSection(\'profile\', this)"]'));
        }

        // Basic Info Functions
        function saveBasicInfo() {
            clientData.basicInfo = {
                name: document.getElementById('client-name').value,
                age: parseInt(document.getElementById('client-age').value),
                occupation: document.getElementById('client-occupation').value,
                maritalStatus: document.getElementById('marital-status').value,
                dependents: parseInt(document.getElementById('dependents').value),
                city: document.getElementById('client-city').value,
                lastUpdated: new Date().toISOString()
            };

            displayBasicInfo();
            autoSave();
            showAlert('Profile information saved successfully!', 'success');
        }

        function displayBasicInfo() {
            const info = clientData.basicInfo;
            document.getElementById('basic-info-form').style.display = 'none';
            document.getElementById('saved-basic-info').style.display = 'block';
            
            document.getElementById('basic-info-display').innerHTML = `
                <div class="data-display">
                    <div class="data-row">
                        <span class="data-label">👤 Name:</span>
                        <span class="data-value">${info.name}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">🎂 Age:</span>
                        <span class="data-value">${info.age} years</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">💼 Occupation:</span>
                        <span class="data-value">${info.occupation}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">💑 Marital Status:</span>
                        <span class="data-value">${info.maritalStatus}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">👨‍👩‍👧‍👦 Dependents:</span>
                        <span class="data-value">${info.dependents}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">🏙️ City:</span>
                        <span class="data-value">${info.city}</span>
                    </div>
                </div>
            `;
        }

        function editBasicInfo() {
            document.getElementById('basic-info-form').style.display = 'block';
            document.getElementById('saved-basic-info').style.display = 'none';
        }

        // Financial Status Functions
        function saveFinancialStatus() {
            const monthlyIncome = parseFloat(document.getElementById('monthly-income').value);
            const monthlyExpenses = parseFloat(document.getElementById('monthly-expenses').value);
            const currentSavings = parseFloat(document.getElementById('current-savings').value);
            const annualIncome = parseFloat(document.getElementById('annual-income').value);

            clientData.financialStatus = {
                monthlyIncome,
                monthlyExpenses,
                currentSavings,
                annualIncome,
                monthlySavings: monthlyIncome - monthlyExpenses,
                savingsRate: monthlyIncome > 0 ? ((monthlyIncome - monthlyExpenses) / monthlyIncome * 100) : 0,
                emergencyFundNeeded: monthlyExpenses * 6,
                lastUpdated: new Date().toISOString()
            };

            displayFinancialInfo();
            generateFinancialInsights();
            autoSave();
            showAlert('Financial status analyzed successfully!', 'success');
        }

        function displayFinancialInfo() {
            const info = clientData.financialStatus;
            document.getElementById('financial-form').style.display = 'none';
            document.getElementById('saved-financial-info').style.display = 'block';
            
            document.getElementById('financial-info-display').innerHTML = `
                <div class="data-display">
                    <div class="data-row">
                        <span class="data-label">💰 Monthly Income:</span>
                        <span class="data-value">₹${formatCurrency(info.monthlyIncome)}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">💸 Monthly Expenses:</span>
                        <span class="data-value">₹${formatCurrency(info.monthlyExpenses)}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">💵 Monthly Savings:</span>
                        <span class="data-value">₹${formatCurrency(info.monthlySavings)}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">📊 Savings Rate:</span>
                        <span class="data-value">${info.savingsRate.toFixed(1)}%</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">🏦 Current Savings:</span>
                        <span class="data-value">₹${formatCurrency(info.currentSavings)}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">📈 Annual Income:</span>
                        <span class="data-value">₹${formatCurrency(info.annualIncome)}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">🚨 Emergency Fund Needed:</span>
                        <span class="data-value">₹${formatCurrency(info.emergencyFundNeeded)}</span>
                    </div>
                </div>
            `;
        }

        function generateFinancialInsights() {
            const info = clientData.financialStatus;
            const insights = [];
            
            if (info.savingsRate < 10) {
                insights.push("⚠️ Your savings rate is below 10%. Consider reducing expenses or increasing income.");
            } else if (info.savingsRate >= 20) {
                insights.push("✅ Excellent savings rate! You're on track for strong financial growth.");
            }
            
            if (info.currentSavings < info.emergencyFundNeeded) {
                const shortfall = info.emergencyFundNeeded - info.currentSavings;
                insights.push(`🚨 Emergency fund shortfall: ₹${formatCurrency(shortfall)}. Build this as priority.`);
            }
            
            if (info.monthlySavings > 0) {
                const monthsToEmergencyFund = Math.ceil((info.emergencyFundNeeded - info.currentSavings) / info.monthlySavings);
                if (monthsToEmergencyFund > 0) {
                    insights.push(`⏰ At current savings rate, you can build emergency fund in ${monthsToEmergencyFund} months.`);
                }
            }
            
            document.getElementById('financial-insights-content').innerHTML = `
                <ul style="list-style: none; padding: 0; margin: 1rem 0;">
                    ${insights.map(insight => `<li style="padding: 0.75rem 0; border-bottom: 1px solid var(--border-gray);">${insight}</li>`).join('')}
                </ul>
            `;
        }

        function editFinancialInfo() {
            document.getElementById('financial-form').style.display = 'block';
            document.getElementById('saved-financial-info').style.display = 'none';
        }

        // Asset and Loan Management
        function addAsset() {
            const assetType = document.getElementById('asset-type').value;
            const assetName = document.getElementById('asset-name').value;
            const assetValue = parseFloat(document.getElementById('asset-value').value);

            if (!assetType || !assetName || !assetValue) {
                showAlert('Please fill all required fields', 'danger');
                return;
            }

            const asset = {
                id: Date.now().toString(),
                type: assetType,
                name: assetName,
                value: assetValue,
                dateAdded: new Date().toISOString()
            };

            clientData.assets.push(asset);
            updateAssetsList();
            updateNetWorth();
            autoSave();

            // Clear form
            document.getElementById('asset-form').reset();
            showAlert('Asset added successfully!', 'success');
        }

        function addLoan() {
            const loanType = document.getElementById('loan-type').value;
            const loanAmount = parseFloat(document.getElementById('loan-amount').value);
            const loanRate = parseFloat(document.getElementById('loan-rate').value);

            if (!loanType || !loanAmount || !loanRate) {
                showAlert('Please fill all required fields', 'danger');
                return;
            }

            const loan = {
                id: Date.now().toString(),
                type: loanType,
                amount: loanAmount,
                rate: loanRate,
                dateAdded: new Date().toISOString()
            };

            clientData.loans.push(loan);
            updateLoansList();
            updateNetWorth();
            autoSave();

            // Clear form
            document.getElementById('loan-form').reset();
            showAlert('Liability added successfully!', 'success');
        }

        function updateAssetsList() {
            const assetsList = document.getElementById('assets-list');
            assetsList.innerHTML = '';

            clientData.assets.forEach(asset => {
                const assetItem = document.createElement('div');
                assetItem.className = 'list-item';
                assetItem.innerHTML = `
                    <div class="item-info">
                        <div class="item-title">${asset.name}</div>
                        <div class="item-details">${asset.type} • ₹${formatCurrency(asset.value)}</div>
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-small btn-danger" onclick="removeAsset('${asset.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                assetsList.appendChild(assetItem);
            });
        }

        function updateLoansList() {
            const loansList = document.getElementById('loans-list');
            loansList.innerHTML = '';

            clientData.loans.forEach(loan => {
                const loanItem = document.createElement('div');
                loanItem.className = 'list-item';
                loanItem.innerHTML = `
                    <div class="item-info">
                        <div class="item-title">${loan.type}</div>
                        <div class="item-details">₹${formatCurrency(loan.amount)} @ ${loan.rate}%</div>
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-small btn-danger" onclick="removeLoan('${loan.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                loansList.appendChild(loanItem);
            });
        }

        function removeAsset(assetId) {
            clientData.assets = clientData.assets.filter(asset => asset.id !== assetId);
            updateAssetsList();
            updateNetWorth();
            autoSave();
            showAlert('Asset removed successfully!', 'success');
        }

        function removeLoan(loanId) {
            clientData.loans = clientData.loans.filter(loan => loan.id !== loanId);
            updateLoansList();
            updateNetWorth();
            autoSave();
            showAlert('Liability removed successfully!', 'success');
        }

        function updateNetWorth() {
            const totalAssets = clientData.assets.reduce((sum, asset) => sum + asset.value, 0);
            const totalLiabilities = clientData.loans.reduce((sum, loan) => sum + loan.amount, 0);
            const netWorth = totalAssets - totalLiabilities;

            document.getElementById('total-assets').textContent = `₹${formatCurrency(totalAssets)}`;
            document.getElementById('total-liabilities').textContent = `₹${formatCurrency(totalLiabilities)}`;
            document.getElementById('net-worth').textContent = `₹${formatCurrency(netWorth)}`;
            document.getElementById('net-worth-widget').textContent = `₹${formatCurrency(netWorth)}`;
        }

        // Goals Management
        function addGoal() {
            const goalName = document.getElementById('goal-name').value;
            const goalAmount = parseFloat(document.getElementById('goal-amount').value);
            const goalTimeframe = parseInt(document.getElementById('goal-timeframe').value);

            if (!goalName || !goalAmount || !goalTimeframe) {
                showAlert('Please fill all required fields', 'danger');
                return;
            }

            const goal = {
                id: Date.now().toString(),
                name: goalName,
                amount: goalAmount,
                timeframe: goalTimeframe,
                dateAdded: new Date().toISOString()
            };

            clientData.goals.push(goal);
            updateGoalsList();
            autoSave();

            // Clear form
            document.getElementById('goal-form').reset();
            showAlert('Goal added successfully!', 'success');
        }

        function updateGoalsList() {
            const goalsList = document.getElementById('goals-list');
            goalsList.innerHTML = '';

            clientData.goals.forEach(goal => {
                const goalItem = document.createElement('div');
                goalItem.className = 'list-item';
                goalItem.innerHTML = `
                    <div class="item-info">
                        <div class="item-title">${goal.name}</div>
                        <div class="item-details">₹${formatCurrency(goal.amount)} in ${goal.timeframe} years</div>
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-small btn-danger" onclick="removeGoal('${goal.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                goalsList.appendChild(goalItem);
            });
        }

        function removeGoal(goalId) {
            clientData.goals = clientData.goals.filter(goal => goal.id !== goalId);
            updateGoalsList();
            autoSave();
            showAlert('Goal removed successfully!', 'success');
        }

        // Insurance Profile
        function saveInsuranceProfile() {
            const currentLifeInsurance = parseFloat(document.getElementById('current-life-insurance').value) || 0;
            const currentHealthInsurance = parseFloat(document.getElementById('current-health-insurance').value) || 0;
            const familyExpenses = parseFloat(document.getElementById('family-expenses').value);

            if (!familyExpenses) {
                showAlert('Please enter family annual expenses', 'danger');
                return;
            }

            // Calculate insurance needs
            const recommendedLifeInsurance = familyExpenses * 15; // 15x annual expenses
            const recommendedHealthInsurance = Math.max(500000, familyExpenses * 0.5); // 50% of annual expenses or 5L minimum

            clientData.insuranceProfile = {
                currentLifeInsurance,
                currentHealthInsurance,
                familyExpenses,
                recommendedLifeInsurance,
                recommendedHealthInsurance,
                lastUpdated: new Date().toISOString()
            };

            displayInsuranceInfo();
            autoSave();
            showAlert('Insurance profile saved successfully!', 'success');
        }

        function displayInsuranceInfo() {
            const info = clientData.insuranceProfile;
            document.getElementById('insurance-form').style.display = 'none';
            document.getElementById('saved-insurance-info').style.display = 'block';
            
            document.getElementById('insurance-info-display').innerHTML = `
                <div class="data-display">
                    <div class="data-row">
                        <span class="data-label">🛡️ Current Life Insurance:</span>
                        <span class="data-value">₹${formatCurrency(info.currentLifeInsurance)}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">🏥 Current Health Insurance:</span>
                        <span class="data-value">₹${formatCurrency(info.currentHealthInsurance)}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">📊 Recommended Life Insurance:</span>
                        <span class="data-value">₹${formatCurrency(info.recommendedLifeInsurance)}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">🏥 Recommended Health Insurance:</span>
                        <span class="data-value">₹${formatCurrency(info.recommendedHealthInsurance)}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">⚠️ Life Insurance Gap:</span>
                        <span class="data-value">₹${formatCurrency(Math.max(0, info.recommendedLifeInsurance - info.currentLifeInsurance))}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">⚠️ Health Insurance Gap:</span>
                        <span class="data-value">₹${formatCurrency(Math.max(0, info.recommendedHealthInsurance - info.currentHealthInsurance))}</span>
                    </div>
                </div>
            `;
        }

        // Risk Profile
        function saveRiskProfile() {
            const experience = document.getElementById('investment-experience').value;
            const tolerance = document.getElementById('risk-tolerance').value;
            const horizon = document.getElementById('investment-horizon').value;
            const monthlyInvestment = parseFloat(document.getElementById('monthly-investment').value);

            if (!experience || !tolerance || !horizon || !monthlyInvestment) {
                showAlert('Please fill all required fields', 'danger');
                return;
            }

            clientData.riskProfile = {
                experience,
                tolerance,
                horizon,
                monthlyInvestment,
                lastUpdated: new Date().toISOString()
            };

            displayRiskInfo();
            autoSave();
            showAlert('Risk profile analyzed successfully!', 'success');
        }

        function displayRiskInfo() {
            const info = clientData.riskProfile;
            document.getElementById('risk-form').style.display = 'none';
            document.getElementById('saved-risk-info').style.display = 'block';
            
            document.getElementById('risk-info-display').innerHTML = `
                <div class="data-display">
                    <div class="data-row">
                        <span class="data-label">📚 Experience Level:</span>
                        <span class="data-value">${info.experience}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">⚖️ Risk Tolerance:</span>
                        <span class="data-value">${info.tolerance}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">⏰ Investment Horizon:</span>
                        <span class="data-value">${info.horizon}</span>
                    </div>
                    <div class="data-row">
                        <span class="data-label">💰 Monthly Investment:</span>
                        <span class="data-value">₹${formatCurrency(info.monthlyInvestment)}</span>
                    </div>
                </div>
            `;
        }

        // SIP Calculator
        function calculateSIPReturns() {
            const sipAmount = parseFloat(document.getElementById('sip-amount').value);
            const sipReturn = parseFloat(document.getElementById('sip-return').value);
            const sipPeriod = parseFloat(document.getElementById('sip-period').value);
            const stepUp = parseFloat(document.getElementById('sip-stepup').value) || 0;

            if (!sipAmount || !sipReturn || !sipPeriod) {
                showAlert('Please fill all required fields', 'danger');
                return;
            }

            // Calculate SIP returns with step-up
            let totalInvestment = 0;
            let futureValue = 0;
            let currentSIP = sipAmount;
            const monthlyRate = sipReturn / 100 / 12;

            for (let year = 1; year <= sipPeriod; year++) {
                for (let month = 1; month <= 12; month++) {
                    totalInvestment += currentSIP;
                    const remainingMonths = (sipPeriod - year) * 12 + (12 - month);
                    futureValue += currentSIP * Math.pow(1 + monthlyRate, remainingMonths);
                }
                // Apply step-up at the end of each year
                currentSIP = currentSIP * (1 + stepUp / 100);
            }

            const totalReturns = futureValue - totalInvestment;

            document.getElementById('sip-results').style.display = 'block';
            document.getElementById('sip-results').innerHTML = `
                <div class="card">
                    <div class="card-header">
                        <h4 class="card-title"><i class="fas fa-calculator"></i> SIP Calculation Results</h4>
                    </div>
                    <div class="data-display">
                        <div class="data-row">
                            <span class="data-label">💰 Total Investment:</span>
                            <span class="data-value">₹${formatCurrency(totalInvestment)}</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">📈 Future Value:</span>
                            <span class="data-value">₹${formatCurrency(futureValue)}</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">🎯 Total Returns:</span>
                            <span class="data-value">₹${formatCurrency(totalReturns)}</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">📊 Return Multiple:</span>
                            <span class="data-value">${(futureValue / totalInvestment).toFixed(2)}x</span>
                        </div>
                    </div>
                </div>
            `;

            showAlert('SIP returns calculated successfully!', 'success');
        }

        // Tax Planning
        function generateTaxPlan() {
            const taxableIncome = parseFloat(document.getElementById('taxable-income').value);
            const current80C = parseFloat(document.getElementById('current-80c').value) || 0;
            const healthPremium = parseFloat(document.getElementById('health-premium').value) || 0;

            if (!taxableIncome) {
                showAlert('Please enter your annual income', 'danger');
                return;
            }

            // Calculate tax for old regime
            let taxableAfterDeductions = taxableIncome - Math.min(current80C, 150000) - Math.min(healthPremium, 25000);
            let tax = 0;

            if (taxableAfterDeductions > 250000) {
                if (taxableAfterDeductions <= 500000) {
                    tax += (taxableAfterDeductions - 250000) * 0.05;
                } else if (taxableAfterDeductions <= 1000000) {
                    tax += 250000 * 0.05 + (taxableAfterDeductions - 500000) * 0.20;
                } else {
                    tax += 250000 * 0.05 + 500000 * 0.20 + (taxableAfterDeductions - 1000000) * 0.30;
                }
            }

            // Add cess
            tax = tax * 1.04;

            const maxSavings = 150000 - current80C;
            const potentialSavings = Math.min(maxSavings, taxableIncome * 0.3) * 0.3; // Assuming 30% tax bracket

            document.getElementById('tax-plan-results').style.display = 'block';
            document.getElementById('tax-plan-results').innerHTML = `
                <div class="card">
                    <div class="card-header">
                        <h4 class="card-title"><i class="fas fa-receipt"></i> Tax Planning Results</h4>
                    </div>
                    <div class="data-display">
                        <div class="data-row">
                            <span class="data-label">💰 Gross Income:</span>
                            <span class="data-value">₹${formatCurrency(taxableIncome)}</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">📉 Current Tax Liability:</span>
                            <span class="data-value">₹${formatCurrency(tax)}</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">💡 Additional 80C Investment Scope:</span>
                            <span class="data-value">₹${formatCurrency(maxSavings)}</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">💰 Potential Tax Savings:</span>
                            <span class="data-value">₹${formatCurrency(potentialSavings)}</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">📊 Effective Tax Rate:</span>
                            <span class="data-value">${(tax / taxableIncome * 100).toFixed(2)}%</span>
                        </div>
                    </div>
                </div>
            `;

            showAlert('Tax plan generated successfully!', 'success');
        }

        // Retirement Planning
        function calculateRetirement() {
            const currentAge = parseInt(document.getElementById('current-age').value);
            const retirementAge = parseInt(document.getElementById('retirement-age').value);
            const monthlyExpenses = parseFloat(document.getElementById('current-monthly-expenses').value);
            const lifeExpectancy = parseInt(document.getElementById('life-expectancy').value);

            if (!currentAge || !retirementAge || !monthlyExpenses || !lifeExpectancy) {
                showAlert('Please fill all required fields', 'danger');
                return;
            }

            const yearsToRetirement = retirementAge - currentAge;
            const yearsInRetirement = lifeExpectancy - retirementAge;
            const inflationRate = 0.06; // 6% inflation
            const returnRate = 0.10; // 10% return

            // Calculate future expenses at retirement
            const futureMonthlyExpenses = monthlyExpenses * Math.pow(1 + inflationRate, yearsToRetirement);
            const annualExpensesAtRetirement = futureMonthlyExpenses * 12;

            // Calculate retirement corpus needed (25x annual expenses)
            const retirementCorpus = annualExpensesAtRetirement * 25;

            // Calculate monthly SIP needed
            const monthsToRetirement = yearsToRetirement * 12;
            const monthlyRate = returnRate / 12;
            const monthlySIPNeeded = retirementCorpus * monthlyRate / (Math.pow(1 + monthlyRate, monthsToRetirement) - 1);

            document.getElementById('retirement-results').style.display = 'block';
            document.getElementById('retirement-results').innerHTML = `
                <div class="card">
                    <div class="card-header">
                        <h4 class="card-title"><i class="fas fa-umbrella"></i> Retirement Planning Results</h4>
                    </div>
                    <div class="data-display">
                        <div class="data-row">
                            <span class="data-label">⏰ Years to Retirement:</span>
                            <span class="data-value">${yearsToRetirement} years</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">💰 Current Monthly Expenses:</span>
                            <span class="data-value">₹${formatCurrency(monthlyExpenses)}</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">📈 Future Monthly Expenses:</span>
                            <span class="data-value">₹${formatCurrency(futureMonthlyExpenses)}</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">🎯 Retirement Corpus Needed:</span>
                            <span class="data-value">₹${formatCurrency(retirementCorpus)}</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">💵 Monthly SIP Required:</span>
                            <span class="data-value">₹${formatCurrency(monthlySIPNeeded)}</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">📊 Total Investment Needed:</span>
                            <span class="data-value">₹${formatCurrency(monthlySIPNeeded * monthsToRetirement)}</span>
                        </div>
                    </div>
                </div>
            `;

            showAlert('Retirement plan calculated successfully!', 'success');
        }

        // Loan Calculator
        function calculateLoanDetails() {
            const principal = parseFloat(document.getElementById('loan-principal').value);
            const rate = parseFloat(document.getElementById('loan-interest-rate').value);
            const tenure = parseFloat(document.getElementById('loan-tenure-years').value);

            if (!principal || !rate || !tenure) {
                showAlert('Please fill all required fields', 'danger');
                return;
            }

            const monthlyRate = rate / 100 / 12;
            const totalMonths = tenure * 12;

            // Calculate EMI
            const emi = principal * monthlyRate * Math.pow(1 + monthlyRate, totalMonths) / (Math.pow(1 + monthlyRate, totalMonths) - 1);
            const totalPayment = emi * totalMonths;
            const totalInterest = totalPayment - principal;

            document.getElementById('loan-calculator-results').style.display = 'block';
            document.getElementById('loan-calculator-results').innerHTML = `
                <div class="card">
                    <div class="card-header">
                        <h4 class="card-title"><i class="fas fa-calculator"></i> Loan Calculation Results</h4>
                    </div>
                    <div class="data-display">
                        <div class="data-row">
                            <span class="data-label">💰 Loan Amount:</span>
                            <span class="data-value">₹${formatCurrency(principal)}</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">💵 Monthly EMI:</span>
                            <span class="data-value">₹${formatCurrency(emi)}</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">📊 Total Payment:</span>
                            <span class="data-value">₹${formatCurrency(totalPayment)}</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">📈 Total Interest:</span>
                            <span class="data-value">₹${formatCurrency(totalInterest)}</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">⏰ Loan Tenure:</span>
                            <span class="data-value">${tenure} years (${totalMonths} months)</span>
                        </div>
                    </div>
                </div>
            `;

            showAlert('Loan details calculated successfully!', 'success');
        }

        // Budget Management
        function addBudgetItem() {
            const category = document.getElementById('budget-category').value;
            const budgetAmount = parseFloat(document.getElementById('budget-amount').value) || 0;
            const actualSpent = parseFloat(document.getElementById('actual-spent').value) || 0;

            const budgetItem = {
                id: Date.now().toString(),
                category: category,
                budgetAmount: budgetAmount,
                actualSpent: actualSpent,
                dateAdded: new Date().toISOString()
            };

            clientData.budgetItems.push(budgetItem);
            updateBudgetList();
            autoSave();

            // Clear form
            document.getElementById('budget-form').reset();
            showAlert('Budget item added successfully!', 'success');
        }

        function updateBudgetList() {
            const budgetList = document.getElementById('budget-list');
            budgetList.innerHTML = '';

            clientData.budgetItems.forEach(item => {
                const variance = item.actualSpent - item.budgetAmount;
                const varianceClass = variance > 0 ? 'error-red' : 'success-green';
                
                const budgetItem = document.createElement('div');
                budgetItem.className = 'list-item';
                budgetItem.innerHTML = `
                    <div class="item-info">
                        <div class="item-title">${item.category}</div>
                        <div class="item-details">Budget: ₹${formatCurrency(item.budgetAmount)} | Spent: ₹${formatCurrency(item.actualSpent)} | <span style="color: var(--${varianceClass})">${variance >= 0 ? 'Over' : 'Under'}: ₹${formatCurrency(Math.abs(variance))}</span></div>
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-small btn-danger" onclick="removeBudgetItem('${item.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                budgetList.appendChild(budgetItem);
            });
        }

        function removeBudgetItem(itemId) {
            clientData.budgetItems = clientData.budgetItems.filter(item => item.id !== itemId);
            updateBudgetList();
            autoSave();
            showAlert('Budget item removed successfully!', 'success');
        }

        // Investment Tracking
        function addInvestment() {
            const investmentName = document.getElementById('investment-name').value;
            const investmentType = document.getElementById('investment-type').value;
            const investmentAmount = parseFloat(document.getElementById('investment-amount').value) || 0;
            const currentValue = parseFloat(document.getElementById('current-value').value) || 0;

            if (!investmentName) {
                showAlert('Please enter investment name', 'danger');
                return;
            }

            const investment = {
                id: Date.now().toString(),
                name: investmentName,
                type: investmentType,
                amount: investmentAmount,
                currentValue: currentValue,
                dateAdded: new Date().toISOString()
            };

            clientData.investments.push(investment);
            updateInvestmentList();
            autoSave();

            // Clear form
            document.getElementById('investment-form').reset();
            showAlert('Investment added successfully!', 'success');
        }

        function updateInvestmentList() {
            const investmentList = document.getElementById('investment-list');
            investmentList.innerHTML = '';

            clientData.investments.forEach(investment => {
                const returns = investment.currentValue - investment.amount;
                const returnPercent = investment.amount > 0 ? (returns / investment.amount * 100) : 0;
                const returnClass = returns >= 0 ? 'success-green' : 'error-red';
                
                const investmentItem = document.createElement('div');
                investmentItem.className = 'list-item';
                investmentItem.innerHTML = `
                    <div class="item-info">
                        <div class="item-title">${investment.name}</div>
                        <div class="item-details">${investment.type} | Invested: ₹${formatCurrency(investment.amount)} | Current: ₹${formatCurrency(investment.currentValue)} | <span style="color: var(--${returnClass})">Returns: ₹${formatCurrency(returns)} (${returnPercent.toFixed(2)}%)</span></div>
                    </div>
                    <div class="item-actions">
                        <button class="btn btn-small btn-danger" onclick="removeInvestment('${investment.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                investmentList.appendChild(investmentItem);
            });
        }

        function removeInvestment(investmentId) {
            clientData.investments = clientData.investments.filter(investment => investment.id !== investmentId);
            updateInvestmentList();
            autoSave();
            showAlert('Investment removed successfully!', 'success');
        }

        // Analytics and Widgets
        function updateAllCharts() {
            updateFinancialScore();
            updateSavingsRate();
            updateEmergencyFundMonths();
            showAlert('Analytics refreshed successfully!', 'success');
        }

        function updateFinancialScore() {
            // Simple financial health score calculation
            let score = 0;
            
            if (clientData.financialStatus) {
                // Savings rate contribution (30 points)
                const savingsRate = clientData.financialStatus.savingsRate || 0;
                score += Math.min(savingsRate * 1.5, 30);
                
                // Emergency fund contribution (25 points)
                const emergencyRatio = clientData.financialStatus.currentSavings / (clientData.financialStatus.emergencyFundNeeded || 1);
                score += Math.min(emergencyRatio * 25, 25);
                
                // Net worth contribution (25 points)
                const totalAssets = clientData.assets.reduce((sum, asset) => sum + asset.value, 0);
                const totalLiabilities = clientData.loans.reduce((sum, loan) => sum + loan.amount, 0);
                const netWorth = totalAssets - totalLiabilities;
                if (netWorth > 0) score += 25;
                
                // Investment contribution (20 points)
                if (clientData.investments.length > 0) score += 20;
            }
            
            document.getElementById('financial-score').textContent = Math.round(score);
        }

        function updateSavingsRate() {
            const savingsRate = clientData.financialStatus?.savingsRate || 0;
            document.getElementById('savings-rate').textContent = `${savingsRate.toFixed(1)}%`;
        }

        function updateEmergencyFundMonths() {
            if (clientData.financialStatus) {
                const months = clientData.financialStatus.currentSavings / (clientData.financialStatus.monthlyExpenses || 1);
                document.getElementById('emergency-fund-months').textContent = Math.round(months);
            }
        }

        // Utility Functions
        function formatCurrency(amount) {
            if (amount >= 10000000) {
                return (amount / 10000000).toFixed(2) + ' Cr';
            } else if (amount >= 100000) {
                return (amount / 100000).toFixed(2) + ' L';
            } else if (amount >= 1000) {
                return (amount / 1000).toFixed(0) + 'K';
            }
            return Math.round(amount).toLocaleString('en-IN');
        }

        function showAlert(message, type = 'success') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.style.cssText = `
                position: fixed;
                top: 2rem;
                right: 2rem;
                z-index: 10000;
                min-width: 300px;
                max-width: 450px;
                animation: slideIn 0.3s ease-out;
            `;
            alertDiv.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'danger' ? 'exclamation-triangle' : 'info-circle'}"></i>
                ${message}
                <button onclick="this.parentElement.remove()" style="float: right; background: none; border: none; color: inherit; font-size: 1.2em; cursor: pointer; padding: 0.25rem;">&times;</button>
            `;
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                if (alertDiv.parentElement) {
                    alertDiv.style.animation = 'slideOut 0.3s ease-in';
                    setTimeout(() => alertDiv.remove(), 300);
                }
            }, 4000);
        }

        // Chatbot Functions
        function toggleChatbot() {
            const chatbotWindow = document.getElementById('chatbot-window');
            isChatbotOpen = !isChatbotOpen;
            chatbotWindow.style.display = isChatbotOpen ? 'block' : 'none';
            
            if (isChatbotOpen && document.getElementById('chat-messages').children.length === 0) {
                addMessageToChat('bot', 'Hello! I\'m your Financial Assistant. I can help you with investment strategies, financial planning, tax optimization, and answer any questions about your financial journey. What would you like to know?');
            }
        }

        function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (message === '') return;

            // Add user message to chat
            addMessageToChat('user', message);
            
            // Clear input
            input.value = '';

            // Show typing indicator
            showTypingIndicator();

            // Simulate bot response with delay
            setTimeout(() => {
                hideTypingIndicator();
                const response = generateBotResponse(message);
                addMessageToChat('bot', response);
            }, 1500);
        }

        function addMessageToChat(sender, message) {
            const chatMessages = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}`;
            
            if (sender === 'bot') {
                messageDiv.innerHTML = `
                    <div class="message-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content">${message}</div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="message-content">${message}</div>
                    <div class="message-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                `;
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTypingIndicator() {
            const chatMessages = document.getElementById('chat-messages');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'chat-message bot typing-indicator';
            typingDiv.id = 'typing-indicator';
            typingDiv.innerHTML = `
                <div class="message-avatar">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="message-content">
                    <div class="typing-dots">
                        <span></span><span></span><span></span>
                    </div>
                </div>
            `;
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function hideTypingIndicator() {
            const typingIndicator = document.getElementById('typing-indicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        function generateBotResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            // Analyze user's financial data for personalized responses
            const hasFinancialData = clientData.financialStatus && clientData.financialStatus.monthlyIncome;
            const hasAssessment = clientData.assessmentResults && clientData.assessmentResults.personalityType;
            
            if (lowerMessage.includes('sip') || lowerMessage.includes('systematic investment')) {
                const monthlyCapacity = hasFinancialData ? clientData.financialStatus.monthlySavings : 10000;
                return `SIP is an excellent wealth-building strategy! ${hasFinancialData ? `Based on your monthly savings of ₹${formatCurrency(monthlyCapacity)}, you could start with a SIP of ₹${formatCurrency(monthlyCapacity * 0.7)} across diversified funds.` : 'I recommend starting with at least ₹5,000 monthly.'} ${hasAssessment ? `Given your ${clientData.assessmentResults.personalityType} profile, I can suggest specific fund categories that match your risk tolerance.` : 'Complete the assessment for personalized fund recommendations!'} Would you like me to calculate potential returns for different SIP amounts?`;
            }
            
            if (lowerMessage.includes('retirement') || lowerMessage.includes('retire')) {
                const age = hasFinancialData && clientData.basicInfo.age ? clientData.basicInfo.age : 30;
                const yearsToRetirement = 60 - age;
                return `Retirement planning is crucial for financial freedom! ${age ? `At ${age} years, you have approximately ${yearsToRetirement} years until retirement.` : ''} ${hasFinancialData ? `With your current monthly expenses of ₹${formatCurrency(clientData.financialStatus.monthlyExpenses)}, you'd need approximately ₹${formatCurrency(clientData.financialStatus.monthlyExpenses * 12 * 25)} as a retirement corpus (25x annual expenses rule).` : 'The general rule is to accumulate 25-30 times your annual expenses.'} Start early to leverage the power of compounding! Would you like me to create a detailed retirement plan?`;
            }
            
            if (lowerMessage.includes('tax') || lowerMessage.includes('80c') || lowerMessage.includes('saving tax')) {
                return `Smart tax planning can save you significant money! Under Section 80C, you can save up to ₹46,800 annually by investing ₹1.5 lakhs. Best options include ELSS mutual funds (equity returns + tax benefits), PPF (15-year lock-in), and EPF contributions. ${hasFinancialData && clientData.financialStatus.annualIncome ? `Based on your income level, you could be in the ${clientData.financialStatus.annualIncome > 1000000 ? '30%' : clientData.financialStatus.annualIncome > 500000 ? '20%' : '5%'} tax bracket.` : ''} Section 80D offers additional savings for health insurance premiums. Would you like a detailed tax optimization strategy?`;
            }
            
            if (lowerMessage.includes('emergency') || lowerMessage.includes('fund')) {
                const emergencyNeeded = hasFinancialData ? clientData.financialStatus.emergencyFundNeeded : 300000;
                const currentSavings = hasFinancialData ? clientData.financialStatus.currentSavings : 0;
                return `An emergency fund is your financial safety net! ${hasFinancialData ? `You need ₹${formatCurrency(emergencyNeeded)} (6 months of expenses). You currently have ₹${formatCurrency(currentSavings)}, so you need ₹${formatCurrency(Math.max(0, emergencyNeeded - currentSavings))} more.` : 'Aim for 6-12 months of expenses in easily accessible accounts.'} Keep this in liquid funds, savings accounts, or short-term FDs. Build this before investing in market-linked products. Need help creating an emergency fund strategy?`;
            }
            
            if (lowerMessage.includes('insurance') || lowerMessage.includes('life insurance') || lowerMessage.includes('health insurance')) {
                const annualIncome = hasFinancialData ? clientData.financialStatus.annualIncome : 600000;
                return `Insurance is crucial for financial protection! Life insurance should be 10-15 times your annual income. ${hasFinancialData ? `For your income of ₹${formatCurrency(annualIncome)}, consider ₹${formatCurrency(annualIncome * 12)} life coverage.` : 'For most people, ₹50-75 lakhs is a good starting point.'} Health insurance should be minimum ₹5 lakhs per family member, preferably ₹10+ lakhs in metro cities. Term insurance is cost-effective for life cover. ${hasFinancialData && clientData.basicInfo.dependents ? `With ${clientData.basicInfo.dependents} dependents, adequate coverage is even more critical.` : ''} Want help calculating your exact insurance needs?`;
            }
            
            if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('hey')) {
                const name = hasFinancialData && clientData.basicInfo.name ? clientData.basicInfo.name : 'there';
                return `Hello ${name}! 👋 I'm your Financial Assistant, here to help you make informed financial decisions. ${hasAssessment ? `I see you're a ${clientData.assessmentResults.personalityType} - great choice completing the assessment!` : ''} ${hasFinancialData ? `I have access to your financial profile and can provide personalized advice.` : 'Complete your financial profile for personalized recommendations.'} I can help with investment strategies, retirement planning, tax optimization, insurance planning, and answer any financial questions. What would you like to explore today?`;
            }
            
            if (lowerMessage.includes('help') || lowerMessage.includes('what can you do')) {
                return `I'm here to be your comprehensive financial guide! 🎯 Here's how I can help:\n\n💡 **Investment Advice**: SIP strategies, mutual funds, stocks, asset allocation\n📊 **Financial Planning**: Goal-based planning, retirement strategies\n💰 **Tax Optimization**: 80C, 80D, tax-saving investments\n🛡️ **Insurance Planning**: Life & health insurance calculations\n📈 **Portfolio Analysis**: Risk assessment, rebalancing strategies\n🏦 **Banking**: Emergency funds, loan optimization\n📚 **Financial Education**: Concepts, strategies, market insights\n\nJust ask me anything about your financial journey - I'll provide personalized advice based on your profile!`;
            }
            
            // Default personalized response
            const personalizedGreeting = hasFinancialData && clientData.basicInfo.name ? `Hi ${clientData.basicInfo.name}! ` : 'Hello! ';
            return `${personalizedGreeting}That's a great question about financial planning! ${hasAssessment ? `Based on your ${clientData.assessmentResults.personalityType} profile, ` : ''}I'd recommend focusing on building a diversified portfolio aligned with your risk tolerance and financial goals. ${hasFinancialData ? `With your current financial situation, we can create a customized strategy for wealth building.` : 'Complete your financial profile for personalized recommendations.'} Feel free to ask about specific areas like SIP planning, tax saving, retirement planning, insurance, or any other financial topics. I'm here to help you make informed decisions! 💪`;
        }

        function handleChatKeyPress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        // Settings Functions
        function showSettingsModal() {
            document.getElementById('settings-modal').style.display = 'flex';
            loadCurrentSettings();
        }

        function hideSettingsModal() {
            document.getElementById('settings-modal').style.display = 'none';
        }

        function loadCurrentSettings() {
            document.getElementById('currency-setting').value = clientData.settings?.currency || 'INR';
            document.getElementById('default-inflation').value = clientData.settings?.defaultInflation || 6;
        }

        function saveSettings() {
            clientData.settings = {
                currency: document.getElementById('currency-setting').value,
                defaultInflation: parseFloat(document.getElementById('default-inflation').value),
                autoSaveInterval: 60
            };
            
            autoSave();
            hideSettingsModal();
            showAlert('Settings saved successfully!', 'success');
        }

        function loadSettings() {
            const savedSettings = localStorage.getItem('financialPlannerSettings');
            if (savedSettings) {
                clientData.settings = { ...clientData.settings, ...JSON.parse(savedSettings) };
            }
        }

        // Modal Functions
        function showProfileModal() {
            document.getElementById('save-profile-modal').style.display = 'flex';
            document.getElementById('profile-name-input').focus();
        }

        function hideProfileModal() {
            document.getElementById('save-profile-modal').style.display = 'none';
            document.getElementById('profile-name-input').value = '';
            document.getElementById('profile-description').value = '';
        }

        function showExportModal() {
            document.getElementById('export-modal').style.display = 'flex';
        }

        function hideExportModal() {
            document.getElementById('export-modal').style.display = 'none';
        }

        function showImportModal() {
            document.getElementById('import-data-modal').style.display = 'flex';
        }

        function hideImportModal() {
            document.getElementById('import-data-modal').style.display = 'none';
        }

        function saveCurrentProfile() {
            if (currentProfileId) {
                autoSave();
                showAlert('Profile updated successfully!', 'success');
            } else {
                showProfileModal();
            }
        }

        function saveProfile() {
            const profileName = document.getElementById('profile-name-input').value.trim();
            const profileDescription = document.getElementById('profile-description').value.trim();
            
            if (!profileName) {
                showAlert('Please enter a profile name', 'danger');
                return;
            }

            const profileId = Date.now().toString();
            const profiles = JSON.parse(localStorage.getItem('financialPlannerProfiles') || '{}');
            
            clientData.profileInfo = {
                name: profileName,
                description: profileDescription,
                createdDate: new Date().toISOString(),
                lastModified: new Date().toISOString()
            };

            profiles[profileId] = clientData;
            localStorage.setItem('financialPlannerProfiles', JSON.stringify(profiles));
            
            currentProfileId = profileId;
            hideProfileModal();
            showAlert(`Profile "${profileName}" saved successfully!`, 'success');
            updateHeaderProfileInfo();
        }

        function updateHeaderProfileInfo() {
            const profileInfo = clientData.profileInfo;
            const nameElement = document.getElementById('current-profile-name');
            
            if (profileInfo && profileInfo.name) {
                nameElement.textContent = profileInfo.name;
            } else {
                nameElement.textContent = 'Unsaved Profile';
            }
        }

        // Export Functions
        function exportCurrentData(format) {
            const dataToExport = {
                ...clientData,
                exportDate: new Date().toISOString(),
                version: '3.0',
                appName: 'Financial Planner Pro Million Dollar Edition'
            };
            
            if (format === 'json') {
                const dataStr = JSON.stringify(dataToExport, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(dataBlob);
                link.download = `financial_data_${clientData.profileInfo.name || 'profile'}_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                showAlert('Data exported successfully as JSON!', 'success');
            } else if (format === 'pdf') {
                showAlert('PDF export feature coming soon! This will generate a comprehensive financial report.', 'info');
            } else if (format === 'excel') {
                showAlert('Excel export feature coming soon! This will create a structured spreadsheet with all your data.', 'info');
            }
            
            hideExportModal();
        }

        // Import Functions
        function importFromFile() {
            const fileInput = document.getElementById('import-file-input');
            const file = fileInput.files[0];
            
            if (!file) {
                showAlert('Please select a file to import', 'danger');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (importedData.basicInfo || importedData.financialStatus || importedData.assets) {
                        // Merge imported data with current structure
                        clientData = { ...clientData, ...importedData };
                        
                        // Generate new profile ID
                        currentProfileId = Date.now().toString();
                        clientData.profileInfo.lastModified = new Date().toISOString();
                        
                        // Save imported profile
                        const profiles = JSON.parse(localStorage.getItem('financialPlannerProfiles') || '{}');
                        profiles[currentProfileId] = clientData;
                        localStorage.setItem('financialPlannerProfiles', JSON.stringify(profiles));
                        
                        hideImportModal();
                        showAlert('Data imported successfully! Profile has been created.', 'success');
                        loadClientData();
                        updateHeaderProfileInfo();
                    } else {
                        showAlert('Invalid file format. Please upload a valid Financial Planner Pro export file.', 'danger');
                    }
                } catch (error) {
                    showAlert('Error reading file. Please check if it\'s a valid JSON file.', 'danger');
                }
            };
            
            reader.readAsText(file);
        }

        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                // Visual feedback for file selection
                const uploadArea = document.querySelector('.file-upload');
                uploadArea.style.borderColor = '#00ff88';
                uploadArea.querySelector('.upload-text').textContent = `Selected: ${file.name}`;
                
                setTimeout(() => {
                    uploadArea.style.borderColor = '';
                    uploadArea.querySelector('.upload-text').textContent = 'Click to select or drag & drop your file here';
                }, 2000);
            }
        }

        function loadClientData() {
            // Load basic info
            if (clientData.basicInfo && clientData.basicInfo.name) {
                document.getElementById('client-name').value = clientData.basicInfo.name;
                document.getElementById('client-age').value = clientData.basicInfo.age;
                document.getElementById('client-occupation').value = clientData.basicInfo.occupation;
                document.getElementById('marital-status').value = clientData.basicInfo.maritalStatus;
                document.getElementById('dependents').value = clientData.basicInfo.dependents;
                document.getElementById('client-city').value = clientData.basicInfo.city;
                displayBasicInfo();
            }

            // Load financial status
            if (clientData.financialStatus && clientData.financialStatus.monthlyIncome) {
                document.getElementById('monthly-income').value = clientData.financialStatus.monthlyIncome;
                document.getElementById('monthly-expenses').value = clientData.financialStatus.monthlyExpenses;
                document.getElementById('current-savings').value = clientData.financialStatus.currentSavings;
                document.getElementById('annual-income').value = clientData.financialStatus.annualIncome;
                displayFinancialInfo();
                generateFinancialInsights();
            }

            // Load risk profile
            if (clientData.riskProfile && clientData.riskProfile.experience) {
                document.getElementById('investment-experience').value = clientData.riskProfile.experience;
                document.getElementById('risk-tolerance').value = clientData.riskProfile.tolerance;
                document.getElementById('investment-horizon').value = clientData.riskProfile.horizon;
                document.getElementById('monthly-investment').value = clientData.riskProfile.monthlyInvestment;
                displayRiskInfo();
            }

            // Load insurance profile
            if (clientData.insuranceProfile && Object.keys(clientData.insuranceProfile).length > 0) {
                if (clientData.insuranceProfile.currentLifeInsurance) document.getElementById('current-life-insurance').value = clientData.insuranceProfile.currentLifeInsurance;
                if (clientData.insuranceProfile.currentHealthInsurance) document.getElementById('current-health-insurance').value = clientData.insuranceProfile.currentHealthInsurance;
                if (clientData.insuranceProfile.familyExpenses) document.getElementById('family-expenses').value = clientData.insuranceProfile.familyExpenses;
                displayInsuranceInfo();
            }

            // Update lists and calculations
            updateAssetsList();
            updateLoansList();
            updateGoalsList();
            updateBudgetList();
            updateInvestmentList();
            updateNetWorth();
            updateHeaderProfileInfo();
            updateAllCharts();
        }

        // Placeholder functions for advanced features
        function generateInvestmentPlan() {
            showAlert('Generating personalized investment plan based on your profile...', 'info');
            setTimeout(() => {
                document.getElementById('investment-plan-results').innerHTML = `
                    <div class="card">
                        <div class="card-header">
                            <h4 class="card-title"><i class="fas fa-lightbulb"></i> Your Personalized Investment Plan</h4>
                        </div>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i> Based on your ${clientData.assessmentResults?.personalityType || 'profile'}, here's your recommended investment strategy:
                            <ul style="margin-top: 1rem; padding-left: 2rem;">
                                <li>🎯 Start with a monthly SIP of ₹${formatCurrency((clientData.financialStatus?.monthlySavings || 10000) * 0.7)}</li>
                                <li>📊 Diversify across large-cap, mid-cap, and debt funds</li>
                                <li>⏰ Maintain a long-term investment horizon</li>
                                <li>🔄 Review and rebalance quarterly</li>
                                <li>💰 Consider tax-saving ELSS funds for 80C benefits</li>
                            </ul>
                        </div>
                    </div>
                `;
                showAlert('Investment plan generated successfully!', 'success');
            }, 2000);
        }

        function generateQuickRecommendations() {
            showAlert('Quick recommendations feature is being enhanced. Coming soon!', 'info');
        }

        function analyzePortfolio() {
            showAlert('Portfolio analysis feature is being enhanced. Coming soon!', 'info');
        }

        function generateRebalancingPlan() {
            showAlert('Rebalancing plan feature is being enhanced. Coming soon!', 'info');
        }

        function generateSmartComparison() {
            showAlert('Smart product comparison feature is being enhanced. Coming soon!', 'info');
        }

        function compareSpecificProducts() {
            showAlert('Product comparison feature is being enhanced. Coming soon!', 'info');
        }

        function exportAnalytics() {
            showAlert('Analytics export feature is being enhanced. Coming soon!', 'info');
        }

        function generateDetailedReport() {
            showAlert('Detailed report generation feature is being enhanced. Coming soon!', 'info');
        }

        function downloadDetailedReport() {
            showAlert('PDF report download feature is being enhanced. Coming soon!', 'info');
        }

        function generateInvestmentReport() {
            showAlert('Investment report generation feature is being enhanced. Coming soon!', 'info');
        }

        function downloadInvestmentReport() {
            showAlert('Investment report download feature is being enhanced. Coming soon!', 'info');
        }

        function generateExecutiveSummary() {
            showAlert('Executive summary generation feature is being enhanced. Coming soon!', 'info');
        }

        function generateQuickInsights() {
            showAlert('Quick insights feature is being enhanced. Coming soon!', 'info');
        }

        function refreshAlerts() {
            showAlert('Financial alerts refreshed successfully!', 'success');
        }

        function configureAlerts() {
            showAlert('Alert configuration feature is being enhanced. Coming soon!', 'info');
        }

        function loadFinancialCalendar() {
            showAlert('Financial calendar feature is being enhanced. Coming soon!', 'info');
        }

        function addFinancialEvent() {
            showAlert('Add financial event feature is being enhanced. Coming soon!', 'info');
        }

        // Add CSS for typing indicator animation
        const typingCSS = `
            .typing-dots {
                display: inline-flex;
                gap: 4px;
                align-items: center;
            }
            .typing-dots span {
                width: 8px;
                height: 8px;
                border-radius: 50%;
                background: #aaa;
                animation: typing 1.4s infinite ease-in-out;
            }
            .typing-dots span:nth-child(2) {
                animation-delay: 0.2s;
            }
            .typing-dots span:nth-child(3) {
                animation-delay: 0.4s;
            }
            @keyframes typing {
                0%, 60%, 100% {
                    transform: translateY(0);
                    opacity: 0.5;
                }
                30% {
                    transform: translateY(-10px);
                    opacity: 1;
                }
            }
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
            .profile-status {
                color: #aaaaaa;
                margin-left: 0.5rem;
            }
        `;
        
        const styleSheet = document.createElement('style');
        styleSheet.textContent = typingCSS;
        document.head.appendChild(styleSheet);

    </script>
</body>
</html>
